# /console-leaks-logs - Browser Console Security Audit

**Description:** Visits a URL using Playwright MCP, monitors the browser console for errors, sensitive data leaks, and unnecessary logging, then generates a security audit report.

**Usage:** `/console-leaks-logs <url>`

**Example:** `/console-leaks-logs https://split.lease/listings`

---

## Instructions

You are tasked with auditing a webpage's browser console output for security issues, errors, and unnecessary logging using the **Playwright MCP**.

### Workflow Steps

**Step 1: Initialize Playwright Browser**

Use the `mcp-tool-specialist` subagent to invoke Playwright MCP:
1. Navigate to the provided URL using `mcp__playwright__browser_navigate`
2. Wait for the page to fully load (use `mcp__playwright__browser_wait_for` with appropriate timeout)

**Step 2: Capture Console Messages**

Use `mcp__playwright__browser_console_messages` to capture all console output:
- Set `level: "debug"` to capture ALL message levels (debug, info, warning, error)
- This ensures we don't miss any potentially sensitive logs

**Step 3: Analyze Console Output**

Categorize each console message into one of these categories:

#### Category 1: ERRORS
- JavaScript errors and exceptions
- Failed network requests
- Unhandled promise rejections
- React/framework errors
- Syntax errors

#### Category 2: SENSITIVE DATA LEAKS (CRITICAL)
Flag any console output containing:
- API keys, tokens, secrets (look for patterns like `sk_`, `pk_`, `api_key`, `token`, `secret`, `bearer`)
- User PII (emails, phone numbers, SSNs, addresses)
- Database IDs or internal identifiers exposed unnecessarily
- Session/auth data
- Passwords or credentials
- Credit card numbers or financial data
- Environment variables
- Internal URLs or IP addresses
- Stack traces exposing file paths or server structure

#### Category 3: UNNECESSARY LOGGING
- Debug statements left in production (`console.log`, `console.debug`)
- Verbose state dumps
- Development-only messages
- Performance timing logs not needed in production
- TODO/FIXME comments logged to console

#### Category 4: WARNINGS
- Deprecation warnings
- Performance warnings
- Accessibility warnings
- Framework-specific warnings

**Step 4: Take Screenshot**

Use `mcp__playwright__browser_take_screenshot` to capture the page state for reference.

**Step 5: Generate Report**

Create a markdown report at `.claude/plans/Documents/YYYYMMDDHHMMSS-console-audit-<sanitized-url>.md`

---

## Report Template

```markdown
# Console Security Audit Report

**URL:** {url}
**Audit Date:** {timestamp}
**Total Messages Captured:** {count}

---

## Summary

| Category | Count | Severity |
|----------|-------|----------|
| Errors | X | HIGH |
| Sensitive Data Leaks | X | CRITICAL |
| Unnecessary Logging | X | MEDIUM |
| Warnings | X | LOW |

**Overall Risk Level:** {CRITICAL | HIGH | MEDIUM | LOW | CLEAN}

---

## Critical Findings: Sensitive Data Leaks

{If any sensitive data was found, list each instance with:}
- **Type:** {API Key / PII / Token / etc.}
- **Message:** {sanitized snippet - DO NOT include actual sensitive values}
- **Recommendation:** {specific fix}

{If none: "No sensitive data leaks detected."}

---

## Errors

{List each error with:}
- **Level:** {error type}
- **Message:** {error message}
- **Potential Impact:** {description}

{If none: "No errors detected."}

---

## Unnecessary Logging

{List each unnecessary log with:}
- **Message:** {log content}
- **Recommendation:** Remove or gate behind `NODE_ENV !== 'production'`

{If none: "No unnecessary logging detected."}

---

## Warnings

{List each warning}

{If none: "No warnings detected."}

---

## Recommendations

1. {Prioritized list of actions to take}
2. {Based on findings}

---

## Screenshot

![Page Screenshot]({screenshot_path})

---

*Generated by /console-leaks-logs audit skill*
```

---

## Sensitive Data Detection Patterns

When analyzing console output, use these regex patterns to detect sensitive data:

```javascript
// API Keys / Tokens
/(?:api[_-]?key|apikey|api_secret|secret[_-]?key|access[_-]?token|auth[_-]?token|bearer)\s*[=:]\s*['"]?[\w-]{20,}/gi
/sk_(?:live|test)_[\w]{24,}/g  // Stripe secret keys
/pk_(?:live|test)_[\w]{24,}/g  // Stripe publishable keys
/eyJ[\w-]*\.eyJ[\w-]*\.[\w-]*/g  // JWT tokens

// Supabase
/(?:supabase|sb)[_-]?(?:key|secret|anon|service)/gi
/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9\.[\w-]+\.[\w-]+/g  // Supabase JWTs

// AWS
/AKIA[\w]{16}/g  // AWS Access Key ID
/(?:aws[_-]?secret|secret[_-]?access[_-]?key)\s*[=:]\s*['"]?[\w/+]{40}/gi

// Environment Variables
/process\.env\.[\w_]+/g
/import\.meta\.env\.[\w_]+/g

// PII
/\b[\w._%+-]+@[\w.-]+\.[A-Za-z]{2,}\b/g  // Email addresses
/\b\d{3}[-.]?\d{3}[-.]?\d{4}\b/g  // Phone numbers
/\b\d{3}[-]?\d{2}[-]?\d{4}\b/g  // SSN pattern
/\b\d{4}[-\s]?\d{4}[-\s]?\d{4}[-\s]?\d{4}\b/g  // Credit card pattern

// Internal/Debug Info
/(?:localhost|127\.0\.0\.1|192\.168\.\d+\.\d+|10\.\d+\.\d+\.\d+)/g  // Internal IPs
/\/(?:home|Users|var|etc|usr)\/[\w/.-]+/g  // File paths
```

---

## Important Notes

1. **MANDATORY**: Use `mcp-tool-specialist` subagent for ALL Playwright MCP calls
2. **Security**: Never include actual sensitive data values in the report - sanitize/redact them
3. **File naming**: Use timestamp prefix format `YYYYMMDDHHMMSS`
4. **Clean up**: Close the browser session after audit completes
5. **Multiple pages**: If the URL requires authentication or has dynamic content, note limitations in the report

---

## Example Output

For URL `https://split.lease/listings`:

```markdown
# Console Security Audit Report

**URL:** https://split.lease/listings
**Audit Date:** 2026-01-29 14:32:00 UTC
**Total Messages Captured:** 12

---

## Summary

| Category | Count | Severity |
|----------|-------|----------|
| Errors | 1 | HIGH |
| Sensitive Data Leaks | 0 | CRITICAL |
| Unnecessary Logging | 3 | MEDIUM |
| Warnings | 2 | LOW |

**Overall Risk Level:** MEDIUM

---

## Critical Findings: Sensitive Data Leaks

No sensitive data leaks detected.

---

## Errors

- **Level:** error
- **Message:** Failed to load resource: net::ERR_BLOCKED_BY_CLIENT
- **Potential Impact:** Ad blocker may be blocking analytics script

---

## Unnecessary Logging

- **Message:** "Listings loaded: 24 items"
- **Recommendation:** Remove or gate behind development environment check

- **Message:** "[DEBUG] Filter state: {category: 'all', priceRange: [0, 5000]}"
- **Recommendation:** Remove debug logging from production build

---

## Recommendations

1. Remove debug console.log statements before production deployment
2. Consider implementing a logging library with environment-based filtering

---

*Generated by /console-leaks-logs audit skill*
```

---

## Error Handling

- **Page load failure**: Report the error and include any console messages captured before failure
- **Timeout**: Increase wait time and retry once
- **Authentication required**: Note in report that page requires login
- **Empty console**: Report as clean with note that page may suppress console output

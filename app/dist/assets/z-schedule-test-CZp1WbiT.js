import{r as a,j as e,c as le}from"./client-BJVKzfAi.js";import{s as Z}from"./supabase-BoCLEw6R.js";import{f as ce}from"./listingDataFetcher-DGGxiGnp.js";import{A as re,c as de,H as he}from"./HostScheduleSelector-HOEnT3Yo.js";import{e as oe}from"./nightCalculations-BvAtd4RD.js";import{S as ue}from"./SearchScheduleSelector-KBnRs4ik.js";import{L as me}from"./ListingScheduleSelector-B9O1H-bT.js";import"./dataLookups-zG18yzis.js";import"./constants-CPVJY5eo.js";const $=13,ge={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},pe=re.reduce((s,r)=>(s[r.id]=r.display,s),{});function xe(){const[s,r]=a.useState([]),[d,N]=a.useState(!0),[h,g]=a.useState(null),[o,y]=a.useState(""),[S,u]=a.useState(null),[p,x]=a.useState({daysAvailable:[0,1,2,3,4,5,6],nightsAvailable:[]}),[M,f]=a.useState(null),[v,R]=a.useState($),[l,i]=a.useState("every-week"),[C,F]=a.useState(!1),[H,E]=a.useState("Frederick"),[W,b]=a.useState(!1),[k,_]=a.useState([]),[I,w]=a.useState(!0),[j,P]=a.useState([]),[z,L]=a.useState([]),[D,A]=a.useState(null),[O,n]=a.useState(null);a.useEffect(()=>{document.title="Schedule Test | Admin"},[]),a.useEffect(()=>{q(),Y()},[]);const G=a.useMemo(()=>oe(j),[j]),V=a.useMemo(()=>k.map(t=>pe[t]||t),[k]);async function q(){try{N(!0),g(null);const{data:t,error:c}=await Z.from("listing").select('_id, Name, "rental type", "Weeks offered"').eq("Deleted",!1).order("Name",{ascending:!0}).limit(500);if(c)throw c;r(t||[])}catch{g("Failed to load listings")}finally{N(!1)}}async function Y(){try{const t=await ce();f(t)}catch{f(null)}}const K=a.useCallback(async t=>{if(y(t),!t){u(null),x({daysAvailable:[0,1,2,3,4,5,6],nightsAvailable:[]});return}try{const{data:c,error:U}=await Z.from("listing").select(`
          _id,
          Name,
          "rental type",
          "Weeks offered",
          "ðŸ’°Nightly Host Rate for 2 nights",
          "ðŸ’°Nightly Host Rate for 3 nights",
          "ðŸ’°Nightly Host Rate for 4 nights",
          "ðŸ’°Nightly Host Rate for 5 nights",
          "ðŸ’°Weekly Host Rate",
          "ðŸ’°Monthly Host Rate",
          "ðŸ’°Damage Deposit",
          "ðŸ’°Cleaning Cost / Maintenance Fee",
          "ðŸ’°Unit Markup",
          "Nights_Available",
          "Nights Available (numbers)",
          "Days Available (List of Days)",
          "Minimum Nights",
          "Maximum Nights",
          " First Available",
          "Last Available",
          "Dates - Blocked",
          Active,
          Complete,
          Approved
        `).eq("_id",t).single();if(U)throw U;u(c),x(Ne(c))}catch{u(null),x({daysAvailable:[0,1,2,3,4,5,6],nightsAvailable:[]})}},[]),X=a.useCallback(t=>{const c=parseInt(t,10);R(Number.isNaN(c)?$:Math.max(c,1))},[]),J=a.useCallback(t=>{i(t)},[]),Q=a.useCallback(()=>{F(t=>!t)},[]),B=a.useCallback(t=>{E(t)},[]),ee=a.useCallback(()=>{b(t=>!t)},[]),se=a.useCallback(t=>{_(t);const c=de(t);w(c.isContiguous)},[]),te=a.useCallback(t=>{P(t)},[]),ae=a.useCallback(t=>{L(t)},[]),ne=a.useCallback(t=>{A(t)},[]),ie=a.useCallback(t=>{n(t)},[]);return{listings:s,listingsLoading:d,listingsError:h,selectedListingId:o,selectedListing:S,scheduleListing:p,zatConfig:M,reservationSpan:v,weekPattern:l,limitToFiveNights:C,activeUserLabel:H,hostSelectedNights:V,hostContiguity:I,searchSelectedDays:j,searchCheckInOut:G,listingSelectedDays:z,listingScheduleState:O,listingPriceBreakdown:D,showOptionSets:W,handleListingChange:K,handleReservationSpanChange:X,handleWeekPatternChange:J,handleLimitToggle:Q,handleUserChange:B,handleHostSelectionChange:se,handleSearchSelectionChange:te,handleListingSelectionChange:ae,handleListingPriceChange:ne,handleListingScheduleChange:ie,toggleOptionSets:ee}}function je(s){if(!s||!Array.isArray(s))return[0,1,2,3,4,5,6];const r=s.map(d=>ge[d]).filter(d=>d!==void 0);return r.length>0?r:[0,1,2,3,4,5,6]}function Ne(s){return s?{id:s._id,name:s.Name||"Untitled",rentalType:s["rental type"]||"Nightly",weeksOffered:s["Weeks offered"]||"Every week",unitMarkup:s["ðŸ’°Unit Markup"]||0,cleaningFee:s["ðŸ’°Cleaning Cost / Maintenance Fee"]||0,damageDeposit:s["ðŸ’°Damage Deposit"]||0,weeklyHostRate:s["ðŸ’°Weekly Host Rate"]||0,monthlyHostRate:s["ðŸ’°Monthly Host Rate"]||0,rate2Night:s["ðŸ’°Nightly Host Rate for 2 nights"]||0,rate3Night:s["ðŸ’°Nightly Host Rate for 3 nights"]||0,rate4Night:s["ðŸ’°Nightly Host Rate for 4 nights"]||0,rate5Night:s["ðŸ’°Nightly Host Rate for 5 nights"]||0,minimumNights:s["Minimum Nights"]||0,maximumNights:s["Maximum Nights"]||7,nightsAvailable:s.Nights_Available||s["Nights Available (numbers)"]||[],daysAvailable:je(s["Days Available (List of Days)"])}:{daysAvailable:[0,1,2,3,4,5,6],nightsAvailable:[]}}const ye=[{value:"every-week",label:"Every Week"},{value:"one-on-off",label:"1 Week On / 1 Off"},{value:"two-on-off",label:"2 On / 2 Off"},{value:"one-three-off",label:"1 On / 3 Off"}];function m(s){return typeof s!="number"||Number.isNaN(s)?"$0":`$${Math.round(s).toLocaleString()}`}function T(s){return!s||s.length===0?"None":s.join(", ")}function Se(){var z,L,D,A,O;const{listings:s,listingsLoading:r,listingsError:d,selectedListingId:N,selectedListing:h,scheduleListing:g,zatConfig:o,reservationSpan:y,weekPattern:S,limitToFiveNights:u,activeUserLabel:p,hostSelectedNights:x,hostContiguity:M,searchSelectedDays:f,searchCheckInOut:v,listingSelectedDays:R,listingScheduleState:l,listingPriceBreakdown:i,showOptionSets:C,handleListingChange:F,handleReservationSpanChange:H,handleWeekPatternChange:E,handleLimitToggle:W,handleUserChange:b,handleHostSelectionChange:k,handleSearchSelectionChange:_,handleListingSelectionChange:I,handleListingPriceChange:w,handleListingScheduleChange:j,toggleOptionSets:P}=xe();return r?e.jsx("div",{className:"zst-state",children:e.jsx("div",{className:"zst-state-card",children:"Loading schedule test data..."})}):d?e.jsx("div",{className:"zst-state",children:e.jsx("div",{className:"zst-state-card zst-state-card--error",children:d})}):e.jsxs("div",{className:"zst-page",children:[e.jsxs("header",{className:"zst-header",children:[e.jsx("h1",{children:"Schedule Test | Admin"}),e.jsx("p",{children:"Validate schedule selectors, pricing spans, and listing availability."})]}),e.jsxs("div",{className:"zst-container",children:[e.jsxs("aside",{className:"zst-sidebar",children:[e.jsxs("div",{className:"zst-card",children:[e.jsx("span",{className:"zst-card-title",children:"Test Context"}),e.jsx("label",{className:"zst-label",htmlFor:"zst-listing-select",children:"Listing"}),e.jsxs("select",{id:"zst-listing-select",className:"zst-select",value:N||"",onChange:n=>F(n.target.value),children:[e.jsx("option",{value:"",children:"Select listing"}),s.map(n=>e.jsx("option",{value:n._id,children:n.Name||n._id},n._id))]}),h&&e.jsxs("div",{className:"zst-meta",children:[e.jsxs("p",{children:[e.jsx("span",{children:"Name"}),h.Name||"Untitled"]}),e.jsxs("p",{children:[e.jsx("span",{children:"Rental Type"}),h["rental type"]||"Nightly"]}),e.jsxs("p",{children:[e.jsx("span",{children:"Weeks Offered"}),h["Weeks offered"]||"Every week"]}),e.jsxs("p",{children:[e.jsx("span",{children:"Min Nights"}),h["Minimum Nights"]??"n/a"]}),e.jsxs("p",{children:[e.jsx("span",{children:"Max Nights"}),h["Maximum Nights"]??"n/a"]})]})]}),e.jsxs("div",{className:"zst-card",children:[e.jsx("span",{className:"zst-card-title",children:"Controls"}),e.jsx("label",{className:"zst-label",htmlFor:"zst-reservation-span",children:"Reservation Span (Weeks)"}),e.jsx("input",{id:"zst-reservation-span",className:"zst-input",type:"number",min:"1",value:y,onChange:n=>H(n.target.value)}),e.jsx("label",{className:"zst-label",htmlFor:"zst-week-pattern",children:"Guest Pattern"}),e.jsx("select",{id:"zst-week-pattern",className:"zst-select",value:S,onChange:n=>E(n.target.value),children:ye.map(n=>e.jsx("option",{value:n.value,children:n.label},n.value))}),e.jsxs("label",{className:"zst-toggle",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:W}),"Limit Listing Selector to 5 Nights"]}),e.jsxs("label",{className:"zst-toggle",children:[e.jsx("input",{type:"checkbox",checked:C,onChange:P}),"Show Day/Night Option Sets"]})]}),e.jsxs("div",{className:"zst-card",children:[e.jsx("span",{className:"zst-card-title",children:"User Context"}),e.jsxs("div",{className:"zst-button-row",children:[e.jsx("button",{type:"button",className:`zst-button ${p==="Frederick"?"active":""}`,onClick:()=>b("Frederick"),children:"Log In as Frederick"}),e.jsx("button",{type:"button",className:`zst-button ${p==="Sharath"?"active":""}`,onClick:()=>b("Sharath"),children:"Log In as Sharath"})]}),e.jsx("div",{className:"zst-meta",children:e.jsxs("p",{children:[e.jsx("span",{children:"Active User"}),p]})})]}),e.jsxs("div",{className:"zst-card",children:[e.jsx("span",{className:"zst-card-title",children:"Price Configuration"}),o?e.jsxs("div",{className:"zst-meta",children:[e.jsxs("p",{children:[e.jsx("span",{children:"Full Time Discount"}),(o.fullTimeDiscount*100).toFixed(1),"%"]}),e.jsxs("p",{children:[e.jsx("span",{children:"Avg Days / Month"}),o.avgDaysPerMonth]}),e.jsxs("p",{children:[e.jsx("span",{children:"Weekly Markup"}),(o.weeklyMarkup*100).toFixed(1),"%"]}),e.jsxs("p",{children:[e.jsx("span",{children:"Site Markup"}),(o.overallSiteMarkup*100).toFixed(1),"%"]})]}):e.jsx("p",{className:"zst-muted",children:"Loading configuration..."})]})]}),e.jsxs("section",{className:"zst-main",children:[e.jsxs("div",{className:"zst-grid",children:[e.jsxs("div",{className:"zst-card",children:[e.jsx("span",{className:"zst-card-title",children:"Host Schedule Selector"}),e.jsx(he,{listing:g,onSelectionChange:k,showAlertsOnLive:!1,isLiveVersion:!1}),e.jsxs("div",{className:"zst-meta",children:[e.jsxs("p",{children:[e.jsx("span",{children:"Selected Nights"}),T(x)]}),e.jsxs("p",{children:[e.jsx("span",{children:"Contiguous"}),M?"Yes":"No"]})]})]}),e.jsxs("div",{className:"zst-card",children:[e.jsx("span",{className:"zst-card-title",children:"Search Schedule Selector"}),e.jsx(ue,{updateUrl:!1,weekPattern:S,onSelectionChange:_}),e.jsxs("div",{className:"zst-meta",children:[e.jsxs("p",{children:[e.jsx("span",{children:"Selected Days"}),T(f.map(n=>n.name))]}),e.jsxs("p",{children:[e.jsx("span",{children:"Check In"}),((z=v.checkIn)==null?void 0:z.name)||"n/a"]}),e.jsxs("p",{children:[e.jsx("span",{children:"Check Out"}),((L=v.checkOut)==null?void 0:L.name)||"n/a"]})]})]}),e.jsxs("div",{className:"zst-card",children:[e.jsx("span",{className:"zst-card-title",children:"Listing Schedule Selector"}),e.jsx(me,{listing:g,reservationSpan:y,limitToFiveNights:u,zatConfig:o,onSelectionChange:I,onPriceChange:w,onScheduleChange:j})]})]}),e.jsxs("div",{className:"zst-debug",children:[e.jsxs("div",{className:"zst-card",children:[e.jsx("span",{className:"zst-card-title",children:"Listing Selector Output"}),e.jsxs("div",{className:"zst-meta",children:[e.jsxs("p",{children:[e.jsx("span",{children:"Selected Days"}),T(R.map(n=>n.name))]}),e.jsxs("p",{children:[e.jsx("span",{children:"Check In Day"}),((D=l==null?void 0:l.checkInDay)==null?void 0:D.name)||"n/a"]}),e.jsxs("p",{children:[e.jsx("span",{children:"Check Out Day"}),((A=l==null?void 0:l.checkOutDay)==null?void 0:A.name)||"n/a"]}),e.jsxs("p",{children:[e.jsx("span",{children:"Selected Nights"}),((O=l==null?void 0:l.selectedNights)==null?void 0:O.length)??0]}),e.jsxs("p",{children:[e.jsx("span",{children:"Not Selected Days"}),T(((l==null?void 0:l.notSelectedDays)||[]).map(n=>n.first3Letters))]})]})]}),e.jsxs("div",{className:"zst-card",children:[e.jsx("span",{className:"zst-card-title",children:"Pricing Outputs"}),e.jsxs("div",{className:"zst-meta",children:[e.jsxs("p",{children:[e.jsx("span",{children:"Nightly Price"}),m((i==null?void 0:i.pricePerNight)||0)]}),e.jsxs("p",{children:[e.jsx("span",{children:"4 Week Rent"}),m((i==null?void 0:i.fourWeekRent)||0)]}),e.jsxs("p",{children:[e.jsx("span",{children:"Total Reservation"}),m((i==null?void 0:i.reservationTotal)||0)]}),e.jsxs("p",{children:[e.jsx("span",{children:"Initial Payment"}),m((i==null?void 0:i.initialPayment)||0)]}),e.jsxs("p",{children:[e.jsx("span",{children:"Damage Deposit"}),m((i==null?void 0:i.damageDeposit)||0)]}),e.jsxs("p",{children:[e.jsx("span",{children:"Cleaning Deposit"}),m((i==null?void 0:i.cleaningFee)||0)]})]})]}),C&&e.jsxs("div",{className:"zst-card",children:[e.jsx("span",{className:"zst-card-title",children:"Option Sets"}),e.jsxs("div",{className:"zst-meta",children:[e.jsxs("p",{children:[e.jsx("span",{children:"Nights Option Set"}),"Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, Saturday"]}),e.jsxs("p",{children:[e.jsx("span",{children:"Days Option Set"}),"Sunday, Monday, Tuesday, Wednesday, Thursday, Friday, Saturday"]})]})]})]})]})]})]})}const fe=le(document.getElementById("root"));fe.render(e.jsx(Se,{}));

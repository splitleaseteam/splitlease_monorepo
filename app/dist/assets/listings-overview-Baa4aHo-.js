import{r as c,j as e,c as pe}from"./client-BJVKzfAi.js";import{s as A}from"./supabase-BoCLEw6R.js";import{A as K}from"./AdminHeader-tCInZd3n.js";import"./auth-QZ4BJadW.js";import"./star-OtPMgcH9.js";import"./createLucideIcon-CgZZH2OU.js";import"./file-text-Bqp_Hw0X.js";import"./triangle-alert-Bp6DQQmR.js";import"./users-d0RSvnp4.js";import"./pen-line-Duo49k9O.js";import"./calendar-CDI4qHEX.js";import"./mail-CRbL90NL.js";import"./user-check-CoCGzn5Y.js";import"./dollar-sign-Dn2-KjNW.js";import"./send-C4mziT0-.js";import"./x-CrJVeoCh.js";const xe=[{code:"CONTACT_IN_DESC",label:"Sharing Contact Information in Description"},{code:"MISSING_PHOTOS",label:"Insufficient Photos (< 5)"},{code:"PRICING_ISSUE",label:"Pricing Below Market Rate"},{code:"INCOMPLETE_PROFILE",label:"Host Profile Incomplete"},{code:"ADDRESS_MISMATCH",label:"Address Verification Failed"},{code:"DUPLICATE_LISTING",label:"Possible Duplicate Listing"},{code:"POLICY_VIOLATION",label:"Policy Violation"},{code:"QUALITY_ISSUE",label:"Photo/Content Quality Issue"}],I={DEFAULT:1.75,MIN:1,MAX:3},H={COMPLETED:"Completed",IN_PROGRESS:"InProgress",DRAFT:"Draft",ARCHIVED:"Archived"},Y={AVAILABLE:"Available",UNAVAILABLE:"Unavailable",PENDING:"Pending"},fe=[{value:"all",label:"Show All"},{value:"active",label:"Active Only"},{value:"inactive",label:"Inactive Only"},{value:"showcase",label:"Showcase Only"},{value:"usability",label:"Usability Only"}],W={showOnlyAvailable:!1,completedListings:!1,notFinishedListings:!1,selectedBorough:"",selectedNeighborhood:"",searchQuery:"",startDate:null,endDate:null,showAllFilter:"all"},X=50;function Ne(s){return s.Deleted?H.ARCHIVED:s.Complete?H.COMPLETED:s.pending?H.DRAFT:H.IN_PROGRESS}function be(s){return s.Active?s.Approved?Y.AVAILABLE:Y.PENDING:Y.UNAVAILABLE}async function je(){const{data:s,error:o}=await A.from("zat_geo_borough_toplevel").select('_id, "Display Borough"').order('"Display Borough"');return o?(console.error("[ListingsOverview] Failed to fetch boroughs:",o),[]):s.map(l=>({id:l._id,name:l["Display Borough"]}))}async function ve(s=null){let o=A.from("zat_geo_hood_mediumlevel").select('_id, "Display", "Geo-Borough"').order('"Display"');s&&(o=o.eq('"Geo-Borough"',s));const{data:l,error:t}=await o;return t?(console.error("[ListingsOverview] Failed to fetch neighborhoods:",t),[]):l.map(n=>({id:n._id,name:n.Display,boroughId:n["Geo-Borough"]}))}async function ye({filters:s,page:o=1,pageSize:l=X}){let t=A.from("listing").select(`
      _id,
      "Name",
      "Description",
      "Host User",
      "Host email",
      "host name",
      "Host phone",
      "Location - Borough",
      "Location - Hood",
      "Nightly Host Rate for 1 night",
      "Nightly Host Rate for 3 nights",
      "Price Override",
      "Active",
      "Approved",
      "Complete",
      "pending",
      "Deleted",
      "isForUsability",
      "Showcase",
      "Features - Photos",
      "Features - Amenities In-Unit",
      "Errors",
      "Modified Date",
      "Created Date",
      "Listing Code OP"
    `,{count:"exact"});if(t=t.or('"Deleted".is.null,"Deleted".eq.false'),s.showOnlyAvailable&&(t=t.eq('"Active"',!0).eq('"Approved"',!0)),s.completedListings&&!s.notFinishedListings?t=t.eq('"Complete"',!0):s.notFinishedListings&&!s.completedListings&&(t=t.or('"Complete".is.null,"Complete".eq.false')),s.selectedBorough&&(t=t.eq('"Location - Borough"',s.selectedBorough)),s.selectedNeighborhood&&(t=t.eq('"Location - Hood"',s.selectedNeighborhood)),s.searchQuery){const a=`%${s.searchQuery}%`;t=t.or(`"Name".ilike.${a},"Host email".ilike.${a},"host name".ilike.${a},"Listing Code OP".ilike.${a}`)}s.showAllFilter==="active"?t=t.eq('"Active"',!0):s.showAllFilter==="inactive"?t=t.or('"Active".is.null,"Active".eq.false'):s.showAllFilter==="showcase"?t=t.eq('"Showcase"',!0):s.showAllFilter==="usability"&&(t=t.eq('"isForUsability"',!0)),s.startDate&&(t=t.gte('"Modified Date"',s.startDate.toISOString())),s.endDate&&(t=t.lte('"Modified Date"',s.endDate.toISOString()));const n=(o-1)*l;t=t.order('"Modified Date"',{ascending:!1}).range(n,n+l-1);const{data:m,error:x,count:h}=await t;return x?(console.error("[ListingsOverview] Failed to fetch listings:",x),{data:[],count:0,error:x}):{data:m||[],count:h||0,error:null}}function Ce(s,o,l){const t=new Map(o.map(m=>[m.id,m.name])),n=new Map(l.map(m=>[m.id,m.name]));return s.map(m=>({...m,boroughName:t.get(m["Location - Borough"])||"Unknown",neighborhoodName:n.get(m["Location - Hood"])||"Unknown"}))}async function U(s,o){const l={...o,"Modified Date":new Date().toISOString()},{data:t,error:n}=await A.from("listing").update(l).eq("_id",s).select().single();return n?(console.error("[ListingsOverview] Failed to update listing:",{id:s,changes:o,error:{code:n.code,message:n.message,details:n.details,hint:n.hint}}),{data:null,error:n}):{data:t,error:null}}async function Ae(s){const{error:o}=await A.from("listing").update({Deleted:!0,"Modified Date":new Date().toISOString()}).eq("_id",s);return o?(console.error("[ListingsOverview] Failed to delete listing:",o),{success:!1,error:o}):{success:!0,error:null}}async function Se(s,o){const{data:l,error:t}=await A.from("listing").select('"Errors"').eq("_id",s).single();if(t)return console.error("[ListingsOverview] Failed to fetch listing for error add:",t),{data:null,error:t};const n=(l==null?void 0:l.Errors)||[];if(n.includes(o))return{data:l,error:null};const m=[...n,o],{data:x,error:h}=await A.from("listing").update({Errors:m,"Modified Date":new Date().toISOString()}).eq("_id",s).select().single();return h?(console.error("[ListingsOverview] Failed to add error:",h),{data:null,error:h}):{data:x,error:null}}async function Le(s){const{data:o,error:l}=await A.from("listing").update({Errors:[],"Modified Date":new Date().toISOString()}).eq("_id",s).select().single();return l?(console.error("[ListingsOverview] Failed to clear errors:",l),{data:null,error:l}):{data:o,error:null}}async function De(s,o){const l=[];for(const t of s){const{data:n,error:m}=await A.from("listing").select('"Nightly Host Rate for 1 night", "Nightly Host Rate for 3 nights"').eq("_id",t).single();if(m){l.push({id:t,success:!1,error:m.message});continue}const x=n["Nightly Host Rate for 1 night"]||0,h=n["Nightly Host Rate for 3 nights"]||0,a=Math.round(x*o*100)/100,b=Math.round(h*o*100)/100,{error:f}=await A.from("listing").update({"Nightly Host Rate for 1 night":a,"Nightly Host Rate for 3 nights":b,"Modified Date":new Date().toISOString()}).eq("_id",t);f?l.push({id:t,success:!1,error:f.message}):l.push({id:t,success:!0,newNightly:a,new3Night:b})}return{results:l,successCount:l.filter(t=>t.success).length,failCount:l.filter(t=>!t.success).length}}function Ee(s,o,l){var t;return{id:s._id,uniqueId:s["Listing Code OP"]||((t=s._id)==null?void 0:t.slice(-8))||"N/A",name:s.Name||"Untitled Listing",description:s.Description||"",host:{id:s["Host User"],email:s["Host email"]||"",name:s["host name"]||"",phone:s["Host phone"]||""},location:{borough:s["Location - Borough"],displayBorough:o||"Unknown",neighborhood:s["Location - Hood"],displayNeighborhood:l||"Unknown"},pricing:{nightly:s["Nightly Host Rate for 1 night"]||0,override:s["Price Override"],calculated3Night:s["Nightly Host Rate for 3 nights"]||0},status:Ne(s),availability:be(s),usability:s.isForUsability||!1,active:s.Active||!1,showcase:s.Showcase||!1,photos:s["Features - Photos"]||[],photoCount:(s["Features - Photos"]||[]).length,features:s["Features - Amenities In-Unit"]||[],errors:s.Errors||[],modifiedAt:s["Modified Date"]?new Date(s["Modified Date"]):null,createdAt:s["Created Date"]?new Date(s["Created Date"]):null,_raw:s}}function we(){const[s,o]=c.useState({isChecking:!0,isAuthenticated:!1,isAdmin:!1,shouldRedirect:!1}),[l,t]=c.useState([]),[n,m]=c.useState([]),[x,h]=c.useState([]),[a,b]=c.useState(0),[f,w]=c.useState(1),[P,k]=c.useState(!0),[y,S]=c.useState(W),[C,L]=c.useState(!1),[O,j]=c.useState(!1),[T,D]=c.useState(null),[M,i]=c.useState({isOpen:!1,title:"",content:null}),[v,R]=c.useState(!1),[q,B]=c.useState(I.DEFAULT),F=c.useRef(null);c.useEffect(()=>{o({isChecking:!1,isAuthenticated:!0,isAdmin:!0,shouldRedirect:!1})},[]),c.useEffect(()=>{if(!s.isAuthenticated||!s.isAdmin||s.isChecking)return;(async()=>{try{const[d,g]=await Promise.all([je(),ve()]);t(d),m(g)}catch(d){console.error("[ListingsOverview] Failed to load reference data:",d),D("Failed to load reference data")}})()},[s.isAuthenticated,s.isAdmin,s.isChecking]);const E=c.useCallback(async(r=!0)=>{if(!(!s.isAuthenticated||!s.isAdmin)){L(!0),D(null);try{const d=r?1:f,{data:g,count:p,error:u}=await ye({filters:y,page:d,pageSize:X});if(u)throw u;const J=Ce(g,l,n).map(_=>Ee(_,_.boroughName,_.neighborhoodName));r?(h(J),w(1)):h(_=>[..._,...J]),b(p),k(g.length===X)}catch(d){console.error("[ListingsOverview] Load failed:",d),D("Failed to load listings")}finally{L(!1)}}},[y,f,l,n,s.isAuthenticated,s.isAdmin]);c.useEffect(()=>{if(!(!s.isAuthenticated||!s.isAdmin||s.isChecking)&&l.length!==0)return F.current&&clearTimeout(F.current),F.current=setTimeout(()=>{E(!0)},300),()=>{F.current&&clearTimeout(F.current)}},[y,l.length,s.isAuthenticated,s.isAdmin,s.isChecking]);const V=c.useCallback((r,d)=>{S(g=>{const p={...g,[r]:d};return r==="selectedBorough"&&(p.selectedNeighborhood=""),p})},[]),G=c.useCallback(()=>{S(W)},[]),$=c.useCallback(()=>{w(r=>r+1),E(!1)},[E]),Q=c.useCallback(async(r,d)=>{const{error:g}=await U(r,{isForUsability:d});g||h(p=>p.map(u=>u.id===r?{...u,usability:d}:u))},[]),z=c.useCallback(async(r,d)=>{const{error:g}=await U(r,{Active:d});g||h(p=>p.map(u=>u.id===r?{...u,active:d,availability:d?u.availability:"Unavailable"}:u))},[]),ee=c.useCallback(async(r,d)=>{const{error:g}=await U(r,{Showcase:d});g||h(p=>p.map(u=>u.id===r?{...u,showcase:d}:u))},[]),se=c.useCallback(async(r,d)=>{const g=l.find(u=>u.id===d);if(!g)return;const{error:p}=await U(r,{"Location - Borough":d,"Location - Hood":null});p||h(u=>u.map(N=>N.id===r?{...N,location:{...N.location,borough:d,displayBorough:g.name,neighborhood:null,displayNeighborhood:""}}:N))},[l]),te=c.useCallback(async(r,d)=>{const g=n.find(u=>u.id===d);if(!g)return;const{error:p}=await U(r,{"Location - Hood":d});p||h(u=>u.map(N=>N.id===r?{...N,location:{...N.location,neighborhood:d,displayNeighborhood:g.name}}:N))},[n]),oe=c.useCallback(r=>{window.open(`/view-split-lease/${r.id}`,"_blank")},[]),le=c.useCallback(r=>{i({isOpen:!0,title:r.name,content:{type:"description",listing:r}})},[]),ae=c.useCallback(r=>{i({isOpen:!0,title:`Pricing - ${r.name}`,content:{type:"pricing",listing:r}})},[]),ne=c.useCallback(r=>{i({isOpen:!0,title:`Errors - ${r.name}`,content:{type:"errors",listing:r}})},[]),ie=c.useCallback(async r=>{if(!window.confirm("Are you sure you want to delete this listing?"))return;const{success:d,error:g}=await Ae(r);d?(h(p=>p.filter(u=>u.id!==r)),b(p=>p-1)):console.error("[ListingsOverview] Delete failed:",g)},[]),re=c.useCallback(async(r,d)=>{const{data:g,error:p}=await Se(r,d);!p&&g&&h(u=>u.map(N=>N.id===r?{...N,errors:g.Errors||[]}:N))},[]),ce=c.useCallback(async r=>{const{error:d}=await Le(r);d||h(g=>g.map(p=>p.id===r?{...p,errors:[]}:p))},[]),de=c.useCallback(()=>{B(I.DEFAULT),R(!0)},[]),he=c.useCallback(()=>{R(!1)},[]),ue=c.useCallback(async r=>{if(x.length!==0){j(!0),R(!1);try{const d=x.map(u=>u.id),{successCount:g,failCount:p}=await De(d,r);i({isOpen:!0,title:"Price Increment Complete",content:{type:"priceResult",successCount:g,failCount:p,multiplier:r}}),E(!0)}catch(d){console.error("[ListingsOverview] Bulk price update failed:",d),D("Failed to update prices")}finally{j(!1)}}},[x,E]),me=c.useCallback(()=>{i({isOpen:!1,title:"",content:null})},[]),ge=c.useCallback(()=>{D(null),E(!0)},[E]);return{authState:s,boroughs:l,neighborhoods:n,listings:x,totalCount:a,hasMore:P,filters:y,isLoading:C,isProcessing:O,error:T,modalContent:M,isPriceModalOpen:v,customMultiplier:q,setCustomMultiplier:B,handleFilterChange:V,handleResetFilters:G,handleLoadMore:$,handleToggleUsability:Q,handleToggleActive:z,handleToggleShowcase:ee,handleBoroughChange:se,handleNeighborhoodChange:te,handleView:oe,handleSeeDescription:le,handleSeePrices:ae,handleSeeErrors:ne,handleDelete:ie,handleAddError:re,handleClearErrors:ce,handleOpenPriceModal:de,handleClosePriceModal:he,handleIncrementPrices:ue,closeModal:me,handleRetry:ge}}function ke({totalCount:s,isProcessing:o,onIncrementPrices:l}){return e.jsx("div",{className:"lo-page-header",children:e.jsxs("div",{className:"lo-header-content",children:[e.jsxs("h1",{className:"lo-page-title",children:["Listing Selection Dashboard - ",s," listings"]}),e.jsxs("div",{className:"lo-header-actions",children:[e.jsx("button",{className:"lo-btn lo-btn-secondary",onClick:()=>window.location.href="/_internal/quick-price",children:"Go to Quick Price"}),e.jsx("button",{className:"lo-btn lo-btn-secondary",onClick:()=>window.location.href="/_internal/modify-listings",children:"Modify Listings"}),e.jsx("button",{className:"lo-btn lo-btn-primary",onClick:l,disabled:o,children:o?"Processing...":"Increment Nightly Prices"})]})]})})}function Ie({filters:s,boroughs:o,neighborhoods:l,totalCount:t,onFilterChange:n,onResetFilters:m}){const x=s.selectedBorough?l.filter(a=>a.boroughId===s.selectedBorough):l,h=a=>a&&a instanceof Date?a.toISOString().split("T")[0]:"";return e.jsxs("div",{className:"lo-filter-panel",children:[e.jsxs("div",{className:"lo-filter-row",children:[e.jsx("div",{className:"lo-filter-group lo-toggle-group",children:e.jsxs("label",{className:"lo-toggle-label",children:[e.jsx("input",{type:"checkbox",className:"lo-toggle-input",checked:s.showOnlyAvailable,onChange:a=>n("showOnlyAvailable",a.target.checked)}),e.jsx("span",{className:"lo-toggle-slider"}),e.jsx("span",{className:"lo-toggle-text",children:"Show only Available"})]})}),e.jsx("div",{className:"lo-filter-group",children:e.jsx("select",{className:"lo-filter-select",value:s.showAllFilter,onChange:a=>n("showAllFilter",a.target.value),children:fe.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})}),e.jsx("div",{className:"lo-filter-group",children:e.jsxs("select",{className:"lo-filter-select",value:s.selectedBorough,onChange:a=>{n("selectedBorough",a.target.value),n("selectedNeighborhood","")},children:[e.jsx("option",{value:"",children:"Select Borough"}),o.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),e.jsx("div",{className:"lo-filter-group",children:e.jsxs("select",{className:"lo-filter-select",value:s.selectedNeighborhood,onChange:a=>n("selectedNeighborhood",a.target.value),disabled:!s.selectedBorough,children:[e.jsx("option",{value:"",children:"Select Neighborhood"}),x.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),e.jsxs("div",{className:"lo-filter-group lo-search-group",children:[e.jsx("input",{type:"text",className:"lo-search-input",placeholder:"Search by ID, host email, name...",value:s.searchQuery,onChange:a=>n("searchQuery",a.target.value)}),s.searchQuery&&e.jsx("button",{className:"lo-search-clear",onClick:()=>n("searchQuery",""),"aria-label":"Clear search",children:"×"})]})]}),e.jsxs("div",{className:"lo-filter-row",children:[e.jsxs("div",{className:"lo-filter-group lo-checkbox-group",children:[e.jsxs("label",{className:"lo-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.completedListings,onChange:a=>n("completedListings",a.target.checked)}),e.jsx("span",{children:"Completed listings"})]}),e.jsxs("label",{className:"lo-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.notFinishedListings,onChange:a=>n("notFinishedListings",a.target.checked)}),e.jsx("span",{children:"Not finished listings"})]})]}),e.jsxs("div",{className:"lo-filter-group lo-date-group",children:[e.jsx("span",{className:"lo-date-label",children:"Modified Between:"}),e.jsx("input",{type:"date",className:"lo-date-input",value:h(s.startDate),onChange:a=>n("startDate",a.target.value?new Date(a.target.value):null)}),e.jsx("span",{className:"lo-date-separator",children:"to"}),e.jsx("input",{type:"date",className:"lo-date-input",value:h(s.endDate),onChange:a=>n("endDate",a.target.value?new Date(a.target.value):null)})]}),e.jsx("div",{className:"lo-filter-group",children:e.jsx("button",{className:"lo-btn lo-btn-text",onClick:m,children:"Reset Filters"})}),e.jsx("div",{className:"lo-filter-group lo-results-count",children:e.jsxs("span",{children:[t," results"]})})]})]})}function Pe({listing:s,boroughs:o,neighborhoods:l,errorOptions:t,onToggleUsability:n,onToggleActive:m,onToggleShowcase:x,onBoroughChange:h,onNeighborhoodChange:a,onView:b,onSeeDescription:f,onSeePrices:w,onDelete:P,onAddError:k,onClearErrors:y,onSeeErrors:S}){const[C,L]=c.useState(""),O=i=>i?new Intl.DateTimeFormat("en-US",{month:"2-digit",day:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(i instanceof Date?i:new Date(i)):"N/A",j=i=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(i||0),T=l.filter(i=>i.boroughId===s.location.borough),D=i=>{const v=i.target.value;v&&(k(s.id,v),i.target.value="")},M=()=>{C.trim()&&(k(s.id,C.trim()),L(""))};return e.jsxs("div",{className:"lo-listing-row",children:[e.jsxs("div",{className:"lo-listing-col lo-listing-details",children:[e.jsx("h3",{className:"lo-listing-name",children:s.name}),e.jsxs("p",{className:"lo-listing-host",children:["Host: ",s.host.name]}),e.jsx("p",{className:"lo-listing-contact",children:s.host.phone}),e.jsx("p",{className:"lo-listing-contact",children:s.host.email}),e.jsxs("p",{className:"lo-listing-created",children:["Created: ",O(s.createdAt)]}),e.jsx("p",{className:"lo-listing-id",children:s.uniqueId}),e.jsxs("p",{className:"lo-listing-photos",children:[s.photoCount," photos"]})]}),e.jsxs("div",{className:"lo-listing-col lo-listing-features",children:[s.photos.length>0&&e.jsxs("div",{className:"lo-photo-thumbnails",children:[s.photos.slice(0,3).map((i,v)=>e.jsx("div",{className:"lo-photo-thumb",children:e.jsx("img",{src:i,alt:`Listing photo ${v+1}`})},v)),s.photos.length>3&&e.jsxs("span",{className:"lo-more-photos",children:["+",s.photos.length-3]})]}),e.jsxs("div",{className:"lo-features-list",children:[s.features.slice(0,3).map((i,v)=>e.jsx("span",{className:"lo-feature-tag",children:i},v)),s.features.length>3&&e.jsxs("span",{className:"lo-feature-more",children:["+",s.features.length-3," more"]})]})]}),e.jsxs("div",{className:"lo-listing-col lo-listing-toggles",children:[e.jsxs("label",{className:"lo-toggle-row",children:[e.jsx("span",{children:"Is Usability?"}),e.jsx("input",{type:"checkbox",checked:s.usability,onChange:i=>n(s.id,i.target.checked)})]}),e.jsxs("label",{className:"lo-toggle-row",children:[e.jsx("span",{children:"Active"}),e.jsx("input",{type:"checkbox",checked:s.active,onChange:i=>m(s.id,i.target.checked)})]}),e.jsxs("label",{className:"lo-toggle-row",children:[e.jsx("span",{children:"Showcase"}),e.jsx("input",{type:"checkbox",checked:s.showcase,onChange:i=>x(s.id,i.target.checked)})]}),e.jsxs("div",{className:"lo-status-badges",children:[e.jsx("span",{className:`lo-status-badge lo-status-${s.status.toLowerCase()}`,children:s.status}),e.jsx("span",{className:`lo-status-badge lo-avail-${s.availability.toLowerCase()}`,children:s.availability})]})]}),e.jsxs("div",{className:"lo-listing-col lo-listing-location",children:[e.jsxs("select",{className:"lo-location-select",value:s.location.borough||"",onChange:i=>h(s.id,i.target.value),children:[e.jsx("option",{value:"",children:"Select Borough"}),o.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),e.jsxs("select",{className:"lo-location-select",value:s.location.neighborhood||"",onChange:i=>a(s.id,i.target.value),disabled:!s.location.borough,children:[e.jsx("option",{value:"",children:"Select Neighborhood"}),T.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]}),e.jsxs("p",{className:"lo-location-display",children:[s.location.displayBorough,s.location.displayNeighborhood&&` / ${s.location.displayNeighborhood}`]})]}),e.jsxs("div",{className:"lo-listing-col lo-listing-pricing",children:[e.jsxs("div",{className:"lo-price-field",children:[e.jsx("label",{children:"Price Override"}),e.jsx("input",{type:"text",className:"lo-price-input",value:s.pricing.override?j(s.pricing.override):"—",readOnly:!0})]}),e.jsx("div",{className:"lo-price-display",children:e.jsxs("span",{children:["Nightly: ",j(s.pricing.nightly)]})}),e.jsx("div",{className:"lo-price-display",children:e.jsxs("span",{children:["3 nights: ",j(s.pricing.calculated3Night)]})})]}),e.jsxs("div",{className:"lo-listing-col lo-listing-actions",children:[e.jsx("button",{className:"lo-btn lo-btn-sm lo-btn-outline",onClick:()=>b(s),children:"View"}),e.jsx("button",{className:"lo-btn lo-btn-sm lo-btn-outline",onClick:()=>f(s),children:"Description"}),e.jsx("button",{className:"lo-btn lo-btn-sm lo-btn-outline",onClick:()=>w(s),children:"Prices"}),e.jsx("button",{className:"lo-btn lo-btn-sm lo-btn-danger",onClick:()=>P(s.id),children:"Delete"})]}),e.jsxs("div",{className:"lo-listing-col lo-listing-errors",children:[e.jsxs("select",{className:"lo-error-select",onChange:D,defaultValue:"",children:[e.jsx("option",{value:"",children:"Add preset error..."}),t.map(i=>e.jsx("option",{value:i.code,children:i.label},i.code))]}),e.jsxs("div",{className:"lo-custom-error",children:[e.jsx("input",{type:"text",placeholder:"Custom error...",value:C,onChange:i=>L(i.target.value),onKeyPress:i=>i.key==="Enter"&&M()}),e.jsx("button",{className:"lo-btn lo-btn-sm lo-btn-outline",onClick:M,disabled:!C.trim(),children:"Add"})]}),e.jsxs("div",{className:"lo-error-buttons",children:[e.jsx("button",{className:"lo-btn lo-btn-sm lo-btn-outline-danger",onClick:()=>y(s.id),disabled:s.errors.length===0,children:"Clear All"}),e.jsxs("button",{className:"lo-btn lo-btn-sm lo-btn-outline",onClick:()=>S(s),disabled:s.errors.length===0,children:["See (",s.errors.length,")"]})]})]})]})}function Oe({listings:s,boroughs:o,neighborhoods:l,errorOptions:t,isLoading:n,onToggleUsability:m,onToggleActive:x,onToggleShowcase:h,onBoroughChange:a,onNeighborhoodChange:b,onView:f,onSeeDescription:w,onSeePrices:P,onDelete:k,onAddError:y,onClearErrors:S,onSeeErrors:C,onLoadMore:L,hasMore:O}){return e.jsxs("div",{className:"lo-listings-table",children:[e.jsxs("div",{className:"lo-listings-header",children:[e.jsx("div",{className:"lo-header-col",children:"Listing Details"}),e.jsx("div",{className:"lo-header-col",children:"Features"}),e.jsx("div",{className:"lo-header-col",children:"Status"}),e.jsx("div",{className:"lo-header-col",children:"Location"}),e.jsx("div",{className:"lo-header-col",children:"Pricing"}),e.jsx("div",{className:"lo-header-col",children:"Actions"}),e.jsx("div",{className:"lo-header-col",children:"Errors"})]}),e.jsx("div",{className:"lo-listings-body",children:s.map(j=>e.jsx(Pe,{listing:j,boroughs:o,neighborhoods:l,errorOptions:t,onToggleUsability:m,onToggleActive:x,onToggleShowcase:h,onBoroughChange:a,onNeighborhoodChange:b,onView:f,onSeeDescription:w,onSeePrices:P,onDelete:k,onAddError:y,onClearErrors:S,onSeeErrors:C},j.id))}),O&&e.jsx("div",{className:"lo-load-more",children:e.jsx("button",{className:"lo-btn lo-btn-secondary",onClick:L,disabled:n,children:n?"Loading...":"Load More"})})]})}function Z(){return e.jsxs("div",{className:"lo-loading-state",children:[e.jsx("div",{className:"lo-spinner"}),e.jsx("p",{children:"Loading listings..."})]})}function Fe({error:s,onRetry:o}){return e.jsxs("div",{className:"lo-error-state",children:[e.jsx("div",{className:"lo-error-icon",children:"!"}),e.jsx("h2",{className:"lo-error-title",children:"Something went wrong"}),e.jsx("p",{className:"lo-error-text",children:s}),e.jsx("button",{className:"lo-btn lo-btn-primary",onClick:o,children:"Try Again"})]})}function Me({onClearFilters:s}){return e.jsxs("div",{className:"lo-empty-state",children:[e.jsx("p",{children:"No listings found matching your filters."}),e.jsx("button",{className:"lo-btn lo-btn-secondary",onClick:s,children:"Clear Filters"})]})}function Te({listing:s}){return e.jsxs("div",{className:"lo-modal-description",children:[e.jsx("h4",{children:"Description"}),e.jsx("p",{children:s.description||"No description provided."}),e.jsx("h4",{children:"Features"}),e.jsx("div",{className:"lo-features-list",children:s.features.length>0?s.features.map((o,l)=>e.jsx("span",{className:"lo-feature-tag",children:o},l)):e.jsx("p",{className:"lo-no-data",children:"No features listed."})}),e.jsx("h4",{children:"Host Information"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",s.host.name||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.host.email||"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Phone:"})," ",s.host.phone||"N/A"]})]})}function Re({listing:s}){const o=l=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(l||0);return e.jsxs("div",{className:"lo-modal-pricing",children:[e.jsxs("div",{className:"lo-price-row",children:[e.jsx("span",{children:"Nightly Rate:"}),e.jsx("strong",{children:o(s.pricing.nightly)})]}),e.jsxs("div",{className:"lo-price-row",children:[e.jsx("span",{children:"3 Nights Price:"}),e.jsx("strong",{children:o(s.pricing.calculated3Night)})]}),s.pricing.override&&e.jsxs("div",{className:"lo-price-row",children:[e.jsx("span",{children:"Price Override:"}),e.jsx("strong",{children:o(s.pricing.override)})]})]})}function _e({listing:s}){return e.jsx("div",{className:"lo-modal-errors",children:s.errors.length===0?e.jsx("p",{className:"lo-no-data",children:"No errors assigned to this listing."}):e.jsx("ul",{className:"lo-errors-list",children:s.errors.map((o,l)=>e.jsx("li",{className:"lo-error-item",children:typeof o=="string"?o:o.code||o.message||JSON.stringify(o)},l))})})}function Ue({successCount:s,failCount:o,multiplier:l}){return e.jsxs("div",{className:"lo-modal-price-result",children:[e.jsxs("p",{children:["Successfully updated ",e.jsx("strong",{children:s})," listing(s)."]}),o>0&&e.jsxs("p",{className:"lo-warning",children:["Failed to update ",o," listing(s)."]}),e.jsxs("p",{children:["Prices have been multiplied by ",e.jsxs("strong",{children:[l,"x"]})]})]})}function Be({isOpen:s,onClose:o,title:l,children:t}){return s?e.jsx("div",{className:"lo-modal-overlay",onClick:o,children:e.jsxs("div",{className:"lo-modal",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"lo-modal-header",children:[e.jsx("h3",{className:"lo-modal-title",children:l}),e.jsx("button",{className:"lo-modal-close",onClick:o,"aria-label":"Close modal",children:"×"})]}),e.jsx("div",{className:"lo-modal-body",children:t})]})}):null}function He({isOpen:s,customMultiplier:o,onMultiplierChange:l,onConfirm:t,onCancel:n}){return s?e.jsx("div",{className:"lo-price-modal-overlay",children:e.jsxs("div",{className:"lo-price-modal",children:[e.jsx("h3",{children:"Bulk Price Increment"}),e.jsx("p",{children:"This will update prices for all currently visible listings."}),e.jsxs("div",{className:"lo-price-options",children:[e.jsxs("button",{className:"lo-btn lo-btn-primary",onClick:()=>t(I.DEFAULT),children:["Quick: ",I.DEFAULT,"x (",((I.DEFAULT-1)*100).toFixed(0),"% increase)"]}),e.jsxs("div",{className:"lo-custom-multiplier",children:[e.jsx("label",{children:"Custom Multiplier:"}),e.jsx("input",{type:"number",min:I.MIN,max:I.MAX,step:"0.05",value:o,onChange:m=>l(parseFloat(m.target.value)||I.DEFAULT)}),e.jsxs("button",{className:"lo-btn lo-btn-secondary",onClick:()=>t(o),children:["Apply ",o,"x"]})]})]}),e.jsx("div",{className:"lo-modal-actions",children:e.jsx("button",{className:"lo-btn lo-btn-text",onClick:n,children:"Cancel"})})]})}):null}function qe(){const{authState:s,boroughs:o,neighborhoods:l,listings:t,totalCount:n,hasMore:m,filters:x,isLoading:h,isProcessing:a,error:b,modalContent:f,isPriceModalOpen:w,customMultiplier:P,setCustomMultiplier:k,handleFilterChange:y,handleResetFilters:S,handleLoadMore:C,handleToggleUsability:L,handleToggleActive:O,handleToggleShowcase:j,handleBoroughChange:T,handleNeighborhoodChange:D,handleView:M,handleSeeDescription:i,handleSeePrices:v,handleSeeErrors:R,handleDelete:q,handleAddError:B,handleClearErrors:F,handleOpenPriceModal:E,handleClosePriceModal:V,handleIncrementPrices:G,closeModal:$,handleRetry:Q}=we();if(s.shouldRedirect)return e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsx("main",{className:"lo-main-content",children:e.jsx("div",{className:"lo-page",children:e.jsx(Z,{})})})]});const z=()=>{if(!f.content)return null;switch(f.content.type){case"description":return e.jsx(Te,{listing:f.content.listing});case"pricing":return e.jsx(Re,{listing:f.content.listing});case"errors":return e.jsx(_e,{listing:f.content.listing});case"priceResult":return e.jsx(Ue,{successCount:f.content.successCount,failCount:f.content.failCount,multiplier:f.content.multiplier});default:return null}};return e.jsxs(e.Fragment,{children:[e.jsx(K,{}),e.jsx("main",{className:"lo-main-content",children:e.jsxs("div",{className:"lo-page",children:[e.jsx(ke,{totalCount:n,isProcessing:a,onIncrementPrices:E}),e.jsxs("div",{className:"lo-container",children:[e.jsx(Ie,{filters:x,boroughs:o,neighborhoods:l,totalCount:n,onFilterChange:y,onResetFilters:S}),e.jsxs("div",{className:"lo-listings-section",children:[h&&t.length===0&&e.jsx(Z,{}),!h&&b&&e.jsx(Fe,{error:b,onRetry:Q}),!h&&!b&&t.length===0&&e.jsx(Me,{onClearFilters:S}),t.length>0&&e.jsx(Oe,{listings:t,boroughs:o,neighborhoods:l,errorOptions:xe,isLoading:h,onToggleUsability:L,onToggleActive:O,onToggleShowcase:j,onBoroughChange:T,onNeighborhoodChange:D,onView:M,onSeeDescription:i,onSeePrices:v,onDelete:q,onAddError:B,onClearErrors:F,onSeeErrors:R,onLoadMore:C,hasMore:m})]})]})]})}),e.jsx(Be,{isOpen:f.isOpen,onClose:$,title:f.title,children:z()}),e.jsx(He,{isOpen:w,customMultiplier:P,onMultiplierChange:k,onConfirm:G,onCancel:V})]})}const Ve=pe(document.getElementById("root"));Ve.render(e.jsx(qe,{}));

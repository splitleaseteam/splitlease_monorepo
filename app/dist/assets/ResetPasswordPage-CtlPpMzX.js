import{r as e,j as s}from"./client-BJVKzfAi.js";import{s as N}from"./supabase-BoCLEw6R.js";import{M as R}from"./auth-QZ4BJadW.js";import{H as E}from"./Header-BJKWma2V.js";import{F as T}from"./Footer-Bzf1rLKh.js";import"./constants-CPVJY5eo.js";import"./Toast-BQk6Nzgd.js";import"./proposalDataFetcher-CipdyWU2.js";import"./proposalStatuses-1Bj0NYR4.js";const b=({open:a})=>s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:a?s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),s.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),s.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})}),I=()=>{const n=new URLSearchParams(window.location.search).get("returnTo");return n&&n.startsWith("/")?n:"/"};function V(){const[a,n]=e.useState(""),[m,y]=e.useState(""),[l,i]=e.useState("loading"),[h,o]=e.useState(""),[w,g]=e.useState(!1),[x]=e.useState(I),[d,P]=e.useState(!1),[u,S]=e.useState(!1);e.useEffect(()=>{console.log("ResetPasswordPage: Initializing...");const r=!!window.location.hash,c=window.location.hash.includes("access_token"),f=window.location.hash.includes("type=recovery");console.log(`URL Check: Hash=${r}, Token=${c}, Type=${f}`),r||console.warn("No URL hash found. Ensure you clicked the link from the email.");const{data:{subscription:k}}=N.auth.onAuthStateChange((t,p)=>{console.log("Auth event:",t),t==="PASSWORD_RECOVERY"?(console.log("PASSWORD_RECOVERY event received"),i("ready")):t==="SIGNED_IN"&&(console.log("SIGNED_IN event - user has session"),i("ready"))});return N.auth.getSession().then(({data:{session:t},error:p})=>{if(p&&console.error("Session check error:",p),console.log("Checking existing session:",t?"found":"none"),t)i("ready");else{const C=setTimeout(()=>{i(j=>j==="loading"?(console.log("No session detected after timeout"),c&&f?(o("Verifying token... If this persists, please try clicking the link again."),"error"):(o("Invalid or expired reset link. Please request a new password reset."),"error")):j)},4e3);return()=>clearTimeout(C)}}),()=>{k.unsubscribe()}},[]);const v=async r=>{if(r.preventDefault(),o(""),a.length<4){o("Password must be at least 4 characters.");return}if(a!==m){o("Passwords do not match.");return}g(!0);const c=await R(a);c.success?(i("success"),setTimeout(()=>{window.location.href=x},2500)):o(c.error||"Failed to update password. Please try again."),g(!1)};return s.jsxs(s.Fragment,{children:[s.jsx(E,{}),s.jsx("main",{className:"reset-password-page",children:s.jsxs("div",{className:"reset-password-container",children:[s.jsx("h1",{children:"Reset Your Password"}),l==="loading"&&s.jsxs("div",{className:"loading-state",children:[s.jsx("div",{className:"spinner"}),s.jsx("p",{children:"Verifying reset link..."})]}),l==="error"&&s.jsxs("div",{className:"error-state",children:[s.jsx("p",{className:"error-message",children:h}),s.jsx("a",{href:"/signup-login",className:"btn-primary",children:"Back to Login"})]}),l==="ready"&&s.jsxs("form",{onSubmit:v,className:"reset-password-form",children:[h&&s.jsx("p",{className:"error-message",children:h}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"newPassword",children:"New Password"}),s.jsxs("div",{className:"password-input-wrapper",children:[s.jsx("input",{type:d?"text":"password",id:"newPassword",value:a,onChange:r=>n(r.target.value),placeholder:"Enter new password",required:!0,minLength:4,autoComplete:"new-password"}),s.jsx("button",{type:"button",className:"toggle-password-btn",onClick:()=>P(!d),"aria-label":d?"Hide password":"Show password",children:s.jsx(b,{open:d})})]})]}),s.jsxs("div",{className:"form-group",children:[s.jsx("label",{htmlFor:"confirmPassword",children:"Confirm Password"}),s.jsxs("div",{className:"password-input-wrapper",children:[s.jsx("input",{type:u?"text":"password",id:"confirmPassword",value:m,onChange:r=>y(r.target.value),placeholder:"Confirm new password",required:!0,autoComplete:"new-password"}),s.jsx("button",{type:"button",className:"toggle-password-btn",onClick:()=>S(!u),"aria-label":u?"Hide password":"Show password",children:s.jsx(b,{open:u})})]})]}),s.jsx("button",{type:"submit",className:"btn-primary btn-full-width",disabled:w,children:w?"Updating...":"Update Password"})]}),l==="success"&&s.jsxs("div",{className:"success-state",children:[s.jsx("div",{className:"success-icon",children:"âœ“"}),s.jsx("p",{className:"success-message",children:"Your password has been updated successfully!"}),s.jsx("p",{className:"redirect-notice",children:"Redirecting you back..."}),s.jsx("a",{href:x,className:"btn-primary",children:"Continue Now"})]})]})}),s.jsx(T,{})]})}export{V as default};

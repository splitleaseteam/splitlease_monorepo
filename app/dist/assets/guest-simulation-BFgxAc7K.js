import{r,j as e,c as J}from"./client-BJVKzfAi.js";/* empty css             */import{s as S,a as Q}from"./Toast-BQk6Nzgd.js";import{L as X,h as M}from"./auth-QZ4BJadW.js";import{s as N}from"./supabase-BoCLEw6R.js";import{A as $}from"./AdminHeader-tCInZd3n.js";import"./star-OtPMgcH9.js";import"./createLucideIcon-CgZZH2OU.js";import"./file-text-Bqp_Hw0X.js";import"./triangle-alert-Bp6DQQmR.js";import"./users-d0RSvnp4.js";import"./pen-line-Duo49k9O.js";import"./calendar-CDI4qHEX.js";import"./mail-CRbL90NL.js";import"./user-check-CoCGzn5Y.js";import"./dollar-sign-Dn2-KjNW.js";import"./send-C4mziT0-.js";import"./x-CrJVeoCh.js";const W={A:"pending",B:"pending",C:"pending",D:"disabled",E:"pending",F:"pending"};function Z(){const[b,w]=r.useState({isLoading:!1,isAuthenticated:!1,user:null}),[m,d]=r.useState(""),[c,i]=r.useState(""),[g,y]=r.useState(""),[a,p]=r.useState(0),[o,h]=r.useState(W),[n,x]=r.useState({userId:null,proposals:[],stepAResult:null,stepBResult:null,stepCResult:null,stepEResult:null,stepFResult:null}),[k,L]=r.useState(!1),[R,f]=r.useState(!1),[P,v]=r.useState(""),[D,j]=r.useState(null),F=r.useCallback(s=>{d(s.target.value),y("")},[]),B=r.useCallback(s=>{i(s.target.value),y("")},[]),I=r.useCallback(async s=>{s.preventDefault(),f(!0),y("");try{const t=await X(m,c);t.success?(w({isLoading:!1,isAuthenticated:!0,user:{userId:t.user_id,email:m,firstName:"User"}}),x(u=>({...u,userId:t.user_id})),S({title:"Login successful",type:"success"})):y(t.error||"Login failed. Please try again.")}catch(t){console.error("Login error:",t),y("An error occurred. Please try again.")}finally{f(!1)}},[m,c]),U=r.useCallback(async()=>{if(!k&&a===0){S({title:"Please confirm you are testing on mobile",type:"warning"});return}f(!0),v("Step A: Marking as usability tester..."),j(null);try{const s=n.userId||M();if(!s)throw new Error("User ID not found");const{error:t}=await N.from("user").update({"is usability tester":!0}).eq("_id",s);if(t)throw new Error(t.message);const u=new Date().toLocaleTimeString();x(C=>({...C,stepAResult:{success:!0,message:`Marked as tester at ${u}`}})),h(C=>({...C,A:"completed",B:"active"})),p(1),S({title:"Step A Complete",content:"Marked as usability tester",type:"success"}),console.log("✅ Step A completed")}catch(s){console.error("Step A failed:",s),j(s.message||"Failed to complete Step A"),x(t=>({...t,stepAResult:{success:!1,message:s.message}})),S({title:"Step A Failed",content:s.message,type:"error"})}finally{f(!1),v("")}},[k,a,n.userId]),q=r.useCallback(async()=>{if(o.B==="active"){f(!0),v("Step B: Creating test proposals..."),j(null);try{const s=n.userId||M();if(!s)throw new Error("User ID not found");const{data:t,error:u}=await N.from("listing").select('_id, Title, "Neighborhood (Text)"').eq("isForUsability",!0).eq("Active",!0).limit(2);if(u)throw new Error(u.message);if(!t||t.length<2)throw new Error("Not enough usability test listings found. Need at least 2 listings with isForUsability = true.");const C=t.slice(0,2).map(async(A,_)=>{const K={guest:s,listing:A._id,Status:"Suggested","Days of Week Count":7,check_in_day_index:0,check_out_day_index:6,"Reservation Length (weeks)":4,"Price Per Night (GC Guest pays)":150+_*25,isForUsability:!0},{data:Y,error:T}=await N.from("proposal").insert(K).select("_id, Status, listing").single();if(T)throw new Error(`Failed to create proposal ${_+1}: ${T.message}`);return Y}),l=await Promise.all(C),z=new Date().toLocaleTimeString();x(A=>({...A,proposals:l,stepBResult:{success:!0,message:`Created proposals ${l.map(_=>_._id).join(", ")} at ${z}`}})),h(A=>({...A,B:"completed",C:"active"})),p(2),S({title:"Step B Complete",content:`Created ${l.length} test proposals`,type:"success"}),console.log("✅ Step B completed:",l)}catch(s){console.error("Step B failed:",s),j(s.message||"Failed to complete Step B"),x(t=>({...t,stepBResult:{success:!1,message:s.message}})),S({title:"Step B Failed",content:s.message,type:"error"})}finally{f(!1),v("")}}},[o.B,n.userId]),V=r.useCallback(async()=>{if(o.C==="active"){f(!0),v("Step C: Applying host counteroffer..."),j(null);try{const s=n.proposals[0];if(!s)throw new Error("No proposals found from Step B");const t={Status:"Host Counter-Offered","hc_Days of Week Count":5,hc_check_in_day_index:1,hc_check_out_day_index:5,"hc_Price Per Night":175,"hc_Reservation Length":8},{error:u}=await N.from("proposal").update(t).eq("_id",s._id);if(u)throw new Error(u.message);const C=new Date().toLocaleTimeString();x(l=>({...l,stepCResult:{success:!0,message:`Counteroffer applied to proposal ${s._id} at ${C}`}})),h(l=>({...l,C:"completed",E:"active"})),p(4),S({title:"Step C Complete",content:"Counteroffer applied",type:"success"}),console.log("✅ Step C completed")}catch(s){console.error("Step C failed:",s),j(s.message||"Failed to complete Step C"),x(t=>({...t,stepCResult:{success:!1,message:s.message}})),S({title:"Step C Failed",content:s.message,type:"error"})}finally{f(!1),v("")}}},[o.C,n.proposals]),G=r.useCallback(async()=>{if(o.E==="active"){f(!0),v("Step E: Scheduling virtual meeting..."),j(null);try{const s=n.proposals[0];if(!s)throw new Error("No proposals found");const t={"virtual meeting":!0,"virtual meeting confirmed":!0,"virtual meeting date":new Date(Date.now()+24*60*60*1e3).toISOString()},{error:u}=await N.from("proposal").update(t).eq("_id",s._id);if(u)throw new Error(u.message);const C=new Date().toLocaleTimeString();x(l=>({...l,stepEResult:{success:!0,message:`Virtual meeting scheduled at ${C}`}})),h(l=>({...l,E:"completed",F:"active"})),p(5),S({title:"Step E Complete",content:"Virtual meeting scheduled",type:"success"}),console.log("✅ Step E completed")}catch(s){console.error("Step E failed:",s),j(s.message||"Failed to complete Step E"),x(t=>({...t,stepEResult:{success:!1,message:s.message}})),S({title:"Step E Failed",content:s.message,type:"error"})}finally{f(!1),v("")}}},[o.E,n.proposals]),H=r.useCallback(async()=>{if(o.F==="active"){f(!0),v("Step F: Accepting proposals..."),j(null);try{const{proposals:s}=n;if(!s||s.length===0)throw new Error("No proposals found");const t=s.map(l=>l._id),{error:u}=await N.from("proposal").update({Status:"Accepted"}).in("_id",t);if(u)throw new Error(u.message);const C=new Date().toLocaleTimeString();x(l=>({...l,stepFResult:{success:!0,message:`Both proposals accepted at ${C}`}})),h(l=>({...l,F:"completed"})),p(6),S({title:"Simulation Complete!",content:"Both proposals accepted",type:"success"}),console.log("✅ Step F completed - Simulation finished!")}catch(s){console.error("Step F failed:",s),j(s.message||"Failed to complete Step F"),x(t=>({...t,stepFResult:{success:!1,message:s.message}})),S({title:"Step F Failed",content:s.message,type:"error"})}finally{f(!1),v("")}}},[o.F,n.proposals]),O=r.useCallback(()=>{p(0),h(W),x(s=>({...s,proposals:[],stepAResult:null,stepBResult:null,stepCResult:null,stepEResult:null,stepFResult:null})),L(!1),j(null),S({title:"Simulation Reset",type:"info"})},[]);return{authState:b,loginEmail:m,loginPassword:c,loginError:g,currentStep:a,stepStatuses:o,simulationData:n,mobileConfirmed:k,isLoading:R,loadingMessage:P,error:D,handleEmailChange:F,handlePasswordChange:B,handleLogin:I,handleMobileConfirmChange:L,handleStepA:U,handleStepB:q,handleStepC:V,handleStepE:G,handleStepF:H,handleReset:O,clearError:()=>j(null)}}function ee({currentStep:b,stepStatuses:w}){const m=[{letter:"A",number:1,label:"Mark Tester"},{letter:"B",number:2,label:"Proposals"},{letter:"C",number:3,label:"Counteroffer"},{letter:"D",number:4,label:"Email"},{letter:"E",number:5,label:"Meeting"},{letter:"F",number:6,label:"Accept"}];return e.jsx("div",{className:"gsim-steps-container",children:m.map((d,c)=>{const i=w[d.letter],g=i==="completed",y=i==="active",a=i==="disabled";return e.jsxs("div",{className:"gsim-step-wrapper",children:[e.jsxs("div",{className:`gsim-step ${g?"completed":""} ${y?"active":""} ${a?"disabled":""}`,children:[e.jsx("div",{className:"gsim-step-indicator",children:g?e.jsx("svg",{className:"gsim-step-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}):a?e.jsxs("svg",{className:"gsim-step-disabled",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}):e.jsx("span",{className:"gsim-step-number",children:d.number})}),e.jsx("span",{className:"gsim-step-label",children:d.label})]}),c<m.length-1&&e.jsx("div",{className:"gsim-step-connector"})]},d.letter)})})}function se({email:b,password:w,error:m,isLoading:d,onEmailChange:c,onPasswordChange:i,onSubmit:g}){return e.jsx("div",{className:"gsim-login-section",children:e.jsxs("div",{className:"gsim-login-card",children:[e.jsxs("div",{className:"gsim-login-header",children:[e.jsx("h2",{children:"Sign In to Continue"}),e.jsx("p",{children:"Please log in to access the guest simulation"})]}),e.jsxs("form",{className:"gsim-login-form",onSubmit:g,children:[m&&e.jsxs("div",{className:"gsim-login-error",children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"15"})]}),e.jsx("span",{children:m})]}),e.jsxs("div",{className:"gsim-input-group",children:[e.jsx("label",{htmlFor:"login-email",children:"Email"}),e.jsx("input",{type:"email",id:"login-email",value:b,onChange:c,placeholder:"Enter your email",required:!0,disabled:d,autoComplete:"email"})]}),e.jsxs("div",{className:"gsim-input-group",children:[e.jsx("label",{htmlFor:"login-password",children:"Password"}),e.jsx("input",{type:"password",id:"login-password",value:w,onChange:i,placeholder:"Enter your password",required:!0,disabled:d,autoComplete:"current-password"})]}),e.jsx("button",{type:"submit",className:"gsim-btn gsim-btn-primary",disabled:d||!b||!w,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"gsim-btn-spinner"}),"Signing in..."]}):"Sign In"})]})]})})}function E({stepNumber:b,stepLetter:w,title:m,description:d,status:c,isActive:i,isLoading:g,onAction:y,buttonText:a,disabled:p,result:o}){const h=c==="completed",n=c==="disabled";return e.jsxs("div",{className:`gsim-step-card ${i?"active":""} ${h?"completed":""} ${n?"disabled":""}`,children:[e.jsxs("div",{className:"gsim-step-card-header",children:[e.jsx("div",{className:"gsim-step-card-badge",children:h?e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}):n?e.jsx("span",{className:"gsim-step-card-badge-disabled",children:"—"}):e.jsx("span",{children:b})}),e.jsx("div",{className:"gsim-step-card-title-section",children:e.jsxs("h3",{className:"gsim-step-card-title",children:["Step ",w,": ",m]})})]}),e.jsx("p",{className:"gsim-step-card-description",children:d}),e.jsx("div",{className:"gsim-step-card-actions",children:e.jsx("button",{className:`gsim-btn ${h?"gsim-btn-success":i?"gsim-btn-primary":"gsim-btn-secondary"}`,onClick:y,disabled:p||h||n,children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"gsim-btn-spinner"}),"Processing..."]}):h?e.jsxs(e.Fragment,{children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"16",height:"16",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),"Completed"]}):a})}),o&&e.jsxs("div",{className:`gsim-step-card-result ${o.success?"success":"error"}`,children:[o.success?e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}):e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),e.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"15"})]}),e.jsx("span",{children:o.message})]})]})}function te(){var F,B;const{authState:b,loginEmail:w,loginPassword:m,loginError:d,currentStep:c,stepStatuses:i,simulationData:g,mobileConfirmed:y,isLoading:a,loadingMessage:p,error:o,handleEmailChange:h,handlePasswordChange:n,handleLogin:x,handleMobileConfirmChange:k,handleStepA:L,handleStepB:R,handleStepC:f,handleStepE:P,handleStepF:v,handleReset:D,clearError:j}=Z();return b.isLoading?e.jsxs("div",{className:"gsim-page",children:[e.jsx($,{}),e.jsx("main",{className:"gsim-main",children:e.jsxs("div",{className:"gsim-loading",children:[e.jsx("div",{className:"gsim-loading__spinner"}),e.jsx("p",{children:"Loading..."})]})})]}):e.jsxs(Q,{children:[e.jsx($,{}),e.jsx("div",{className:"gsim-page",children:e.jsx("main",{className:"gsim-main",children:e.jsxs("div",{className:"gsim-container",children:[e.jsxs("header",{className:"gsim-header",children:[e.jsx("h1",{className:"gsim-title",children:"Guest Proposal Simulation (Day 1)"}),e.jsx("p",{className:"gsim-subtitle",children:"6-step usability testing simulation for the guest proposal flow"})]}),e.jsxs("div",{className:"gsim-warning-banner",children:[e.jsxs("svg",{className:"gsim-warning-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13",strokeLinecap:"round"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17",strokeLinecap:"round"})]}),e.jsx("span",{children:"Keep this page open during testing. Progress will be lost if you reload."})]}),!b.isAuthenticated&&e.jsx(se,{email:w,password:m,error:d,isLoading:a,onEmailChange:h,onPasswordChange:n,onSubmit:x}),b.isAuthenticated&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"gsim-user-info",children:[e.jsx("span",{className:"gsim-user-label",children:"Logged in as:"}),e.jsx("span",{className:"gsim-user-email",children:((F=b.user)==null?void 0:F.email)||((B=b.user)==null?void 0:B.firstName)||"User"})]}),o&&e.jsxs("div",{className:"gsim-error",children:[e.jsx("p",{children:o}),e.jsx("button",{onClick:j,type:"button",children:"Dismiss"})]}),c===0&&e.jsxs("div",{className:"gsim-mobile-confirm",children:[e.jsxs("label",{className:"gsim-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:y,onChange:I=>k(I.target.checked),disabled:a}),e.jsx("span",{children:"I'm testing on mobile"})]}),e.jsx("p",{className:"gsim-mobile-hint",children:"Check this box to confirm you are using a mobile device for testing."})]}),c>0&&e.jsx(ee,{currentStep:c,stepStatuses:i}),e.jsxs("div",{className:"gsim-steps-grid",children:[e.jsx(E,{stepNumber:1,stepLetter:"A",title:"Mark as Usability Tester",description:"Set your user account as a usability tester to enable test mode features.",status:i.A,isActive:c===0||i.A==="active",isLoading:a&&p.includes("Step A"),onAction:L,buttonText:"Mark as Tester",disabled:!y&&c===0,result:g.stepAResult}),e.jsx(E,{stepNumber:2,stepLetter:"B",title:"Receive 2 Suggested Proposals",description:"Create 2 test proposals linked to usability test listings.",status:i.B,isActive:i.B==="active",isLoading:a&&p.includes("Step B"),onAction:R,buttonText:"Create Proposals",disabled:i.B!=="active",result:g.stepBResult}),e.jsx(E,{stepNumber:3,stepLetter:"C",title:"Receive Counteroffer from Host",description:"Simulate receiving a host counter-offer with modified pricing.",status:i.C,isActive:i.C==="active",isLoading:a&&p.includes("Step C"),onAction:f,buttonText:"Apply Counteroffer",disabled:i.C!=="active",result:g.stepCResult}),e.jsx(E,{stepNumber:4,stepLetter:"D",title:"Email Response",description:"This step is not implemented in the original Bubble workflow.",status:"disabled",isActive:!1,isLoading:!1,onAction:null,buttonText:"Not Implemented",disabled:!0,result:null}),e.jsx(E,{stepNumber:5,stepLetter:"E",title:"Virtual Meeting from Host",description:"Simulate scheduling a virtual meeting with the host.",status:i.E,isActive:i.E==="active",isLoading:a&&p.includes("Step E"),onAction:P,buttonText:"Schedule Meeting",disabled:i.E!=="active",result:g.stepEResult}),e.jsx(E,{stepNumber:6,stepLetter:"F",title:"Acceptance of 2 Proposals",description:"Accept both test proposals to complete the simulation.",status:i.F,isActive:i.F==="active",isLoading:a&&p.includes("Step F"),onAction:v,buttonText:"Accept Proposals",disabled:i.F!=="active",result:g.stepFResult})]}),i.F==="completed"&&e.jsxs("div",{className:"gsim-complete",children:[e.jsx("div",{className:"gsim-complete-icon",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01",strokeLinecap:"round",strokeLinejoin:"round"})]})}),e.jsx("h2",{children:"Simulation Complete!"}),e.jsx("p",{children:"You have successfully completed the Day 1 guest proposal simulation."}),e.jsx("button",{className:"gsim-btn gsim-btn-secondary",onClick:D,disabled:a,children:"Reset & Start Over"})]}),a&&e.jsxs("div",{className:"gsim-loading-overlay",children:[e.jsx("div",{className:"gsim-loading__spinner"}),e.jsx("p",{children:p||"Processing..."})]})]})]})})})]})}const ie=J(document.getElementById("root"));ie.render(e.jsx(te,{}));

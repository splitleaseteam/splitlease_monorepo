import{r as u,j as e,c as ze,R as Fe}from"./client-BJVKzfAi.js";import{H as ne}from"./Header-BJKWma2V.js";import{F as le}from"./Footer-Bzf1rLKh.js";import{c as Ie,v as $e,k as Me,g as _e,i as ie}from"./auth-QZ4BJadW.js";import{s as I}from"./supabase-BoCLEw6R.js";import{i as re}from"./isHost-bTARCkET.js";import{s as H,a as He}from"./Toast-BQk6Nzgd.js";import{U as de}from"./user-C2rhnql4.js";import{C as he}from"./circle-check-big-42edTrxg.js";import{B as Ee}from"./briefcase-U9yY2xYz.js";import{C as Z}from"./chevron-up-BHVOGcSe.js";import{C as J,S as te}from"./star-OtPMgcH9.js";import{M as Ue}from"./mail-CRbL90NL.js";import{P as Be}from"./phone-JQItnCAU.js";import{c as X}from"./createLucideIcon-CgZZH2OU.js";import{E as ue}from"./external-link-CaRKhh-A.js";import{C as me}from"./clock-BT0kKcUb.js";import{C as ae}from"./calendar-CDI4qHEX.js";import{A as ge}from"./arrow-right-BZ6iPYHW.js";import{C as pe}from"./check-B34HRHn5.js";import{X as W}from"./x-CrJVeoCh.js";import{E as qe}from"./eye-J9MlnJAi.js";import{F as Y}from"./file-text-Bqp_Hw0X.js";import{F as Ve}from"./file-check-BoSUDexW.js";import{D as se}from"./dollar-sign-Dn2-KjNW.js";import{C as Ge}from"./circle-alert-C7SsrRDS.js";import{E as Oe}from"./ErrorBoundary-9_HbXv1y.js";/* empty css             */import"./constants-CPVJY5eo.js";import"./proposalDataFetcher-CipdyWU2.js";import"./proposalStatuses-1Bj0NYR4.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],O=X("calendar-days",We);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]],Ze=X("receipt",Ye);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z",key:"emmmcr"}]],Xe=X("thumbs-up",Je);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z",key:"m61m77"}]],Qe=X("thumbs-down",Ke);function xe(t){return t?{...t,id:t._id||t.id,title:t.Name||t.title||t.name||"Unnamed Listing",name:t.Name||t.title||t.name||"Unnamed Listing",thumbnail:t["Cover Photo"]||t.thumbnail||t.cover_photo||null,neighborhood:t.Neighborhood||t.neighborhood||null}:null}function fe(t){return t?{...t,id:t._id,name:t["Name - Full"]||t.name||"Guest",firstName:t["Name - First"]||t.firstName||"Guest",email:t.email||null,phone:t["Phone Number"]||t.phone||null,profilePhoto:t["Profile Photo"]||t.profilePhoto||null,isVerified:t["user verified?"]||!1,hasIdVerification:!!t["Selfie with ID"],hasWorkVerification:!!t["Verify - Linked In ID"]}:null}function et(t){return t?{...t,id:t._id,agreementNumber:t["Agreement Number"],leaseStatus:t["Lease Status"],leaseSigned:t["Lease signed?"],listing:t.listing?xe(t.listing):null,listingId:t.Listing,guest:t.guest?fe(t.guest):null,guestId:t.Guest,hostId:t.Host,reservationStart:t["Reservation Period: Start"]||t["Move In Date"],reservationEnd:t["Reservation Period: End"]||t["Move-out"],firstPaymentDate:t["First Payment Date"],nextPaymentDueDate:t["Next Payment Due Date"],totalRent:t["Total Rent"],totalCompensation:t["Total Compensation"],paidToDate:t["Paid to Date from Guest"],contract:t.Contract,supplementalAgreement:t["supplemental agreement"],hostPayoutSchedule:t["Host Payout Schedule"]||null,periodicTenancyAgreement:t["Periodic Tenancy Agreement"]||null,createdDate:t["Created Date"],modifiedDate:t["Modified Date"],stays:(t.stays||[]).map(tt),paymentRecords:(t.paymentRecords||[]).map(at),dateChangeRequests:(t.dateChangeRequests||[]).map(st)}:null}function tt(t){return t?{id:t._id,leaseId:t.Lease,weekNumber:t["Week Number"],checkInNight:t["Check In (night)"],lastNight:t["Last Night (night)"],stayStatus:t["Stay Status"],reviewSubmittedByHost:t["Review Submitted by Host"]||!1,datesInPeriod:t["Dates - List of dates in this period"]||[]}:null}function at(t){return t?{id:t._id,leaseId:t["Booking - Reservation"],paymentNumber:t["Payment #"],scheduledDate:t["Scheduled Date"],actualDate:t["Actual Date"],rentAmount:t["Rent Amount"],maintenanceFee:t["Maintenance Fee"],damageDeposit:t["Damage Deposit"],totalAmount:t["Total Amount"],bankTransactionNumber:t["Bank Transaction Number"],paymentReceipt:t["Payment Receipt"],isPaid:t["Is Paid"],isRefunded:t["Is Refunded"]}:null}function st(t){return t?{id:t._id,leaseId:t.Lease,requestedById:t["Requested by"],requestReceiverId:t["Request receiver"],requestedByUser:t.requestedByUser?fe(t.requestedByUser):null,stayAssociated1:t["Stay Associated 1"],stayAssociated2:t["Stay Associated 2"],status:t.status,requestType:t["Request Type"],originalDate:t["Original Date"],requestedDate:t["Requested Date"],priceAdjustment:t["Price Adjustment"],createdDate:t["Created Date"]}:null}function nt(){const[t,a]=u.useState({isChecking:!0,isAuthenticated:!1,shouldRedirect:!1,userType:null}),[s,h]=u.useState(null),[n,c]=u.useState([]),[r,i]=u.useState(null),[m,g]=u.useState([]),[y,j]=u.useState(!0),[R,L]=u.useState(null),[P,w]=u.useState({}),[T,z]=u.useState(!1),[A,$]=u.useState(null),[M,D]=u.useState(!1),[C,F]=u.useState(null),[K,Q]=u.useState({});u.useEffect(()=>{async function o(){var l,d,p,b,N;try{if(!await Ie()){a({isChecking:!1,isAuthenticated:!1,shouldRedirect:!0,userType:null}),window.location.href="/";return}const S=await $e({clearOnFailure:!1});let v=null,k=null;if(S)v=S["User Type"]||S.userType,k=S,console.log("[HostLeases] User data loaded, userType:",v);else{const{data:{session:f}}=await I.auth.getSession();if(f!=null&&f.user){if(v=((l=f.user.user_metadata)==null?void 0:l.user_type)||Me()||null,console.log("[HostLeases] Using fallback session data, userType:",v),v&&re({userType:v})&&(k={userId:((d=f.user.user_metadata)==null?void 0:d.user_id)||ie()||f.user.id,_id:((p=f.user.user_metadata)==null?void 0:p.user_id)||ie()||f.user.id,firstName:((b=f.user.user_metadata)==null?void 0:b.first_name)||_e()||((N=f.user.email)==null?void 0:N.split("@")[0])||"Host",email:f.user.email,userType:v}),!v){console.log("[HostLeases] Cannot determine user type from session, redirecting"),a({isChecking:!1,isAuthenticated:!0,shouldRedirect:!0,userType:null}),window.location.href="/";return}}else{console.log("[HostLeases] No valid session, redirecting"),a({isChecking:!1,isAuthenticated:!1,shouldRedirect:!0,userType:null}),window.location.href="/";return}}if(!re({userType:v})){console.warn("[HostLeases] User is not a Host, redirecting..."),a({isChecking:!1,isAuthenticated:!1,shouldRedirect:!0,userType:v}),window.location.href="/";return}h(k),a({isChecking:!1,isAuthenticated:!0,shouldRedirect:!1,userType:v}),await V(k.userId||k._id)}catch(x){console.error("Auth check failed:",x),L("Authentication failed. Please log in again."),a({isChecking:!1,isAuthenticated:!1,shouldRedirect:!0,userType:null})}}o()},[]);const V=async o=>{j(!0),L(null);try{const l=await B(o);if(l.length>0){const d=l.map(xe);c(d);const b=new URLSearchParams(window.location.search).get("listingId");let N=d[0];if(b){const k=d.find(f=>f.id===b);k&&(N=k)}i(N);const x=await E(o,null),S={};x.forEach(k=>{const f=k.listingId;S[f]=(S[f]||0)+1}),Q(S);const v=x.filter(k=>k.listingId===N.id);g(v)}else c([]),g([])}catch(l){console.error("Failed to load host data:",l),L("Failed to load your listings and leases. Please try again.")}finally{j(!1)}},B=async o=>{try{console.log("[useHostLeasesPageLogic] Fetching listings for user:",o);const{data:l,error:d}=await I.rpc("get_host_listings",{host_user_id:o});if(d)throw console.error("[useHostLeasesPageLogic] Error fetching listings:",d),d;return console.log("[useHostLeasesPageLogic] Found listings:",(l==null?void 0:l.length)||0),l||[]}catch(l){return console.error("Failed to fetch listings:",l),[]}},E=async(o,l=null)=>{var d;try{console.log("[useHostLeasesPageLogic] Fetching leases for user:",o,"listing:",l);const{data:{session:p}}=await I.auth.getSession(),b=p==null?void 0:p.access_token;if(!b)throw console.error("[useHostLeasesPageLogic] No auth token available"),new Error("Authentication required");const N={hostUserId:o};l&&(N.listingId=l);const{data:x,error:S}=await I.functions.invoke("lease",{headers:{Authorization:`Bearer ${b}`},body:{action:"get_host_leases",payload:N}});if(S)throw console.error("[useHostLeasesPageLogic] Error fetching leases:",S),S;if(!(x!=null&&x.success))throw new Error((x==null?void 0:x.error)||"Failed to fetch leases");return console.log("[useHostLeasesPageLogic] Found leases:",((d=x.data)==null?void 0:d.length)||0),(x.data||[]).map(et)}catch(p){return console.error("Failed to fetch leases:",p),[]}},U=u.useCallback(async o=>{let l=o;if(typeof o=="string"&&(l=n.find(d=>d.id===o),!l)){console.warn("[useHostLeasesPageLogic] Listing not found:",o);return}i(l),j(!0),w({});try{const d=(s==null?void 0:s.userId)||(s==null?void 0:s._id),p=await E(d,l.id);g(p)}catch(d){console.error("Failed to load leases for listing:",d),L("Failed to load leases. Please try again.")}finally{j(!1)}},[n,s]),ye=u.useCallback((o,l)=>{w(d=>({...d,[o]:{...d[o],[l]:!0}}))},[]),Ne=u.useCallback((o,l)=>{w(d=>({...d,[o]:{...d[o],[l]:!1}}))},[]),ve=u.useCallback(o=>{w(l=>{var d;return{...l,[o]:{...l[o],allStays:!((d=l[o])!=null&&d.allStays)}}})},[]),we=u.useCallback(o=>{w(l=>{var d;return{...l,[o]:{...l[o],details:!((d=l[o])!=null&&d.details)}}})},[]),Se=u.useCallback(async o=>{try{console.log("[useHostLeasesPageLogic] Accepting date change request:",o);const{data:{session:l}}=await I.auth.getSession(),d=l==null?void 0:l.access_token,{data:p,error:b}=await I.functions.invoke("date-change-request",{headers:{Authorization:`Bearer ${d}`},body:{action:"accept",payload:{requestId:o}}});if(b)throw b;H({title:"Success",content:"Date change request accepted.",type:"success"});const N=(s==null?void 0:s.userId)||(s==null?void 0:s._id),x=await E(N,r==null?void 0:r.id);g(x)}catch(l){console.error("Failed to accept date change request:",l),H({title:"Error",content:"Failed to accept request. Please try again.",type:"error"})}},[s,r]),Ce=u.useCallback(async o=>{try{console.log("[useHostLeasesPageLogic] Declining date change request:",o);const{data:{session:l}}=await I.auth.getSession(),d=l==null?void 0:l.access_token,{data:p,error:b}=await I.functions.invoke("date-change-request",{headers:{Authorization:`Bearer ${d}`},body:{action:"decline",payload:{requestId:o}}});if(b)throw b;H({title:"Done",content:"Date change request declined.",type:"info"});const N=(s==null?void 0:s.userId)||(s==null?void 0:s._id),x=await E(N,r==null?void 0:r.id);g(x)}catch(l){console.error("Failed to decline date change request:",l),H({title:"Error",content:"Failed to decline request. Please try again.",type:"error"})}},[s,r]),ke=u.useCallback(o=>{$(o),z(!0)},[]),ee=u.useCallback(()=>{z(!1),$(null)},[]),De=u.useCallback(async o=>{if(!A){H({title:"Error",content:"No stay selected for review.",type:"error"});return}try{console.log("[useHostLeasesPageLogic] Submitting guest review:",o);const l=(s==null?void 0:s.userId)||(s==null?void 0:s._id),d=A.id,p=m.find(k=>{var f;return(f=k.stays)==null?void 0:f.some(Te=>Te.id===d)}),b=(p==null?void 0:p.guestId)||A.guestId;if(!b)throw new Error("Could not determine guest ID for review");const N=`${Date.now()}-${Math.random().toString(36).substring(2,9)}`,{error:x}=await I.from("mainreview").insert({_id:N,Reviewer:l,"Reviewee/Target":b,Stay:d,Lease:p==null?void 0:p.id,"Created By":l,type:"Host to Guest","Created Date":new Date().toISOString(),"Modified Date":new Date().toISOString(),"Rating Details":JSON.stringify({overallRating:o.overallRating,cleanlinessRating:o.cleanlinessRating||null,communicationRating:o.communicationRating||null,houseRulesRating:o.houseRulesRating||null,reviewText:o.reviewText||"",wouldRecommend:o.wouldRecommend??!0})});if(x)throw console.error("[useHostLeasesPageLogic] Error creating review:",x),new Error(`Failed to create review: ${x.message}`);const{error:S}=await I.from("bookings_stays").update({"Review Submitted by Host":N,"Modified Date":new Date().toISOString()}).eq("_id",d);S&&(console.error("[useHostLeasesPageLogic] Error updating stay:",S),console.warn("Review created but stay link update failed")),H({title:"Success",content:"Your review has been submitted!",type:"success"});const v=await E(l,r==null?void 0:r.id);g(v),ee()}catch(l){console.error("Failed to submit guest review:",l),H({title:"Error",content:l.message||"Failed to submit review. Please try again.",type:"error"})}},[A,s,m,r,ee]),Re=u.useCallback(o=>{F(o),D(!0)},[]),Le=u.useCallback(()=>{D(!1),F(null)},[]),Pe=u.useCallback((o,l)=>{let d=null,p="Document";switch(o){case"contract":d=l.contract,p="Lease Contract";break;case"supplemental":d=l.supplementalAgreement,p="Supplemental Agreement";break;case"payoutSchedule":d=l.hostPayoutSchedule,p="Payout Schedule";break;case"periodicTenancy":d=l.periodicTenancyAgreement,p="Periodic Tenancy Agreement";break;default:console.warn("Unknown document type:",o)}d?window.open(d,"_blank"):H({title:"Not Available",content:`${p} is not available yet.`,type:"info"})},[]),Ae=u.useCallback(()=>{s&&V(s.userId||s._id)},[s]);return{authState:t,user:s,listings:n,selectedListing:r,leases:m,isLoading:y,error:R,expandedSections:P,isReviewModalOpen:T,reviewTargetStay:A,isDateChangeModalOpen:M,selectedDateChangeRequest:C,leaseCountsByListing:K,handleListingChange:U,handleExpandSection:ye,handleCollapseSection:Ne,handleToggleShowAllStays:ve,handleToggleShowDetails:we,handleAcceptDateChangeRequest:Se,handleDeclineDateChangeRequest:Ce,handleOpenReviewModal:ke,handleCloseReviewModal:ee,handleSubmitGuestReview:De,handleViewDateChangeDetails:Re,handleCloseDateChangeModal:Le,handleOpenDocument:Pe,handleRetry:Ae}}function lt(t){if(t!=null&&t.thumbnail)return t.thumbnail;if(t!=null&&t.picture_url)return t.picture_url;if(t!=null&&t.Image)return t.Image;if(t!=null&&t.photo)return t.photo;const a=(t==null?void 0:t.title)||(t==null?void 0:t.name)||"Listing";return`https://ui-avatars.com/api/?name=${encodeURIComponent(a)}&background=E9E0F7&color=6D31C2&size=100`}function it({listings:t=[],selectedListingId:a,onListingChange:s,leaseCountsByListing:h={}}){return t!=null&&t.length?e.jsx("div",{className:"hl-listing-tabs",children:t.map(n=>{const c=n.id||n._id,r=c===a,i=h[c]??0,m=n.title||n.name||"Unnamed Listing",g=lt(n);return e.jsxs("button",{type:"button",className:`hl-listing-tab${r?" active":""}`,onClick:()=>s==null?void 0:s(c),"aria-pressed":r,"aria-label":`${m} - ${i} leases`,children:[e.jsx("img",{src:g,className:"hl-listing-tab-thumb",alt:"",loading:"lazy"}),e.jsx("span",{className:"hl-listing-tab-name",children:m}),i>0&&e.jsx("span",{className:"hl-listing-tab-count",children:i})]},c)})}):null}function _(t){return t==null||isNaN(t)?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}function oe(t){if(!t)return"";const a=new Date(t);if(isNaN(a.getTime()))return"";const s=a.getMonth()+1,h=a.getDate(),n=a.getFullYear().toString().slice(-2);return`${s}/${h}/${n}`}function q(t){if(!t)return"";const a=new Date(t);return isNaN(a.getTime())?"":a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function rt(t,a){if(!t||!a)return"";const s=new Date(t),h=new Date(a);if(isNaN(s.getTime())||isNaN(h.getTime()))return"";const n=s.toLocaleDateString("en-US",{month:"short"}),c=s.getDate(),r=h.toLocaleDateString("en-US",{month:"short"}),i=h.getDate(),m=h.getFullYear();return n===r?`${n} ${c} - ${i}, ${m}`:`${n} ${c} - ${r} ${i}, ${m}`}function je(t,a){if(!t||!a)return"";const s=new Date(t),h=new Date(a);if(isNaN(s.getTime())||isNaN(h.getTime()))return"";const n=s.toLocaleDateString("en-US",{month:"short"}),c=s.getDate(),r=h.toLocaleDateString("en-US",{month:"short"}),i=h.getDate();return n===r?`${n} ${c} - ${i}`:`${n} ${c} - ${r} ${i}`}function ot(t){if(!t)return"hl-status-badge";const a=t.toLowerCase();return a==="active"?"hl-status-badge hl-status-active":a==="completed"?"hl-status-badge hl-status-completed":a==="cancelled"?"hl-status-badge hl-status-cancelled":a.includes("pending")?"hl-status-badge hl-status-pending":"hl-status-badge"}function ct(t){if(!t)return"hl-stay-status-badge";const a=t.toLowerCase();return a==="upcoming"?"hl-stay-status-badge hl-stay-status-upcoming":a==="in progress"?"hl-stay-status-badge hl-stay-status-in-progress":a==="completed"?"hl-stay-status-badge hl-stay-status-completed":a==="cancelled"?"hl-stay-status-badge hl-stay-status-cancelled":"hl-stay-status-badge"}function be(t){if(!t)return"hl-dcr-status-badge";const a=t.toLowerCase();return a==="pending"?"hl-dcr-status-badge hl-dcr-status-pending":a==="accepted"?"hl-dcr-status-badge hl-dcr-status-accepted":a==="declined"?"hl-dcr-status-badge hl-dcr-status-declined":a==="cancelled"?"hl-dcr-status-badge hl-dcr-status-cancelled":"hl-dcr-status-badge"}function dt(t){if(!t)return"";const a=t.replace(/\D/g,"");return a.length===10?`(${a.slice(0,3)}) ${a.slice(3,6)}-${a.slice(6)}`:a.length===11&&a[0]==="1"?`+1 (${a.slice(1,4)}) ${a.slice(4,7)}-${a.slice(7)}`:t}function ht(t){if(t!=null&&t.profilePhoto)return t.profilePhoto;const a=(t==null?void 0:t.firstName)||(t==null?void 0:t.name)||"Guest";return`https://ui-avatars.com/api/?name=${encodeURIComponent(a)}&background=6C7FEB&color=FFFFFF&size=80`}function ut({guest:t,isExpanded:a=!1,onToggle:s}){if(!t)return e.jsx("div",{className:"hl-guest-section",children:e.jsxs("div",{className:"hl-guest-header",children:[e.jsx(de,{size:20}),e.jsx("span",{children:"Guest information not available"})]})});const{name:h,firstName:n,email:c,phone:r,profilePhoto:i,isVerified:m,hasIdVerification:g,hasWorkVerification:y}=t,j=h||n||"Guest",R=ht(t);return e.jsxs("div",{className:"hl-guest-section",children:[e.jsxs("div",{className:"hl-guest-header",onClick:s,role:"button",tabIndex:0,children:[e.jsxs("div",{className:"hl-guest-summary",children:[e.jsx("img",{src:R,alt:`${j}'s avatar`,className:"hl-guest-avatar"}),e.jsxs("div",{className:"hl-guest-name-badges",children:[e.jsx("span",{className:"hl-guest-name",children:j}),e.jsxs("div",{className:"hl-guest-badges",children:[(m||g)&&e.jsxs("span",{className:"hl-verification-badge hl-verified-id",title:"ID Verified",children:[e.jsx(he,{size:12}),"ID"]}),y&&e.jsxs("span",{className:"hl-verification-badge hl-verified-work",title:"Work Verified",children:[e.jsx(Ee,{size:12}),"Work"]})]})]})]}),e.jsx("button",{type:"button",className:"hl-guest-toggle","aria-expanded":a,"aria-label":a?"Hide contact details":"Show contact details",children:a?e.jsx(Z,{size:16}):e.jsx(J,{size:16})})]}),a&&e.jsxs("div",{className:"hl-guest-details",children:[c&&e.jsxs("div",{className:"hl-guest-contact-row",children:[e.jsx(Ue,{size:14}),e.jsx("a",{href:`mailto:${c}`,className:"hl-guest-email",children:c})]}),r&&e.jsxs("div",{className:"hl-guest-contact-row",children:[e.jsx(Be,{size:14}),e.jsx("a",{href:`tel:${r}`,className:"hl-guest-phone",children:dt(r)})]}),!c&&!r&&e.jsx("p",{className:"hl-guest-no-contact",children:"Contact details not available"})]})]})}function mt({payments:t=[]}){const[a,s]=u.useState(!1);if(!t||t.length===0)return null;const h=()=>s(!a),n=t.filter(i=>i.isPaid).reduce((i,m)=>i+(m.totalAmount||0),0),c=t.filter(i=>!i.isPaid).reduce((i,m)=>i+(m.totalAmount||0),0),r=t.filter(i=>i.isPaid).length;return e.jsxs("div",{className:"hl-payments-section",children:[e.jsxs("div",{className:"hl-payments-header",onClick:h,role:"button",tabIndex:0,children:[e.jsxs("div",{className:"hl-payments-title",children:[e.jsx(Ze,{size:18}),e.jsx("span",{children:"Payment Records"}),e.jsxs("span",{className:"hl-payments-summary",children:[r,"/",t.length," paid - ",_(n)," received"]})]}),e.jsx("button",{type:"button",className:"hl-payments-toggle","aria-expanded":a,"aria-label":a?"Hide payment records":"Show payment records",children:a?e.jsx(Z,{size:16}):e.jsx(J,{size:16})})]}),a&&e.jsx("div",{className:"hl-payments-table-wrapper",children:e.jsxs("table",{className:"hl-payments-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Scheduled"}),e.jsx("th",{children:"Actual"}),e.jsx("th",{children:"Rent"}),e.jsx("th",{children:"Maint. Fee"}),e.jsx("th",{children:"Deposit"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Status"})]})}),e.jsx("tbody",{children:t.map((i,m)=>e.jsxs("tr",{className:i.isPaid?"hl-payment-paid":"hl-payment-pending",children:[e.jsx("td",{children:i.paymentNumber||m+1}),e.jsx("td",{children:oe(i.scheduledDate)}),e.jsx("td",{children:i.actualDate?oe(i.actualDate):"-"}),e.jsx("td",{children:_(i.rentAmount)}),e.jsx("td",{children:_(i.maintenanceFee)}),e.jsx("td",{children:i.damageDeposit?_(i.damageDeposit):"-"}),e.jsx("td",{className:"hl-payment-total",children:_(i.totalAmount)}),e.jsx("td",{children:i.isPaid?e.jsxs("span",{className:"hl-payment-status hl-payment-status-paid",children:[e.jsx(he,{size:12}),"Paid",i.paymentReceipt&&e.jsx("a",{href:i.paymentReceipt,target:"_blank",rel:"noopener noreferrer",className:"hl-payment-receipt-link",title:"View receipt",onClick:g=>g.stopPropagation(),children:e.jsx(ue,{size:10})})]}):e.jsxs("span",{className:"hl-payment-status hl-payment-status-pending",children:[e.jsx(me,{size:12}),"Pending"]})})]},i.id||m))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:6,className:"hl-payment-footer-label",children:"Total"}),e.jsx("td",{className:"hl-payment-total",children:_(n+c)}),e.jsx("td",{})]})})]})})]})}function gt({stays:t=[],showAll:a=!1,onToggleShowAll:s,onOpenReview:h}){if(!t||t.length===0)return null;const n=a?t:t.slice(0,3),c=t.length>3;return e.jsxs("div",{className:"hl-stays-section",children:[e.jsx("div",{className:"hl-stays-header",children:e.jsxs("div",{className:"hl-stays-title",children:[e.jsx(ae,{size:18}),e.jsx("span",{children:"Stays"}),e.jsxs("span",{className:"hl-stays-count",children:["(",t.length," total)"]})]})}),e.jsx("div",{className:"hl-stays-table-wrapper",children:e.jsxs("table",{className:"hl-stays-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Week"}),e.jsx("th",{children:"Period"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:n.map((r,i)=>{var g;const m=((g=r.stayStatus)==null?void 0:g.toLowerCase())==="completed"&&!r.reviewSubmittedByHost;return e.jsxs("tr",{children:[e.jsx("td",{className:"hl-stay-week",children:r.weekNumber||i+1}),e.jsx("td",{className:"hl-stay-period",children:je(r.checkInNight,r.lastNight)}),e.jsx("td",{children:e.jsx("span",{className:ct(r.stayStatus),children:r.stayStatus||"Unknown"})}),e.jsx("td",{children:m?e.jsxs("button",{type:"button",className:"hl-btn hl-btn-small hl-btn-review",onClick:()=>h==null?void 0:h(r),children:[e.jsx(te,{size:12}),"Review Guest"]}):r.reviewSubmittedByHost?e.jsxs("span",{className:"hl-review-submitted",children:[e.jsx(te,{size:12,className:"hl-star-filled"}),"Reviewed"]}):null})]},r.id||i)})})]})}),c&&e.jsx("button",{type:"button",className:"hl-stays-toggle-all",onClick:s,children:a?e.jsxs(e.Fragment,{children:[e.jsx(Z,{size:14}),"Show Less"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{size:14}),"Show All ",t.length," Stays"]})})]})}function pt({requests:t=[],onAccept:a,onDecline:s,onViewDetails:h}){return!t||t.length===0?null:e.jsxs("div",{className:"hl-date-changes-section",children:[e.jsxs("div",{className:"hl-date-changes-header",children:[e.jsx(O,{size:18}),e.jsx("span",{children:"Date Change Requests"}),e.jsxs("span",{className:"hl-date-changes-count",children:["(",t.length,")"]})]}),e.jsx("div",{className:"hl-date-changes-list",children:t.map(n=>{var i,m,g;const c=((i=n.status)==null?void 0:i.toLowerCase())==="pending",r=((m=n.requestedByUser)==null?void 0:m.name)||((g=n.requestedByUser)==null?void 0:g.firstName)||"Guest";return e.jsxs("div",{className:"hl-date-change-item",children:[e.jsxs("div",{className:"hl-date-change-info",children:[e.jsxs("div",{className:"hl-date-change-requester",children:["Requested by ",e.jsx("strong",{children:r})]}),e.jsxs("div",{className:"hl-date-change-dates",children:[e.jsx("span",{className:"hl-date-change-original",children:q(n.originalDate)}),e.jsx(ge,{size:14}),e.jsx("span",{className:"hl-date-change-requested",children:q(n.requestedDate)})]}),n.priceAdjustment!=null&&n.priceAdjustment!==0&&e.jsxs("div",{className:"hl-date-change-price",children:["Price adjustment: ",_(n.priceAdjustment)]}),e.jsx("span",{className:be(n.status),children:n.status})]}),e.jsx("div",{className:"hl-date-change-actions",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:"hl-btn hl-btn-small hl-btn-accept",onClick:()=>a==null?void 0:a(n.id),title:"Accept request",children:[e.jsx(pe,{size:14}),"Accept"]}),e.jsxs("button",{type:"button",className:"hl-btn hl-btn-small hl-btn-decline",onClick:()=>s==null?void 0:s(n.id),title:"Decline request",children:[e.jsx(W,{size:14}),"Decline"]})]}):e.jsxs("button",{type:"button",className:"hl-btn hl-btn-small hl-btn-secondary",onClick:()=>h==null?void 0:h(n),title:"View details",children:[e.jsx(qe,{size:14}),"Details"]})})]},n.id)})})]})}function xt({contract:t,supplementalAgreement:a,hostPayoutSchedule:s,periodicTenancyAgreement:h,onOpenDocument:n}){const c=[{key:"contract",label:"Lease Contract",url:t,icon:Y,title:"View lease contract"},{key:"supplemental",label:"Supplemental Agreement",url:a,icon:Ve,title:"View supplemental agreement"},{key:"payoutSchedule",label:"Payout Schedule",url:s,icon:se,title:"View host payout schedule"},{key:"periodicTenancy",label:"Periodic Tenancy",url:h,icon:ae,title:"View periodic tenancy agreement"}];return c.some(r=>!!r.url),e.jsxs("div",{className:"hl-pdf-links-row",children:[e.jsxs("div",{className:"hl-pdf-links-title",children:[e.jsx(Y,{size:16}),e.jsx("span",{children:"Documents"})]}),e.jsx("div",{className:"hl-pdf-links",children:c.map(({key:r,label:i,url:m,icon:g,title:y})=>e.jsxs("button",{type:"button",className:`hl-pdf-link${m?"":" hl-pdf-link-disabled"}`,onClick:()=>n==null?void 0:n(r),title:m?y:`${i} not available`,"aria-label":m?y:`${i} not available`,children:[e.jsx(g,{size:14}),i,e.jsx(ue,{size:12})]},r))})]})}function ft({lease:t,expanded:a={},handlers:s}){const[h,n]=u.useState(!0);if(!t)return null;const{id:c,agreementNumber:r,leaseStatus:i,guest:m,reservationStart:g,reservationEnd:y,totalCompensation:j,stays:R=[],paymentRecords:L=[],dateChangeRequests:P=[],contract:w,supplementalAgreement:T,hostPayoutSchedule:z,periodicTenancyAgreement:A}=t,$=P.filter(C=>{var F;return((F=C.status)==null?void 0:F.toLowerCase())==="pending"}),M=$.length>0,D=()=>n(!h);return e.jsxs("div",{className:"hl-lease-card",children:[e.jsxs("div",{className:"hl-lease-card-header",onClick:D,children:[e.jsxs("div",{className:"hl-lease-card-header-left",children:[e.jsxs("h3",{className:"hl-lease-agreement-number",children:["Agreement #",r||"N/A"]}),e.jsx("span",{className:ot(i),children:i||"Unknown"}),M&&e.jsxs("span",{className:"hl-pending-badge",title:"Pending date change requests",children:[e.jsx(Ge,{size:14}),$.length," Pending"]})]}),e.jsxs("div",{className:"hl-lease-card-header-right",children:[e.jsxs("span",{className:"hl-lease-dates",children:[e.jsx(ae,{size:14}),rt(g,y)]}),e.jsxs("span",{className:"hl-lease-total",children:[e.jsx(se,{size:14}),_(j)]}),e.jsx("button",{type:"button",className:"hl-card-toggle","aria-expanded":h,"aria-label":h?"Collapse lease details":"Expand lease details",children:h?e.jsx(Z,{size:20}):e.jsx(J,{size:20})})]})]}),h&&e.jsxs("div",{className:"hl-lease-card-body",children:[e.jsx(ut,{guest:m,isExpanded:a.details,onToggle:()=>{var C;return(C=s.onToggleDetails)==null?void 0:C.call(s,c)}}),e.jsx(xt,{contract:w,supplementalAgreement:T,hostPayoutSchedule:z,periodicTenancyAgreement:A,onOpenDocument:C=>{var F;return(F=s.onOpenDocument)==null?void 0:F.call(s,C,t)}}),e.jsx(gt,{stays:R,showAll:a.allStays,onToggleShowAll:()=>{var C;return(C=s.onToggleAllStays)==null?void 0:C.call(s,c)},onOpenReview:s.onOpenReview}),e.jsx(mt,{payments:L}),P.length>0&&e.jsx(pt,{requests:P,onAccept:s.onAcceptDateChange,onDecline:s.onDeclineDateChange,onViewDetails:s.onViewDateChangeDetails})]})]})}function jt({listingName:t}){return e.jsxs("div",{className:"hl-empty-state",children:[e.jsx("div",{className:"hl-empty-state-icon","aria-hidden":"true",children:e.jsx(Y,{size:48,strokeWidth:1.5})}),e.jsx("h2",{className:"hl-empty-state-title",children:"No leases yet"}),e.jsx("p",{className:"hl-empty-state-text",children:t?`There are no active leases for ${t}.`:"You don't have any leases yet."}),e.jsx("p",{className:"hl-empty-state-hint",children:"Leases are created when a proposal is accepted and documents are signed."})]})}function G({value:t,onChange:a,label:s}){const[h,n]=u.useState(0);return e.jsxs("div",{className:"hl-star-rating",children:[e.jsx("label",{className:"hl-star-rating-label",children:s}),e.jsx("div",{className:"hl-stars",children:[1,2,3,4,5].map(c=>e.jsx("button",{type:"button",className:`hl-star ${c<=(h||t)?"hl-star-filled":""}`,onClick:()=>a(c),onMouseEnter:()=>n(c),onMouseLeave:()=>n(0),"aria-label":`${c} star${c!==1?"s":""}`,children:e.jsx(te,{size:24})},c))})]})}function bt({isOpen:t,stay:a,onClose:s,onSubmit:h}){const[n,c]=u.useState(0),[r,i]=u.useState(0),[m,g]=u.useState(0),[y,j]=u.useState(0),[R,L]=u.useState(""),[P,w]=u.useState(null),[T,z]=u.useState(!1);if(u.useEffect(()=>{t&&(c(0),i(0),g(0),j(0),L(""),w(null),z(!1))},[t]),!t)return null;const A=async D=>{if(D.preventDefault(),n!==0){z(!0);try{await h({stayId:a==null?void 0:a.id,overallRating:n,cleanlinessRating:r||null,communicationRating:m||null,houseRulesRating:y||null,reviewText:R.trim()||null,wouldRecommend:P})}finally{z(!1)}}},$=D=>{D.target===D.currentTarget&&s()},M=a?je(a.checkInNight,a.lastNight):"";return e.jsx("div",{className:"hl-modal-backdrop",onClick:$,children:e.jsxs("div",{className:"hl-modal hl-review-modal",role:"dialog","aria-modal":"true","aria-labelledby":"review-modal-title",children:[e.jsxs("div",{className:"hl-modal-header",children:[e.jsx("h2",{id:"review-modal-title",className:"hl-modal-title",children:"Review Guest"}),e.jsx("button",{type:"button",className:"hl-modal-close",onClick:s,"aria-label":"Close modal",children:e.jsx(W,{size:20})})]}),e.jsxs("form",{className:"hl-modal-body",onSubmit:A,children:[M&&e.jsxs("p",{className:"hl-review-stay-period",children:["Stay: Week ",a==null?void 0:a.weekNumber," (",M,")"]}),e.jsx("div",{className:"hl-review-section",children:e.jsx(G,{value:n,onChange:c,label:"Overall Rating *"})}),e.jsxs("div",{className:"hl-review-categories",children:[e.jsx(G,{value:r,onChange:i,label:"Cleanliness"}),e.jsx(G,{value:m,onChange:g,label:"Communication"}),e.jsx(G,{value:y,onChange:j,label:"Following House Rules"})]}),e.jsxs("div",{className:"hl-review-section",children:[e.jsx("label",{htmlFor:"review-text",className:"hl-review-label",children:"Written Review (Optional)"}),e.jsx("textarea",{id:"review-text",className:"hl-review-textarea",value:R,onChange:D=>L(D.target.value),placeholder:"Share your experience with this guest...",rows:4,maxLength:1e3}),e.jsxs("span",{className:"hl-review-char-count",children:[R.length,"/1000"]})]}),e.jsxs("div",{className:"hl-review-section",children:[e.jsx("label",{className:"hl-review-label",children:"Would you recommend this guest?"}),e.jsxs("div",{className:"hl-recommend-buttons",children:[e.jsxs("button",{type:"button",className:`hl-recommend-btn ${P===!0?"hl-recommend-yes":""}`,onClick:()=>w(!0),children:[e.jsx(Xe,{size:18}),"Yes"]}),e.jsxs("button",{type:"button",className:`hl-recommend-btn ${P===!1?"hl-recommend-no":""}`,onClick:()=>w(!1),children:[e.jsx(Qe,{size:18}),"No"]})]})]})]}),e.jsxs("div",{className:"hl-modal-footer",children:[e.jsx("button",{type:"button",className:"hl-btn hl-btn-secondary",onClick:s,disabled:T,children:"Cancel"}),e.jsx("button",{type:"submit",className:"hl-btn hl-btn-primary",onClick:A,disabled:T||n===0,children:T?"Submitting...":"Submit Review"})]})]})})}function yt({isOpen:t,request:a,onClose:s,onAccept:h,onDecline:n}){var m,g,y;if(!t||!a)return null;const c=j=>{j.target===j.currentTarget&&s()},r=((m=a.status)==null?void 0:m.toLowerCase())==="pending",i=((g=a.requestedByUser)==null?void 0:g.name)||((y=a.requestedByUser)==null?void 0:y.firstName)||"Guest";return e.jsx("div",{className:"hl-modal-backdrop",onClick:c,children:e.jsxs("div",{className:"hl-modal hl-dcr-modal",role:"dialog","aria-modal":"true","aria-labelledby":"dcr-modal-title",children:[e.jsxs("div",{className:"hl-modal-header",children:[e.jsxs("h2",{id:"dcr-modal-title",className:"hl-modal-title",children:[e.jsx(O,{size:20}),"Date Change Request"]}),e.jsx("button",{type:"button",className:"hl-modal-close",onClick:s,"aria-label":"Close modal",children:e.jsx(W,{size:20})})]}),e.jsxs("div",{className:"hl-modal-body",children:[e.jsx("div",{className:"hl-dcr-status-row",children:e.jsx("span",{className:be(a.status),children:a.status})}),e.jsxs("div",{className:"hl-dcr-details",children:[e.jsxs("div",{className:"hl-dcr-detail-row",children:[e.jsxs("div",{className:"hl-dcr-detail-label",children:[e.jsx(de,{size:16}),"Requested By"]}),e.jsx("div",{className:"hl-dcr-detail-value",children:i})]}),a.requestType&&e.jsxs("div",{className:"hl-dcr-detail-row",children:[e.jsxs("div",{className:"hl-dcr-detail-label",children:[e.jsx(O,{size:16}),"Request Type"]}),e.jsx("div",{className:"hl-dcr-detail-value",children:a.requestType})]}),e.jsxs("div",{className:"hl-dcr-detail-row hl-dcr-dates-row",children:[e.jsxs("div",{className:"hl-dcr-detail-label",children:[e.jsx(O,{size:16}),"Date Change"]}),e.jsxs("div",{className:"hl-dcr-dates",children:[e.jsx("span",{className:"hl-dcr-original-date",children:q(a.originalDate)}),e.jsx(ge,{size:16,className:"hl-dcr-arrow"}),e.jsx("span",{className:"hl-dcr-requested-date",children:q(a.requestedDate)})]})]}),a.priceAdjustment!=null&&a.priceAdjustment!==0&&e.jsxs("div",{className:"hl-dcr-detail-row",children:[e.jsxs("div",{className:"hl-dcr-detail-label",children:[e.jsx(se,{size:16}),"Price Adjustment"]}),e.jsxs("div",{className:`hl-dcr-detail-value ${a.priceAdjustment>0?"hl-dcr-positive":"hl-dcr-negative"}`,children:[a.priceAdjustment>0?"+":"",_(a.priceAdjustment)]})]}),e.jsxs("div",{className:"hl-dcr-detail-row",children:[e.jsxs("div",{className:"hl-dcr-detail-label",children:[e.jsx(me,{size:16}),"Requested On"]}),e.jsx("div",{className:"hl-dcr-detail-value",children:q(a.createdDate)})]})]})]}),e.jsx("div",{className:"hl-modal-footer",children:r?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"hl-btn hl-btn-secondary",onClick:s,children:"Cancel"}),e.jsxs("button",{type:"button",className:"hl-btn hl-btn-decline",onClick:()=>{n(a.id),s()},children:[e.jsx(W,{size:16}),"Decline"]}),e.jsxs("button",{type:"button",className:"hl-btn hl-btn-accept",onClick:()=>{h(a.id),s()},children:[e.jsx(pe,{size:16}),"Accept"]})]}):e.jsx("button",{type:"button",className:"hl-btn hl-btn-secondary",onClick:s,children:"Close"})})]})})}function ce(){return e.jsxs("div",{className:"hl-loading-state",role:"status","aria-live":"polite",children:[e.jsx("div",{className:"hl-spinner","aria-hidden":"true"}),e.jsx("p",{children:"Loading your leases..."})]})}function Nt({error:t,onRetry:a}){return e.jsxs("div",{className:"hl-error-state",role:"alert",children:[e.jsx("div",{className:"hl-error-icon","aria-hidden":"true",children:"!"}),e.jsx("h2",{className:"hl-error-title",children:"Something went wrong"}),e.jsx("p",{className:"hl-error-text",children:t}),e.jsx("button",{className:"hl-btn hl-btn-primary",onClick:a,children:"Try Again"})]})}function vt(){const{authState:t,listings:a,selectedListing:s,leases:h,isLoading:n,error:c,expandedSections:r,isReviewModalOpen:i,reviewTargetStay:m,isDateChangeModalOpen:g,selectedDateChangeRequest:y,leaseCountsByListing:j,handleListingChange:R,handleToggleShowAllStays:L,handleToggleShowDetails:P,handleAcceptDateChangeRequest:w,handleDeclineDateChangeRequest:T,handleOpenReviewModal:z,handleCloseReviewModal:A,handleSubmitGuestReview:$,handleViewDateChangeDetails:M,handleCloseDateChangeModal:D,handleOpenDocument:C,handleRetry:F}=nt(),K=u.useMemo(()=>({onToggleDetails:P,onToggleAllStays:L,onAcceptDateChange:w,onDeclineDateChange:T,onViewDateChangeDetails:M,onOpenReview:z,onOpenDocument:C}),[P,L,w,T,M,z,C]),Q=u.useCallback(U=>{R(U)},[R]);if(t.shouldRedirect)return e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsx("main",{className:"main-content",children:e.jsx("div",{className:"hl-page",children:e.jsx(ce,{})})}),e.jsx(le,{})]});const V=(s==null?void 0:s.id)||(s==null?void 0:s._id),B=(s==null?void 0:s.title)||(s==null?void 0:s.name),E=h&&h.length>0;return e.jsxs(e.Fragment,{children:[e.jsx(ne,{}),e.jsxs("main",{className:"main-content",role:"main",id:"main-content",children:[e.jsx("h1",{className:"sr-only",children:"Host Leases Dashboard"}),e.jsxs("div",{className:"hl-page",children:[e.jsxs("div",{className:"hl-page-header",children:[e.jsx("div",{className:"hl-page-header-top",children:e.jsxs("h2",{className:"hl-page-title","aria-label":`Leases${B?` for ${B}`:""}`,children:[e.jsx(Y,{size:28,className:"hl-page-title-icon"}),"My Leases"]})}),!n&&!c&&a&&a.length>0&&e.jsx("nav",{"aria-label":"Listing filter",children:e.jsx(it,{listings:a,selectedListingId:V,onListingChange:Q,leaseCountsByListing:j})})]}),n&&e.jsx(ce,{}),!n&&c&&e.jsx(Nt,{error:c,onRetry:F}),!n&&!c&&e.jsx(e.Fragment,{children:E?e.jsx("div",{className:"hl-lease-cards",children:h.map(U=>e.jsx(ft,{lease:U,expanded:r[U.id]||{},handlers:K},U.id))}):e.jsx(jt,{listingName:B})})]})]}),e.jsx(le,{}),e.jsx(bt,{isOpen:i,stay:m,onClose:A,onSubmit:$}),e.jsx(yt,{isOpen:g,request:y,onClose:D,onAccept:w,onDecline:T})]})}ze(document.getElementById("root")).render(e.jsx(Fe.StrictMode,{children:e.jsx(Oe,{children:e.jsx(He,{children:e.jsx(vt,{})})})}));

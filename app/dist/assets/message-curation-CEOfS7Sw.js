import{r as n,j as e,c as xe}from"./client-BJVKzfAi.js";import{s as je}from"./supabase-BoCLEw6R.js";import{u as _e,a as fe}from"./Toast-BQk6Nzgd.js";import{A as be}from"./AdminHeader-tCInZd3n.js";import"./auth-QZ4BJadW.js";import"./star-OtPMgcH9.js";import"./createLucideIcon-CgZZH2OU.js";import"./file-text-Bqp_Hw0X.js";import"./triangle-alert-Bp6DQQmR.js";import"./users-d0RSvnp4.js";import"./pen-line-Duo49k9O.js";import"./calendar-CDI4qHEX.js";import"./mail-CRbL90NL.js";import"./user-check-CoCGzn5Y.js";import"./dollar-sign-Dn2-KjNW.js";import"./send-C4mziT0-.js";import"./x-CrJVeoCh.js";const Ne="https://qcfifybkaddcoimjroca.supabase.co",V=50;function ye(){const{showToast:a}=_e(),[o,r]=n.useState([]),[i,d]=n.useState(0),[c,m]=n.useState(null),[u,h]=n.useState(""),[p,_]=n.useState(!0),[l,N]=n.useState(1),[j,x]=n.useState([]),[g,f]=n.useState(null),[E,L]=n.useState(!1),[P,T]=n.useState(null),[U,B]=n.useState(!1),[R,D]=n.useState(!1),[$,b]=n.useState(!1),[z,v]=n.useState(null),[k,C]=n.useState(""),[F,O]=n.useState("guest");n.useEffect(()=>{M()},[]),n.useEffect(()=>{M()},[u,l]),n.useEffect(()=>{const s=new URLSearchParams(window.location.search),t=s.get("thread");s.get("message"),t&&o.length>0&&!c&&H(t)},[o]);async function y(s,t={}){const{data:{session:w}}=await je.auth.getSession();if(!w)throw new Error("You must be logged in to perform this action");const W=await fetch(`${Ne}/functions/v1/message-curation`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w.access_token}`},body:JSON.stringify({action:s,payload:t})}),S=await W.json();if(!W.ok||!S.success)throw new Error(S.error||"Request failed");return S.data}const M=n.useCallback(async()=>{try{_(!0),v(null);const s=await y("getThreads",{limit:V,offset:(l-1)*V,search:u||void 0});r(s.threads||[]),d(s.total||0)}catch(s){console.error("[useMessageCurationPageLogic] Fetch threads error:",s),v(s.message),a(s.message||"Failed to fetch threads","error")}finally{_(!1)}},[l,u,a]),I=n.useCallback(async s=>{if(s)try{L(!0),v(null);const t=await y("getThreadMessages",{threadId:s});x(t.messages||[]),T(t.thread||null)}catch(t){console.error("[useMessageCurationPageLogic] Fetch messages error:",t),v(t.message),a(t.message||"Failed to fetch messages","error")}finally{L(!1)}},[a]),A=n.useCallback(async s=>{if(s)try{const t=await y("getMessage",{messageId:s});f(t.message||null)}catch(t){console.error("[useMessageCurationPageLogic] Fetch message error:",t),a(t.message||"Failed to fetch message details","error")}},[a]),H=n.useCallback(s=>{m(s),f(null),C("");const t=new URL(window.location.href);s?(t.searchParams.set("thread",s),t.searchParams.delete("message")):(t.searchParams.delete("thread"),t.searchParams.delete("message")),window.history.replaceState({},"",t.toString()),s?I(s):(x([]),T(null))},[I]),G=n.useCallback(s=>{f(s);const t=new URL(window.location.href);t.searchParams.set("message",s.id),window.history.replaceState({},"",t.toString())},[]),Z=n.useCallback(s=>{h(s),N(1)},[]),X=n.useCallback(s=>{N(s)},[]),ee=n.useCallback(()=>{m(null),f(null),x([]),T(null),C("");const s=new URL(window.location.href);s.searchParams.delete("thread"),s.searchParams.delete("message"),window.history.replaceState({},"",s.toString())},[]),se=n.useCallback(async()=>{if(g)try{b(!0),await y("deleteMessage",{messageId:g.id}),x(s=>s.filter(t=>t.id!==g.id)),f(null),B(!1),a("Message deleted successfully","success")}catch(s){console.error("[useMessageCurationPageLogic] Delete message error:",s),a(s.message||"Failed to delete message","error")}finally{b(!1)}},[g,a]),ae=n.useCallback(async()=>{if(c)try{b(!0);const s=await y("deleteThread",{threadId:c});x([]),f(null),D(!1),a(`Deleted ${s.deletedCount} messages from thread`,"success")}catch(s){console.error("[useMessageCurationPageLogic] Delete thread error:",s),a(s.message||"Failed to delete thread","error")}finally{b(!1)}},[c,a]),te=n.useCallback(async()=>{if(g)try{b(!0),await y("forwardMessage",{messageId:g.id}),x(s=>s.map(t=>t.id===g.id?{...t,isForwarded:!0}:t)),f(s=>s?{...s,isForwarded:!0}:null),a("Message forwarded to support","success")}catch(s){console.error("[useMessageCurationPageLogic] Forward message error:",s),a(s.message||"Failed to forward message","error")}finally{b(!1)}},[g,a]),ne=n.useCallback(async()=>{if(!(!c||!k.trim()))try{b(!0);const s=await y("sendSplitBotMessage",{threadId:c,messageBody:k.trim(),recipientType:F}),t={id:s.message.id,body:s.message.body,createdAt:s.message.createdAt,senderType:"splitbot",isSplitBotWarning:!0,isForwarded:!1,originator:null};x(w=>[...w,t]),C(""),a("Split Bot message sent","success")}catch(s){console.error("[useMessageCurationPageLogic] Send Split Bot message error:",s),a(s.message||"Failed to send Split Bot message","error")}finally{b(!1)}},[c,k,F,a]),re=n.useCallback(s=>{const t={redacted_contact_info:"We noticed your message contained contact information. For your safety and security, we've removed it. Please use Split Lease messaging for all communications.",limit_messages:"We noticed a high volume of messages in this conversation. Please consolidate your messages to help keep the conversation organized.",lease_documents_signed:"Great news! Your lease documents have been signed and processed. You can now proceed with your move-in arrangements."};t[s]&&C(t[s])},[]),ie=n.useCallback(()=>{g&&B(!0)},[g]),oe=n.useCallback(()=>{B(!1)},[]),le=n.useCallback(()=>{c&&D(!0)},[c]),ce=n.useCallback(()=>{D(!1)},[]),de=n.useMemo(()=>Math.ceil(i/V),[i]),he=n.useCallback(s=>s&&(`${s.firstName||""} ${s.lastName||""}`.trim()||s.email)||"Unknown",[]),me=n.useCallback(s=>{var W,S;if(!s)return"";const t=((W=s.listing)==null?void 0:W.name)||"No Listing",w=((S=s.guest)==null?void 0:S.email)||"No Guest";return`${t} - ${w}`},[]),ue=n.useCallback(s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",[]),ge=n.useCallback(s=>{switch(s){case"guest":return"sender-guest";case"host":return"sender-host";case"splitbot":return"sender-splitbot";default:return"sender-unknown"}},[]),pe=n.useCallback(async s=>{try{await navigator.clipboard.writeText(s),a("Copied to clipboard","success")}catch(t){console.error("Copy to clipboard failed:",t),a("Failed to copy","error")}},[a]);return{threads:o,totalThreadCount:i,selectedThreadId:c,searchText:u,isLoadingThreads:p,currentPage:l,totalPages:de,messages:j,selectedMessage:g,isLoadingMessages:E,currentThread:P,isDeleteMessageModalOpen:U,isDeleteThreadModalOpen:R,isProcessing:$,error:z,splitBotMessageText:k,splitBotRecipientType:F,setSplitBotMessageText:C,setSplitBotRecipientType:O,fetchThreads:M,fetchThreadMessages:I,fetchMessageDetails:A,handleThreadSelect:H,handleMessageClick:G,handleSearchChange:Z,handlePageChange:X,clearSelection:ee,handleDeleteMessage:se,handleDeleteThread:ae,handleForwardMessage:te,handleSendSplitBotMessage:ne,applySplitBotTemplate:re,openDeleteMessageModal:ie,closeDeleteMessageModal:oe,openDeleteThreadModal:le,closeDeleteThreadModal:ce,getUserDisplayName:he,getThreadDisplayLabel:me,formatDate:ue,getSenderColorClass:ge,copyToClipboard:pe}}function ve({threads:a,selectedThreadId:o,searchText:r,isLoading:i,currentPage:d,totalPages:c,onSelect:m,onSearchChange:u,onPageChange:h,getThreadDisplayLabel:p,formatDate:_}){return e.jsxs("div",{className:"thread-selector",children:[e.jsxs("div",{className:"thread-selector__search",children:[e.jsx(ke,{}),e.jsx("input",{type:"text",placeholder:"Search by listing, email, or name...",value:r,onChange:l=>u(l.target.value),className:"thread-selector__search-input"}),r&&e.jsx("button",{onClick:()=>u(""),className:"thread-selector__clear-search","aria-label":"Clear search",children:e.jsx(Ce,{})})]}),e.jsx("div",{className:"thread-selector__list",children:i?e.jsxs("div",{className:"thread-selector__loading",children:[e.jsx("span",{className:"thread-selector__loading-spinner"}),e.jsx("span",{children:"Loading threads..."})]}):a.length===0?e.jsx("div",{className:"thread-selector__empty",children:r?"No threads match your search":"No threads found"}):a.map(l=>{var N,j,x,g;return e.jsxs("button",{onClick:()=>m(l.id),className:`thread-selector__item ${o===l.id?"thread-selector__item--selected":""}`,children:[e.jsxs("div",{className:"thread-selector__item-main",children:[e.jsx("span",{className:"thread-selector__item-listing",children:((N=l.listing)==null?void 0:N.name)||"No Listing"}),e.jsx("span",{className:"thread-selector__item-guest",children:((j=l.guest)==null?void 0:j.email)||"No Guest"})]}),e.jsxs("div",{className:"thread-selector__item-meta",children:[e.jsxs("span",{className:"thread-selector__item-host",children:["Host: ",((x=l.host)==null?void 0:x.firstName)||((g=l.host)==null?void 0:g.email)||"N/A"]}),e.jsx("span",{className:"thread-selector__item-date",children:_(l.modifiedAt)})]})]},l.id)})}),c>1&&e.jsxs("div",{className:"thread-selector__pagination",children:[e.jsx("button",{onClick:()=>h(d-1),disabled:d<=1,className:"thread-selector__page-button",children:"Previous"}),e.jsxs("span",{className:"thread-selector__page-info",children:["Page ",d," of ",c]}),e.jsx("button",{onClick:()=>h(d+1),disabled:d>=c,className:"thread-selector__page-button",children:"Next"})]})]})}function ke(){return e.jsx("svg",{className:"thread-selector__search-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}function Ce(){return e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",width:"16",height:"16",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}function Me({messages:a,selectedMessageId:o,isLoading:r,currentThread:i,onMessageClick:d,getUserDisplayName:c,formatDate:m,getSenderColorClass:u}){var h,p,_;return r?e.jsxs("div",{className:"conversation-history conversation-history--loading",children:[e.jsx("div",{className:"conversation-history__spinner"}),e.jsx("span",{children:"Loading messages..."})]}):a.length===0?e.jsxs("div",{className:"conversation-history conversation-history--empty",children:[e.jsx(we,{}),e.jsx("p",{children:"No messages in this thread"})]}):e.jsxs("div",{className:"conversation-history",children:[i&&e.jsxs("div",{className:"conversation-history__thread-info",children:[e.jsxs("div",{className:"thread-info__listing",children:[e.jsx("strong",{children:"Listing:"})," ",((h=i.listing)==null?void 0:h.name)||"No Listing"]}),e.jsxs("div",{className:"thread-info__users",children:[e.jsxs("span",{className:"thread-info__guest",children:[e.jsx(q,{}),((p=i.guest)==null?void 0:p.email)||"No Guest"]}),e.jsx("span",{className:"thread-info__arrow",children:"â†”"}),e.jsxs("span",{className:"thread-info__host",children:[e.jsx(J,{}),((_=i.host)==null?void 0:_.email)||"No Host"]})]})]}),e.jsx("div",{className:"conversation-history__messages",children:a.map(l=>{const N=u(l.senderType),j=l.id===o;return e.jsxs("button",{onClick:()=>d(l),className:`message-bubble ${N} ${j?"message-bubble--selected":""}`,children:[e.jsxs("div",{className:"message-bubble__header",children:[e.jsx("span",{className:"message-bubble__sender",children:l.senderType==="splitbot"?e.jsxs(e.Fragment,{children:[e.jsx(Se,{}),"Split Bot"]}):l.senderType==="guest"?e.jsxs(e.Fragment,{children:[e.jsx(q,{}),c(l.originator)||"Guest"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{}),c(l.originator)||"Host"]})}),e.jsx("span",{className:"message-bubble__time",children:m(l.createdAt)})]}),e.jsx("div",{className:"message-bubble__body",children:l.body}),e.jsxs("div",{className:"message-bubble__indicators",children:[l.isSplitBotWarning&&e.jsx("span",{className:"message-indicator message-indicator--warning",title:"Split Bot Warning",children:e.jsx(Le,{})}),l.isForwarded&&e.jsx("span",{className:"message-indicator message-indicator--forwarded",title:"Forwarded",children:e.jsx(Te,{})})]})]},l.id)})}),e.jsxs("div",{className:"conversation-history__count",children:[a.length," message",a.length!==1?"s":""]})]})}function we(){return e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",width:"48",height:"48",className:"empty-icon",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})})}function q(){return e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",width:"14",height:"14",className:"sender-icon sender-icon--guest",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}function J(){return e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",width:"14",height:"14",className:"sender-icon sender-icon--host",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})}function Se(){return e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",width:"14",height:"14",className:"sender-icon sender-icon--splitbot",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}function Le(){return e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",width:"14",height:"14",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}function Te(){return e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",width:"14",height:"14",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}function Be({message:a,thread:o,getUserDisplayName:r,formatDate:i,copyToClipboard:d}){return a?e.jsxs("div",{className:"message-display",children:[e.jsxs("div",{className:"message-display__field",children:[e.jsx("label",{className:"message-display__label",children:"Message ID"}),e.jsxs("div",{className:"message-display__value message-display__value--id",children:[e.jsx("code",{children:a.id}),e.jsx("button",{onClick:()=>d(a.id),className:"message-display__copy-button",title:"Copy to clipboard",children:e.jsx(Fe,{})})]})]}),e.jsxs("div",{className:"message-display__field",children:[e.jsx("label",{className:"message-display__label",children:"Sender"}),e.jsx("div",{className:"message-display__value",children:e.jsx(Y,{user:a.originator,senderType:a.senderType,getUserDisplayName:r})})]}),o&&e.jsxs("div",{className:"message-display__participants",children:[e.jsxs("div",{className:"message-display__participant",children:[e.jsx("label",{className:"message-display__label",children:"Guest"}),e.jsx(Y,{user:o.guest,senderType:"guest",getUserDisplayName:r,isOriginator:a.originatorUserId===o.guestUserId})]}),e.jsxs("div",{className:"message-display__participant",children:[e.jsx("label",{className:"message-display__label",children:"Host"}),e.jsx(Y,{user:o.host,senderType:"host",getUserDisplayName:r,isOriginator:a.originatorUserId===o.hostUserId})]})]}),(o==null?void 0:o.listing)&&e.jsxs("div",{className:"message-display__field",children:[e.jsx("label",{className:"message-display__label",children:"Listing"}),e.jsx("div",{className:"message-display__value",children:o.listing.name})]}),e.jsxs("div",{className:"message-display__field",children:[e.jsx("label",{className:"message-display__label",children:"Sent At"}),e.jsx("div",{className:"message-display__value",children:i(a.createdAt)})]}),e.jsxs("div",{className:"message-display__badges",children:[a.isSplitBotWarning&&e.jsx("span",{className:"message-display__badge message-display__badge--warning",children:"Split Bot Warning"}),a.isForwarded&&e.jsx("span",{className:"message-display__badge message-display__badge--forwarded",children:"Forwarded"}),e.jsxs("span",{className:`message-display__badge message-display__badge--sender message-display__badge--${a.senderType}`,children:[a.senderType==="guest"&&"From Guest",a.senderType==="host"&&"From Host",a.senderType==="splitbot"&&"From Split Bot",a.senderType==="unknown"&&"Unknown Sender"]})]}),e.jsxs("div",{className:"message-display__field",children:[e.jsx("label",{className:"message-display__label",children:"Message Content"}),e.jsx("textarea",{className:"message-display__body",value:a.body||"",readOnly:!0,rows:6})]})]}):null}function Y({user:a,senderType:o,getUserDisplayName:r,isOriginator:i}){if(!a)return e.jsxs("div",{className:"user-card user-card--empty",children:[e.jsx("div",{className:"user-card__avatar user-card__avatar--empty",children:"?"}),e.jsx("div",{className:"user-card__info",children:e.jsx("span",{className:"user-card__name",children:"Unknown User"})})]});const d=De(a.firstName,a.lastName);return e.jsxs("div",{className:`user-card user-card--${o} ${i?"user-card--originator":""}`,children:[e.jsx("div",{className:`user-card__avatar user-card__avatar--${o}`,children:a.profilePhoto?e.jsx("img",{src:a.profilePhoto,alt:r(a)}):d}),e.jsxs("div",{className:"user-card__info",children:[e.jsxs("span",{className:"user-card__name",children:[r(a),i&&e.jsx("span",{className:"user-card__originator-badge",children:"Sender"})]}),e.jsx("span",{className:"user-card__email",children:a.email})]})]})}function De(a,o){const r=(a||"").charAt(0).toUpperCase(),i=(o||"").charAt(0).toUpperCase();return r+i||"?"}function Fe(){return e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",width:"16",height:"16",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}function Ie({hasSelectedMessage:a,hasSelectedThread:o,isMessageForwarded:r,isProcessing:i,onDeleteMessage:d,onDeleteThread:c,onForwardMessage:m}){return e.jsxs("div",{className:"moderation-actions",children:[e.jsx("h3",{className:"moderation-actions__title",children:"Moderation Actions"}),e.jsxs("button",{onClick:m,disabled:!a||i||r,className:"moderation-actions__button moderation-actions__button--forward",title:r?"Message already forwarded":"Forward to support email",children:[e.jsx(Ae,{}),r?"Already Forwarded":"Forward Message"]}),e.jsxs("button",{onClick:d,disabled:!a||i,className:"moderation-actions__button moderation-actions__button--delete",children:[e.jsx(We,{}),"Delete Message"]}),e.jsxs("button",{onClick:c,disabled:!o||i,className:"moderation-actions__button moderation-actions__button--delete-all",children:[e.jsx(Ee,{}),"Delete All Messages in Thread"]}),i&&e.jsxs("div",{className:"moderation-actions__processing",children:[e.jsx("span",{className:"moderation-actions__spinner"}),"Processing..."]})]})}function Ae(){return e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",width:"18",height:"18",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}function We(){return e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",width:"18",height:"18",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}function Ee(){return e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",width:"18",height:"18",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}function K({threadId:a,messageText:o,recipientType:r,isProcessing:i,onMessageTextChange:d,onRecipientTypeChange:c,onSendMessage:m,onApplyTemplate:u}){const h=a&&o.trim()&&!i;return e.jsxs("div",{className:"splitbot-messaging",children:[e.jsxs("h3",{className:"splitbot-messaging__title",children:[e.jsx(Pe,{}),"Split Bot Messaging"]}),e.jsxs("div",{className:"splitbot-messaging__recipient",children:[e.jsx("label",{className:"splitbot-messaging__label",children:"Send to:"}),e.jsxs("div",{className:"splitbot-messaging__radio-group",children:[e.jsxs("label",{className:"splitbot-messaging__radio",children:[e.jsx("input",{type:"radio",name:"recipientType",value:"guest",checked:r==="guest",onChange:()=>c("guest"),disabled:i}),e.jsx("span",{className:"splitbot-messaging__radio-label",children:"Guest"})]}),e.jsxs("label",{className:"splitbot-messaging__radio",children:[e.jsx("input",{type:"radio",name:"recipientType",value:"host",checked:r==="host",onChange:()=>c("host"),disabled:i}),e.jsx("span",{className:"splitbot-messaging__radio-label",children:"Host"})]})]})]}),e.jsxs("div",{className:"splitbot-messaging__templates",children:[e.jsx("label",{className:"splitbot-messaging__label",children:"Quick Templates:"}),e.jsxs("div",{className:"splitbot-messaging__template-buttons",children:[e.jsx("button",{onClick:()=>u("redacted_contact_info"),className:"splitbot-messaging__template-button",disabled:i,title:"Contact info redacted warning",children:"Contact Redacted"}),e.jsx("button",{onClick:()=>u("limit_messages"),className:"splitbot-messaging__template-button",disabled:i,title:"Please limit messages",children:"Limit Messages"}),e.jsx("button",{onClick:()=>u("lease_documents_signed"),className:"splitbot-messaging__template-button",disabled:i,title:"Lease documents signed notification",children:"Lease Signed"})]})]}),e.jsxs("div",{className:"splitbot-messaging__input",children:[e.jsx("label",{className:"splitbot-messaging__label",children:"Message:"}),e.jsx("textarea",{value:o,onChange:p=>d(p.target.value),placeholder:"Enter Split Bot message...",rows:4,disabled:i,className:"splitbot-messaging__textarea"})]}),e.jsx("button",{onClick:m,disabled:!h,className:"splitbot-messaging__send-button",children:i?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"splitbot-messaging__spinner"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(He,{}),"Send Split Bot Message"]})}),e.jsxs("p",{className:"splitbot-messaging__helper",children:["Messages sent via Split Bot will appear as system messages to the ",r,"."]})]})}function Pe(){return e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",width:"18",height:"18",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}function He(){return e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",width:"18",height:"18",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})}function Q({title:a,message:o,confirmLabel:r,confirmVariant:i="primary",onConfirm:d,onCancel:c,isProcessing:m}){const u=p=>{p.target===p.currentTarget&&!m&&c()},h=p=>{p.key==="Escape"&&!m&&c()};return e.jsx("div",{className:"confirmation-modal__backdrop",onClick:u,onKeyDown:h,tabIndex:-1,role:"dialog","aria-modal":"true","aria-labelledby":"confirmation-modal-title",children:e.jsxs("div",{className:"confirmation-modal",children:[e.jsxs("div",{className:"confirmation-modal__header",children:[e.jsx("h3",{id:"confirmation-modal-title",className:"confirmation-modal__title",children:a}),e.jsx("button",{onClick:c,disabled:m,className:"confirmation-modal__close","aria-label":"Close",children:e.jsx(Ue,{})})]}),e.jsx("div",{className:"confirmation-modal__body",children:e.jsx("p",{className:"confirmation-modal__message",children:o})}),e.jsxs("div",{className:"confirmation-modal__footer",children:[e.jsx("button",{onClick:c,disabled:m,className:"confirmation-modal__button confirmation-modal__button--cancel",children:"Cancel"}),e.jsx("button",{onClick:d,disabled:m,className:`confirmation-modal__button confirmation-modal__button--confirm confirmation-modal__button--${i}`,children:m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"confirmation-modal__spinner"}),"Processing..."]}):r})]})]})})}function Ue(){return e.jsx("svg",{fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",width:"20",height:"20",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}function Re(){const{threads:a,totalThreadCount:o,selectedThreadId:r,searchText:i,isLoadingThreads:d,currentPage:c,totalPages:m,messages:u,selectedMessage:h,isLoadingMessages:p,currentThread:_,isDeleteMessageModalOpen:l,isDeleteThreadModalOpen:N,isProcessing:j,error:x,splitBotMessageText:g,splitBotRecipientType:f,setSplitBotMessageText:E,setSplitBotRecipientType:L,fetchThreads:P,handleThreadSelect:T,handleMessageClick:U,handleSearchChange:B,handlePageChange:R,clearSelection:D,handleDeleteMessage:$,handleDeleteThread:b,handleForwardMessage:z,handleSendSplitBotMessage:v,applySplitBotTemplate:k,openDeleteMessageModal:C,closeDeleteMessageModal:F,openDeleteThreadModal:O,closeDeleteThreadModal:y,getUserDisplayName:M,getThreadDisplayLabel:I,formatDate:A,getSenderColorClass:H,copyToClipboard:G}=ye();return e.jsxs("div",{className:"message-curation-page",children:[e.jsx(be,{}),e.jsxs("header",{className:"message-curation-header",children:[e.jsxs("div",{className:"header-content",children:[e.jsx("h1",{className:"header-title",children:"Message Curation"}),e.jsx("p",{className:"header-subtitle",children:"View and moderate message threads"})]}),e.jsx("button",{onClick:P,className:"refresh-button",disabled:d,children:d?"Refreshing...":"Refresh"})]}),e.jsxs("main",{className:"message-curation-main",children:[x&&e.jsxs("div",{className:"error-banner",children:[e.jsx("span",{children:x}),e.jsx("button",{onClick:P,className:"retry-button",children:"Retry"})]}),e.jsxs("div",{className:"three-column-layout",children:[e.jsxs("section",{className:"column column-threads",children:[e.jsxs("h2",{className:"section-title",children:["Threads (",o,")"]}),e.jsx(ve,{threads:a,selectedThreadId:r,searchText:i,isLoading:d,currentPage:c,totalPages:m,onSelect:T,onSearchChange:B,onPageChange:R,getThreadDisplayLabel:I,formatDate:A}),r&&e.jsx("button",{onClick:D,className:"clear-selection-button",children:"Clear Selection"})]}),e.jsxs("section",{className:"column column-conversation",children:[e.jsx("h2",{className:"section-title",children:_?"Conversation":"Select a Thread"}),r?e.jsx(Me,{messages:u,selectedMessageId:h==null?void 0:h.id,isLoading:p,currentThread:_,onMessageClick:U,getUserDisplayName:M,formatDate:A,getSenderColorClass:H}):e.jsxs("div",{className:"empty-state",children:[e.jsx($e,{}),e.jsx("h3",{className:"empty-title",children:"No Thread Selected"}),e.jsx("p",{className:"empty-text",children:"Select a thread from the list to view the conversation."})]})]}),e.jsxs("section",{className:"column column-details",children:[e.jsx("h2",{className:"section-title",children:h?"Message Details":"Details"}),h?e.jsxs(e.Fragment,{children:[e.jsx(Be,{message:h,thread:_,getUserDisplayName:M,formatDate:A,copyToClipboard:G}),e.jsx(Ie,{hasSelectedMessage:!!h,hasSelectedThread:!!r,isMessageForwarded:h==null?void 0:h.isForwarded,isProcessing:j,onDeleteMessage:C,onDeleteThread:O,onForwardMessage:z}),r&&e.jsx(K,{threadId:r,messageText:g,recipientType:f,isProcessing:j,onMessageTextChange:E,onRecipientTypeChange:L,onSendMessage:v,onApplyTemplate:k})]}):r?e.jsxs("div",{className:"empty-state empty-state--small",children:[e.jsx(ze,{}),e.jsx("h3",{className:"empty-title",children:"No Message Selected"}),e.jsx("p",{className:"empty-text",children:"Click on a message to view details and moderation options."}),e.jsx("div",{className:"split-bot-section",children:e.jsx(K,{threadId:r,messageText:g,recipientType:f,isProcessing:j,onMessageTextChange:E,onRecipientTypeChange:L,onSendMessage:v,onApplyTemplate:k})})]}):e.jsxs("div",{className:"empty-state empty-state--small",children:[e.jsx(Oe,{}),e.jsx("h3",{className:"empty-title",children:"No Selection"}),e.jsx("p",{className:"empty-text",children:"Select a thread and message to see details and actions."})]})]})]})]}),e.jsx("footer",{className:"message-curation-footer",children:e.jsx("p",{className:"footer-text",children:"Split Lease Admin Dashboard - Internal Use Only"})}),l&&h&&e.jsx(Q,{title:"Delete Message",message:"Are you sure you want to delete this message? This action will soft-delete the message.",confirmLabel:"Delete Message",confirmVariant:"danger",onConfirm:$,onCancel:F,isProcessing:j}),N&&r&&e.jsx(Q,{title:"Delete All Messages in Thread",message:`Are you sure you want to delete ALL messages in this thread? This will soft-delete all ${u.length} messages. This action cannot be easily undone.`,confirmLabel:"Delete All Messages",confirmVariant:"danger",onConfirm:b,onCancel:y,isProcessing:j})]})}function $e(){return e.jsx("svg",{className:"empty-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}function ze(){return e.jsx("svg",{className:"empty-icon empty-icon--small",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}function Oe(){return e.jsx("svg",{className:"empty-icon empty-icon--small",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}const Ge=document.getElementById("root"),Ve=xe(Ge);Ve.render(e.jsx(fe,{children:e.jsx(Re,{})}));

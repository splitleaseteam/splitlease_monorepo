import{r as d,j as e,R as fe}from"./client-BJVKzfAi.js";import{s as U}from"./supabase-BoCLEw6R.js";function je(o){const r=o.getFullYear(),l=o.getMonth(),a=new Date(r,l,1),n=a.getDay(),f=new Date(r,l+1,0).getDate(),p=n+f,c=Math.ceil(p/7)*7,u=new Date(a);u.setDate(u.getDate()-n);const g=[];for(let v=0;v<c;v++){const x=new Date(u);x.setDate(u.getDate()+v),g.push(x)}return g}function pe(o,r=11,l=22,a=60){const n=[],m=new Date(o);for(let f=r;f<l;f++)for(let p=0;p<60;p+=a){const i=new Date(m);i.setHours(f,p,0,0),n.push({id:`slot_${i.getTime()}`,dateTime:i,formattedTime:ve(i),displayTime:ye(i)})}return n}function ve(o){return o.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}).toLowerCase()}function ye(o){return o.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})+" EST"}function _(o){return o.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}function Ne(o){return o.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}async function Se(o){try{const r=o.selectedTimes.map(m=>Ne(m.dateTime)),l={userId:o.userId,userEmail:o.userEmail,userName:o.userName,listingId:o.listingId||null,selectedTimes:r,subject:o.subject||"",details:o.details||""};console.log("[cohostService] Sending payload:",l);const{data:a,error:n}=await U.functions.invoke("cohost-request",{body:{action:"create",payload:l}});if(console.log("[cohostService] Response:",a),console.log("[cohostService] Error:",n),n){if(console.error("[cohostService] Error creating request:",n),n.context)try{const m=await n.context.json();return console.error("[cohostService] Error body from Edge Function:",m),{success:!1,error:m.error||m.message||"Failed to create request"}}catch(m){console.error("[cohostService] Could not parse error body:",m)}return a&&console.error("[cohostService] Response with error:",a),{success:!1,error:n.message||"Failed to create request"}}return a&&a.success===!1?(console.error("[cohostService] Edge Function returned error:",a.error),{success:!1,error:a.error||"Failed to create request"}):a!=null&&a.success&&(a!=null&&a.data)?{success:!0,requestId:a.data.requestId,virtualMeetingId:a.data.virtualMeetingId}:{success:!0,requestId:(a==null?void 0:a.requestId)||(a==null?void 0:a._id),virtualMeetingId:a==null?void 0:a.virtualMeetingId}}catch(r){return console.error("[cohostService] Exception creating request:",r),{success:!1,error:r.message||"Failed to create request"}}}async function we(o,r,l){try{const{data:a,error:n}=await U.functions.invoke("cohost-request",{body:{action:"rate",payload:{requestId:o,Rating:r,"Rating message (optional)":l||""}}});return n?(console.error("[cohostService] Error submitting rating:",n),{success:!1,error:n.message||"Failed to submit rating"}):a&&!a.success?{success:!1,error:a.error||"Failed to submit rating"}:{success:!0}}catch(a){return console.error("[cohostService] Exception submitting rating:",a),{success:!1,error:a.message||"Failed to submit rating"}}}function De(o){if(!o||o.length===0)return{valid:!1,error:"Please select at least one time slot"};if(o.length<3){const r=3-o.length;return{valid:!1,error:`Please select ${r} more time slot${r>1?"s":""}`}}return o.length>3?{valid:!1,error:"You can only select up to 3 time slots"}:{valid:!0}}function Te(o){return o?o.trim().replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").substring(0,5e3):""}const W=[{id:"sharath",name:"Sharath",initial:"S"},{id:"frederick",name:"Frederick",initial:"F"},{id:"rod",name:"Rod",initial:"R"},{id:"igor",name:"Igor",initial:"I"}],Me=["Can my Listing be private?","What are the differences between the rental styles?","How do I get paid?","Setting up my listing","Understanding pricing","Other question"],Ce=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ke={"co-host requested":1,requested:1,pending:1,"co-host selected":2,"google meet scheduled":3,"virtual meeting finished":4,"google meet finished":4,finished:5,"request closed":5,closed:5};function G(o){return o&&ke[o.toLowerCase()]||1}const T=[{order:1,label:"Requested",labelPosition:"below"},{order:2,label:"Co-Host Selected",labelPosition:"above"},{order:3,label:"Google Meet Scheduled",labelPosition:"below"},{order:4,label:"Google Meet Finished",labelPosition:"above"},{order:5,label:"Finished",labelPosition:"below"}],A={success:{color:"#22C55E",icon:"✓"},error:{color:"#EF4444",icon:"✕"},warning:{color:"#F6DA3B",icon:"⚠"},information:{color:"#3B82F6",icon:"ℹ"}};function Fe({toast:o,onClose:r}){const l=A[o.type]||A.information;return d.useEffect(()=>{const a=setTimeout(()=>{r(o.id)},o.duration||1e4);return()=>clearTimeout(a)},[o.id,o.duration,r]),e.jsxs("div",{className:"schedule-cohost-toast",style:{borderLeftColor:l.color},children:[e.jsx("span",{className:"schedule-cohost-toast-icon",style:{color:l.color},children:l.icon}),e.jsxs("div",{className:"schedule-cohost-toast-content",children:[e.jsx("strong",{className:"schedule-cohost-toast-title",children:o.title}),o.content&&e.jsx("p",{className:"schedule-cohost-toast-message",children:o.content})]}),e.jsx("button",{className:"schedule-cohost-toast-close",onClick:()=>r(o.id),type:"button",children:"×"}),e.jsx("div",{className:"schedule-cohost-toast-progress",style:{backgroundColor:l.color,animationDuration:`${o.duration||1e4}ms`}})]})}function qe({currentStatus:o}){const r=G(o);return T.filter(l=>l.labelPosition==="above"),T.filter(l=>l.labelPosition==="below"),e.jsxs("div",{className:"schedule-cohost-progress",role:"progressbar","aria-valuenow":r,"aria-valuemin":"1","aria-valuemax":"5","aria-label":"Co-host request progress",children:[e.jsx("div",{className:"schedule-cohost-progress-labels schedule-cohost-progress-labels--top",children:T.map(l=>e.jsx("span",{className:`schedule-cohost-progress-label ${l.labelPosition==="above"&&r>=l.order?"schedule-cohost-progress-label--active":""}`,children:l.labelPosition==="above"?l.label:""},l.order))}),e.jsx("div",{className:"schedule-cohost-progress-track",children:T.map((l,a)=>e.jsxs(fe.Fragment,{children:[a>0&&e.jsx("div",{className:`schedule-cohost-progress-bar ${r>=l.order?"schedule-cohost-progress-bar--active":""}`}),e.jsx("div",{className:`schedule-cohost-progress-dot ${r>=l.order?"schedule-cohost-progress-dot--active":""}`})]},l.order))}),e.jsx("div",{className:"schedule-cohost-progress-labels schedule-cohost-progress-labels--bottom",children:T.map(l=>e.jsx("span",{className:`schedule-cohost-progress-label ${l.labelPosition==="below"&&r>=l.order?"schedule-cohost-progress-label--active":""}`,children:l.labelPosition==="below"?l.label:""},l.order))})]})}function Re({value:o,onChange:r,disabled:l}){const[a,n]=d.useState(0),m=(i,c)=>{if(l)return;const u=c?i-.5:i;r(u)},f=(i,c)=>{if(l)return;const u=c.currentTarget.getBoundingClientRect(),g=c.clientX-u.left<u.width/2;n(g?i-.5:i)},p=a||o;return e.jsx("div",{className:"schedule-cohost-star-rating-container",children:[1,2,3,4,5].map(i=>{let c=0;return p>=i?c=100:p>=i-.5&&(c=50),e.jsxs("div",{className:`schedule-cohost-star-wrapper ${l?"schedule-cohost-star-wrapper--disabled":""}`,onMouseMove:u=>f(i,u),onMouseLeave:()=>n(0),onClick:u=>{const g=u.currentTarget.getBoundingClientRect(),v=u.clientX-g.left<g.width/2;m(i,v)},"aria-label":`Rate ${i} out of 5 stars`,children:[e.jsx("span",{className:"schedule-cohost-star-bg",children:"★"}),e.jsx("span",{className:"schedule-cohost-star-fill",style:{width:`${c}%`},children:"★"})]},i)})})}function Pe({userId:o,userEmail:r,userName:l,listingId:a,existingRequest:n,onRequestSubmitted:m,onClose:f}){const[p,i]=d.useState(n?"details":"request"),[c,u]=d.useState(n||null),[g,v]=d.useState(new Date),[x,L]=d.useState(null),[b,F]=d.useState([]),[M,H]=d.useState([]),[w,O]=d.useState(""),[D,V]=d.useState(0),[q,z]=d.useState(""),[y,C]=d.useState(!1),[J,k]=d.useState(""),[X,$]=d.useState([]),R=d.useRef(null);d.useEffect(()=>{const s=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=s}},[]);const K=d.useMemo(()=>je(g),[g]),Q=d.useMemo(()=>x?pe(x,11,22,60):[],[x]),N=d.useCallback(({title:s,content:t,type:h="information",duration:j=1e4})=>{const I=`toast_${Date.now()}`;$(P=>[...P,{id:I,title:s,content:t,type:h,duration:j}])},[]),Z=d.useCallback(s=>{$(t=>t.filter(h=>h.id!==s))},[]),ee=()=>{v(s=>{const t=new Date(s);return t.setMonth(t.getMonth()-1),t})},se=()=>{v(s=>{const t=new Date(s);return t.setMonth(t.getMonth()+1),t})},te=s=>{const t=new Date;t.setHours(0,0,0,0),!(s<t)&&s.getMonth()===g.getMonth()&&(L(s),setTimeout(()=>{R.current&&R.current.scrollIntoView({behavior:"smooth",block:"start"})},50))},Y=s=>{F(t=>t.some(j=>j.id===s.id)?t.filter(j=>j.id!==s.id):t.length<3?[...t,s]:t)},oe=()=>{F([])},ce=s=>{H(t=>t.includes(s)?t.filter(h=>h!==s):[...t,s])},ae=s=>{let t=s.target.value;t=t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""),t.length<=1e3&&O(t)},le=async()=>{const s=De(b);if(!s.valid){N({title:"Validation Error",content:s.error,type:"error"});return}C(!0),k("Creating your co-host request...");const t=await Se({userId:o,userEmail:r,userName:l,listingId:a,selectedTimes:b,subject:M.join(", "),details:w.trim()});C(!1),k(""),t.success?(u({id:t.requestId,virtualMeetingId:t.virtualMeetingId,status:"Co-Host Requested",subject:M.join(", "),details:w,selectedTimes:b}),F([]),L(null),H([]),O(""),N({title:"Request Submitted!",content:"Your co-host request has been submitted. We'll reach out to confirm a time.",type:"success",duration:1e4}),i("details"),m==null||m(t.requestId,t.virtualMeetingId)):N({title:"Submission Failed",content:t.error||"Failed to submit request. Please try again.",type:"error"})},re=async()=>{if(!(c!=null&&c.id)||D===0){N({title:"Please select a rating",type:"warning"});return}C(!0),k("Submitting your rating...");const s=await we(c.id,D,q);C(!1),k(""),s.success?(N({title:"Thank you!",content:"Your feedback has been submitted.",type:"success"}),u(t=>({...t,status:"Request closed",rating:D,ratingMessage:q})),setTimeout(()=>f(),2e3)):N({title:"Failed to submit rating",content:s.error,type:"error"})},ne=s=>{s.target===s.currentTarget&&f()},ie=s=>s.getMonth()===g.getMonth(),de=s=>{const t=new Date;return s.getDate()===t.getDate()&&s.getMonth()===t.getMonth()&&s.getFullYear()===t.getFullYear()},he=s=>{const t=new Date;return t.setHours(0,0,0,0),s<t},ue=s=>x?s.getDate()===x.getDate()&&s.getMonth()===x.getMonth()&&s.getFullYear()===x.getFullYear():!1,me=s=>b.some(t=>{const h=t.dateTime;return h.getDate()===s.getDate()&&h.getMonth()===s.getMonth()&&h.getFullYear()===s.getFullYear()}),ge=g.toLocaleDateString("en-US",{month:"long",year:"numeric"}),xe=b.length===3&&!y,E=3-b.length;return e.jsx("div",{className:"schedule-cohost-overlay",onClick:ne,role:"dialog","aria-modal":"true","aria-labelledby":"schedule-cohost-title",children:e.jsxs("div",{className:"schedule-cohost-modal",onClick:s=>s.stopPropagation(),children:[e.jsx("div",{className:"schedule-cohost-grab-handle","aria-hidden":"true"}),e.jsx("div",{className:"schedule-cohost-toasts",children:X.map(s=>e.jsx(Fe,{toast:s,onClose:Z},s.id))}),y&&e.jsxs("div",{className:"schedule-cohost-loading",children:[e.jsx("div",{className:"schedule-cohost-spinner"}),e.jsx("p",{className:"schedule-cohost-loading-text",children:J})]}),e.jsxs("header",{className:"schedule-cohost-header",children:[e.jsxs("div",{className:"schedule-cohost-header-content",children:[e.jsxs("div",{className:"schedule-cohost-header-title",children:[e.jsxs("svg",{className:"schedule-cohost-icon-svg",width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),e.jsx("h2",{id:"schedule-cohost-title",className:"schedule-cohost-title",children:"Meet with a Co-Host"})]}),e.jsx("p",{className:"schedule-cohost-subtitle",children:"Get personalized guidance and support."})]}),e.jsx("button",{className:"schedule-cohost-close",onClick:f,type:"button","aria-label":"Close modal",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),p==="request"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"schedule-cohost-team",children:[e.jsx("div",{className:"schedule-cohost-avatars",children:W.map((s,t)=>e.jsx("div",{className:"schedule-cohost-avatar",style:{zIndex:W.length-t},children:s.initial},s.id))}),e.jsx("p",{className:"schedule-cohost-team-text",children:"One of our team members will join as your co-host"})]}),e.jsxs("div",{className:"schedule-cohost-calendar",children:[e.jsxs("div",{className:"schedule-cohost-calendar-header",children:[e.jsx("button",{type:"button",className:"schedule-cohost-calendar-nav",onClick:ee,"aria-label":"Previous month",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M15 18l-6-6 6-6"})})}),e.jsx("span",{className:"schedule-cohost-calendar-month",children:ge}),e.jsx("button",{type:"button",className:"schedule-cohost-calendar-nav",onClick:se,"aria-label":"Next month",children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M9 18l6-6-6-6"})})})]}),e.jsx("div",{className:"schedule-cohost-calendar-weekdays",children:Ce.map(s=>e.jsx("div",{className:"schedule-cohost-calendar-weekday",children:s},s))}),e.jsx("div",{className:"schedule-cohost-calendar-grid",children:K.map((s,t)=>{const h=!ie(s),j=he(s),I=ue(s),P=me(s),be=de(s),B=!h&&!j,S=["schedule-cohost-calendar-day"];return h&&S.push("schedule-cohost-calendar-day--other"),j&&S.push("schedule-cohost-calendar-day--past"),I&&S.push("schedule-cohost-calendar-day--selected"),P&&S.push("schedule-cohost-calendar-day--has-slots"),be&&S.push("schedule-cohost-calendar-day--today"),e.jsx("button",{type:"button",className:S.join(" "),onClick:()=>B&&te(s),disabled:!B,children:s.getDate()},t)})})]}),x&&e.jsxs("div",{className:"schedule-cohost-timeslots",ref:R,children:[e.jsxs("div",{className:"schedule-cohost-timeslots-header",children:[e.jsxs("div",{className:"schedule-cohost-timeslots-title",children:[e.jsxs("label",{className:"schedule-cohost-label",children:["Select ",e.jsx("u",{children:"3"})," Time Slots (EST)"]}),e.jsxs("span",{className:"schedule-cohost-count",children:[b.length,"/3 selected"]})]}),b.length>0&&e.jsx("button",{className:"schedule-cohost-clear-btn",onClick:oe,type:"button",children:"Clear Time Slots"})]}),e.jsxs("div",{className:"schedule-cohost-selected-date",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),e.jsx("span",{children:_(x)})]}),e.jsx("div",{className:"schedule-cohost-slots-grid",children:Q.map(s=>{const t=b.some(j=>j.id===s.id),h=!t&&b.length>=3;return e.jsx("button",{className:`schedule-cohost-slot ${t?"schedule-cohost-slot--selected":""} ${h?"schedule-cohost-slot--disabled":""}`,onClick:()=>Y(s),disabled:h,type:"button",children:s.formattedTime},s.id)})}),e.jsx("p",{className:"schedule-cohost-timezone",children:"Times shown in Eastern Standard Time (EST)"}),b.length>0&&e.jsxs("div",{className:"schedule-cohost-selections-summary",children:[e.jsx("label",{className:"schedule-cohost-label",children:"Your selected time slots:"}),e.jsx("div",{className:"schedule-cohost-selections-list",children:b.map((s,t)=>e.jsxs("div",{className:"schedule-cohost-selection-item",children:[e.jsxs("span",{className:"schedule-cohost-selection-number",children:["#",t+1]}),e.jsx("span",{className:"schedule-cohost-selection-datetime",children:s.displayTime}),e.jsx("button",{type:"button",className:"schedule-cohost-selection-remove",onClick:()=>Y(s),"aria-label":`Remove ${s.displayTime}`,children:"×"})]},s.id))})]})]}),e.jsxs("div",{className:"schedule-cohost-form",children:[e.jsxs("div",{className:"schedule-cohost-field",children:[e.jsx("label",{className:"schedule-cohost-label",children:"What would you like help with?"}),e.jsx("div",{className:"schedule-cohost-subjects",children:Me.map(s=>e.jsxs("button",{type:"button",className:`schedule-cohost-subject-tag ${M.includes(s)?"schedule-cohost-subject-tag--selected":""}`,onClick:()=>ce(s),children:[s,M.includes(s)&&e.jsx("span",{className:"schedule-cohost-subject-remove",children:"×"})]},s))})]}),e.jsxs("div",{className:"schedule-cohost-field",children:[e.jsx("label",{className:"schedule-cohost-label",children:"Additional details (optional)"}),e.jsx("textarea",{className:"schedule-cohost-textarea",value:w,onChange:ae,placeholder:"Type any details of what you want to get help with (optional)",rows:4}),e.jsxs("span",{className:`schedule-cohost-charcount ${w.length>900?"schedule-cohost-charcount--warning":""}`,children:[w.length,"/1000 characters"]})]})]}),e.jsxs("div",{className:"schedule-cohost-actions",children:[e.jsx("button",{className:"schedule-cohost-submit",onClick:le,disabled:!xe,type:"button",children:y?"Submitting...":E>0?`Select ${E} more slot${E!==1?"s":""}`:"Submit Request"}),!x&&e.jsx("p",{className:"schedule-cohost-hint",children:"Please select a date from the calendar"})]})]}),p==="details"&&c&&e.jsxs("div",{className:"schedule-cohost-details",children:[e.jsx(qe,{currentStatus:c.status||c["Status - Co-Host Request"]||"Co-Host Requested"}),(c["Co-Host selected (OS)"]||c.cohostName)&&e.jsxs("div",{className:"schedule-cohost-assigned-info",children:[e.jsxs("div",{className:"schedule-cohost-assigned-cohost",children:[e.jsx("span",{className:"schedule-cohost-assigned-label",children:"Your Co-Host:"}),e.jsx("span",{className:"schedule-cohost-assigned-value",children:c["Co-Host selected (OS)"]||c.cohostName})]}),(c["Meeting Date Time"]||c.meetingDateTime)&&e.jsxs("div",{className:"schedule-cohost-assigned-meeting",children:[e.jsx("span",{className:"schedule-cohost-assigned-label",children:"Meeting Time:"}),e.jsx("span",{className:"schedule-cohost-assigned-value",children:c["Meeting Date Time"]||c.meetingDateTime})]}),(c["Google Meet Link"]||c.googleMeetLink)&&e.jsx("a",{href:c["Google Meet Link"]||c.googleMeetLink,target:"_blank",rel:"noopener noreferrer",className:"schedule-cohost-meet-link",children:"Join Google Meet"})]}),e.jsx("p",{className:"schedule-cohost-success-text",children:"Your suggested meeting times:"}),e.jsx("div",{className:"schedule-cohost-selected-times",children:(c.selectedTimes||c["Dates and times suggested"]||b||[]).map((t,h)=>{const j=typeof t=="string"?t:t.displayTime||t.formattedTime||"";return e.jsxs("div",{className:"schedule-cohost-selected-time",children:["#",h+1," - ",j]},t.id||h)})}),(c.subject||c["Request notes"])&&e.jsxs("div",{className:"schedule-cohost-details-subject",children:[e.jsx("strong",{children:"Request:"})," ",c.subject||c["Request notes"]]}),e.jsx("p",{className:"schedule-cohost-success-info",children:"We'll reach out to confirm a time that works for everyone. You'll receive a confirmation email and SMS shortly."}),G(c.status||c["Status - Co-Host Request"])>=4&&e.jsxs("div",{className:"schedule-cohost-details-section",children:[e.jsx("h4",{className:"schedule-cohost-details-title",children:"How was your meeting?"}),e.jsx(Re,{value:D,onChange:V,disabled:y}),e.jsx("textarea",{className:"schedule-cohost-feedback-textarea",value:q,onChange:s=>z(Te(s.target.value)),placeholder:"Anything you would like to share about your Co-Host experience? (optional)",rows:3,"aria-label":"Feedback message (optional)"}),e.jsx("button",{className:"schedule-cohost-submit-rating-btn",onClick:re,disabled:D===0||y,type:"button",children:y?"Submitting...":"Submit Rating"})]}),e.jsx("div",{className:"schedule-cohost-actions",children:e.jsx("button",{className:"schedule-cohost-done-btn",onClick:f,type:"button",children:"Done"})}),e.jsxs("div",{className:"schedule-cohost-metadata-centered",children:[(c.createdDate||c["Created Date"])&&e.jsxs("p",{children:["Created: ",_(new Date(c.createdDate||c["Created Date"]))]}),(c.id||c._id)&&e.jsxs("p",{children:["Unique ID: ",c.id||c._id]})]})]})]})})}export{Pe as S};

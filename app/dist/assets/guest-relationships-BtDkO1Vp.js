import{r as d,j as e,c as gs,R as us}from"./client-BJVKzfAi.js";import{s as ps}from"./supabase-BoCLEw6R.js";import{U as xs,M as ze,A as js}from"./AdminHeader-tCInZd3n.js";import{U as T}from"./user-C2rhnql4.js";import{C as Me}from"./calendar-CDI4qHEX.js";import{M as ce}from"./mail-CRbL90NL.js";import{P as Pe}from"./phone-JQItnCAU.js";import{U as Fe}from"./users-d0RSvnp4.js";import{S as ke}from"./search-CwPLSYgc.js";import{c as Le}from"./createLucideIcon-CgZZH2OU.js";import{C as fs}from"./clock-BT0kKcUb.js";import{S as Te}from"./send-C4mziT0-.js";import{C as Be}from"./star-OtPMgcH9.js";import{F as de}from"./file-text-Bqp_Hw0X.js";import{P as me}from"./plus-DM0NjXG9.js";import{H as W}from"./house-_O8RlyPO.js";import{M as Ns}from"./moon-dFwEaCUk.js";import{D as _e}from"./dollar-sign-Dn2-KjNW.js";import{T as Ee}from"./trash-2-DKO8yvV5.js";import{S as vs}from"./square-BGeZC4Cm.js";import{M as bs}from"./map-pin-Be7EkBk1.js";import{E as Ss}from"./eye-J9MlnJAi.js";import{B as we}from"./book-open-C2XUWVN0.js";import{I as ys}from"./info-CcVWtG4-.js";import{C as Cs}from"./circle-alert-C7SsrRDS.js";import{C as ws}from"./circle-check-big-42edTrxg.js";import{E as As}from"./ErrorBoundary-9_HbXv1y.js";/* empty css             */import"./config-QPKPRtag.js";import"./auth-QZ4BJadW.js";import"./triangle-alert-Bp6DQQmR.js";import"./pen-line-Duo49k9O.js";import"./user-check-CoCGzn5Y.js";import"./x-CrJVeoCh.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],Ls=Le("ellipsis",Ps);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],zs=Le("history",Es);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ks=[["path",{d:"M21 10.656V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.344",key:"2acyp4"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],De=Le("square-check-big",ks);var Re;const Ts=((Re=window.ENV)==null?void 0:Re.SUPABASE_URL)||"https://qcfifybkaddcoimjroca.supabase.co";async function _s(){const{data:{session:s}}=await ps.auth.getSession();return(s==null?void 0:s.access_token)||null}async function z(s,r,o={}){const m=await _s();if(!m)throw new Error("Authentication required");const u=await fetch(`${Ts}/functions/v1/${s}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({action:r,payload:o})}),p=await u.json();if(!u.ok||!p.success)throw new Error(p.error||`Request failed: ${u.status}`);return p.data}async function oe({query:s,searchType:r="all",limit:o=20}){return z("guest-management","search_guests",{query:s,searchType:r,limit:o})}async function Ds(s,r={}){const{includeHistory:o=!0,includeArticles:m=!0}=r;return z("guest-management","get_guest",{guestId:s,includeHistory:o,includeArticles:m})}async function Rs(s){return z("guest-management","create_guest",s)}async function Ms(s,r){return z("guest-management","assign_article",{guestId:s,articleId:r})}async function Fs(s,r){return z("guest-management","remove_article",{guestId:s,articleId:r})}async function Bs(s={}){return z("guest-management","list_articles",s)}async function $s({to:s,subject:r,body:o,bcc:m}){return z("send-email","send",{to:s,subject:r,body:o,bcc:m||"noisybubble-aaaafnhc4jdlagc3jg3cdatmi@splitlease.slack.com"})}async function Us({to:s,body:r}){return z("send-sms","send",{to:s,body:r})}async function Hs(s={},r=20){return z("listing","search",{filters:s,limit:r})}async function Is(s,r={}){const{type:o="all"}=r;return z("proposal","get",{userId:s,type:o})}const Gs=[{value:"guest",label:"Guest"},{value:"host",label:"Host"},{value:"corporate",label:"Corporate"},{value:"admin",label:"Admin"}],Os=[{value:"custom",label:"Custom Email"},{value:"welcome",label:"Welcome Email"},{value:"reminder",label:"Reminder Email"},{value:"follow-up",label:"Follow Up"}];function Ae(s,r){let o;return function(...u){const p=()=>{clearTimeout(o),s(...u)};clearTimeout(o),o=setTimeout(p,r)}}function qs(s){if(!s)return"";const r=s.replace(/\D/g,"");return r.length===10?`(${r.slice(0,3)}) ${r.slice(3,6)}-${r.slice(6)}`:r.length===11&&r[0]==="1"?`+1 (${r.slice(1,4)}) ${r.slice(4,7)}-${r.slice(7)}`:s}function Ys(){const[s,r]=d.useState(null),[o,m]=d.useState([]),[u,p]=d.useState(!1),[S,h]=d.useState(""),[A,N]=d.useState(""),[v,x]=d.useState(""),[y,P]=d.useState(!1),[L,C]=d.useState(!1),[n,b]=d.useState(!1),[c,E]=d.useState({firstName:"",lastName:"",birthDate:"",email:"",phoneNumber:"",userType:"guest"}),[t,l]=d.useState({}),[w,V]=d.useState(!1),[he,ge]=d.useState("custom"),[_,K]=d.useState(""),[D,J]=d.useState(""),[R,Q]=d.useState(""),[ue,X]=d.useState([]),[pe,M]=d.useState(!1),[xe,H]=d.useState([]),[je,F]=d.useState([]),[Z,ee]=d.useState([]),[I,se]=d.useState([]),[fe,ae]=d.useState(!1),[Ne,G]=d.useState([]),[re,ie]=d.useState([]),[B,ve]=d.useState([]),[O,$]=d.useState([]),[be,te]=d.useState(""),[Se,U]=d.useState(!1),[ye,ne]=d.useState(!1),[Ce,le]=d.useState(null),[q,Y]=d.useState(null);d.useEffect(()=>{$e()},[]);async function $e(){try{ne(!0);const[a,i,g]=await Promise.all([Bs({limit:50}).catch(()=>({articles:[]})),oe({query:"",limit:20}).catch(()=>[]),Hs({},20).catch(()=>[])]);ve(a.articles||[]),ie(i||[]),se(g||[])}catch(a){console.error("Failed to load initial data:",a),le("Failed to load data. Please refresh the page.")}finally{ne(!1)}}d.useEffect(()=>{s!=null&&s._id?Ue(s._id):($([]),H([]),F([]))},[s==null?void 0:s._id]);async function Ue(a){try{ae(!0);const[i,g]=await Promise.all([Ds(a,{includeHistory:!0,includeArticles:!0}),Is(a).catch(()=>[])]);i.assignedArticles&&$(i.assignedArticles);const j=g||[];H(j.filter(k=>k.type==="current"||!k.type)),F(j.filter(k=>k.type==="suggested"))}catch(i){console.error("Failed to load guest details:",i),f("Failed to load guest details","error")}finally{ae(!1)}}const He=d.useCallback(Ae(async a=>{if(!a||a.length<2){m([]);return}try{p(!0);const i=await oe({query:a,searchType:"name",limit:10});m(i||[])}catch(i){console.error("Search failed:",i)}finally{p(!1)}},300),[]),Ie=d.useCallback(Ae(async a=>{if(!a||a.length<3){m([]);return}try{p(!0);const i=await oe({query:a,searchType:"phone",limit:10});m(i||[])}catch(i){console.error("Search failed:",i)}finally{p(!1)}},300),[]),Ge=d.useCallback(Ae(async a=>{if(!a||a.length<3){m([]);return}try{p(!0);const i=await oe({query:a,searchType:"email",limit:10});m(i||[])}catch(i){console.error("Search failed:",i)}finally{p(!1)}},300),[]);function Oe(a){h(a),He(a)}function qe(a){N(a),Ie(a)}function Ye(a){x(a),Ge(a)}function We(a){r(a),h(""),N(""),x(""),P(!1),C(!1),b(!1),m([])}function Ve(){r(null)}function Ke(a,i){E(g=>({...g,[a]:i})),t[a]&&l(g=>({...g,[a]:void 0}))}function Je(){var i,g,j,k;const a={};return(i=c.firstName)!=null&&i.trim()||(a.firstName="First name is required"),(g=c.lastName)!=null&&g.trim()||(a.lastName="Last name is required"),(j=c.email)!=null&&j.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(c.email)||(a.email="Please enter a valid email"):a.email="Email is required",(k=c.phoneNumber)!=null&&k.trim()||(a.phoneNumber="Phone number is required"),l(a),Object.keys(a).length===0}async function Qe(){if(Je())try{V(!0);const a=await Rs(c);r({_id:a._id,firstName:a.firstName,lastName:a.lastName,email:a.email,phoneNumber:a.phoneNumber}),E({firstName:"",lastName:"",birthDate:"",email:"",phoneNumber:"",userType:"guest"}),ie(i=>[a,...i]),f("Customer created successfully","success")}catch(a){console.error("Failed to create customer:",a),f(a.message||"Failed to create customer","error")}finally{V(!1)}}async function Xe(){if(!s||!_||!D){f("Please fill in all email fields","error");return}try{M(!0),await $s({to:s.email,subject:_,body:D});const a={id:`msg-${Date.now()}`,senderId:"staff",recipientId:s._id,messageBody:`Subject: ${_}

${D}`,messageType:"email",status:"sent",timestamp:new Date().toISOString()};X(i=>[a,...i]),K(""),J(""),f("Email sent successfully","success")}catch(a){console.error("Failed to send email:",a),f(a.message||"Failed to send email","error")}finally{M(!1)}}async function Ze(){var g;if(!s||!R){f("Please enter a message","error");return}const a=(g=s.phoneNumber)==null?void 0:g.replace(/\D/g,"");if(!a||a.length<10){f("Invalid phone number","error");return}const i=a.length===10?`+1${a}`:`+${a}`;try{M(!0),await Us({to:i,body:R});const j={id:`msg-${Date.now()}`,senderId:"staff",recipientId:s._id,messageBody:R,messageType:"sms",status:"sent",timestamp:new Date().toISOString()};X(k=>[j,...k]),Q(""),f("SMS sent successfully","success")}catch(j){console.error("Failed to send SMS:",j),f(j.message||"Failed to send SMS","error")}finally{M(!1)}}function es(a){H(i=>i.filter(g=>g.id!==a)),F(i=>i.filter(g=>g.id!==a)),f("Proposal removed","success")}function ss(a){f("Pricing confirmation not yet implemented","info")}function as(a){const i=I.find(j=>j._id===a||j.id===a);if(!i)return;const g={id:`prop-${Date.now()}`,listingId:a,listing:i,userId:(s==null?void 0:s._id)||"",moveInDate:new Date().toISOString().split("T")[0],daysSelected:7,nights:7,duration:"1 week",nightlyPrice:100,status:"pending",type:"suggested",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};F(j=>[...j,g]),f("Suggested proposal added","success")}function rs(a,i){const g=I.find(j=>j._id===a||j.id===a);g&&!Z.some(j=>(j._id||j.id)===a)&&(ee(j=>[...j,g]),f("Listing added","success"))}function is(a){ee(i=>i.filter(g=>(g._id||g.id)!==a)),f("Listing removed","success")}function ts(a){f("Curated listing feature not yet implemented","info")}function ns(){G(re.map(a=>a._id))}function ls(){G([])}function ds(a){G(i=>i.includes(a)?i.filter(g=>g!==a):[...i,a])}async function os(a){if(!(!s||!a))try{U(!0),await Ms(s._id,a);const i=B.find(g=>g.id===a);i&&$(g=>[...g,{...i,assignedAt:new Date().toISOString()}]),te(""),f("Article assigned","success")}catch(i){console.error("Failed to assign article:",i),f(i.message||"Failed to assign article","error")}finally{U(!1)}}async function cs(a){if(!(!s||!a))try{U(!0),await Fs(s._id,a),$(i=>i.filter(g=>g.id!==a)),f("Article removed","success")}catch(i){console.error("Failed to remove article:",i),f(i.message||"Failed to remove article","error")}finally{U(!1)}}function f(a,i="info"){Y({message:a,type:i}),setTimeout(()=>Y(null),4e3)}const ms=d.useMemo(()=>{const a=new Set(O.map(i=>i.id));return B.filter(i=>!a.has(i.id))},[B,O]),hs=(s==null?void 0:s.history)||[];return{USER_TYPES:Gs,MESSAGE_TYPES:Os,selectedGuest:s,guestSearchResults:o,isSearchingGuests:u,nameSearch:S,phoneSearch:A,emailSearch:v,showNameDropdown:y,showPhoneDropdown:L,showEmailDropdown:n,handleNameSearchChange:Oe,handlePhoneSearchChange:qe,handleEmailSearchChange:Ye,handleGuestSelect:We,handleClearSelectedGuest:Ve,setShowNameDropdown:P,setShowPhoneDropdown:C,setShowEmailDropdown:b,createCustomerForm:c,createCustomerErrors:t,isCreatingCustomer:w,handleCreateCustomerFieldChange:Ke,handleCreateCustomer:Qe,messageType:he,setMessageType:ge,emailSubject:_,setEmailSubject:K,emailBody:D,setEmailBody:J,smsBody:R,setSmsBody:Q,messageHistory:ue,isSendingMessage:pe,handleSendEmail:Xe,handleSendSMS:Ze,currentProposals:xe,suggestedProposals:je,isLoadingProposals:fe,handleRemoveProposal:es,handleConfirmPricing:ss,handleAddSuggestedProposal:as,suggestedListings:Z,allListings:I,handleAddListing:rs,handleRemoveListing:is,handleAddCuratedListing:ts,selectedUsers:Ne,allGuests:re,handleSelectAllGuests:ns,handleDeselectAllGuests:ls,handleToggleUserSelection:ds,allArticles:B,assignedArticles:O,availableArticles:ms,selectedArticleToAdd:be,setSelectedArticleToAdd:te,isLoadingArticles:Se,handleAddArticle:os,handleRemoveArticle:cs,guestHistory:hs,isLoading:ye,error:Ce,toast:q,formatPhoneNumber:qs}}function Ws({formData:s,errors:r,userTypes:o,isLoading:m,onFieldChange:u,onSubmit:p}){function S(h){h.preventDefault(),p()}return e.jsxs("div",{className:"grd-section",children:[e.jsxs("h2",{className:"grd-section-title",children:[e.jsx(xs,{size:20}),"Create Customer"]}),e.jsxs("form",{onSubmit:S,className:"grd-form",children:[e.jsxs("div",{className:"grd-form-grid",children:[e.jsxs("div",{className:"grd-form-field",children:[e.jsxs("label",{className:"grd-form-label",children:[e.jsx(T,{size:16}),"First Name"]}),e.jsx("input",{type:"text",className:`grd-form-input ${r.firstName?"grd-form-input-error":""}`,placeholder:"Choose a first name",value:s.firstName,onChange:h=>u("firstName",h.target.value)}),r.firstName&&e.jsx("span",{className:"grd-error-text",children:r.firstName})]}),e.jsxs("div",{className:"grd-form-field",children:[e.jsxs("label",{className:"grd-form-label",children:[e.jsx(T,{size:16}),"Last Name"]}),e.jsx("input",{type:"text",className:`grd-form-input ${r.lastName?"grd-form-input-error":""}`,placeholder:"Choose a last name",value:s.lastName,onChange:h=>u("lastName",h.target.value)}),r.lastName&&e.jsx("span",{className:"grd-error-text",children:r.lastName})]}),e.jsxs("div",{className:"grd-form-field",children:[e.jsxs("label",{className:"grd-form-label",children:[e.jsx(Me,{size:16}),"Birth Date *"]}),e.jsx("input",{type:"date",className:`grd-form-input ${r.birthDate?"grd-form-input-error":""}`,value:s.birthDate,onChange:h=>u("birthDate",h.target.value)}),r.birthDate&&e.jsx("span",{className:"grd-error-text",children:r.birthDate})]}),e.jsxs("div",{className:"grd-form-field",children:[e.jsxs("label",{className:"grd-form-label",children:[e.jsx(ce,{size:16}),"Email"]}),e.jsx("input",{type:"email",className:`grd-form-input ${r.email?"grd-form-input-error":""}`,placeholder:"Choose an email",value:s.email,onChange:h=>u("email",h.target.value)}),r.email&&e.jsx("span",{className:"grd-error-text",children:r.email})]}),e.jsxs("div",{className:"grd-form-field",children:[e.jsxs("label",{className:"grd-form-label",children:[e.jsx(Pe,{size:16}),"Phone Number"]}),e.jsx("input",{type:"tel",className:`grd-form-input ${r.phoneNumber?"grd-form-input-error":""}`,placeholder:"Choose a phone number",value:s.phoneNumber,onChange:h=>u("phoneNumber",h.target.value)}),r.phoneNumber&&e.jsx("span",{className:"grd-error-text",children:r.phoneNumber})]}),e.jsxs("div",{className:"grd-form-field",children:[e.jsxs("label",{className:"grd-form-label",children:[e.jsx(Fe,{size:16}),"User Type"]}),e.jsxs("select",{className:"grd-form-input grd-form-select",value:s.userType,onChange:h=>u("userType",h.target.value),children:[e.jsx("option",{value:"",disabled:!0,children:"Choose a user type"}),o.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))]})]})]}),e.jsx("button",{type:"submit",className:"grd-btn grd-btn-primary grd-submit-btn",disabled:m,children:m?"Creating...":"Create Customer"})]})]})}function Vs({guests:s,selectedGuest:r,nameSearch:o,phoneSearch:m,emailSearch:u,showNameDropdown:p,showPhoneDropdown:S,showEmailDropdown:h,isSearching:A,onNameSearchChange:N,onPhoneSearchChange:v,onEmailSearchChange:x,onGuestSelect:y,onClearGuest:P,setShowNameDropdown:L,setShowPhoneDropdown:C,setShowEmailDropdown:n,formatPhoneNumber:b}){const c=d.useRef(null),E=d.useRef(null),t=d.useRef(null);return d.useEffect(()=>{function l(w){c.current&&!c.current.contains(w.target)&&L(!1),E.current&&!E.current.contains(w.target)&&C(!1),t.current&&!t.current.contains(w.target)&&n(!1)}return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[L,C,n]),e.jsxs("div",{className:"grd-section",children:[e.jsx("h2",{className:"grd-section-title",children:"Select a Guest by only one of the following fields"}),e.jsxs("div",{className:"grd-search-grid",children:[e.jsxs("div",{className:"grd-search-field",ref:c,children:[e.jsxs("label",{className:"grd-search-label",children:[e.jsx(T,{size:16}),"Search by Name"]}),e.jsxs("div",{className:"grd-search-input-wrapper",children:[e.jsx(ke,{size:16,className:"grd-search-icon"}),e.jsx("input",{type:"text",className:"grd-search-input",placeholder:"Search guest by name...",value:o,onChange:l=>N(l.target.value),onFocus:()=>L(!0)})]}),p&&o&&s.length>0&&e.jsx("div",{className:"grd-search-dropdown",children:s.slice(0,10).map(l=>e.jsxs("div",{className:"grd-dropdown-option",onClick:()=>y(l),children:[e.jsx("div",{className:"grd-option-avatar",children:l.profilePhoto?e.jsx("img",{src:l.profilePhoto,alt:""}):e.jsx(T,{size:16})}),e.jsxs("div",{className:"grd-option-info",children:[e.jsxs("span",{className:"grd-option-name",children:[l.firstName," ",l.lastName]}),e.jsx("span",{className:"grd-option-secondary",children:l.email})]})]},l._id))})]}),e.jsxs("div",{className:"grd-search-field",ref:E,children:[e.jsxs("label",{className:"grd-search-label",children:[e.jsx(Pe,{size:16}),"Search by Phone"]}),e.jsxs("div",{className:"grd-search-input-wrapper",children:[e.jsx(ke,{size:16,className:"grd-search-icon"}),e.jsx("input",{type:"text",className:"grd-search-input",placeholder:"Search guest by phone...",value:m,onChange:l=>v(l.target.value),onFocus:()=>C(!0)})]}),S&&m&&s.length>0&&e.jsx("div",{className:"grd-search-dropdown",children:s.slice(0,10).map(l=>e.jsxs("div",{className:"grd-dropdown-option",onClick:()=>y(l),children:[e.jsx("div",{className:"grd-option-avatar",children:l.profilePhoto?e.jsx("img",{src:l.profilePhoto,alt:""}):e.jsx(T,{size:16})}),e.jsxs("div",{className:"grd-option-info",children:[e.jsx("span",{className:"grd-option-name",children:b(l.phoneNumber)}),e.jsxs("span",{className:"grd-option-secondary",children:[l.firstName," ",l.lastName]})]})]},l._id))})]})]}),e.jsxs("div",{className:"grd-email-search-section",children:[e.jsx("span",{className:"grd-or-divider",children:"or Enter an email:"}),e.jsxs("div",{className:"grd-search-field",ref:t,children:[e.jsxs("div",{className:"grd-search-input-wrapper",children:[e.jsx(ce,{size:16,className:"grd-search-icon"}),e.jsx("input",{type:"email",className:"grd-search-input",placeholder:"Choose by email...",value:u,onChange:l=>x(l.target.value),onFocus:()=>n(!0)})]}),h&&u&&s.length>0&&e.jsx("div",{className:"grd-search-dropdown",children:s.slice(0,10).map(l=>e.jsxs("div",{className:"grd-dropdown-option",onClick:()=>y(l),children:[e.jsx("div",{className:"grd-option-avatar",children:l.profilePhoto?e.jsx("img",{src:l.profilePhoto,alt:""}):e.jsx(T,{size:16})}),e.jsxs("div",{className:"grd-option-info",children:[e.jsx("span",{className:"grd-option-name",children:l.email}),e.jsxs("span",{className:"grd-option-secondary",children:[l.firstName," ",l.lastName]})]})]},l._id))})]})]}),r&&e.jsx("div",{className:"grd-selected-guest-card",children:e.jsxs("div",{className:"grd-selected-guest-header",children:[e.jsx("div",{className:"grd-selected-avatar",children:r.profilePhoto?e.jsx("img",{src:r.profilePhoto,alt:""}):e.jsx(T,{size:32})}),e.jsxs("div",{className:"grd-selected-info",children:[e.jsxs("h3",{children:[r.firstName," ",r.lastName]}),e.jsx("p",{children:r.email}),e.jsx("p",{children:b(r.phoneNumber)})]}),e.jsx("button",{className:"grd-btn grd-btn-secondary grd-btn-sm",onClick:P,children:"Clear"})]})}),A&&e.jsxs("div",{className:"grd-search-loading",children:[e.jsx("div",{className:"grd-spinner-sm"}),e.jsx("span",{children:"Searching..."})]})]})}function Ks({history:s}){function r(o){return new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}return e.jsxs("div",{className:"grd-section",children:[e.jsxs("h2",{className:"grd-section-title",children:[e.jsx(zs,{size:20}),"History"]}),e.jsx("div",{className:"grd-history-content",children:s&&s.length>0?e.jsx("div",{className:"grd-history-list",children:s.map((o,m)=>e.jsxs("div",{className:"grd-history-item",children:[e.jsx(fs,{size:14,className:"grd-history-icon"}),e.jsxs("span",{className:"grd-history-text",children:["Page visited: ",e.jsx("strong",{children:o.page})," on ",r(o.date)]})]},m))}):e.jsx("p",{className:"grd-history-empty",children:"No history available"})})]})}const Js=[{id:"1",name:"Welcome New Guest",subject:"Welcome to Split Lease!"},{id:"2",name:"Proposal Reminder",subject:"Your Proposal is Waiting"},{id:"3",name:"Check-In Instructions",subject:"Your Check-In Details"},{id:"4",name:"Review Request",subject:"How was your stay?"}];function Qs({selectedGuest:s,messageTypes:r,messageType:o,emailSubject:m,emailBody:u,smsBody:p,messageHistory:S,isLoading:h,onMessageTypeChange:A,onEmailSubjectChange:N,onEmailBodyChange:v,onSmsBodyChange:x,onSendEmail:y,onSendSMS:P,formatPhoneNumber:L}){const[C,n]=d.useState(!1);function b(c){N(c.subject),n(!1)}return e.jsxs("div",{className:"grd-section",children:[e.jsxs("div",{className:"grd-messaging-header",children:[e.jsxs("h2",{className:"grd-section-title",children:[e.jsx(ce,{size:20}),"Send Messages"]}),e.jsx("div",{className:"grd-message-type-selector",children:e.jsxs("select",{className:"grd-form-select",value:o,onChange:c=>A(c.target.value),children:[e.jsx("option",{value:"",children:"Choose an option..."}),r.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))]})})]}),s&&e.jsxs("div",{className:"grd-guest-contact-info",children:[e.jsx("div",{className:"grd-contact-avatar",children:s.profilePhoto?e.jsx("img",{src:s.profilePhoto,alt:""}):e.jsx(T,{size:24})}),e.jsxs("div",{className:"grd-contact-details",children:[e.jsxs("span",{className:"grd-contact-name",children:[s.firstName," ",s.lastName]}),e.jsxs("span",{className:"grd-contact-phone",children:[e.jsx(Pe,{size:14}),L(s.phoneNumber)]})]})]}),e.jsxs("div",{className:"grd-email-section",children:[e.jsx("h3",{className:"grd-subsection-title",children:"Custom Email"}),e.jsxs("div",{className:"grd-email-form",children:[e.jsxs("div",{className:"grd-form-field",children:[e.jsx("label",{className:"grd-form-label",children:"Subject Line"}),e.jsx("input",{type:"text",className:"grd-form-input",placeholder:"Enter email subject...",value:m,onChange:c=>N(c.target.value)})]}),e.jsxs("div",{className:"grd-form-field",children:[e.jsx("label",{className:"grd-form-label",children:"Email Body"}),e.jsx("textarea",{className:"grd-form-input grd-form-textarea",placeholder:"Enter email body...",rows:6,value:u,onChange:c=>v(c.target.value)})]}),e.jsxs("button",{className:"grd-btn grd-btn-primary grd-send-btn",onClick:y,disabled:!s||!m||!u||h,children:[e.jsx(Te,{size:16}),"Send"]})]})]}),e.jsxs("div",{className:"grd-preset-emails-section",children:[e.jsxs("h3",{className:"grd-subsection-title",children:["Preset Emails",e.jsx("span",{className:"grd-subtitle-note",children:"(templates for common emails)"})]}),e.jsx("a",{href:"mailto:Robert@leasesplit.com",className:"grd-email-link",target:"_blank",rel:"noopener noreferrer",children:"Link to Email (be sure to be signed into Robert@leasesplit.com)"}),e.jsxs("div",{className:"grd-preset-dropdown-wrapper",children:[e.jsxs("button",{className:"grd-preset-dropdown-trigger",onClick:()=>n(!C),children:["Select a preset email",e.jsx(Be,{size:16})]}),C&&e.jsx("div",{className:"grd-preset-dropdown-menu",children:Js.map(c=>e.jsx("button",{className:"grd-preset-option",onClick:()=>b(c),children:c.name},c.id))})]})]}),e.jsxs("div",{className:"grd-sms-section",children:[e.jsxs("h3",{className:"grd-subsection-title",children:[e.jsx(ze,{size:18}),"Text Guest"]}),e.jsxs("div",{className:"grd-sms-form",children:[e.jsx("textarea",{className:"grd-form-input grd-form-textarea",placeholder:"Type here message body...",rows:4,value:p,onChange:c=>x(c.target.value)}),e.jsxs("button",{className:"grd-btn grd-btn-primary grd-send-btn",onClick:P,disabled:!s||!p||h,children:[e.jsx(Te,{size:16}),"Send"]})]})]}),S.length>0&&e.jsxs("div",{className:"grd-message-history",children:[e.jsx("h3",{className:"grd-subsection-title",children:"Message History"}),e.jsx("div",{className:"grd-messages-list",children:S.map(c=>e.jsxs("div",{className:"grd-message-item",children:[e.jsxs("div",{className:"grd-message-meta",children:[e.jsxs("span",{className:`grd-message-type-badge grd-message-type-${c.messageType}`,children:[c.messageType==="email"?e.jsx(ce,{size:12}):e.jsx(ze,{size:12}),c.messageType]}),e.jsx("span",{className:"grd-message-time",children:new Date(c.timestamp).toLocaleString()})]}),e.jsx("p",{className:"grd-message-body",children:c.messageBody})]},c.id))})]})]})}function Xs({currentProposals:s,suggestedProposals:r,availableListings:o,isLoading:m,onRemoveProposal:u,onConfirmPricing:p,onAddSuggestedProposal:S}){const[h,A]=d.useState(!1),[N,v]=d.useState("");function x(){N&&(S(N),v(""),A(!1))}function y(n){return`#P${n.slice(0,8).toUpperCase()}`}function P(n){return new Date(n).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function L(n){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(n||0)}function C({proposal:n,type:b}){var t;const c=n.listing||{},E=c.photos||[];return e.jsxs("div",{className:"grd-proposal-card",children:[e.jsx("div",{className:"grd-proposal-image",children:(t=E[0])!=null&&t.url?e.jsx("img",{src:E[0].url,alt:c.name||"Listing"}):e.jsx("div",{className:"grd-placeholder-image",children:e.jsx(W,{size:32})})}),e.jsxs("div",{className:"grd-proposal-details",children:[e.jsx("h4",{className:"grd-proposal-listing-name",children:c.name||"Unknown Listing"}),e.jsxs("div",{className:"grd-proposal-info-grid",children:[e.jsxs("div",{className:"grd-proposal-info-item",children:[e.jsx(Me,{size:14}),e.jsxs("span",{children:["Move in: ",P(n.moveInDate)]})]}),e.jsxs("div",{className:"grd-proposal-info-item",children:[e.jsx(Ns,{size:14}),e.jsxs("span",{children:[n.nights||7," nights"]})]}),e.jsx("div",{className:"grd-proposal-info-item",children:e.jsx("span",{className:"grd-duration-badge",children:n.duration||"1 week"})}),e.jsxs("div",{className:"grd-proposal-info-item grd-price",children:[e.jsx(_e,{size:14}),e.jsxs("span",{children:[L(n.nightlyPrice),"/night"]})]})]}),e.jsx("div",{className:"grd-proposal-id",children:y(n.id||n._id)})]}),e.jsxs("div",{className:"grd-proposal-actions",children:[b==="current"&&e.jsxs("button",{className:"grd-btn grd-btn-secondary grd-btn-sm",onClick:()=>p(n.id||n._id),children:[e.jsx(_e,{size:14}),"Confirm Pricing"]}),e.jsx("button",{className:"grd-btn grd-btn-icon",onClick:()=>u(n.id||n._id),title:"Remove",children:e.jsx(Ee,{size:16})}),e.jsx("button",{className:"grd-btn grd-btn-icon",title:"More options",children:e.jsx(Ls,{size:16})})]})]})}return e.jsxs("div",{className:"grd-proposals-section",children:[e.jsxs("div",{className:"grd-proposals-group",children:[e.jsxs("div",{className:"grd-proposals-header",children:[e.jsxs("h2",{className:"grd-section-title",children:[e.jsx(de,{size:20}),"Current Proposals"]}),e.jsx("span",{className:"grd-proposals-count",children:s.length})]}),e.jsx("div",{className:"grd-proposals-list",children:s.length>0?s.map(n=>e.jsx(C,{proposal:n,type:"current"},n.id||n._id)):e.jsxs("div",{className:"grd-empty-state",children:[e.jsx(de,{size:32}),e.jsx("p",{children:"No current proposals"})]})})]}),e.jsxs("div",{className:"grd-proposals-group",children:[e.jsxs("div",{className:"grd-proposals-header",children:[e.jsxs("h2",{className:"grd-section-title",children:[e.jsx(de,{size:20}),"Suggested Proposals"]}),e.jsxs("button",{className:"grd-btn grd-btn-primary grd-btn-sm",onClick:()=>A(!h),children:[e.jsx(me,{size:14}),"Add Suggested Proposal"]})]}),h&&e.jsxs("div",{className:"grd-add-proposal-form",children:[e.jsxs("select",{className:"grd-form-select",value:N,onChange:n=>v(n.target.value),children:[e.jsx("option",{value:"",children:"Select a listing..."}),o.map(n=>{var b;return e.jsxs("option",{value:n._id||n.id,children:[n.name||n["Listing Name"]," - ",((b=n.location)==null?void 0:b.hood)||n["Hood - Text"]||"NYC"]},n._id||n.id)})]}),e.jsx("button",{className:"grd-btn grd-btn-primary grd-btn-sm",onClick:x,disabled:!N,children:"Add"})]}),e.jsx("div",{className:"grd-proposals-list",children:r.length>0?r.map(n=>e.jsx(C,{proposal:n,type:"suggested"},n.id||n._id)):e.jsxs("div",{className:"grd-empty-state",children:[e.jsx(de,{size:32}),e.jsx("p",{children:"No suggested proposals"})]})})]}),m&&e.jsxs("div",{className:"grd-loading-indicator",children:[e.jsx("div",{className:"grd-spinner-sm"}),e.jsx("span",{children:"Loading proposals..."})]})]})}function Zs({suggestedListings:s,allListings:r,allGuests:o,selectedUsers:m,onAddListing:u,onRemoveListing:p,onAddCuratedListing:S,onSelectAllGuests:h,onDeselectAllGuests:A,onToggleUserSelection:N}){const[v,x]=d.useState(""),[y,P]=d.useState("");function L(){v&&m.length>0&&(u(v,m),x(""))}function C(){y&&(S(y),P(""))}function n(t){return t.name||t["Listing Name"]||"Unnamed Listing"}function b(t){var l;return((l=t.location)==null?void 0:l.hood)||t["Hood - Text"]||"NYC"}function c(t){var w;const l=t.photos||t["ðŸ“· All Photos for Display"]||[];return((w=l[0])==null?void 0:w.url)||l[0]||null}function E(t){var l;return((l=t.rentalType)==null?void 0:l.display)||t["Rental Type"]||"Rental"}return e.jsxs("div",{className:"grd-listings-section",children:[e.jsxs("div",{className:"grd-listings-group",children:[e.jsx("div",{className:"grd-listings-header",children:e.jsxs("h2",{className:"grd-section-title",children:[e.jsx(Fe,{size:20}),"Selecting Multiple Users"]})}),e.jsxs("div",{className:"grd-multi-user-selector",children:[e.jsxs("div",{className:"grd-user-selection-controls",children:[e.jsxs("button",{className:"grd-btn grd-btn-secondary grd-btn-sm",onClick:h,children:[e.jsx(De,{size:14}),"Select all Guests"]}),e.jsxs("button",{className:"grd-btn grd-btn-secondary grd-btn-sm",onClick:A,children:[e.jsx(vs,{size:14}),"Deselect All"]})]}),e.jsx("div",{className:"grd-users-grid",children:o.slice(0,12).map(t=>{var l,w;return e.jsxs("div",{className:`grd-user-chip ${m.includes(t._id)?"grd-user-chip-selected":""}`,onClick:()=>N(t._id),children:[e.jsx("div",{className:"grd-user-chip-avatar",children:t.profilePhoto?e.jsx("img",{src:t.profilePhoto,alt:""}):e.jsxs("span",{children:[((l=t.firstName)==null?void 0:l[0])||"",((w=t.lastName)==null?void 0:w[0])||""]})}),e.jsxs("span",{className:"grd-user-chip-name",children:[t.firstName," ",t.lastName]}),m.includes(t._id)&&e.jsx(De,{size:14,className:"grd-check-icon"})]},t._id)})})]}),e.jsxs("div",{className:"grd-add-listing-form",children:[e.jsxs("select",{className:"grd-form-select",value:v,onChange:t=>x(t.target.value),children:[e.jsx("option",{value:"",children:"Select a listing..."}),r.map(t=>e.jsx("option",{value:t._id||t.id,children:n(t)},t._id||t.id))]}),e.jsxs("button",{className:"grd-btn grd-btn-primary grd-btn-sm",onClick:L,disabled:!v||m.length===0,children:[e.jsx(me,{size:14}),"Add Listing"]})]})]}),e.jsxs("div",{className:"grd-listings-group",children:[e.jsx("div",{className:"grd-listings-header",children:e.jsxs("h2",{className:"grd-section-title",children:[e.jsx(W,{size:20}),"Add a Curated Listing"]})}),e.jsxs("div",{className:"grd-add-listing-form",children:[e.jsxs("select",{className:"grd-form-select",value:y,onChange:t=>P(t.target.value),children:[e.jsx("option",{value:"",children:"Select a curated listing..."}),r.map(t=>e.jsxs("option",{value:t._id||t.id,children:[n(t)," - ",b(t)]},t._id||t.id))]}),e.jsxs("button",{className:"grd-btn grd-btn-primary grd-btn-sm",onClick:C,disabled:!y,children:[e.jsx(me,{size:14}),"Add"]})]})]}),e.jsxs("div",{className:"grd-listings-group",children:[e.jsxs("div",{className:"grd-listings-header",children:[e.jsxs("h2",{className:"grd-section-title",children:[e.jsx(W,{size:20}),"Listings to be Added to All"]}),e.jsx("span",{className:"grd-listings-count",children:s.length})]}),e.jsx("div",{className:"grd-listings-grid",children:s.length>0?s.map(t=>{const l=t._id||t.id,w=c(t);return e.jsxs("div",{className:"grd-listing-card",children:[e.jsx("div",{className:"grd-listing-image",children:w?e.jsx("img",{src:w,alt:n(t)}):e.jsx("div",{className:"grd-placeholder-image",children:e.jsx(W,{size:32})})}),e.jsxs("div",{className:"grd-listing-info",children:[e.jsx("h4",{className:"grd-listing-name",children:n(t)}),e.jsxs("div",{className:"grd-listing-meta",children:[e.jsxs("span",{className:"grd-listing-location",children:[e.jsx(bs,{size:14}),b(t)]}),e.jsx("span",{className:"grd-listing-type",children:E(t)})]})]}),e.jsxs("div",{className:"grd-listing-actions",children:[e.jsxs("button",{className:"grd-btn grd-btn-secondary grd-btn-sm",children:[e.jsx(Ss,{size:14}),"View Listing"]}),e.jsx("button",{className:"grd-btn grd-btn-icon",onClick:()=>p(l),title:"Remove",children:e.jsx(Ee,{size:16})})]})]},l)}):e.jsxs("div",{className:"grd-empty-state",children:[e.jsx(W,{size:32}),e.jsx("p",{children:"No suggested listings"})]})})]})]})}function ea({articles:s,assignedArticles:r,selectedArticle:o,isLoading:m,onArticleSelect:u,onAddArticle:p,onRemoveArticle:S}){var v;const[h,A]=d.useState(!1);function N(){o&&p(o)}return e.jsxs("div",{className:"grd-section",children:[e.jsx("div",{className:"grd-kb-header",children:e.jsxs("h2",{className:"grd-section-title",children:[e.jsx(we,{size:20}),"Knowledge Base / Blog Article..."]})}),e.jsxs("div",{className:"grd-kb-add-form",children:[e.jsxs("div",{className:"grd-dropdown-wrapper",children:[e.jsxs("button",{className:"grd-dropdown-trigger",onClick:()=>A(!h),children:[o&&((v=s.find(x=>x.id===o))==null?void 0:v.pageHeadline)||"Select an article...",e.jsx(Be,{size:16})]}),h&&e.jsx("div",{className:"grd-dropdown-menu",children:s.length>0?s.map(x=>e.jsxs("button",{className:"grd-dropdown-option-btn",onClick:()=>{u(x.id),A(!1)},children:[e.jsx("span",{className:"grd-option-headline",children:x.pageHeadline}),e.jsx("span",{className:"grd-option-subtext",children:x.pageHeadlineSubtext})]},x.id)):e.jsx("div",{className:"grd-dropdown-empty",children:"No more articles available"})})]}),e.jsxs("button",{className:"grd-btn grd-btn-primary grd-btn-sm",onClick:N,disabled:!o||m,children:[e.jsx(me,{size:14}),"Add"]})]}),e.jsx("div",{className:"grd-kb-articles-list",children:r.length>0?r.map(x=>e.jsxs("div",{className:"grd-kb-article-card",children:[e.jsx("div",{className:"grd-article-icon",children:e.jsx(we,{size:20})}),e.jsxs("div",{className:"grd-article-content",children:[e.jsx("h4",{className:"grd-article-headline",children:x.pageHeadline}),e.jsx("p",{className:"grd-article-subtext",children:x.pageHeadlineSubtext})]}),e.jsxs("button",{className:"grd-btn grd-btn-remove",onClick:()=>S(x.id),disabled:m,children:[e.jsx(Ee,{size:14}),"Remove"]})]},x.id)):e.jsxs("div",{className:"grd-empty-state",children:[e.jsx(we,{size:32}),e.jsx("p",{children:"No knowledge base articles assigned"})]})}),m&&e.jsxs("div",{className:"grd-loading-indicator",children:[e.jsx("div",{className:"grd-spinner-sm"}),e.jsx("span",{children:"Processing..."})]})]})}function sa({message:s,type:r="info"}){const o={success:e.jsx(ws,{size:20}),error:e.jsx(Cs,{size:20}),info:e.jsx(ys,{size:20})};return e.jsxs("div",{className:`grd-toast grd-toast-${r}`,children:[o[r]||o.info,e.jsx("span",{children:s})]})}function aa(){return e.jsxs("div",{className:"grd-loading-overlay",children:[e.jsx("div",{className:"grd-spinner"}),e.jsx("p",{children:"Loading..."})]})}function ra(){const{USER_TYPES:s,MESSAGE_TYPES:r,selectedGuest:o,guestSearchResults:m,isSearchingGuests:u,nameSearch:p,phoneSearch:S,emailSearch:h,showNameDropdown:A,showPhoneDropdown:N,showEmailDropdown:v,handleNameSearchChange:x,handlePhoneSearchChange:y,handleEmailSearchChange:P,handleGuestSelect:L,handleClearSelectedGuest:C,setShowNameDropdown:n,setShowPhoneDropdown:b,setShowEmailDropdown:c,createCustomerForm:E,createCustomerErrors:t,isCreatingCustomer:l,handleCreateCustomerFieldChange:w,handleCreateCustomer:V,messageType:he,setMessageType:ge,emailSubject:_,setEmailSubject:K,emailBody:D,setEmailBody:J,smsBody:R,setSmsBody:Q,messageHistory:ue,isSendingMessage:X,handleSendEmail:pe,handleSendSMS:M,currentProposals:xe,suggestedProposals:H,isLoadingProposals:je,handleRemoveProposal:F,handleConfirmPricing:Z,handleAddSuggestedProposal:ee,suggestedListings:I,allListings:se,handleAddListing:fe,handleRemoveListing:ae,handleAddCuratedListing:Ne,selectedUsers:G,allGuests:re,handleSelectAllGuests:ie,handleDeselectAllGuests:B,handleToggleUserSelection:ve,assignedArticles:O,availableArticles:$,selectedArticleToAdd:be,setSelectedArticleToAdd:te,isLoadingArticles:Se,handleAddArticle:U,handleRemoveArticle:ye,guestHistory:ne,isLoading:Ce,error:le,toast:q,formatPhoneNumber:Y}=Ys();return e.jsxs(e.Fragment,{children:[e.jsx(js,{}),e.jsxs("main",{className:"grd-main",children:[e.jsxs("div",{className:"grd-container",children:[e.jsx("header",{className:"grd-header",children:e.jsx("h1",{className:"grd-title",children:"Relationships Dashboard"})}),le&&e.jsxs("div",{className:"grd-error-banner",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),le]}),e.jsxs("div",{className:"grd-grid",children:[e.jsxs("div",{className:"grd-column",children:[e.jsx(Ws,{formData:E,errors:t,userTypes:s,isLoading:l,onFieldChange:w,onSubmit:V}),e.jsx(Vs,{guests:m,selectedGuest:o,nameSearch:p,phoneSearch:S,emailSearch:h,showNameDropdown:A,showPhoneDropdown:N,showEmailDropdown:v,isSearching:u,onNameSearchChange:x,onPhoneSearchChange:y,onEmailSearchChange:P,onGuestSelect:L,onClearGuest:C,setShowNameDropdown:n,setShowPhoneDropdown:b,setShowEmailDropdown:c,formatPhoneNumber:Y}),o&&e.jsx(Ks,{history:ne}),e.jsx(Qs,{selectedGuest:o,messageTypes:r,messageType:he,emailSubject:_,emailBody:D,smsBody:R,messageHistory:ue,isLoading:X,onMessageTypeChange:ge,onEmailSubjectChange:K,onEmailBodyChange:J,onSmsBodyChange:Q,onSendEmail:pe,onSendSMS:M,formatPhoneNumber:Y}),e.jsx(ea,{articles:$,assignedArticles:O,selectedArticle:be,isLoading:Se,onArticleSelect:te,onAddArticle:U,onRemoveArticle:ye})]}),e.jsxs("div",{className:"grd-column",children:[e.jsx(Xs,{currentProposals:xe,suggestedProposals:H,availableListings:se,isLoading:je,onRemoveProposal:F,onConfirmPricing:Z,onAddSuggestedProposal:ee}),e.jsx(Zs,{suggestedListings:I,allListings:se,allGuests:re,selectedUsers:G,onAddListing:fe,onRemoveListing:ae,onAddCuratedListing:Ne,onSelectAllGuests:ie,onDeselectAllGuests:B,onToggleUserSelection:ve})]})]})]}),Ce&&e.jsx(aa,{})]}),q&&e.jsx(sa,{message:q.message,type:q.type})]})}gs(document.getElementById("root")).render(e.jsx(us.StrictMode,{children:e.jsx(As,{children:e.jsx(ra,{})})}));

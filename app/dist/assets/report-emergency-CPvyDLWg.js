const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/supabase-BoCLEw6R.js","assets/client-BJVKzfAi.js"])))=>i.map(i=>d[i]);
import{r as a,j as e,c as O,R as U}from"./client-BJVKzfAi.js";import{H as N}from"./Header-BJKWma2V.js";import{F as P}from"./Footer-Bzf1rLKh.js";import{_ as M}from"./supabase-BoCLEw6R.js";import{c as $}from"./auth-QZ4BJadW.js";import{i as C,j as q}from"./emergencyService-2rzJUyBu.js";/* empty css             */import"./constants-CPVJY5eo.js";import"./Toast-BQk6Nzgd.js";import"./proposalDataFetcher-CipdyWU2.js";import"./proposalStatuses-1Bj0NYR4.js";const E={emergency_type:"",description:"",proposal_id:"",agreement_number:"",property_address:"",reporter_name:"",reporter_phone:"",reporter_email:"",photo1:null,photo2:null};function B(){const[r,o]=a.useState(E),[p,d]=a.useState({}),[y,g]=a.useState(!1),[x,_]=a.useState(!1),[l,h]=a.useState(null),[u,j]=a.useState(!1),[i,f]=a.useState(null),[w,k]=a.useState([]),[S,v]=a.useState(!1);a.useEffect(()=>{async function t(){try{const s=await $();s.authenticated&&s.user&&(j(!0),f(s.user),o(c=>({...c,reporter_name:`${s.user.firstName||""} ${s.user.lastName||""}`.trim(),reporter_phone:s.user.phone||"",reporter_email:s.user.email||""})),await I(s.user._id))}catch(s){console.error("[ReportEmergencyPage] Auth check failed:",s)}}t()},[]);const I=a.useCallback(async t=>{v(!0);try{const{supabase:s}=await M(async()=>{const{supabase:m}=await import("./supabase-BoCLEw6R.js").then(D=>D.a);return{supabase:m}},__vite__mapDeps([0,1])),{data:c,error:n}=await s.from("proposal").select(`
          _id,
          agreementNumber,
          status,
          moveIn,
          moveOut,
          listing:listing_id (
            _id,
            name,
            streetAddress,
            city
          )
        `).eq("user",t).in("status",["accepted","move_in","active"]).order("moveIn",{ascending:!1});if(n){console.error("[ReportEmergencyPage] Error loading proposals:",n);return}k(c||[])}catch(s){console.error("[ReportEmergencyPage] Failed to load proposals:",s)}finally{v(!1)}},[]),R=a.useCallback(t=>{const{name:s,value:c}=t.target;o(n=>({...n,[s]:c})),p[s]&&d(n=>({...n,[s]:null})),l&&h(null)},[p,l]),F=a.useCallback(t=>{const{name:s,files:c}=t.target;if(c&&c[0]){const n=c[0];if(!n.type.startsWith("image/")){d(m=>({...m,[s]:"Please select an image file"}));return}if(n.size>10*1024*1024){d(m=>({...m,[s]:"Image must be less than 10MB"}));return}o(m=>({...m,[s]:n})),p[s]&&d(m=>({...m,[s]:null}))}},[p]),b=a.useCallback(()=>{const t={};return r.emergency_type||(t.emergency_type="Please select an emergency type"),r.description?r.description.length<20&&(t.description="Please provide more detail (minimum 20 characters)"):t.description="Please describe the emergency",(!r.reporter_name||r.reporter_name.trim().length<2)&&(t.reporter_name="Please enter your name"),r.reporter_phone?r.reporter_phone.replace(/\D/g,"").length<10&&(t.reporter_phone="Please enter a valid phone number"):t.reporter_phone="Please enter your phone number",r.reporter_email?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.reporter_email)||(t.reporter_email="Please enter a valid email address"):t.reporter_email="Please enter your email",d(t),Object.keys(t).length===0},[r]),A=a.useCallback(async t=>{if(t.preventDefault(),!b()){const s=document.querySelector(".form-input--error, .form-select--error, .form-textarea--error");s&&s.scrollIntoView({behavior:"smooth",block:"center"});return}g(!0),h(null);try{let s=null,c=null;r.photo1&&(s=await C(r.photo1)),r.photo2&&(c=await C(r.photo2));const n={emergency_type:r.emergency_type,description:r.description,reporter_name:r.reporter_name.trim(),reporter_phone:r.reporter_phone,reporter_email:r.reporter_email.trim().toLowerCase(),photo1_url:s,photo2_url:c};r.proposal_id&&(n.proposal_id=r.proposal_id),r.property_address&&(n.property_address=r.property_address),u&&i&&(n.reported_by_user_id=i._id),await q(n),_(!0),console.log("[ReportEmergencyPage] Emergency submitted successfully")}catch(s){console.error("[ReportEmergencyPage] Submission error:",s),h(s.message||"Failed to submit emergency report. Please try again or call us directly.")}finally{g(!1)}},[r,b,u,i]),L=a.useCallback(()=>{o(E),d({}),_(!1),h(null),u&&i&&o(t=>({...t,reporter_name:`${i.firstName||""} ${i.lastName||""}`.trim(),reporter_phone:i.phone||"",reporter_email:i.email||""}))},[u,i]);return{formData:r,errors:p,isSubmitting:y,isSubmitted:x,submissionError:l,isAuthenticated:u,userProposals:w,loadingProposals:S,handleInputChange:R,handlePhotoChange:F,handleSubmit:A,handleReset:L}}function W(){const{formData:r,errors:o,isSubmitting:p,isSubmitted:d,submissionError:y,isAuthenticated:g,userProposals:x,loadingProposals:_,handleInputChange:l,handlePhotoChange:h,handleSubmit:u,handleReset:j}=B();return d?e.jsxs("div",{className:"report-emergency-page",children:[e.jsx(N,{}),e.jsx("main",{className:"report-emergency-main",children:e.jsx("div",{className:"report-emergency-container",children:e.jsxs("div",{className:"success-state",children:[e.jsx("div",{className:"success-state__icon",children:e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]})}),e.jsx("h1",{children:"Emergency Reported"}),e.jsx("p",{children:"Your emergency report has been submitted successfully. Our team will review it and contact you shortly."}),e.jsx("p",{className:"success-state__note",children:"If this is a life-threatening emergency, please also call 911 immediately."}),e.jsxs("div",{className:"success-state__actions",children:[e.jsx("button",{onClick:j,className:"btn btn--secondary",children:"Report Another Emergency"}),e.jsx("a",{href:"/",className:"btn btn--primary",children:"Return Home"})]})]})})}),e.jsx(P,{})]}):e.jsxs("div",{className:"report-emergency-page",children:[e.jsx(N,{}),e.jsx("main",{className:"report-emergency-main",children:e.jsxs("div",{className:"report-emergency-container",children:[e.jsxs("header",{className:"report-emergency-header",children:[e.jsx("h1",{children:"Report an Emergency"}),e.jsx("p",{className:"report-emergency-subtitle",children:"Use this form to report any emergency situation during your stay. Our team will respond as quickly as possible."}),e.jsxs("div",{className:"emergency-notice",children:[e.jsx("strong",{children:"Life-threatening emergency?"})," Call 911 immediately, then submit this form for our records."]})]}),y&&e.jsx("div",{className:"alert alert--error",role:"alert",children:e.jsx("span",{children:y})}),e.jsxs("form",{onSubmit:u,className:"emergency-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{children:"Emergency Details"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"emergency_type",children:"Type of Emergency *"}),e.jsxs("select",{id:"emergency_type",name:"emergency_type",value:r.emergency_type,onChange:l,className:`form-select ${o.emergency_type?"form-select--error":""}`,required:!0,children:[e.jsx("option",{value:"",children:"Select emergency type..."}),e.jsx("option",{value:"Lockout",children:"Lockout - Cannot access property"}),e.jsx("option",{value:"Plumbing Issue",children:"Plumbing Issue - Leak, clog, no water"}),e.jsx("option",{value:"Electrical Issue",children:"Electrical Issue - Power outage, sparking"}),e.jsx("option",{value:"HVAC Issue",children:"HVAC Issue - No heat, no AC"}),e.jsx("option",{value:"Security Concern",children:"Security Concern - Break-in, suspicious activity"}),e.jsx("option",{value:"Appliance Malfunction",children:"Appliance Malfunction - Major appliance not working"}),e.jsx("option",{value:"Water Damage",children:"Water Damage - Flooding, water intrusion"}),e.jsx("option",{value:"Pest Issue",children:"Pest Issue - Infestation discovered"}),e.jsx("option",{value:"Noise Complaint",children:"Noise Complaint - Excessive noise from neighbors"}),e.jsx("option",{value:"Medical Emergency",children:"Medical Emergency - Injury at property"}),e.jsx("option",{value:"Fire/Smoke",children:"Fire or Smoke - Fire alarm, smoke detected"}),e.jsx("option",{value:"Other",children:"Other - Describe below"})]}),o.emergency_type&&e.jsx("span",{className:"form-error",children:o.emergency_type})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"description",children:"Description *"}),e.jsx("textarea",{id:"description",name:"description",value:r.description,onChange:l,placeholder:"Please describe the emergency in detail. Include what happened, when it started, and any actions you've already taken...",rows:5,className:`form-textarea ${o.description?"form-textarea--error":""}`,required:!0}),o.description&&e.jsx("span",{className:"form-error",children:o.description}),e.jsx("span",{className:"form-hint",children:"Minimum 20 characters. The more detail you provide, the faster we can help."})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{children:"Your Stay"}),g&&x.length>0?e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"proposal_id",children:"Select Your Booking"}),e.jsxs("select",{id:"proposal_id",name:"proposal_id",value:r.proposal_id,onChange:l,className:"form-select",children:[e.jsx("option",{value:"",children:"Select booking (optional)..."}),x.map(i=>{var f;return e.jsxs("option",{value:i._id,children:[((f=i.listing)==null?void 0:f.name)||"Property"," - Agreement #",i.agreementNumber||"N/A"]},i._id)})]}),e.jsx("span",{className:"form-hint",children:"Selecting your booking helps us respond faster."})]}):g&&_?e.jsx("p",{className:"text-muted",children:"Loading your bookings..."}):e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"agreement_number",children:"Agreement Number (if known)"}),e.jsx("input",{type:"text",id:"agreement_number",name:"agreement_number",value:r.agreement_number,onChange:l,placeholder:"e.g., SL-12345",className:"form-input"}),e.jsx("span",{className:"form-hint",children:"Found in your booking confirmation email."})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"property_address",children:"Property Address"}),e.jsx("input",{type:"text",id:"property_address",name:"property_address",value:r.property_address,onChange:l,placeholder:"Street address of the property",className:"form-input"})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{children:"Contact Information"}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reporter_name",children:"Your Name *"}),e.jsx("input",{type:"text",id:"reporter_name",name:"reporter_name",value:r.reporter_name,onChange:l,placeholder:"Full name",className:`form-input ${o.reporter_name?"form-input--error":""}`,required:!0}),o.reporter_name&&e.jsx("span",{className:"form-error",children:o.reporter_name})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reporter_phone",children:"Phone Number *"}),e.jsx("input",{type:"tel",id:"reporter_phone",name:"reporter_phone",value:r.reporter_phone,onChange:l,placeholder:"+1 (555) 123-4567",className:`form-input ${o.reporter_phone?"form-input--error":""}`,required:!0}),o.reporter_phone&&e.jsx("span",{className:"form-error",children:o.reporter_phone})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reporter_email",children:"Email Address *"}),e.jsx("input",{type:"email",id:"reporter_email",name:"reporter_email",value:r.reporter_email,onChange:l,placeholder:"your.email@example.com",className:`form-input ${o.reporter_email?"form-input--error":""}`,required:!0}),o.reporter_email&&e.jsx("span",{className:"form-error",children:o.reporter_email})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h2",{children:"Photos (Optional)"}),e.jsx("p",{className:"form-section__description",children:"Upload photos of the issue to help our team understand the situation."}),e.jsxs("div",{className:"photo-upload-grid",children:[e.jsxs("div",{className:"photo-upload",children:[e.jsx("label",{htmlFor:"photo1",className:"photo-upload__label",children:r.photo1?e.jsxs("div",{className:"photo-upload__preview",children:[e.jsx("img",{src:URL.createObjectURL(r.photo1),alt:"Preview 1"}),e.jsx("span",{className:"photo-upload__remove",children:"Change"})]}):e.jsxs("div",{className:"photo-upload__placeholder",children:[e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]}),e.jsx("span",{children:"Add Photo 1"})]})}),e.jsx("input",{type:"file",id:"photo1",name:"photo1",accept:"image/*",onChange:h,className:"photo-upload__input"})]}),e.jsxs("div",{className:"photo-upload",children:[e.jsx("label",{htmlFor:"photo2",className:"photo-upload__label",children:r.photo2?e.jsxs("div",{className:"photo-upload__preview",children:[e.jsx("img",{src:URL.createObjectURL(r.photo2),alt:"Preview 2"}),e.jsx("span",{className:"photo-upload__remove",children:"Change"})]}):e.jsxs("div",{className:"photo-upload__placeholder",children:[e.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]}),e.jsx("span",{children:"Add Photo 2"})]})}),e.jsx("input",{type:"file",id:"photo2",name:"photo2",accept:"image/*",onChange:h,className:"photo-upload__input"})]})]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn btn--primary btn--large",disabled:p,children:p?"Submitting...":"Submit Emergency Report"}),e.jsx("p",{className:"form-actions__note",children:"By submitting, you confirm the information provided is accurate."})]})]})]})}),e.jsx(P,{})]})}O(document.getElementById("root")).render(e.jsx(U.StrictMode,{children:e.jsx(W,{})}));

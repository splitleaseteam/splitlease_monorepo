import{r as d,j as t,b as Gt,c as zt,R as Yt}from"./client-BJVKzfAi.js";import{N as Jt,d as Kt,H as ct}from"./Header-BJKWma2V.js";import{F as ot}from"./Footer-Bzf1rLKh.js";import{s as z}from"./supabase-BoCLEw6R.js";import{j as Qt,c as Xt,v as Zt,k as es}from"./auth-QZ4BJadW.js";import{g as $e,P as le,a as ts,i as ss,b as jt,s as ns}from"./proposalStatuses-1Bj0NYR4.js";import{i as kt,a as St,b as qe,g as as,c as is,d as rs,f as dt,e as ls,h as cs,j as os,D as Z,k as ut,l as ds}from"./displayUtils-CS8KoWLq.js";import{C as Ye,V as Dt,g as us,a as hs,b as ee}from"./virtualMeetingRules-B_v6fFKi.js";import{D as Pt}from"./dayUtils-C3_GW2W5.js";import{g as ms}from"./constants-CPVJY5eo.js";import{s as we,a as fs}from"./Toast-BQk6Nzgd.js";import{E as gs}from"./ErrorBoundary-9_HbXv1y.js";/* empty css             */import"./proposalDataFetcher-CipdyWU2.js";import"./dataLookups-zG18yzis.js";import"./format-AibE8BX3.js";/* empty css                           */function ps(){const e=window.location.pathname.split("/").filter(Boolean),s=new URLSearchParams(window.location.search),n=e.findIndex(f=>f==="guest-proposals"||f==="guest-proposals.html");let i=!1;const a="/guest-proposals",r=new URLSearchParams;n!==-1&&e[n+1]&&(console.log("cleanLegacyUserIdFromUrl: Found legacy user ID in path, will redirect"),i=!0),s.has("user")&&(console.log("cleanLegacyUserIdFromUrl: Found legacy user query param, will redirect"),i=!0);const c=s.get("proposal");if(c&&r.set("proposal",c),i){const f=r.toString()?`${a}?${r.toString()}`:a;return console.log("cleanLegacyUserIdFromUrl: Redirecting to clean URL:",f),window.history.replaceState({},"",f),!0}return!1}function ys(){const e=Qt();return e?(console.log("getUserIdFromSession: Got user ID from session"),e):(console.log("getUserIdFromSession: No user ID in session (not authenticated)"),null)}function It(){const s=new URLSearchParams(window.location.search).get("proposal");return s&&console.log("getProposalIdFromQuery: Extracted proposal ID from query:",s),s}function ht(e){const s=`/guest-proposals?proposal=${e}`;window.history.pushState({},"",s),console.log("updateUrlWithProposal: Updated URL to:",s)}async function vs(e){const{data:s,error:n}=await z.from("user").select(`
      _id,
      "Name - First",
      "Name - Last",
      "Name - Full",
      "Profile Photo",
      "email as text",
      "Proposals List"
    `).eq("_id",e).maybeSingle();if(n)throw console.error("fetchUserWithProposalList: Error fetching user:",n),new Error(`Failed to fetch user: ${n.message}`);if(!s)throw console.error("fetchUserWithProposalList: User not found with ID:",e),new Error(`User with ID ${e} not found. Please check the URL.`);return console.log("fetchUserWithProposalList: User fetched:",s["Name - First"]||s["Name - Full"]),s}function xs(e){const s=e["Proposals List"];return!s||!Array.isArray(s)?(console.warn("extractProposalIds: User has no Proposals List or invalid format"),[]):(console.log(`extractProposalIds: Extracted ${s.length} proposal IDs from user's Proposals List`),s)}async function bs(e,s=null){if(!e||e.length===0)return console.warn("fetchProposalsByIds: No proposal IDs to fetch"),[];const{data:n,error:i}=await z.from("proposal").select(`
      _id,
      "Status",
      "Deleted",
      "Guest",
      "Listing",
      "Days Selected",
      "Nights Selected (Nights list)",
      "Reservation Span (Weeks)",
      "nights per week (num)",
      "check in day",
      "check out day",
      "Move in range start",
      "Move in range end",
      "Total Price for Reservation (guest)",
      "proposal nightly price",
      "cleaning fee",
      "damage deposit",
      "counter offer happened",
      "hc days selected",
      "hc check in day",
      "hc check out day",
      "hc nights per week",
      "hc reservation span (weeks)",
      "hc total price",
      "hc nightly price",
      "Created Date",
      "Modified Date",
      "about_yourself",
      "special_needs",
      "reason for cancellation",
      "rental application",
      "virtual meeting",
      "Is Finalized",
      "House Rules",
      "remindersByGuest (number)",
      "guest documents review finalized?"
    `).in("_id",e).or('"Deleted".is.null,"Deleted".eq.false').neq("Status","Proposal Cancelled by Guest").order("Created Date",{ascending:!1});if(i)throw console.error("fetchProposalsByIds: Error fetching proposals:",i),new Error(`Failed to fetch proposals: ${i.message}`);const a=(n||[]).filter(l=>!(!l||l.Deleted===!0||l.Deleted==="true"||l.Status==="Proposal Cancelled by Guest"));if(a.length===0)return console.log("fetchProposalsByIds: No valid proposals found"),[];a.length<e.length?console.warn(`fetchProposalsByIds: Found ${a.length} proposals out of ${e.length} IDs (${e.length-a.length} orphaned/filtered)`):console.log(`fetchProposalsByIds: Fetched ${a.length} proposals from user's list`);const r=[...new Set(a.map(l=>l.Listing).filter(Boolean))];if(r.length===0)return console.warn("fetchProposalsByIds: No listings found for proposals"),a.map(l=>({...l,listing:null}));console.log(`fetchProposalsByIds: Fetching ${r.length} unique listings`);const{data:c,error:f}=await z.from("listing").select(`
      _id,
      "Name",
      "Description",
      "Location - Address",
      "Location - slightly different address",
      "Location - Borough",
      "Location - Hood",
      "Features - Photos",
      "Features - House Rules",
      "NEW Date Check-in Time",
      "NEW Date Check-out Time",
      "Host User",
      "House manual"
    `).in("_id",r);if(f)return console.error("fetchProposalsByIds: Error fetching listings:",f),a.map(l=>({...l,listing:null}));console.log(`fetchProposalsByIds: Extracting featured photos for ${r.length} listings`);const N=new Map,w=[];(c||[]).forEach(l=>{const v=l["Features - Photos"];let B=[];if(Array.isArray(v))B=v;else if(typeof v=="string")try{B=JSON.parse(v)}catch{}if(B.length>0&&typeof B[0]=="object"&&B[0]!==null){const te=B.find(ie=>ie.toggleMainPhoto)||B[0];let Q=te.url||te.Photo||"";Q.startsWith("//")&&(Q="https:"+Q),Q&&N.set(l._id,Q)}else w.push(l._id)}),console.log(`fetchProposalsByIds: Found ${N.size} embedded photos, ${w.length} need fetch`);let g=[];if(w.length>0){const{data:l,error:v}=await z.from("listing_photo").select(`
        _id,
        "Listing",
        "Photo"
      `).in('"Listing"',w).eq('"toggleMainPhoto"',!0).eq('"Active"',!0);v?console.error("fetchProposalsByIds: Error fetching featured photos:",v):(g=l||[],console.log(`fetchProposalsByIds: Fetched ${g.length} photos from listing_photo table`))}const m=[...new Set((c||[]).map(l=>l["Location - Borough"]).filter(Boolean))],h=[...new Set((c||[]).map(l=>l["Location - Hood"]).filter(Boolean))],p=[...new Set(a.flatMap(l=>{const v=l["House Rules"];if(!v)return[];if(typeof v=="string")try{return JSON.parse(v)}catch(B){return console.warn("fetchProposalsByIds: Failed to parse House Rules JSON:",B),[]}return Array.isArray(v)?v:[]}).filter(Boolean))];console.log(`fetchProposalsByIds: Fetching ${m.length} boroughs, ${h.length} neighborhoods, ${p.length} house rules`);let o=[],I=[];if(m.length>0){const{data:l,error:v}=await z.schema("reference_table").from("zat_geo_borough_toplevel").select('_id, "Display Borough"').in("_id",m);v||(o=l||[],console.log(`fetchProposalsByIds: Fetched ${o.length} boroughs`))}if(h.length>0){const{data:l,error:v}=await z.schema("reference_table").from("zat_geo_hood_mediumlevel").select('_id, "Display"').in("_id",h);v||(I=l||[],console.log(`fetchProposalsByIds: Fetched ${I.length} neighborhoods`))}let k=[];if(p.length>0){const{data:l,error:v}=await z.schema("reference_table").from("zat_features_houserule").select('_id, "Name"').in("_id",p);v?console.error("fetchProposalsByIds: Error fetching house rules:",v):(k=l||[],console.log(`fetchProposalsByIds: Fetched ${k.length} house rules`))}const L=[...new Set((c||[]).map(l=>l["Host User"]).filter(Boolean))];console.log(`fetchProposalsByIds: Fetching ${L.length} unique hosts`);let u=[];if(L.length>0){const{data:l,error:v}=await z.from("user").select(`
        _id,
        "Name - First",
        "Name - Last",
        "Name - Full",
        "Profile Photo",
        "About Me / Bio",
        "Verify - Linked In ID",
        "Verify - Phone",
        "user verified?"
      `).in("_id",L);v?console.error("fetchProposalsByIds: Error fetching hosts:",v):(u=l||[],console.log(`fetchProposalsByIds: Fetched ${u.length} hosts`))}const W=[...new Set(a.map(l=>l.Guest).filter(Boolean))];console.log(`fetchProposalsByIds: Fetching ${W.length} unique guests`);let H=[];if(W.length>0){const{data:l,error:v}=await z.from("user").select(`
        _id,
        "Name - First",
        "Name - Last",
        "Name - Full",
        "Profile Photo",
        "About Me / Bio",
        "Verify - Linked In ID",
        "Verify - Phone",
        "user verified?",
        "ID documents submitted?"
      `).in("_id",W);v?console.error("fetchProposalsByIds: Error fetching guests:",v):(H=l||[],console.log(`fetchProposalsByIds: Fetched ${H.length} guests`))}const J=[...new Set(a.map(l=>l["rental application"]).filter(Boolean))];console.log(`fetchProposalsByIds: Fetching ${J.length} rental applications`);let j=[];if(J.length>0){const{data:l,error:v}=await z.from("rentalapplication").select('_id, submitted, "percentage % done"').in("_id",J);v?console.error("fetchProposalsByIds: Error fetching rental applications:",v):(j=l||[],console.log(`fetchProposalsByIds: Fetched ${j.length} rental applications`))}const D=new Map(j.map(l=>[l._id,l]));console.log(`fetchProposalsByIds: Fetching virtual meetings for ${a.length} proposals`);const T=a.map(l=>l._id).filter(Boolean);let O=[];if(T.length>0){const{data:l,error:v}=await z.from("virtualmeetingschedulesandlinks").select(`
        _id,
        "booked date",
        "confirmedBySplitLease",
        "meeting link",
        "meeting declined",
        "requested by",
        "suggested dates and times",
        "guest name",
        "host name",
        "proposal"
      `).in("proposal",T);v?console.error("fetchProposalsByIds: Error fetching virtual meetings:",v):(O=l||[],console.log(`fetchProposalsByIds: Fetched ${O.length} virtual meetings`))}const x=new Map(O.map(l=>[l.proposal,l])),E=a.map(l=>l._id);let A=[];if(E.length>0){let l=z.from("negotiationsummary").select("*").in('"Proposal associated"',E).order('"Created Date"',{ascending:!1});s&&(l=l.eq('"To Account"',s));const{data:v,error:B}=await l;B?console.error("fetchProposalsByIds: Error fetching negotiation summaries:",B):(A=v||[],console.log(`fetchProposalsByIds: Fetched ${A.length} negotiation summaries for user ${s||"unknown"}`))}const b=new Map;A.forEach(l=>{const v=l["Proposal associated"];b.has(v)||b.set(v,[]),b.get(v).push(l)}),console.log(`fetchProposalsByIds: Fetching counteroffer summaries for ${E.length} proposals`);const F=new Map;if(E.length>0){const{data:l,error:v}=await z.from("thread").select('_id, "Proposal"').in('"Proposal"',E);if(v)console.error("fetchProposalsByIds: Error fetching threads:",v);else if(l&&l.length>0){const B=l.map(V=>V._id),te=new Map(l.map(V=>[V._id,V.Proposal])),{data:Q,error:ie}=await z.from("_message").select(`
          _id,
          "Message Body",
          "Call to Action",
          "Associated Thread/Conversation",
          "Created Date"
        `).in('"Associated Thread/Conversation"',B).eq('"is Split Bot"',!0).eq('"Call to Action"',"Respond to Counter Offer").order('"Created Date"',{ascending:!1});ie?console.error("fetchProposalsByIds: Error fetching counteroffer messages:",ie):Q&&Q.length>0&&(console.log(`fetchProposalsByIds: Fetched ${Q.length} counteroffer summary messages`),Q.forEach(V=>{const se=V["Associated Thread/Conversation"],ue=te.get(se);ue&&!F.has(ue)&&F.set(ue,V["Message Body"])}))}}const R=new Map((c||[]).map(l=>[l._id,l])),S=new Map(u.map(l=>[l._id,l])),$=new Map(H.map(l=>[l._id,l])),U=new Map(o.map(l=>[l._id,l["Display Borough"]])),P=new Map(I.map(l=>[l._id,l.Display])),C=new Map([...N.entries(),...(g||[]).map(l=>[l.Listing,l.Photo])]),q=new Map(k.map(l=>[l._id,l.Name])),ae=a.map(l=>{const v=R.get(l.Listing),B=v?S.get(v["Host User"]):null,te=$.get(l.Guest),Q=v?U.get(v["Location - Borough"]):null,ie=v?P.get(v["Location - Hood"]):null,V=v?C.get(v._id):null,se=x.get(l._id)||null,ue=D.get(l["rental application"])||null,pe=b.get(l._id)||[],ye=F.get(l._id)||null;let he=[];const oe=l["House Rules"];if(oe)if(typeof oe=="string")try{he=JSON.parse(oe)}catch{he=[]}else Array.isArray(oe)&&(he=oe);const ce=he.map(ve=>q.get(ve)).filter(Boolean);return{...l,listing:v?{...v,host:B,boroughName:Q,hoodName:ie,featuredPhotoUrl:V,hasHouseManual:!!v["House manual"]}:null,guest:te||null,virtualMeeting:se,rentalApplication:ue,houseRules:ce,negotiationSummaries:pe,counterofferSummary:ye}});return console.log(`fetchProposalsByIds: Successfully enriched ${ae.length} proposals with listing and host data`),ae}async function Ns(){const e=ys();if(!e)throw new Error("NOT_AUTHENTICATED");const s=await vs(e),n=xs(s);if(n.length===0)return console.log("fetchUserProposalsFromUrl: User has no proposal IDs in their Proposals List"),{user:s,proposals:[],selectedProposal:null};const i=await bs(n,e);if(i.length===0)return console.log("fetchUserProposalsFromUrl: No valid proposals found (all IDs may be orphaned)"),{user:s,proposals:[],selectedProposal:null};const a=It();let r=null;return a?(r=i.find(c=>c._id===a),r?console.log("fetchUserProposalsFromUrl: Using preselected proposal:",a):(console.warn(`fetchUserProposalsFromUrl: Preselected proposal ${a} not found, defaulting to first`),r=i[0]||null)):(r=i[0]||null,console.log("fetchUserProposalsFromUrl: Defaulting to first proposal")),{user:s,proposals:i,selectedProposal:r}}function ws(e){if(!e)return null;const s=e["Location - Address"],n=typeof s=="object"&&(s!=null&&s.address)?s.address:typeof s=="string"?s:null;return{id:e._id,name:e.Name,description:e.Description,address:n,addressData:s,borough:e["Location - Borough"],hood:e["Location - Hood"],boroughName:e.boroughName,hoodName:e.hoodName,city:e["Location - City"],state:e["Location - State"],zipCode:e["Location - Zip Code"],photos:e["Features - Photos"],featuredPhotoUrl:e.featuredPhotoUrl,houseRules:e.houseRules||[],checkInTime:e["NEW Date Check-in Time"],checkOutTime:e["NEW Date Check-out Time"]}}function js(e){return e?{id:e._id,firstName:e["Name - First"],lastName:e["Name - Last"],fullName:e["Name - Full"],profilePhoto:e["Profile Photo"],bio:e["About Me / Bio"],linkedInVerified:e["Verify - Linked In ID"],phoneVerified:e["Verify - Phone"],userVerified:e["user verified?"]}:null}function ks(e){return e?{id:e._id,firstName:e["Name - First"],lastName:e["Name - Last"],fullName:e["Name - Full"],profilePhoto:e["Profile Photo"],bio:e["About Me / Bio"],linkedInVerified:e["Verify - Linked In ID"],phoneVerified:e["Verify - Phone"],userVerified:e["user verified?"]}:null}function Ss(e){return e?{id:e._id,bookedDate:e["booked date"],confirmedBySplitlease:e.confirmedBySplitLease,meetingLink:e["meeting link"],meetingDeclined:e["meeting declined"],requestedBy:e["requested by"],suggestedTimeslots:e["suggested dates and times"],guestName:e["guest name"],hostName:e["host name"],proposalId:e.proposal}:null}function mt(e){if(!e)return null;const s=e.listing,n=s==null?void 0:s.host,i=e.guest,a=e.virtualMeeting;return{id:e._id,status:e.Status,deleted:e.Deleted,daysSelected:e["Days Selected"],nightsSelected:e["Nights Selected (Nights list)"],reservationWeeks:e["Reservation Span (Weeks)"],nightsPerWeek:e["nights per week (num)"],checkInDay:e["check in day"],checkOutDay:e["check out day"],moveInStart:e["Move in range start"],moveInEnd:e["Move in range end"],totalPrice:e["Total Price for Reservation (guest)"],nightlyPrice:e["proposal nightly price"],cleaningFee:e["cleaning fee"],damageDeposit:e["damage deposit"],counterOfferHappened:e["counter offer happened"],hcDaysSelected:e["hc days selected"],hcReservationWeeks:e["hc reservation span (weeks)"],hcTotalPrice:e["hc total price"],hcNightlyPrice:e["hc nightly price"],createdDate:e["Created Date"],modifiedDate:e["Modified Date"],aboutYourself:e.about_yourself,specialNeeds:e.special_needs,reasonForCancellation:e["reason for cancellation"],proposalStage:e["Proposal Stage"],rentalApplicationId:e["rental application"],virtualMeetingId:e["virtual meeting"],isFinalized:e["Is Finalized"],houseRules:e.houseRules||[],listing:ws(s),host:js(n),guest:ks(i),virtualMeeting:Ss(a)}}function Ds(e){var i,a,r;if(!e)return null;const s=((i=e.host)==null?void 0:i.firstName)||((a=e.host)==null?void 0:a.fullName)||"Host",n=((r=e.listing)==null?void 0:r.name)||"Property";return`${s} - ${n}`}function X(e,s=!0){return e==null?null:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:s?2:0,maximumFractionDigits:s?2:0}).format(e)}function We(e){if(!e)return null;const s=typeof e=="string"?new Date(e):e;return isNaN(s.getTime())?null:s.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}const Ct=[{id:1,name:"Proposal Submitted",shortName:"Submitted",icon:"1",description:"Your proposal has been submitted to the host",helpText:"The next step is to complete your rental application so the host can review your profile."},{id:2,name:"Rental App Submitted",shortName:"Application",icon:"2",description:"Your rental application is complete",helpText:"The host is reviewing your application and will respond soon."},{id:3,name:"Host Review",shortName:"Review",icon:"3",description:"Host is reviewing your proposal",helpText:"The host may accept your proposal, request changes, or propose a counteroffer."},{id:4,name:"Review Documents",shortName:"Documents",icon:"4",description:"Review proposal documents and terms",helpText:"Carefully review all documents before proceeding to the lease agreement."},{id:5,name:"Lease Documents",shortName:"Lease",icon:"5",description:"Review and sign lease documents",helpText:"Read the lease agreement thoroughly and sign when ready."},{id:6,name:"Initial Payment",shortName:"Payment",icon:"6",description:"Submit initial payment to activate lease",helpText:"Submit your first payment to activate the lease and finalize your reservation."}];function Ps(e){return!e||e<1||e>6?null:Ct.find(s=>s.id===e)||null}function Is(e,s){return!e||!s?!1:e<s}function Cs(e,s){return!e||!s?!1:e===s}function _s(e,s){const n=Ps(e);if(!n)return null;let i="pending",a="Pending";return Is(e,s)?(i="completed",a="Completed"):Cs(e,s)&&(i="current",a="In Progress"),{...n,status:i,statusLabel:a,isCompleted:i==="completed",isCurrent:i==="current",isPending:i==="pending"}}function Ms(e){return Ct.map(s=>_s(s.id,e))}let Ce=null,Oe=null,Le=null;async function Es(){return Ce||Le||(Le=(async()=>{try{const{data:e,error:s}=await z.schema("reference_table").from("os_proposal_status").select(`
          id,
          name,
          display,
          displayed_on_screen,
          guest_action_1,
          guest_action_2,
          host_action_1,
          host_action_2,
          sort_order
        `).order("sort_order",{ascending:!0});if(s)throw console.error("fetchStatusConfigurations: Error fetching status config:",s),s;return Ce=e||[],Oe=new Map((e||[]).map(n=>[typeof n.display=="string"?n.display.trim():n.display,n])),console.log(`fetchStatusConfigurations: Cached ${Ce.length} status configurations`),Ce}catch(e){return console.error("fetchStatusConfigurations: Failed to fetch status configurations:",e),[]}finally{Le=null}})(),Le)}function Je(e){if(!Oe)return console.warn("getStatusConfigByDisplay: Cache not initialized. Call fetchStatusConfigurations first."),null;if(!e)return null;const s=typeof e=="string"?e.trim():e;return Oe.get(s)||null}function Fs(e){const s=Je(e);if(!s)return null;const n=s.guest_action_1;return!n||n==="Invisible"?null:n}function Rs(e){const s=Je(e);if(!s)return null;const n=s.guest_action_2;return!n||n==="Invisible"?null:n}function Ls(e){return e?(typeof e=="string"?e.trim():e).includes("Submitted for guest by Split Lease"):!1}function Ts(e){return!!(!e||!e["rental application"]&&!e.rentalApplication||e.rentalApplication&&!e.rentalApplication.submitted)}function _t(e){if(!e)return!0;const s=typeof e=="string"?e.trim():e,n=le.INITIAL_PAYMENT_SUBMITTED_LEASE_ACTIVATED.key.trim(),i=le.SUGGESTED_PROPOSAL_AWAITING_RENTAL_APP.key.trim(),a=le.SUGGESTED_PROPOSAL_PENDING_CONFIRMATION.key.trim();return[le.REJECTED_BY_HOST.key,le.CANCELLED_BY_SPLITLEASE.key,n,i,a].includes(s)}function Mt(e){var J,j;if(!e)return{guestAction1:{visible:!1,label:null,action:null},guestAction2:{visible:!1,label:null,action:null},cancelButton:{visible:!1,label:"Cancel Proposal",action:null},vmButton:{visible:!1,label:"Request Virtual Meeting",action:null}};const s=e.Status,n=typeof s=="string"?s.trim():s,i=Je(n),a=(i==null?void 0:i.sort_order)??-99,r=e["remindersByGuest (number)"]||0,c=e["guest documents review finalized?"]===!0,f=((J=e.guest)==null?void 0:J["ID documents submitted?"])===!0,N=((j=e.listing)==null?void 0:j.hasHouseManual)===!0,w=n===le.COUNTEROFFER_SUBMITTED_AWAITING_GUEST_REVIEW.key,g=a===-1,m=n===le.REJECTED_BY_HOST.key,h=Ls(n),p=n===le.LEASE_DOCUMENTS_SENT_FOR_REVIEW.key,o={visible:!1,label:null,action:null,style:null},I=Fs(n);if(I)switch(o.visible=!0,o.label=I,I==="Remind Split Lease"&&r>=3&&(o.visible=!1),I==="Review Documents"&&c&&p&&(o.visible=!1),I==="Delete Proposal"&&m&&(o.style={backgroundColor:"#EF4444",color:"white"}),I){case"Interested":o.action="confirm_interest";break;case"Submit Rental App":o.action="submit_rental_app";break;case"Modify Proposal":o.action="modify_proposal";break;case"Accept Host Terms":o.action="accept_counteroffer";break;case"Remind Split Lease":o.action="remind_sl";break;case"Review Documents":o.action="review_documents";break;case"Resend Lease Docs":o.action="resend_lease_docs";break;case"Submit Initial Payment":o.action="submit_payment";break;case"Go to Leases":o.action="go_to_leases";break;case"Delete Proposal":o.action="delete_proposal";break;default:o.action=null}const k={visible:!1,label:null,action:null,style:null},L=Rs(n);if(L)switch(k.visible=!0,k.label=L,L==="Verify Your Identity"&&f&&p&&(k.visible=!1),L){case"Not Interested":k.action="reject_suggestion";break;case"Review Host Terms":k.action="review_counteroffer";break;case"See Details":k.action="see_details";break;case"Verify Your Identity":k.action="verify_identity";break;default:k.action=null}const u={visible:!1,label:"Cancel Proposal",action:"cancel_proposal",style:null,disabled:!1},W=n===le.INITIAL_PAYMENT_SUBMITTED_LEASE_ACTIVATED.key.trim();if(g)o.action!=="delete_proposal"&&(u.visible=!0,u.label="Delete Proposal",u.action="delete_proposal");else if(W)u.visible=!1;else if(a>5&&N)u.visible=!0,u.label="See House Manual",u.action="see_house_manual",u.style={backgroundColor:"#6D31C2",color:"white"},u.disabled=!0;else if(w)u.visible=!0,u.label="Reject Modified Terms",u.action="reject_counteroffer";else if(h){const D=$e(n);D!=null&&D.guestConfirmed||(o.visible=!0,o.label="Confirm Proposal",o.action="confirm_proposal",Ts(e)&&(k.visible=!0,k.label="Submit Rental Application",k.action="submit_rental_app")),k.action!=="reject_suggestion"&&(u.visible=!0,u.label="Reject Proposal",u.action="reject_proposal")}else(a>5||a>=0&&a<=5)&&(u.visible=!0,u.label="Cancel Proposal",u.action="cancel_proposal");const H={visible:!1,label:"Request Virtual Meeting",action:"request_vm",style:null,disabled:!1};return!_t(n)&&!g&&(H.visible=!0),{guestAction1:o,guestAction2:k,cancelButton:u,vmButton:H,sortOrder:a,isTerminal:g,isCounteroffer:w,isSLSuggested:h}}function As(){return Ce!==null&&Oe!==null}function Ws(){const[e,s]=d.useState({isChecking:!0,isAuthenticated:!1,isGuest:!1,shouldRedirect:!1,redirectReason:null}),[n,i]=d.useState(null),[a,r]=d.useState([]),[c,f]=d.useState(null),[N,w]=d.useState(!1),[g,m]=d.useState(null),[h,p]=d.useState(!0),[o,I]=d.useState(null);d.useEffect(()=>{async function b(){var U,P;if(console.log("ðŸ” Guest Proposals: Checking authentication..."),ps(),!await Xt()){console.log("âŒ Guest Proposals: User not authenticated, redirecting to home"),s({isChecking:!1,isAuthenticated:!1,isGuest:!1,shouldRedirect:!0,redirectReason:"NOT_AUTHENTICATED"}),window.location.href="/";return}const R=await Zt({clearOnFailure:!1});let S=null,$=!1;if(R)S=R.userType,$=S==="Guest"||(S==null?void 0:S.includes("Guest")),console.log("âœ… Guest Proposals: User data loaded, userType:",S);else{const{data:{session:C}}=await z.auth.getSession();if(C!=null&&C.user){if(S=((U=C.user.user_metadata)==null?void 0:U.user_type)||es()||null,$=S==="Guest"||((P=S==null?void 0:S.includes)==null?void 0:P.call(S,"Guest")),console.log("âš ï¸ Guest Proposals: Using fallback session data, userType:",S),!S){console.log("âŒ Guest Proposals: Cannot determine user type from session, redirecting"),s({isChecking:!1,isAuthenticated:!0,isGuest:!1,shouldRedirect:!0,redirectReason:"USER_TYPE_UNKNOWN"}),window.location.href="/";return}}else{console.log("âŒ Guest Proposals: No valid session, redirecting to home"),s({isChecking:!1,isAuthenticated:!1,isGuest:!1,shouldRedirect:!0,redirectReason:"TOKEN_INVALID"}),window.location.href="/";return}}if(!$){console.log("âŒ Guest Proposals: User is not a Guest (type:",S,"), redirecting to home"),s({isChecking:!1,isAuthenticated:!0,isGuest:!1,shouldRedirect:!0,redirectReason:"NOT_GUEST"}),window.location.href="/";return}console.log("âœ… Guest Proposals: User authenticated as Guest"),s({isChecking:!1,isAuthenticated:!0,isGuest:!0,shouldRedirect:!1,redirectReason:null})}b()},[]);const k=d.useCallback(async()=>{p(!0),I(null);try{const[b]=await Promise.all([Ns(),Es()]);i(b.user),r(b.proposals),f(b.selectedProposal),w(As())}catch(b){if(console.error("useGuestProposalsPageLogic: Error loading proposals:",b),b.message==="NOT_AUTHENTICATED"){window.location.href="/";return}I(b.message||"Failed to load proposals")}finally{p(!1)}},[]);d.useEffect(()=>{e.isAuthenticated&&e.isGuest&&!e.isChecking&&k()},[e.isAuthenticated,e.isGuest,e.isChecking,k]),d.useEffect(()=>{if(a.length===0||h)return;const b=It();if(!b)return;a.some(R=>R._id===b)?(console.log("ðŸ“‚ Auto-expanding proposal from URL:",b),m(b)):console.warn("âš ï¸ Proposal ID from URL not found in user proposals:",b)},[a,h]);const L=d.useCallback(b=>{const F=a.find(R=>R._id===b);F&&(f(F),ht(b))},[a]),u=d.useCallback(b=>{m(F=>{const R=F===b?null:b;return R&&ht(R),R})},[]),W=d.useCallback(()=>{k()},[k]),H=d.useCallback(b=>{r(F=>{const R=F.filter(S=>S._id!==b);return f(S=>(S==null?void 0:S._id)===b?R.length>0?R[0]:null:S),m(S=>S===b?null:S),R})},[]),J=c?mt(c):null,j=c?$e(c.Status):null,D=c?ts(c.Status):null,T=D?Ms(D):[],O=a.map(b=>({id:b._id,label:Ds(mt(b))})),x=c&&N?Mt(c):null,E=d.useMemo(()=>{const b=[],F=[];a.forEach(S=>{const $=S.Status||"";kt($)&&St($)?b.push(S):F.push(S)});const R=(S,$)=>{const U=qe(S.Status),P=qe($.Status);if(U!==P)return U?1:-1;const C=new Date(S["Created Date"]||S.createdAt||0);return new Date($["Created Date"]||$.createdAt||0)-C};return{suggested:b.sort(R),userCreated:F.sort(R)}},[a]),A=e.isChecking||h;return{authState:e,user:n,proposals:a,selectedProposal:c,categorizedProposals:E,expandedProposalId:g,transformedProposal:J,statusConfig:j,currentStage:D,formattedStages:T,proposalOptions:O,buttonConfig:x,isLoading:A,error:o,handleProposalSelect:L,handleToggleExpand:u,handleRetry:W,handleProposalDeleted:H}}const Bs=()=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})}),Os=()=>t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),t.jsx("polyline",{points:"14 2 14 8 20 8"}),t.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),t.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),t.jsx("polyline",{points:"10 9 9 9 8 9"})]});function ft({type:e,count:s}){const n=e==="suggested";return t.jsxs("div",{className:`section-header ${n?"section-header--suggested":"section-header--user"}`,children:[t.jsx("div",{className:"section-header__icon",children:n?t.jsx(Bs,{}):t.jsx(Os,{})}),t.jsxs("h2",{className:"section-header__title",children:[n?"Suggested for You":"Your Proposals",typeof s=="number"&&t.jsxs("span",{className:"section-header__count",children:["(",s,")"]})]})]})}const $s=()=>t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[t.jsx("path",{d:"M9 18h6"}),t.jsx("path",{d:"M10 22h4"}),t.jsx("path",{d:"M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"})]});function Vs(e){const s=[],n=(e==null?void 0:e.listing)||{},i=e["Days Selected"]||e.hcDaysSelected||[];Array.isArray(i)&&i.length>=4&&s.push({tag:"Schedule",description:"Fits your preferred days"});const a=e["Reservation Span (Weeks)"]||e["hc reservation span (weeks)"];a&&a>=8&&s.push({tag:"Duration",description:"Long-term stay available"});const r=e["proposal nightly price"]||e["hc nightly price"];return r&&r<=200&&s.push({tag:"Budget",description:"Within your price range"}),(n.hoodName||n.boroughName)&&s.push({tag:"Location",description:`${n.hoodName||n.boroughName}`}),(n["Pets Allowed"]===!0||n.petsAllowed===!0)&&s.push({tag:"Pet OK",description:"Allows pets"}),s.length===0&&s.push({tag:"Match",description:"Recommended based on your preferences"}),s}function Us({proposal:e,customReason:s}){const n=Vs(e);return t.jsxs("div",{className:"match-reason-card",children:[t.jsxs("div",{className:"match-reason-card__header",children:[t.jsx("div",{className:"match-reason-card__icon",children:t.jsx($s,{})}),t.jsxs("div",{className:"match-reason-card__content",children:[t.jsx("h4",{className:"match-reason-card__title",children:"Why this matches"}),t.jsx("p",{className:"match-reason-card__text",children:s||"A Split Lease Agent found this listing based on your preferences."})]})]}),t.jsx("div",{className:"match-reason-card__tags",children:n.map((i,a)=>t.jsx("span",{className:"match-tag",title:i.description,children:i.tag},a))})]})}function Hs(e){return e&&e.split(/\*\*([^*]+)\*\*/g).map((n,i)=>i%2===1?t.jsx("strong",{children:n},i):n)}function qs({summaries:e}){const[s,n]=d.useState(!1),i=e==null?void 0:e[0];if(!i)return null;const a=i.Summary||i["Guest Summary"]||i["Host Summary"]||i.summary||"";return a?t.jsxs("div",{className:"negotiation-summary-section",children:[t.jsxs("button",{className:"negotiation-summary-toggle",onClick:()=>n(!s),"aria-expanded":s,children:[t.jsx("span",{className:"negotiation-summary-icon",children:"ðŸ’¡"}),t.jsx("span",{className:"negotiation-summary-label",children:"Why This Proposal?"}),t.jsx("span",{className:`negotiation-summary-chevron ${s?"expanded":""}`,children:"â–¼"})]}),s&&t.jsx("div",{className:"negotiation-summary-content",children:t.jsx("p",{children:Hs(a)})})]}):null}function Gs(e){if(!e)return e;const s=[];let n=0;const i=/\[b\](.*?)\[\/b\]|\[color=(#[0-9a-fA-F]{6})\](.*?)\[\/color\]/g;let a=0,r;for(;(r=i.exec(e))!==null;)r.index>a&&s.push(e.slice(a,r.index)),r[1]!==void 0?s.push(t.jsx("strong",{children:r[1]},n++)):r[2]!==void 0&&r[3]!==void 0&&s.push(t.jsx("span",{style:{color:r[2]},children:r[3]},n++)),a=r.index+r[0].length;return a<e.length&&s.push(e.slice(a)),s.length>0?s:e}function zs({summary:e}){const[s,n]=d.useState(!0);return e?t.jsxs("div",{className:"counteroffer-summary-section",children:[t.jsxs("button",{className:"counteroffer-summary-toggle",onClick:()=>n(!s),"aria-expanded":s,children:[t.jsx("span",{className:"counteroffer-summary-icon",children:"ðŸ“‹"}),t.jsx("span",{className:"counteroffer-summary-label",children:"Counteroffer Summary"}),t.jsx("span",{className:`counteroffer-summary-chevron ${s?"expanded":""}`,children:"â–¼"})]}),s&&t.jsx("div",{className:"counteroffer-summary-content",children:t.jsx("p",{children:Gs(e)})})]}):null}function Ys(e,s){if(!e){console.error("[navigationWorkflow] No host ID found for messaging");return}let n="/messages";const i=new URLSearchParams;e&&i.append("recipient",e),s&&i.append("proposal",s),i.toString()&&(n+=`?${i.toString()}`),console.log("[navigationWorkflow] Navigating to messaging:",n),window.location.href=n}function Js(e){return e?!!(!e["rental application"]&&!e.rentalApplication||e["rental application"]&&!e.rentalApplication||e.rentalApplication&&!e.rentalApplication.submitted):!1}function Ks(e){return e?(e.status||e.Status)===le.SUGGESTED_PROPOSAL_PENDING_CONFIRMATION.key:!1}function Qs(e){return Js(e)?le.SUGGESTED_PROPOSAL_AWAITING_RENTAL_APP.key:le.HOST_REVIEW.key}async function Xs(e,s=null){if(!e)throw new Error("Proposal ID is required");const n=new Date().toISOString(),i={Status:le.CANCELLED_BY_GUEST.key,"Modified Date":n};s&&(i["reason for cancellation"]=s),console.log("[cancelProposalWorkflow] Cancelling proposal:",e);const{data:a,error:r}=await z.from("proposal").update(i).eq("_id",e).select().single();if(r)throw console.error("[cancelProposalWorkflow] Error cancelling proposal:",r),new Error(`Failed to cancel proposal: ${r.message}`);return console.log("[cancelProposalWorkflow] Proposal cancelled successfully:",e),a}async function Zs(e){if(!e)throw new Error("Proposal ID is required");const s=new Date().toISOString();console.log("[cancelProposalWorkflow] Soft-deleting proposal:",e);const{error:n}=await z.from("proposal").update({Deleted:!0,"Modified Date":s}).eq("_id",e);if(n)throw console.error("[cancelProposalWorkflow] Error deleting proposal:",n),new Error(`Failed to delete proposal: ${n.message}`);console.log("[cancelProposalWorkflow] Proposal deleted successfully:",e)}const en=[{path:"/",file:"index.html",aliases:["/index","/index.html"],protected:!1,cloudflareInternal:!1,hasDynamicSegment:!1},{path:"/index-dev",file:"index-dev.html",aliases:["/index-dev.html"],protected:!1,cloudflareInternal:!1,hasDynamicSegment:!1,devOnly:!0},{path:"/search",file:"search.html",aliases:["/search.html"],protected:!1,cloudflareInternal:!0,internalName:"search-view",hasDynamicSegment:!1},{path:"/quick-match",file:"quick-match.html",aliases:["/quick-match.html"],protected:!1,cloudflareInternal:!0,internalName:"quick-match-view",hasDynamicSegment:!1},{path:"/view-split-lease",file:"view-split-lease.html",aliases:["/view-split-lease.html"],protected:!1,cloudflareInternal:!0,internalName:"listing-view",hasDynamicSegment:!0,dynamicPattern:"/view-split-lease/:id"},{path:"/preview-split-lease",file:"preview-split-lease.html",aliases:["/preview-split-lease.html"],protected:!0,cloudflareInternal:!0,internalName:"preview-listing-view",hasDynamicSegment:!0,dynamicPattern:"/preview-split-lease/:id"},{path:"/guest-proposals",file:"guest-proposals.html",aliases:["/guest-proposals.html"],protected:!0,cloudflareInternal:!0,internalName:"guest-proposals-view",hasDynamicSegment:!0,dynamicPattern:"/guest-proposals/:userId",excludeFromFunctions:!0},{path:"/account-profile",file:"account-profile.html",aliases:["/account-profile.html"],protected:!0,cloudflareInternal:!0,internalName:"account-profile-view",hasDynamicSegment:!0,dynamicPattern:"/account-profile/:userId"},{path:"/help-center",file:"help-center.html",aliases:["/help-center.html"],protected:!1,cloudflareInternal:!0,internalName:"help-center-view",hasDynamicSegment:!1},{path:"/help-center/:category",file:"help-center-category.html",protected:!1,cloudflareInternal:!0,internalName:"help-center-category-view",hasDynamicSegment:!0,skipFileExtensionCheck:!0},{path:"/faq",file:"faq.html",aliases:["/faq.html"],protected:!1,cloudflareInternal:!0,internalName:"faq-view",hasDynamicSegment:!1},{path:"/policies",file:"policies.html",aliases:["/policies.html"],protected:!1,cloudflareInternal:!0,internalName:"policies-view",hasDynamicSegment:!1},{path:"/list-with-us",file:"list-with-us.html",aliases:["/list-with-us.html"],protected:!1,cloudflareInternal:!0,internalName:"list-with-us-view",hasDynamicSegment:!1},{path:"/list-with-us-v2",file:"list-with-us-v2.html",aliases:["/list-with-us-v2.html"],protected:!1,cloudflareInternal:!0,internalName:"list-with-us-v2-view",hasDynamicSegment:!1},{path:"/why-split-lease",file:"why-split-lease.html",aliases:["/why-split-lease.html"],protected:!1,cloudflareInternal:!0,internalName:"why-split-lease-view",hasDynamicSegment:!1},{path:"/careers",file:"careers.html",aliases:["/careers.html"],protected:!1,cloudflareInternal:!0,internalName:"careers-view",hasDynamicSegment:!1},{path:"/about-us",file:"about-us.html",aliases:["/about-us.html"],protected:!1,cloudflareInternal:!0,internalName:"about-us-view",hasDynamicSegment:!1},{path:"/host-guarantee",file:"host-guarantee.html",aliases:["/host-guarantee.html"],protected:!1,cloudflareInternal:!0,internalName:"host-guarantee-view",hasDynamicSegment:!1},{path:"/referral",file:"referral.html",aliases:["/referral.html","/ref"],protected:!1,cloudflareInternal:!0,internalName:"referral-view",hasDynamicSegment:!1},{path:"/guest-success",file:"guest-success.html",aliases:["/guest-success.html"],protected:!1,cloudflareInternal:!0,internalName:"guest-success-view",hasDynamicSegment:!1},{path:"/host-success",file:"host-success.html",aliases:["/host-success.html"],protected:!1,cloudflareInternal:!0,internalName:"host-success-view",hasDynamicSegment:!1},{path:"/guest-leases",file:"guest-leases.html",aliases:["/guest-leases.html","/my-leases"],protected:!0,cloudflareInternal:!0,internalName:"guest-leases-view",hasDynamicSegment:!0,dynamicPattern:"/guest-leases/:userId",excludeFromFunctions:!0},{path:"/host-proposals",file:"host-proposals.html",aliases:["/host-proposals.html"],protected:!0,cloudflareInternal:!0,internalName:"host-proposals-view",hasDynamicSegment:!0,dynamicPattern:"/host-proposals/:userId",excludeFromFunctions:!0},{path:"/host-leases",file:"host-leases.html",aliases:["/host-leases.html"],protected:!0,cloudflareInternal:!0,internalName:"host-leases-view",hasDynamicSegment:!1},{path:"/self-listing",file:"self-listing.html",aliases:["/self-listing.html"],protected:!0,cloudflareInternal:!0,internalName:"self-listing-view",hasDynamicSegment:!1},{path:"/self-listing-v2",file:"self-listing-v2.html",aliases:["/self-listing-v2.html"],protected:!1,cloudflareInternal:!0,internalName:"self-listing-v2-view",hasDynamicSegment:!1},{path:"/listing-dashboard",file:"listing-dashboard.html",aliases:["/listing-dashboard.html"],protected:!0,cloudflareInternal:!0,internalName:"listing-dashboard-view",hasDynamicSegment:!1},{path:"/host-overview",file:"host-overview.html",aliases:["/host-overview.html"],protected:!0,cloudflareInternal:!0,internalName:"host-overview-view",hasDynamicSegment:!1},{path:"/favorite-listings",file:"favorite-listings.html",aliases:["/favorite-listings.html"],protected:!0,cloudflareInternal:!0,internalName:"favorite-listings-view",hasDynamicSegment:!1},{path:"/favorite-listings-v2",file:"favorite-listings-v2.html",aliases:["/favorite-listings-v2.html"],protected:!0,cloudflareInternal:!0,internalName:"favorite-listings-v2-view",hasDynamicSegment:!1,devOnly:!0},{path:"/rental-application",file:"rental-application.html",aliases:["/rental-application.html"],protected:!0,cloudflareInternal:!0,internalName:"rental-application-view",hasDynamicSegment:!1},{path:"/reset-password",file:"reset-password.html",aliases:["/reset-password.html"],protected:!1,cloudflareInternal:!0,internalName:"reset-password-view",hasDynamicSegment:!1},{path:"/auth/verify",file:"auth-verify.html",aliases:["/auth/verify.html"],protected:!1,cloudflareInternal:!0,internalName:"auth-verify-view",hasDynamicSegment:!1},{path:"/404",file:"404.html",aliases:["/404.html"],protected:!1,cloudflareInternal:!1,hasDynamicSegment:!1},{path:"/messages",file:"messages.html",aliases:["/messages.html","/messaging-app"],protected:!0,cloudflareInternal:!0,internalName:"messages-view",hasDynamicSegment:!1},{path:"/house-manual",file:"house-manual.html",aliases:["/house-manual.html"],protected:!0,cloudflareInternal:!0,internalName:"house-manual-view",hasDynamicSegment:!1},{path:"/visit-manual",file:"visit-manual.html",aliases:["/visit-manual.html"],protected:!1,cloudflareInternal:!0,internalName:"visit-manual-view",hasDynamicSegment:!1},{path:"/signup-trial-host",file:"signup-trial-host.html",aliases:["/signup-trial-host.html"],protected:!1,cloudflareInternal:!0,internalName:"signup-trial-host-view",hasDynamicSegment:!1,devOnly:!0},{path:"/_internal-test",file:"internal-test.html",aliases:["/_internal-test.html"],protected:!1,cloudflareInternal:!0,internalName:"internal-test-view",hasDynamicSegment:!1},{path:"/_create-suggested-proposal",file:"create-suggested-proposal.html",aliases:["/_create-suggested-proposal.html"],protected:!1,cloudflareInternal:!0,internalName:"create-suggested-proposal-view",hasDynamicSegment:!1},{path:"/_leases-overview",file:"leases-overview.html",aliases:["/_leases-overview.html"],protected:!1,cloudflareInternal:!0,internalName:"leases-overview-view",hasDynamicSegment:!1},{path:"/_email-sms-unit",file:"email-sms-unit.html",aliases:["/_email-sms-unit.html"],protected:!1,cloudflareInternal:!0,internalName:"email-sms-unit-view",hasDynamicSegment:!1},{path:"/referral-demo",file:"referral-demo.html",aliases:["/referral-demo.html"],protected:!1,cloudflareInternal:!1,hasDynamicSegment:!1,devOnly:!0},{path:"/_guest-simulation",file:"guest-simulation.html",aliases:["/_guest-simulation.html","/simulation-guest-proposals-mobile-day1"],protected:!1,cloudflareInternal:!0,internalName:"guest-simulation-view",hasDynamicSegment:!1},{path:"/simulation-guest-mobile",file:"simulation-guest-mobile.html",aliases:["/simulation-guest-mobile.html","/simulation-guest-proposals-mobile-day2"],protected:!0,cloudflareInternal:!0,internalName:"simulation-guest-mobile-view",hasDynamicSegment:!1},{path:"/simulation-guestside-demo",file:"simulation-guestside-demo.html",aliases:["/simulation-guestside-demo.html","/usability-test"],protected:!0,cloudflareInternal:!0,internalName:"simulation-guestside-demo-view",hasDynamicSegment:!1},{path:"/simulation-hostside-demo",file:"simulation-hostside-demo.html",aliases:["/simulation-hostside-demo.html","/host-usability-test"],protected:!0,cloudflareInternal:!0,internalName:"simulation-hostside-demo-view",hasDynamicSegment:!1},{path:"/simulation-host-mobile",file:"simulation-host-mobile.html",aliases:["/simulation-host-mobile.html","/host-simulation"],protected:!0,cloudflareInternal:!0,internalName:"simulation-host-mobile-view",hasDynamicSegment:!1},{path:"/_guest-relationships",file:"guest-relationships.html",aliases:["/_guest-relationships.html"],protected:!1,cloudflareInternal:!0,internalName:"guest-relationships-view",hasDynamicSegment:!1},{path:"/_manage-virtual-meetings",file:"manage-virtual-meetings.html",aliases:["/_manage-virtual-meetings.html"],protected:!1,cloudflareInternal:!0,internalName:"manage-virtual-meetings-view",hasDynamicSegment:!1},{path:"/_manage-informational-texts",file:"manage-informational-texts.html",aliases:["/_manage-informational-texts.html"],protected:!1,cloudflareInternal:!0,internalName:"manage-informational-texts-view",hasDynamicSegment:!1},{path:"/_quick-price",file:"quick-price.html",aliases:["/_quick-price.html"],protected:!1,cloudflareInternal:!0,internalName:"quick-price-view",hasDynamicSegment:!1},{path:"/_verify-users",file:"verify-users.html",aliases:["/_verify-users.html"],protected:!1,cloudflareInternal:!0,internalName:"verify-users-view",hasDynamicSegment:!1},{path:"/_co-host-requests",file:"co-host-requests.html",aliases:["/_co-host-requests.html"],protected:!1,cloudflareInternal:!0,internalName:"co-host-requests-view",hasDynamicSegment:!1},{path:"/_simulation-admin",file:"simulation-admin.html",aliases:["/_simulation-admin.html"],protected:!1,cloudflareInternal:!0,internalName:"simulation-admin-view",hasDynamicSegment:!1},{path:"/_send-magic-login-links",file:"send-magic-login-links.html",aliases:["/_send-magic-login-links.html"],protected:!1,cloudflareInternal:!0,internalName:"send-magic-login-links-view",hasDynamicSegment:!1},{path:"/_modify-listings",file:"modify-listings.html",aliases:["/_modify-listings.html"],protected:!1,cloudflareInternal:!0,internalName:"modify-listings-view",hasDynamicSegment:!1},{path:"/_message-curation",file:"message-curation.html",aliases:["/_message-curation.html"],protected:!1,cloudflareInternal:!0,internalName:"message-curation-view",hasDynamicSegment:!1},{path:"/_usability-data-management",file:"usability-data-management.html",aliases:["/_usability-data-management.html"],protected:!1,cloudflareInternal:!0,internalName:"usability-data-management-view",hasDynamicSegment:!1},{path:"/_ai-tools",file:"ai-tools.html",aliases:["/_ai-tools.html"],protected:!1,cloudflareInternal:!0,internalName:"ai-tools-view",hasDynamicSegment:!1},{path:"/_emergency",file:"internal-emergency.html",aliases:["/_emergency.html"],protected:!1,cloudflareInternal:!0,internalName:"internal-emergency-view",hasDynamicSegment:!1},{path:"/_admin-threads",file:"admin-threads.html",aliases:["/_admin-threads.html"],protected:!1,cloudflareInternal:!0,internalName:"admin-threads-view",hasDynamicSegment:!1},{path:"/_manage-rental-applications",file:"manage-rental-applications.html",aliases:["/_manage-rental-applications.html"],protected:!1,cloudflareInternal:!0,internalName:"manage-rental-applications-view",hasDynamicSegment:!0,dynamicPattern:"/_manage-rental-applications/:id"},{path:"/_create-document",file:"create-document.html",aliases:["/_create-document.html"],protected:!1,cloudflareInternal:!0,internalName:"create-document-view",hasDynamicSegment:!1},{path:"/_proposal-manage",file:"proposal-manage.html",aliases:["/_proposal-manage.html"],protected:!1,cloudflareInternal:!0,internalName:"proposal-manage-view",hasDynamicSegment:!1},{path:"/_listings-overview",file:"listings-overview.html",aliases:["/_listings-overview.html"],protected:!1,cloudflareInternal:!0,internalName:"listings-overview-view",hasDynamicSegment:!1},{path:"/_experience-responses",file:"experience-responses.html",aliases:["/_experience-responses.html"],protected:!1,cloudflareInternal:!0,internalName:"experience-responses-view",hasDynamicSegment:!1},{path:"/_internal/z-search-unit-test",file:"z-search-unit-test.html",aliases:["/_internal/z-search-unit-test.html"],protected:!1,cloudflareInternal:!0,internalName:"z-search-unit-test-view",hasDynamicSegment:!1},{path:"/_internal/z-emails-unit",file:"z-emails-unit.html",aliases:["/_internal/z-emails-unit.html"],protected:!1,cloudflareInternal:!0,internalName:"z-emails-unit-view",hasDynamicSegment:!1},{path:"/_internal/z-pricing-unit-test",file:"z-pricing-unit-test.html",aliases:["/_internal/z-pricing-unit-test.html"],protected:!1,cloudflareInternal:!0,internalName:"z-pricing-unit-test-view",hasDynamicSegment:!1},{path:"/_internal/z-schedule-test",file:"z-schedule-test.html",aliases:["/_internal/z-schedule-test.html"],protected:!1,cloudflareInternal:!0,internalName:"z-schedule-test-view",hasDynamicSegment:!1},{path:"/_internal/z-sharath-test",file:"z-sharath-test.html",aliases:["/_internal/z-sharath-test.html"],protected:!1,cloudflareInternal:!0,internalName:"z-sharath-test-view",hasDynamicSegment:!1},{path:"/_internal/z-unit-chatgpt-models",file:"z-unit-chatgpt-models.html",aliases:["/_internal/z-unit-chatgpt-models.html"],protected:!1,cloudflareInternal:!0,internalName:"z-unit-chatgpt-models-view",hasDynamicSegment:!1},{path:"/report-emergency",file:"report-emergency.html",aliases:["/report-emergency.html","/emergency-form"],protected:!1,cloudflareInternal:!0,internalName:"report-emergency-view",hasDynamicSegment:!1},{path:"/_internal/z-unit-payment-records-js",file:"z-unit-payment-records-js.html",aliases:["/_internal/z-unit-payment-records-js.html"],protected:!1,cloudflareInternal:!0,internalName:"z-unit-payment-records-js-view",hasDynamicSegment:!1}];en.filter(e=>e.excludeFromFunctions).map(e=>[e.path,`${e.path}/*`]).flat();function tn(e,s={}){if(!e)return"/view-split-lease";const n=new URLSearchParams;s.daysSelected&&s.daysSelected.length>0&&n.set("days-selected",s.daysSelected.join(",")),s.reservationSpan&&n.set("reservation-span",s.reservationSpan.toString()),s.moveInDate&&n.set("move-in",s.moveInDate);const i=n.toString();return`/view-split-lease/${e}${i?"?"+i:""}`}function gt(e,s={}){const{openModal:n=!0,scrollToSection:i=!0}=s,a=new URLSearchParams;i&&a.set("section","rental-application"),n&&a.set("openRentalApp","true"),e?window.location.href=`/rental-application?proposal=${e}`:window.location.href="/rental-application";const r=a.toString();window.location.href=`/account-profile${r?"?"+r:""}`}function sn({listingId:e}){const[s,n]=d.useState([]),[i,a]=d.useState(!0),[r,c]=d.useState(null);if(d.useEffect(()=>{if(!e)return;async function h(){try{const{data:p,error:o}=await z.from("external_reviews").select("*").eq("listing_id",e).order("review_date",{ascending:!1}).limit(10);if(o)throw o;n(p||[])}catch(p){console.error("Error loading external reviews:",p),c(p.message)}finally{a(!1)}}h()},[e]),i)return t.jsxs("div",{className:"animate-pulse space-y-3",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"}),t.jsx("div",{className:"h-20 bg-gray-200 rounded"})]});if(r||s.length===0)return null;const f=s.reduce((h,p)=>(h[p.platform]||(h[p.platform]=[]),h[p.platform].push(p),h),{}),N={Airbnb:"bg-red-100 text-red-700",VRBO:"bg-blue-100 text-blue-700","Booking.com":"bg-green-100 text-green-700"};function w(h,p=200){return h?h.length<=p?h:h.slice(0,p)+"...":""}function g(h){return new Date(h).toLocaleDateString("en-US",{year:"numeric",month:"short"})}function m(h){const p=h>5?h/2:h,o=Math.round(p);return t.jsx("div",{className:"flex gap-0.5",children:[...Array(5)].map((I,k)=>t.jsx("svg",{className:`w-4 h-4 ${k<o?"text-yellow-400":"text-gray-300"}`,fill:"currentColor",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})},k))})}return t.jsxs("div",{className:"border-t pt-4 mt-4",children:[t.jsxs("h4",{className:"text-sm font-semibold text-gray-700 mb-4",children:["External Reviews (",s.length,")"]}),t.jsx("div",{className:"space-y-4",children:Object.entries(f).map(([h,p])=>t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded ${N[h]||"bg-gray-100 text-gray-700"}`,children:h}),t.jsxs("span",{className:"text-xs text-gray-500",children:[p.length," ",p.length===1?"review":"reviews"]})]}),p.slice(0,3).map(o=>t.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[t.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[o.reviewer_photo?t.jsx("img",{src:o.reviewer_photo,alt:o.reviewer_name,className:"w-10 h-10 rounded-full object-cover"}):t.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-gray-600 font-medium",children:o.reviewer_name.charAt(0)}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:o.reviewer_name}),t.jsx("span",{className:"text-xs text-gray-500",children:g(o.review_date)})]}),m(o.rating)]})]}),t.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:w(o.description,200)}),o.original_url&&t.jsxs("a",{href:o.original_url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 mt-2 text-xs text-purple-600 hover:text-purple-700",children:["View on ",h,t.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})]})]},o.id)),p.length>3&&t.jsxs("button",{className:"text-sm text-purple-600 hover:text-purple-700 font-medium",children:["Show ",p.length-3," more ",h," reviews"]})]},h))})]})}const nn=()=>t.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",children:t.jsx("path",{d:"M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"})}),an=()=>t.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",children:t.jsx("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"})}),rn=()=>t.jsxs("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),t.jsx("polyline",{points:"22,6 12,13 2,6"})]}),ln=()=>t.jsxs("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2"}),t.jsx("circle",{cx:"8",cy:"12",r:"2"}),t.jsx("path",{d:"M14 10h4"}),t.jsx("path",{d:"M14 14h4"})]}),cn=()=>t.jsx("svg",{viewBox:"0 0 24 24",width:"14",height:"14",fill:"currentColor",children:t.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})});function on({host:e,listing:s,onClose:n}){var g,m;if(!e)return null;const i=e["Name - First"]||"",a=((g=e["Name - Last"])==null?void 0:g.charAt(0))||"",r=a?`${i.charAt(0)}. ${a}. ${i.charAt(i.length-1)||""}`.replace(/\. \. /g,". "):i,c=e["Profile Photo"]?e["Profile Photo"].startsWith("//")?`https:${e["Profile Photo"]}`:e["Profile Photo"]:null,f=[(s==null?void 0:s.hoodName)||(s==null?void 0:s["Location - Hood"]),(s==null?void 0:s.boroughName)||(s==null?void 0:s["Location - Borough"])].filter(Boolean).join(", "),N=(s==null?void 0:s.featuredPhotoUrl)||((m=s==null?void 0:s["Features - Photos"])==null?void 0:m[0])||null,w=[{icon:t.jsx(nn,{}),label:"LinkedIn",verified:e["linkedIn verification"]},{icon:t.jsx(an,{}),label:"Phone",verified:e["Phone Number Verified"]},{icon:t.jsx(rn,{}),label:"Email",verified:e["Email - Verified"]},{icon:t.jsx(ln,{}),label:"Identity",verified:e["Identity Verified"]}];return t.jsx("div",{className:"host-profile-overlay",onClick:n,children:t.jsxs("div",{className:"host-profile-modal",onClick:h=>h.stopPropagation(),children:[t.jsxs("div",{className:"hpm-host-section",children:[c?t.jsx("img",{src:c,alt:r,className:"hpm-host-photo"}):t.jsx("div",{className:"hpm-host-photo-placeholder",children:i.charAt(0)||"H"}),t.jsxs("div",{className:"hpm-host-info",children:[t.jsxs("div",{className:"hpm-host-name",children:["Host: ",r]}),t.jsx("div",{className:"hpm-verification-list",children:w.map(({icon:h,label:p,verified:o})=>t.jsxs("div",{className:"hpm-verification-item",children:[t.jsx("span",{className:"hpm-verification-icon",children:h}),t.jsx("span",{className:"hpm-verification-label",children:p}),t.jsx("span",{className:`hpm-verification-status ${o?"verified":"unverified"}`,children:o?"Verified":"Unverified"})]},p))})]})]}),s&&t.jsxs("div",{className:"hpm-featured-section",children:[t.jsxs("div",{className:"hpm-featured-title",children:["Featured Listings from ",i.charAt(0),". ",a,"."]}),t.jsxs("div",{className:"hpm-listing-card",children:[N?t.jsx("img",{src:N,alt:s.Name,className:"hpm-listing-photo"}):t.jsx("div",{className:"hpm-listing-photo-placeholder"}),t.jsxs("div",{className:"hpm-listing-info",children:[t.jsx("a",{href:`/view-split-lease/${s._id}`,className:"hpm-listing-name",target:"_blank",rel:"noopener noreferrer",children:s.Name}),t.jsxs("div",{className:"hpm-listing-location",children:[t.jsx("span",{className:"hpm-location-icon",children:t.jsx(cn,{})}),t.jsx("span",{children:f})]})]})]})]}),s&&t.jsx("div",{className:"hpm-reviews-section",children:t.jsx(sn,{listingId:s._id})}),t.jsx("div",{className:"hpm-footer",children:t.jsx("button",{className:"hpm-close-button",onClick:n,children:"Close"})})]})})}const _e=[{id:0,name:"Sunday",shortName:"Sun",singleLetter:"S",dayIndex:0},{id:1,name:"Monday",shortName:"Mon",singleLetter:"M",dayIndex:1},{id:2,name:"Tuesday",shortName:"Tue",singleLetter:"T",dayIndex:2},{id:3,name:"Wednesday",shortName:"Wed",singleLetter:"W",dayIndex:3},{id:4,name:"Thursday",shortName:"Thu",singleLetter:"T",dayIndex:4},{id:5,name:"Friday",shortName:"Fri",singleLetter:"F",dayIndex:5},{id:6,name:"Saturday",shortName:"Sat",singleLetter:"S",dayIndex:6}],je=[{id:"2-weeks",display:"2 weeks",weeks:2,months:0,type:"weeks"},{id:"4-weeks",display:"4 weeks",weeks:4,months:0,type:"weeks"},{id:"1-month",display:"1 month",weeks:4,months:1,type:"months"},{id:"2-months",display:"2 months",weeks:8,months:2,type:"months"},{id:"3-months",display:"3 months",weeks:13,months:3,type:"months"},{id:"6-months",display:"6 months",weeks:26,months:6,type:"months"},{id:"12-months",display:"12 months",weeks:52,months:12,type:"months"},{id:"other",display:"Other (wks)",weeks:0,months:0,type:"other"}],dn=30.44;function ke(e){return e==null||isNaN(e)?"$0.00":"$"+e.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,",")}function un(e){return!e||!(e instanceof Date)?"":new Intl.DateTimeFormat("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}).format(e)}function hn(e){return!e||!(e instanceof Date)?"":new Intl.DateTimeFormat("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}).format(e)}function Ge(e,s=!1){return s?hn(e):un(e)}function ze(e,s){return!s||s===0?0:Math.ceil(e/s)}function mn(e,s,n,i,a){var r;switch(e){case"Nightly":return ze(s,n)*i;case"Weekly":return ze(s,n);case"Monthly":return(a==null?void 0:a.type)==="other"?(s*7/dn).toFixed(2):((r=a==null?void 0:a.months)==null?void 0:r.toFixed(2))||"0.00";default:return 0}}function pt(e){return e==="guest"||e==="A Guest (I would like to rent a space)"}function fn(e){switch(e){case"Nightly":return"Compensation /night";case"Weekly":return"Compensation /Week";case"Monthly":return"Compensation /31 days";default:return"Compensation /night"}}function Et(e){switch(e){case"Nightly":return"Nights reserved";case"Weekly":return"Weeks reserved";case"Monthly":return"Months reserved";default:return"Nights reserved"}}function Ft(e){switch(e){case"Weekly":return"Price per 4 calendar weeks";default:return"Price per 4 weeks"}}function gn({days:e=_e,selectedDays:s,selectedNights:n,onDayToggle:i,onNightToggle:a,checkInDay:r,checkOutDay:c,onCheckInSelect:f,onCheckOutSelect:N,disabled:w=!1}){const g=d.useCallback(o=>{w||(i(o),a(o))},[w,i,a]);d.useCallback(o=>({display:o.name,dayIndex:o.dayIndex,first3Letters:o.shortName}),[]);const m=d.useCallback(o=>s.includes(o),[s]);d.useCallback(o=>(r==null?void 0:r.dayIndex)===o.dayIndex,[r]),d.useCallback(o=>(c==null?void 0:c.dayIndex)===o.dayIndex,[c]);const h=s.length,p=n.length;return t.jsxs("div",{className:"day-night-selector",role:"group","aria-labelledby":"dns-heading",children:[t.jsx("span",{id:"dns-heading",className:"gep-sr-only",children:"Select days of the week for your stay"}),t.jsx("div",{className:"dns-day-grid",role:"group","aria-label":"Days of the week",children:e.map(o=>t.jsx("button",{type:"button",className:`dns-day-btn ${m(o.id)?"dns-day-btn--selected":""}`,onClick:()=>g(o.id),disabled:w,title:o.name,"aria-label":`${o.name}${m(o.id)?", selected":""}`,"aria-pressed":m(o.id),children:o.singleLetter},o.id))}),t.jsxs("div",{className:"dns-schedule-info",children:[t.jsxs("div",{className:"dns-schedule-info-row",children:[t.jsx("span",{className:"dns-schedule-info-label",children:"Check-in:"}),t.jsx("span",{className:"dns-schedule-info-value",children:(r==null?void 0:r.display)||"Not set"})]}),t.jsxs("div",{className:"dns-schedule-info-row",children:[t.jsx("span",{className:"dns-schedule-info-label",children:"Check-out:"}),t.jsx("span",{className:"dns-schedule-info-value",children:(c==null?void 0:c.display)||"Not set"})]}),t.jsx("div",{className:"dns-schedule-info-divider"}),t.jsx("div",{className:"dns-schedule-info-row",children:t.jsxs("span",{className:"dns-schedule-info-summary",children:[t.jsx("strong",{children:h})," days, ",t.jsx("strong",{children:p})," nights per week"]})})]})]})}function pn({listing:e,proposal:s,moveInDate:n,checkInDay:i,checkOutDay:a,reservationSpan:r,weeksReservationSpanNumber:c,nightsSelected:f,houseRulesToDisplay:N=[],pricePerNight:w=0,totalPriceForReservation:g=0,priceRentPer4Weeks:m=0,user:h,isVisible:p=!0,isHouseRulesVisible:o=!1,onHouseRulesClick:I,pageWidth:k=1200}){var v,B,te;if(!p)return null;const L=(s==null?void 0:s.rentalType)||(e==null?void 0:e.rentalType)||"Nightly",u=s==null?void 0:s.weekSelection,W=(s==null?void 0:s.hostCompensation)??0,H=(s==null?void 0:s.damageDeposit)??(s==null?void 0:s["damage deposit"])??0,J=(s==null?void 0:s.cleaningFee)??(s==null?void 0:s["cleaning fee"])??0,j=pt((v=h==null?void 0:h.watching)==null?void 0:v.type)||pt((B=h==null?void 0:h.watching)==null?void 0:B.typeUserSignup)||(h==null?void 0:h.type)==="guest",D=(f==null?void 0:f.length)||0,T=D===7,O=L==="Weekly",x=k<900,E=k<380,A=k<350,b=(u==null?void 0:u.period)||1,F=ze(c,b),R=mn(L,c,b,D,r),S=fn(L),$=Et(L),U=Ft(L),P=()=>{var se;if(((N==null?void 0:N.length)||((se=s==null?void 0:s.hcHouseRules)==null?void 0:se.length)||0)===0)return j?"No House Rules":"You Don't Have any House Rules";const ie=o?"(click to hide)":"(click to see)",V=j?"House Rules":"Your House Rules";return t.jsxs(t.Fragment,{children:[V," ",t.jsx("span",{className:"rpb-small-text",children:ie})]})},C=()=>E?"Duration":"Reservation Length",q=()=>(r==null?void 0:r.type)==="other"||A?`${c} weeks`:(r==null?void 0:r.display)||`${c} weeks`,ae=()=>T?"Occupancy":"Check-in",l=()=>T?"Full Time":(i==null?void 0:i.display)||"Not set";return t.jsxs("div",{className:"reservation-price-breakdown",children:[t.jsxs("div",{className:"rpb-row",children:[t.jsx("span",{className:"rpb-label",children:"Move-in"}),t.jsx("span",{className:"rpb-value",children:Ge(n,x)})]}),t.jsxs("div",{className:"rpb-row",children:[t.jsx("span",{className:"rpb-label",children:ae()}),t.jsx("span",{className:"rpb-value",children:l()})]}),!T&&t.jsxs("div",{className:"rpb-row",children:[t.jsx("span",{className:"rpb-label",children:"Check-out"}),t.jsx("span",{className:"rpb-value",children:(a==null?void 0:a.display)||"Not set"})]}),t.jsxs("div",{className:"rpb-row",children:[t.jsx("span",{className:"rpb-label",children:C()}),t.jsx("span",{className:"rpb-value",children:q()})]}),t.jsxs("div",{className:"rpb-row",children:[t.jsx("span",{className:`rpb-label rpb-house-rules-label ${A?"rpb-label--small":""}`,onClick:I,children:P()}),t.jsx("span",{className:`rpb-value ${A?"rpb-value--small":""}`,children:(N==null?void 0:N.length)||((te=s==null?void 0:s.hcHouseRules)==null?void 0:te.length)||0})]}),t.jsx("hr",{className:"rpb-divider"}),O&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"rpb-row",children:[t.jsx("span",{className:"rpb-label rpb-label--regular",children:"Weekly Pattern"}),t.jsx("span",{className:"rpb-value rpb-value--regular",children:x&&(u!=null&&u.displayMobile)?u.displayMobile:(u==null?void 0:u.display)||""})]}),t.jsxs("div",{className:"rpb-row",children:[t.jsx("span",{className:"rpb-label rpb-label--regular",children:"Actual Weeks Used"}),t.jsx("span",{className:"rpb-value rpb-value--regular",children:F})]})]}),!j&&t.jsxs("div",{className:"rpb-row",children:[t.jsx("span",{className:`rpb-label rpb-label--large ${E?"rpb-label--responsive":""}`,children:S}),t.jsx("span",{className:"rpb-value",children:ke(W)})]}),j&&t.jsxs("div",{className:"rpb-row rpb-row--white",children:[t.jsx("span",{className:`rpb-label rpb-label--regular rpb-label--large ${k<700?"rpb-label--responsive-large":""}`,children:"Price per night"}),t.jsx("span",{className:`rpb-value rpb-value--regular rpb-value--large ${k<700?"rpb-value--responsive-large":""}`,children:ke(w)})]}),t.jsxs("div",{className:"rpb-row",children:[t.jsx("span",{className:"rpb-label rpb-label--regular",children:$}),t.jsxs("span",{className:"rpb-value rpb-value--regular",children:["x ",R]})]}),t.jsx("hr",{className:"rpb-divider"}),!j&&t.jsxs("div",{className:"rpb-row",children:[t.jsxs("span",{className:`rpb-label rpb-label--regular rpb-label--large ${E?"rpb-label--responsive":""}`,children:["Total Compensation ",t.jsx("span",{className:"rpb-small-text",children:"*Excluding Maintenance Fee and Damage Deposit"})]}),t.jsx("span",{className:`rpb-value rpb-value--regular rpb-value--large ${k<700?"rpb-value--responsive-large":""}`,children:ke(g)})]}),j&&t.jsxs(t.Fragment,{children:[t.jsx("hr",{className:"rpb-divider rpb-divider--thick"}),t.jsxs("div",{className:"rpb-row",children:[t.jsx("span",{className:`rpb-label rpb-label--regular rpb-label--large ${k<700?"rpb-label--responsive-large":""}`,children:"Total Price for Reservation"}),t.jsx("span",{className:`rpb-value rpb-value--regular rpb-value--large ${k<700?"rpb-value--responsive-large":""}`,children:ke(g)})]})]}),t.jsx("hr",{className:"rpb-divider rpb-divider--thick"}),j&&t.jsxs("div",{className:"rpb-row rpb-row--white",children:[t.jsx("span",{className:`rpb-label rpb-label--regular rpb-label--large ${k<700?"rpb-label--responsive-large":""}`,children:U}),t.jsx("span",{className:`rpb-value rpb-value--regular rpb-value--large ${k<700?"rpb-value--responsive-large":""}`,children:ke(m)})]}),t.jsxs("div",{className:"rpb-row",children:[t.jsxs("span",{className:"rpb-label rpb-label--regular rpb-label--small",children:["Refundable Damage Deposit",t.jsx("span",{className:"rpb-asterisk",children:"*"})]}),t.jsx("span",{className:"rpb-value rpb-value--regular rpb-value--small",children:ke(H)})]}),t.jsxs("div",{className:"rpb-row",children:[t.jsxs("span",{className:"rpb-label rpb-label--regular rpb-label--small",children:["Maintenance Fee",t.jsx("span",{className:"rpb-asterisk",children:"*"})," ",t.jsx("span",{className:"rpb-small-text",children:"*see terms of use"})]}),t.jsx("span",{className:"rpb-value rpb-value--regular rpb-value--small",children:ke(J)})]}),t.jsx("p",{className:"rpb-disclaimer",children:"*Refundable Damage Deposit is held with Split Lease"}),o&&(N==null?void 0:N.length)>0&&t.jsxs("div",{className:"rpb-house-rules-expanded",children:[t.jsx("h4",{className:"rpb-house-rules-title",children:"House Rules:"}),t.jsx("ul",{className:"rpb-house-rules-list",children:N.map((Q,ie)=>t.jsx("li",{className:"rpb-house-rule-item",children:Q},ie))})]})]})}function yn({proposal:e,listing:s,user:n,initialView:i="pristine",isVisible:a=!0,isInternalUsage:r=!1,pageWidth:c=1200,onClose:f,onProposalUpdate:N,onProposalCancel:w,onAlert:g,pricePerNight:m=0,totalPriceForReservation:h=0,priceRentPer4Weeks:p=0}){var be,Ne,Me,Te,fe,De,Pe,Ee,Fe,Ie,Re;const[o,I]=d.useState(i);console.log("[GuestEditingProposalModal] initialView:",i,"| current view:",o);const k=y=>{let _=(y==null?void 0:y["Days Selected"])||(y==null?void 0:y["hc days selected"])||[];if(typeof _=="string")try{_=JSON.parse(_)}catch{_=[]}return!Array.isArray(_)||_.length===0?[1,2,3,4,5]:_.map(M=>{if(typeof M=="number")return M;if(typeof M=="string"){const K=M.trim(),re=parseInt(K,10);return!isNaN(re)&&String(re)===K?re:{Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6}[K]??-1}return-1}).filter(M=>M>=0&&M<=6)},L=(y,_=1)=>{if(y==null||y===""){const ne=_e[_];return{display:ne.name,dayIndex:ne.dayIndex,first3Letters:ne.shortName}}const M=typeof y=="number"?y:parseInt(String(y).trim(),10);if(!isNaN(M)&&M>=0&&M<=6){const ne=_e[M];return{display:ne.name,dayIndex:ne.dayIndex,first3Letters:ne.shortName}}const K=_e.find(ne=>ne.name===y||ne.shortName===y);if(K)return{display:K.name,dayIndex:K.dayIndex,first3Letters:K.shortName};const re=_e[_];return{display:re.name,dayIndex:re.dayIndex,first3Letters:re.shortName}},[u,W]=d.useState(()=>{const y=k(e),_=(e==null?void 0:e["nights per week (num)"])||y.length-1||4,M=(e==null?void 0:e["check in day"])||(e==null?void 0:e.checkInDay),K=(e==null?void 0:e["check out day"])||(e==null?void 0:e.checkOutDay);return{moveInDate:e!=null&&e.hcMoveInDate?new Date(e.hcMoveInDate):e!=null&&e["hc Move-in Date"]?new Date(e["hc Move-in Date"]):e!=null&&e["Move in range start"]?new Date(e["Move in range start"]):new Date,flexibleMoveInRange:(e==null?void 0:e.moveInRangeText)||(e==null?void 0:e["Move in range text"])||"",reservationSpan:je.find(re=>re.weeks===((e==null?void 0:e.reservationSpanWeeks)||(e==null?void 0:e["Reservation Span (Weeks)"])))||je[1],numberOfWeeks:(e==null?void 0:e.reservationSpanWeeks)||(e==null?void 0:e["Reservation Span (Weeks)"])||4,selectedDays:y,selectedNights:y.slice(0,_),checkInDay:L(M,1),checkOutDay:L(K,5)}}),[H,J]=d.useState(!0),[j,D]=d.useState(!1),[T,O]=d.useState(!1),[x,E]=d.useState(!0),A=c<900,F=(((be=e==null?void 0:e.status)==null?void 0:be.usualOrder)||(e==null?void 0:e["Status - Usual Order"])||((Ne=e==null?void 0:e.Status)==null?void 0:Ne.usualOrder)||0)>=3,R=o!=="cancel",S=o==="editing",$=F||o==="editing"||r,U=o==="editing"||o==="general"||o==="pristine"||F||r;d.useEffect(()=>{if(e&&x){const y=(e==null?void 0:e.hcMoveInDate)||(e==null?void 0:e["hc Move-in Date"])||(e==null?void 0:e["Move in range start"]),_=(e==null?void 0:e.reservationSpanWeeks)||(e==null?void 0:e["Reservation Span (Weeks)"])||4,M=k(e),K=(e==null?void 0:e["nights per week (num)"])||M.length-1||4,re=(e==null?void 0:e["check in day"])||(e==null?void 0:e.checkInDay),ne=(e==null?void 0:e["check out day"])||(e==null?void 0:e.checkOutDay);W(Ke=>({...Ke,moveInDate:y?new Date(y):new Date,numberOfWeeks:_,reservationSpan:je.find(Ve=>Ve.weeks===_)||je[1],selectedDays:M,selectedNights:M.slice(0,K),checkInDay:L(re,1),checkOutDay:L(ne,5)})),E(!1)}},[e,x]);const P=d.useMemo(()=>{const y=u.reservationSpan;return{weeks:(y==null?void 0:y.weeks)||u.numberOfWeeks,months:(y==null?void 0:y.months)||Math.floor(u.numberOfWeeks/4),weeksInThisPeriod:u.numberOfWeeks,display:(y==null?void 0:y.display)||`${u.numberOfWeeks} weeks`,type:(y==null?void 0:y.type)||"weeks"}},[u.reservationSpan,u.numberOfWeeks]),C=d.useCallback(()=>{I("pristine"),f==null||f()},[f]),q=d.useCallback(()=>{o==="editing"?I("pristine"):C()},[o,C]),ae=d.useCallback(()=>{I(o!=="editing"?"editing":"general")},[o]),l=d.useCallback(()=>{I("editing")},[]),v=d.useCallback(y=>{const _=new Date(y.target.value);W(M=>({...M,moveInDate:_}))},[]),B=d.useCallback(y=>{W(_=>({..._,flexibleMoveInRange:y.target.value}))},[]),te=d.useCallback(y=>{const _=y.target.value,M=je.find(K=>K.id===_);W(K=>({...K,reservationSpan:M||null,numberOfWeeks:(M==null?void 0:M.type)==="other"?K.numberOfWeeks:(M==null?void 0:M.weeks)||K.numberOfWeeks}))},[]),Q=d.useCallback(y=>{const _=parseInt(y.target.value)||0;W(M=>({...M,numberOfWeeks:_}))},[]),ie=d.useCallback(y=>{W(_=>({..._,selectedDays:y}))},[]),V=d.useCallback(y=>{W(_=>({..._,selectedNights:y}))},[]),se=d.useCallback(y=>{W(_=>({..._,checkInDay:y}))},[]),ue=d.useCallback(y=>{W(_=>({..._,checkOutDay:y}))},[]),pe=d.useCallback(()=>{D(y=>!y)},[]),ye=d.useCallback(()=>{J(!0),I("general"),g==null||g({text:"New terms calculated",alertType:"information",showOnLive:!0})},[g]),he=d.useCallback(()=>{if(!e)return;const y={proposal:e,nightsSelected:u.selectedNights,daysSelected:u.selectedDays,checkIn:u.checkInDay,checkOut:u.checkOutDay,reservationSpan:u.reservationSpan||je[0],numberOfWeeks:u.numberOfWeeks,moveInDate:u.moveInDate,fourWeekRent:p,nightlyPrice:m,totalPrice:h};N==null||N(y),g==null||g({text:"Proposal updated successfully",alertType:"success",showOnLive:!0}),C()},[e,u,p,m,h,N,g,C]),oe=d.useCallback(()=>{I("pristine")},[]);d.useCallback(()=>{I("cancel")},[]);const ce=d.useCallback(async y=>{const _=e==null?void 0:e._id;if(!_){g==null||g({text:"Unable to cancel: proposal ID not found",alertType:"error",showOnLive:!0});return}try{await Xs(_,y||void 0),w==null||w(y),g==null||g({text:"Proposal cancelled successfully",alertType:"success",showOnLive:!0}),C()}catch(M){console.error("[GuestEditingProposalModal] Error cancelling proposal:",M),g==null||g({text:`Failed to cancel proposal: ${M.message}`,alertType:"error",showOnLive:!0})}},[e,w,g,C]),ve=d.useCallback(()=>{I("general")},[]),Se=d.useMemo(()=>({watching:{type:(n==null?void 0:n.type)||"guest",typeUserSignup:(n==null?void 0:n.typeUserSignup)||"A Guest (I would like to rent a space)"},type:"guest"}),[n]),xe=d.useMemo(()=>(e==null?void 0:e.hcHouseRules)||(e==null?void 0:e["hc House Rules"])||(s==null?void 0:s["House Rules"])||[],[e,s]);return a?t.jsx("div",{className:"guest-editing-proposal-modal-overlay",onClick:C,role:"dialog","aria-modal":"true","aria-labelledby":"gep-modal-title",children:t.jsxs("div",{className:"guest-editing-proposal",onClick:y=>y.stopPropagation(),role:"document",children:[R&&t.jsxs("div",{className:`gep-main-view ${o==="editing"?"gep-main-view--editing":""}`,children:[t.jsx("div",{className:"gep-header",children:o==="pristine"?t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"gep-header-left",children:[t.jsx("div",{className:"gep-header-icon","aria-hidden":"true",children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),t.jsx("polyline",{points:"14,2 14,8 20,8"}),t.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),t.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]})}),t.jsxs("div",{children:[t.jsx("h2",{id:"gep-modal-title",className:"gep-header-title-text",children:"Proposal Details"}),t.jsx("p",{className:"gep-header-subtitle",children:(s==null?void 0:s.title)||(s==null?void 0:s.Title)||((Me=e==null?void 0:e._listing)==null?void 0:Me.title)||"Listing"})]})]}),t.jsx("button",{type:"button",className:"gep-close-button",onClick:C,"aria-label":"Close modal",children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"gep-header-left",children:[t.jsx("button",{type:"button",className:"gep-header-back-btn",onClick:q,"aria-label":"Go back to previous view",children:t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2","aria-hidden":"true",children:t.jsx("path",{d:"M15 18L9 12L15 6",strokeLinecap:"round",strokeLinejoin:"round"})})}),t.jsxs("div",{children:[t.jsx("h2",{id:"gep-modal-title",className:"gep-header-title-text",children:"Edit Proposal"}),t.jsx("p",{className:"gep-header-subtitle",children:(s==null?void 0:s.title)||(s==null?void 0:s.Title)||((Te=e==null?void 0:e._listing)==null?void 0:Te.title)||"Listing"})]})]}),t.jsx("button",{type:"button",className:"gep-close-button",onClick:C,"aria-label":"Close modal",children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),t.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})}),((e==null?void 0:e.guestCommentToEditSuggestedProposal)||(e==null?void 0:e["Guest Comment to Edit Suggested Proposal"]))&&t.jsx("div",{className:"gep-guest-comment",children:t.jsxs("p",{className:"gep-guest-comment-text",children:["Guest's comment to update suggested proposal: ",e.guestCommentToEditSuggestedProposal||e["Guest Comment to Edit Suggested Proposal"]]})}),S&&t.jsxs("div",{className:"gep-editing-portion",children:[t.jsx(gn,{days:_e,selectedDays:u.selectedDays,selectedNights:u.selectedNights,onDayToggle:y=>{const _=u.selectedDays.includes(y)?u.selectedDays.filter(M=>M!==y):[...u.selectedDays,y];ie(_)},onNightToggle:y=>{const _=u.selectedNights.includes(y)?u.selectedNights.filter(M=>M!==y):[...u.selectedNights,y];V(_)},checkInDay:u.checkInDay,checkOutDay:u.checkOutDay,onCheckInSelect:se,onCheckOutSelect:ue}),t.jsxs("div",{className:"gep-form-section",children:[t.jsx("label",{htmlFor:"gep-move-in-date",className:"gep-form-label",children:"Move-In Date"}),t.jsxs("div",{className:"gep-date-input-container",children:[t.jsx("input",{type:"date",id:"gep-move-in-date",className:"gep-date-input",value:u.moveInDate instanceof Date&&!isNaN(u.moveInDate)?u.moveInDate.toISOString().split("T")[0]:"",onChange:v,"aria-describedby":"gep-move-in-display"}),t.jsx("button",{type:"button",className:"gep-calendar-button","aria-label":"Open calendar picker",children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[t.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),t.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10",stroke:"currentColor",strokeWidth:"2"}),t.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),t.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})})]}),t.jsxs("p",{id:"gep-move-in-display",className:"gep-date-display","aria-live":"polite",children:["Move-in: ",Ge(u.moveInDate,A)]})]}),t.jsxs("div",{className:"gep-form-section",children:[t.jsxs("label",{htmlFor:"gep-flexible-move-in",className:"gep-form-label",children:["Flexible move-in date?",t.jsx("button",{type:"button",className:"gep-info-button","aria-label":"More information about flexible move-in dates",children:t.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[t.jsx("circle",{cx:"10",cy:"10",r:"9",stroke:"currentColor",strokeWidth:"2"}),t.jsx("text",{x:"10",y:"14",textAnchor:"middle",fontSize:"12",fill:"currentColor",fontWeight:"bold",children:"?"})]})})]}),t.jsx("textarea",{id:"gep-flexible-move-in",className:"gep-textarea",value:u.flexibleMoveInRange,onChange:B,placeholder:"Type here your move-in range...",rows:2,"aria-describedby":"gep-flexible-hint"}),t.jsx("span",{id:"gep-flexible-hint",className:"gep-sr-only",children:"Optionally describe a range of dates when you could move in"})]}),t.jsxs("div",{className:"gep-form-section",children:[t.jsx("label",{htmlFor:"gep-reservation-span",className:"gep-form-label",children:"Reservation Span"}),t.jsxs("select",{id:"gep-reservation-span",className:"gep-select",value:((fe=u.reservationSpan)==null?void 0:fe.id)||"",onChange:te,"aria-describedby":((De=u.reservationSpan)==null?void 0:De.type)==="other"?"gep-weeks-section":void 0,children:[t.jsx("option",{value:"",disabled:!0,children:"Select reservation length"}),je.map(y=>t.jsx("option",{value:y.id,children:y.display},y.id))]}),((Pe=u.reservationSpan)==null?void 0:Pe.type)==="other"&&t.jsxs("div",{id:"gep-weeks-section",className:"gep-weeks-input-section",children:[t.jsx("label",{htmlFor:"gep-num-weeks",className:"gep-form-label-small",children:"# of Weeks"}),t.jsx("input",{type:"number",id:"gep-num-weeks",className:"gep-number-input",value:u.numberOfWeeks,onChange:Q,placeholder:"Enter # of Weeks",min:1,"aria-label":"Number of weeks for reservation"})]})]})]}),o==="pristine"&&t.jsxs("div",{className:"gep-document-view",role:"region","aria-label":"Proposal details",children:[t.jsxs("dl",{className:"gep-details-list",children:[t.jsxs("div",{className:"gep-detail-row",children:[t.jsx("dt",{className:"gep-detail-label",children:"Move-in"}),t.jsx("dd",{className:"gep-detail-value",children:Ge(u.moveInDate,!1)})]}),t.jsxs("div",{className:"gep-detail-row",children:[t.jsx("dt",{className:"gep-detail-label",children:"Check-in"}),t.jsx("dd",{className:"gep-detail-value",children:((Ee=u.checkInDay)==null?void 0:Ee.display)||"Not set"})]}),t.jsxs("div",{className:"gep-detail-row",children:[t.jsx("dt",{className:"gep-detail-label",children:"Check-out"}),t.jsx("dd",{className:"gep-detail-value",children:((Fe=u.checkOutDay)==null?void 0:Fe.display)||"Not set"})]}),t.jsxs("div",{className:"gep-detail-row",children:[t.jsx("dt",{className:"gep-detail-label",children:"Reservation Length"}),t.jsx("dd",{className:"gep-detail-value",children:P.display})]}),t.jsxs("div",{className:"gep-detail-row",children:[t.jsx("dt",{className:"gep-detail-label",children:"Weekly Pattern"}),t.jsxs("dd",{className:"gep-detail-value",children:[((Ie=u.checkInDay)==null?void 0:Ie.first3Letters)||"Mon"," - ",((Re=u.checkOutDay)==null?void 0:Re.first3Letters)||"Fri"," (",u.selectedNights.length," nights/week)"]})]}),t.jsxs("div",{className:"gep-detail-row",children:[t.jsx("dt",{className:"gep-detail-label",children:"House Rules"}),t.jsx("dd",{className:"gep-detail-value",children:xe.length})]})]}),t.jsxs("div",{className:"gep-pricing-section",children:[t.jsx("div",{className:"gep-pricing-title",children:"Pricing Breakdown"}),t.jsxs("div",{className:"gep-pricing-row",children:[t.jsx("span",{className:"gep-pricing-label",children:"Price per night"}),t.jsxs("span",{className:"gep-pricing-value",children:["$",(m||0).toFixed(2)]})]}),t.jsxs("div",{className:"gep-pricing-row",children:[t.jsx("span",{className:"gep-pricing-label",children:Et((s==null?void 0:s.rentalType)||"Nightly")}),t.jsxs("span",{className:"gep-pricing-value",children:["Ã— ",u.selectedNights.length*u.numberOfWeeks]})]}),t.jsxs("div",{className:"gep-pricing-row gep-pricing-row--total",children:[t.jsx("span",{className:"gep-pricing-label",children:"Total Price for Reservation"}),t.jsxs("span",{className:"gep-pricing-value",children:["$",(h||0).toFixed(2)]})]})]}),t.jsxs("div",{className:"gep-fees-section",children:[t.jsxs("div",{className:"gep-fee-row",children:[t.jsx("span",{className:"gep-fee-label",children:Ft((s==null?void 0:s.rentalType)||"Nightly")}),t.jsxs("span",{className:"gep-fee-value",children:["$",(p||0).toFixed(2)]})]}),t.jsxs("div",{className:"gep-fee-row",children:[t.jsx("span",{className:"gep-fee-label",children:"Refundable Damage Deposit*"}),t.jsxs("span",{className:"gep-fee-value",children:["$",((s==null?void 0:s.damageDeposit)||(s==null?void 0:s["Damage Deposit"])||0).toFixed(2)]})]}),t.jsxs("div",{className:"gep-fee-row",children:[t.jsxs("span",{className:"gep-fee-label",children:["Maintenance Fee* ",t.jsx("span",{className:"gep-fee-note",children:"*see terms of use"})]}),t.jsxs("span",{className:"gep-fee-value",children:["$",((s==null?void 0:s.maintenanceFee)||(s==null?void 0:s["Maintenance Fee"])||0).toFixed(2)]})]}),t.jsx("p",{className:"gep-disclaimer",children:"*Refundable Damage Deposit is held with Split Lease"})]})]}),o==="general"&&t.jsx("div",{className:"gep-breakdown-details",children:t.jsx(pn,{listing:s||(e==null?void 0:e._listing),proposal:e,moveInDate:u.moveInDate,checkInDay:u.checkInDay,checkOutDay:u.checkOutDay,reservationSpan:P,weeksReservationSpanNumber:u.numberOfWeeks,nightsSelected:u.selectedNights,houseRulesToDisplay:xe,pricePerNight:m||(e==null?void 0:e["proposal nightly price"])||0,totalPriceForReservation:h||(e==null?void 0:e["Total Price for Reservation (guest)"])||0,priceRentPer4Weeks:p||(e==null?void 0:e["Price Rent per 4 weeks"])||0,user:Se,isVisible:!0,isHouseRulesVisible:j,onHouseRulesClick:pe,pageWidth:c})}),$&&t.jsx("div",{className:`gep-schedule-financial ${T?"gep-schedule-financial--hovered":""}`,onClick:ae,onMouseEnter:()=>O(!0),onMouseLeave:()=>O(!1),children:t.jsxs("div",{className:"gep-schedule-financial-content",children:[t.jsx("span",{className:"gep-schedule-financial-label",children:"Edit Proposal Terms (Nights, Weeks, Move-in date)"}),t.jsx("svg",{className:`gep-expand-icon ${o==="editing"?"gep-expand-icon--expanded":""}`,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M9 18L15 12L9 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})})]}),R&&U&&t.jsx("div",{className:`gep-buttons ${o==="pristine"?"gep-buttons--vertical":""}`,children:o==="pristine"?t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:"gep-button gep-button--primary",onClick:l,children:"Edit Proposal"}),t.jsx("button",{type:"button",className:"gep-button gep-button--secondary",onClick:C,children:"Close"})]}):o==="editing"?t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:"gep-button gep-button--secondary",onClick:oe,children:"Cancel edits"}),t.jsx("button",{type:"button",className:"gep-button gep-button--primary",onClick:ye,children:"Display New Terms"})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{type:"button",className:"gep-button gep-button--secondary",onClick:C,children:"Close"}),t.jsx("button",{type:"button",className:"gep-button gep-button--primary",onClick:he,children:"Submit Proposal Edits"})]})}),t.jsx(Ye,{isOpen:o==="cancel",proposal:e,listing:s||(e==null?void 0:e._listing),userType:"guest",onClose:ve,onConfirm:ce})]})}):null}async function vn(e){if(!e)throw new Error("Proposal ID is required");console.log("[counterofferWorkflow] Accepting counteroffer for proposal:",e);const{data:s,error:n}=await z.from("proposal").select("*").eq("_id",e).single();if(n)throw new Error(`Failed to fetch proposal: ${n.message}`);if(!s["counter offer happened"])throw new Error("Proposal does not have a counteroffer to accept");const i=new Date().toISOString(),a={Status:le.PROPOSAL_OR_COUNTEROFFER_ACCEPTED.key,"Modified Date":i,"Is Finalized":!0},{data:r,error:c}=await z.from("proposal").update(a).eq("_id",e).select().single();if(c)throw console.error("[counterofferWorkflow] Error accepting counteroffer:",c),new Error(`Failed to accept counteroffer: ${c.message}`);console.log("[counterofferWorkflow] Counteroffer accepted successfully:",e);const f="https://qcfifybkaddcoimjroca.supabase.co";if(s){const N=s["nights per week (num)"]||0,w=s["proposal nightly price"]||0,g=N*4*w,m=g;fetch(`${f}/functions/v1/lease`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"create",payload:{proposalId:e,isCounteroffer:!1,fourWeekRent:m,fourWeekCompensation:g}})}).catch(h=>{console.warn("[counterofferWorkflow] Lease creation trigger failed (non-blocking):",h)})}return r}async function xn(e,s="Counteroffer declined by guest"){if(!e)throw new Error("Proposal ID is required");console.log("[counterofferWorkflow] Declining counteroffer for proposal:",e);const n=new Date().toISOString(),i={Status:le.CANCELLED_BY_GUEST.key,Deleted:!0,"Modified Date":n,"reason for cancellation":s},{data:a,error:r}=await z.from("proposal").update(i).eq("_id",e).select().single();if(r)throw console.error("[counterofferWorkflow] Error declining counteroffer:",r),new Error(`Failed to decline counteroffer: ${r.message}`);return console.log("[counterofferWorkflow] Counteroffer declined successfully:",e),a}function bn(e){if(!e)throw new Error("Proposal is required");const s={daysSelected:e.daysSelected||e["Days Selected"]||[],nightsPerWeek:e.nightsPerWeek||e["nights per week (num)"]||0,reservationWeeks:e.reservationWeeks||e["Reservation Span (Weeks)"]||0,checkInDay:e.checkInDay||e["check in day"]||null,checkOutDay:e.checkOutDay||e["check out day"]||null,totalPrice:e.totalPrice||e["Total Price for Reservation (guest)"]||0,nightlyPrice:e.nightlyPrice||e["proposal nightly price"]||0,damageDeposit:e.damageDeposit||e["damage deposit"]||0,cleaningFee:e.cleaningFee||e["cleaning fee"]||0},n={daysSelected:e.hcDaysSelected||e["hc days selected"]||s.daysSelected,nightsPerWeek:e.hcNightsPerWeek||e["hc nights per week"]||s.nightsPerWeek,reservationWeeks:e.hcReservationWeeks||e["hc reservation span (weeks)"]||s.reservationWeeks,checkInDay:e.hcCheckInDay||e["hc check in day"]||s.checkInDay,checkOutDay:e.hcCheckOutDay||e["hc check out day"]||s.checkOutDay,totalPrice:e.hcTotalPrice||e["hc total price"]||s.totalPrice,nightlyPrice:e.hcNightlyPrice||e["hc nightly price"]||s.nightlyPrice,damageDeposit:e.hcDamageDeposit||e["hc damage deposit"]||s.damageDeposit,cleaningFee:e.hcCleaningFee||e["hc cleaning fee"]||s.cleaningFee},i=[];return s.totalPrice!==n.totalPrice&&i.push({field:"totalPrice",label:"Total Price",original:s.totalPrice,modified:n.totalPrice}),s.nightlyPrice!==n.nightlyPrice&&i.push({field:"nightlyPrice",label:"Nightly Rate",original:s.nightlyPrice,modified:n.nightlyPrice}),s.reservationWeeks!==n.reservationWeeks&&i.push({field:"reservationWeeks",label:"Duration (Weeks)",original:s.reservationWeeks,modified:n.reservationWeeks}),s.nightsPerWeek!==n.nightsPerWeek&&i.push({field:"nightsPerWeek",label:"Nights per Week",original:s.nightsPerWeek,modified:n.nightsPerWeek}),JSON.stringify(s.daysSelected)!==JSON.stringify(n.daysSelected)&&i.push({field:"daysSelected",label:"Weekly Schedule",original:s.daysSelected,modified:n.daysSelected}),{originalTerms:s,counterofferTerms:n,changes:i,hasChanges:i.length>0}}function yt(e){let s=e||[];if(typeof s=="string")try{s=JSON.parse(s)}catch{return[]}return Array.isArray(s)?s.map(n=>{if(typeof n=="number")return n;if(typeof n=="string"){const i=n.trim(),a=parseInt(i,10);if(!isNaN(a)&&String(a)===i)return a;const r=Pt.indexOf(i);return r>=0?r:-1}return-1}).filter(n=>n>=0&&n<=6):[]}function Be(e){return typeof e!="number"||e<0||e>6?"N/A":Pt[e]}function Nn({proposal:e,onClose:s,onAcceptCounteroffer:n,onCancelProposal:i}){const[a,r]=d.useState(!1),[c,f]=d.useState(!1),[N,w]=d.useState(null),[g,m]=d.useState(!1),[h,p]=d.useState(!1),o=d.useMemo(()=>{if(!e)return null;try{return bn(e)}catch(x){return console.error("[useCompareTermsModalLogic] Error getting terms comparison:",x),null}},[e]),I=d.useMemo(()=>{if(!e)return null;const x=e["Move in range start"],E=e["Move in range end"],A=yt(e["Days Selected"]),b=e["check in day"],F=e["check out day"],R=e["nights per week (num)"]||A.length||0,S=e["Reservation Span (Weeks)"]||0,$=e["proposal nightly price"]||0,U=e["Total Price for Reservation (guest)"]||0,P=e["cleaning fee"]||0,C=e["damage deposit"]||0,q=e["maintenance fee"]||0,ae=R*S,l=$*R*4,v=R*4,B=q*4,te=U+P+C;return{moveInStart:x,moveInEnd:E,moveInDisplay:E&&E!==x?`${We(x)} - ${We(E)}`:We(x)||"TBD",daysSelected:A,checkInDay:typeof b=="number"?b:parseInt(b,10),checkOutDay:typeof F=="number"?F:parseInt(F,10),checkInDayName:Be(typeof b=="number"?b:parseInt(b,10)),checkOutDayName:Be(typeof F=="number"?F:parseInt(F,10)),nightsPerWeek:R,reservationWeeks:S,nightlyPrice:$,nightlyPriceFormatted:X($,!1),totalPrice:U,totalPriceFormatted:X(U,!1),cleaningFee:P,cleaningFeeFormatted:X(P,!1),damageDeposit:C,damageDepositFormatted:X(C,!1),maintenanceFee:q,maintenanceFeeFormatted:X(q,!1),nightsReserved:ae,pricePerFourWeeks:l,pricePerFourWeeksFormatted:X(l,!1),nightsPerFourWeeks:v,maintenanceFeePerFourWeeks:B,maintenanceFeePerFourWeeksFormatted:X(B,!1),initialPayment:te,initialPaymentFormatted:X(te,!1)}},[e]),k=d.useMemo(()=>{if(!e)return null;const x=e["hc move in date"],E=yt(e["hc days selected"]||e["Days Selected"]),A=e["hc check in day"]??e["check in day"],b=e["hc check out day"]??e["check out day"],F=e["hc nights per week"]??e["nights per week (num)"]??E.length??0,R=e["hc reservation span (weeks)"]??e["Reservation Span (Weeks)"]??0,S=e["hc nightly price"]??e["proposal nightly price"]??0,$=e["hc total price"]??e["Total Price for Reservation (guest)"]??0,U=e["hc cleaning fee"]??e["cleaning fee"]??0,P=e["hc damage deposit"]??e["damage deposit"]??0,C=e["hc maintenance fee"]??e["maintenance fee"]??0,q=F*R,ae=S*F*4,l=F*4,v=C*4,B=$+U+P;return{moveInDate:x,moveInDisplay:We(x)||"TBD",daysSelected:E,checkInDay:typeof A=="number"?A:parseInt(A,10),checkOutDay:typeof b=="number"?b:parseInt(b,10),checkInDayName:Be(typeof A=="number"?A:parseInt(A,10)),checkOutDayName:Be(typeof b=="number"?b:parseInt(b,10)),nightsPerWeek:F,reservationWeeks:R,nightlyPrice:S,nightlyPriceFormatted:X(S,!1),totalPrice:$,totalPriceFormatted:X($,!1),cleaningFee:U,cleaningFeeFormatted:X(U,!1),damageDeposit:P,damageDepositFormatted:X(P,!1),maintenanceFee:C,maintenanceFeeFormatted:X(C,!1),nightsReserved:q,pricePerFourWeeks:ae,pricePerFourWeeksFormatted:X(ae,!1),nightsPerFourWeeks:l,maintenanceFeePerFourWeeks:v,maintenanceFeePerFourWeeksFormatted:X(v,!1),initialPayment:B,initialPaymentFormatted:X(B,!1)}},[e]),L=d.useMemo(()=>(e==null?void 0:e.negotiationSummaries)||[],[e]),u=d.useMemo(()=>{var b;const x=e==null?void 0:e["counter offer happened"],E=(e==null?void 0:e["hc house rules"])||(e==null?void 0:e.hcHouseRules);if(x&&Array.isArray(E)&&E.length>0)return E;const A=(e==null?void 0:e.houseRules)||(e==null?void 0:e["House Rules"])||((b=e==null?void 0:e.listing)==null?void 0:b.houseRules)||[];return Array.isArray(A)?A:[]},[e]),W=d.useMemo(()=>{const x=e==null?void 0:e.listing;return{name:(x==null?void 0:x.Name)||"Property",checkInTime:(x==null?void 0:x["Check in time"])||(x==null?void 0:x["NEW Date Check-in Time"])||"2:00 PM",checkOutTime:(x==null?void 0:x["Check Out time"])||(x==null?void 0:x["NEW Date Check-out Time"])||"11:00 AM"}},[e]),H=d.useCallback(async()=>{if(!(e!=null&&e._id)){w("Proposal ID is missing");return}r(!0),w(null);try{const{count:x,error:E}=await z.from("bookings_leases").select("*",{count:"exact",head:!0});E&&console.warn("[useCompareTermsModalLogic] Could not count leases:",E);const A=(x||0)<10?4:(x||0)<100?3:2,b=e["nights per week (num)"]||0,F=e["proposal nightly price"]||0,R=b*4*F;await vn(e._id);const S=e["hc nights per week"]||b,$=e["hc nightly price"]||F,U=S*4*$;console.log("[useCompareTermsModalLogic] Creating lease with parameters:",{proposalId:e._id,numberOfZeros:A,fourWeekRent:U,isCounteroffer:"yes",fourWeekCompensation:R});const C=await(await fetch("https://qcfifybkaddcoimjroca.supabase.co/functions/v1/lease",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"create",payload:{proposalId:e._id,isCounteroffer:"yes",fourWeekRent:U,fourWeekCompensation:R,numberOfZeros:A}})})).json();if(!C.success)throw new Error(C.error||"Failed to create lease");console.log("[useCompareTermsModalLogic] Lease created:",C.data),alert("We will work on drafting a lease for you. Please give us 48 hours to finalize your lease with the terms proposed by your host."),n&&n(),s()}catch(x){console.error("[useCompareTermsModalLogic] Error accepting counteroffer:",x),w(x.message||"Failed to accept counteroffer. Please try again.")}finally{r(!1)}},[e,n,s]),J=d.useCallback(x=>{m(!0)},[i]),j=d.useCallback(async x=>{if(e!=null&&e._id){f(!0),w(null);try{await xn(e._id,x),m(!1),s(),window.location.reload()}catch(E){console.error("[useCompareTermsModalLogic] Error declining counteroffer:",E),w(E.message||"Failed to decline counteroffer. Please try again.")}finally{f(!1)}}},[e,s]),D=d.useCallback(()=>{!a&&!c&&s()},[a,c,s]),T=d.useCallback(()=>{c||m(!1)},[c]),O=d.useCallback(()=>{p(x=>!x)},[]);return{isAccepting:a,isCancelling:c,isLoading:a||c,error:N,originalTerms:I,counterofferTerms:k,termsComparison:o,negotiationSummaries:L,houseRules:u,listingInfo:W,showCancelModal:g,isExpanded:h,handleAcceptCounteroffer:H,handleCancelProposal:J,handleCancelConfirm:j,handleClose:D,handleCloseCancelModal:T,handleToggleExpanded:O}}const wn=["S","M","T","W","T","F","S"];function vt({daysSelected:e=[],isCounteroffer:s=!1}){const n=new Set(e);return t.jsx("div",{className:"compare-terms-days",role:"group","aria-label":"Selected days of the week",children:wn.map((i,a)=>{const r=n.has(a);let c="compare-terms-day-pill";return r&&(c+=s?" compare-terms-day-pill--selected-counteroffer":" compare-terms-day-pill--selected"),t.jsx("div",{className:c,"aria-label":`${["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][a]}${r?", selected":""}`,children:i},a)})})}function jn({summaries:e=[]}){if(!e||e.length===0)return null;const s=e[e.length-1],n=(s==null?void 0:s.summary)||(s==null?void 0:s.text)||s;return n?t.jsxs("div",{className:"compare-terms-negotiation",role:"status",children:[t.jsx("svg",{className:"compare-terms-negotiation-icon",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:t.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),t.jsx("span",{className:"compare-terms-negotiation-text",children:n})]}):null}function xt({rules:e=[]}){return!e||e.length===0?t.jsx("span",{className:"compare-terms-no-rules",children:"None specified"}):t.jsxs("div",{className:"compare-terms-house-rules",children:[e.slice(0,5).map((s,n)=>t.jsx("span",{className:"compare-terms-house-rule-badge",children:s},n)),e.length>5&&t.jsxs("span",{className:"compare-terms-house-rule-badge",children:["+",e.length-5," more"]})]})}function kn({original:e,counteroffer:s,isExpanded:n=!1}){if(!e||!s)return null;const i=[{label:"Check-In Day",originalVal:e.checkInDayName,counterVal:s.checkInDayName},{label:"Check-Out Day",originalVal:e.checkOutDayName,counterVal:s.checkOutDayName},{label:"Price/Night",originalVal:e.nightlyPriceFormatted,counterVal:s.nightlyPriceFormatted},{label:"Nights Reserved",originalVal:e.nightsReserved,counterVal:s.nightsReserved},{label:"Duration",originalVal:`${e.reservationWeeks} weeks`,counterVal:`${s.reservationWeeks} weeks`},{label:"Total Price",originalVal:e.totalPriceFormatted,counterVal:s.totalPriceFormatted},{label:"Price/4 Weeks",originalVal:e.pricePerFourWeeksFormatted,counterVal:s.pricePerFourWeeksFormatted},{label:"Nights/4 Weeks",originalVal:e.nightsPerFourWeeks,counterVal:s.nightsPerFourWeeks},{label:"Maintenance Fee/4wks",originalVal:e.maintenanceFeePerFourWeeksFormatted||"$0",counterVal:s.maintenanceFeePerFourWeeksFormatted||"$0"},{label:"Damage Deposit",originalVal:e.damageDepositFormatted,counterVal:s.damageDepositFormatted},{label:"Initial Payment",originalVal:e.initialPaymentFormatted,counterVal:s.initialPaymentFormatted}],a=n?i:i.filter(r=>String(r.originalVal)!==String(r.counterVal));return!n&&a.length===0?null:t.jsxs("div",{className:"compare-terms-details-section",children:[t.jsx("h4",{className:"compare-terms-details-title",children:"Reservation Details"}),t.jsxs("div",{className:"compare-terms-details-table",children:[t.jsxs("div",{className:"compare-terms-details-row compare-terms-details-row--header",children:[t.jsx("div",{className:"compare-terms-details-cell"}),t.jsx("div",{className:"compare-terms-details-cell",children:"Your Terms"}),t.jsx("div",{className:"compare-terms-details-cell",children:"Host Terms"})]}),a.map((r,c)=>{const f=String(r.originalVal)!==String(r.counterVal);return t.jsxs("div",{className:"compare-terms-details-row",children:[t.jsx("div",{className:"compare-terms-details-cell compare-terms-details-cell--label",children:r.label}),t.jsx("div",{className:"compare-terms-details-cell",children:r.originalVal}),t.jsx("div",{className:`compare-terms-details-cell ${f?"compare-terms-details-cell--changed":""}`,children:r.counterVal})]},c)})]})]})}function Sn({proposal:e,onClose:s,onAcceptCounteroffer:n}){const{isAccepting:i,isLoading:a,error:r,originalTerms:c,counterofferTerms:f,negotiationSummaries:N,houseRules:w,showCancelModal:g,isExpanded:m,handleAcceptCounteroffer:h,handleCancelProposal:p,handleCancelConfirm:o,handleClose:I,handleCloseCancelModal:k,handleToggleExpanded:L}=Nn({proposal:e,onClose:s,onAcceptCounteroffer:n,onCancelProposal:()=>{}});if(d.useEffect(()=>{function W(H){H.key==="Escape"&&(H.preventDefault(),H.stopPropagation())}return document.addEventListener("keydown",W,!0),()=>document.removeEventListener("keydown",W,!0)},[]),!e||!e["counter offer happened"]||!c||!f)return null;const u=t.jsxs("div",{className:"compare-terms-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"compare-terms-title",children:[t.jsxs("div",{className:"compare-terms-modal",children:[t.jsxs("div",{className:"compare-terms-header",children:[t.jsx("h2",{id:"compare-terms-title",className:"compare-terms-title",children:"Compare Terms"}),t.jsx("button",{className:"compare-terms-close-btn",onClick:I,disabled:a,"aria-label":"Close modal",children:"Ã—"})]}),t.jsxs("div",{className:"compare-terms-body",children:[r&&t.jsx("div",{className:"compare-terms-error",role:"alert",children:t.jsx("span",{className:"compare-terms-error-text",children:r})}),t.jsx(jn,{summaries:N}),t.jsxs("div",{className:"compare-terms-columns-header",children:[t.jsx("div",{className:"compare-terms-column-title compare-terms-column-title--original",children:"Your Terms"}),t.jsx("div",{className:"compare-terms-column-title compare-terms-column-title--counteroffer",children:"Host Terms"})]}),t.jsxs("div",{className:"compare-terms-grid",children:[t.jsxs("div",{className:"compare-terms-column",children:[t.jsxs("div",{className:"compare-terms-row",children:[t.jsx("span",{className:"compare-terms-label",children:"Move-in Date"}),t.jsx("span",{className:"compare-terms-value",children:c.moveInDisplay})]}),t.jsxs("div",{className:"compare-terms-row",children:[t.jsx("span",{className:"compare-terms-label",children:"Duration"}),t.jsxs("span",{className:"compare-terms-value",children:[c.reservationWeeks," weeks"]})]}),t.jsxs("div",{className:"compare-terms-row",children:[t.jsx("span",{className:"compare-terms-label",children:"Schedule"}),t.jsx(vt,{daysSelected:c.daysSelected,isCounteroffer:!1})]}),t.jsxs("div",{className:"compare-terms-row",children:[t.jsx("span",{className:"compare-terms-label",children:"Days/Nights"}),t.jsxs("span",{className:"compare-terms-value",children:[c.daysSelected.length," days, ",Math.max(0,c.daysSelected.length-1)," nights"]})]}),t.jsxs("div",{className:"compare-terms-row",children:[t.jsx("span",{className:"compare-terms-label",children:"House Rules"}),t.jsx(xt,{rules:w})]})]}),t.jsxs("div",{className:"compare-terms-column",children:[t.jsxs("div",{className:"compare-terms-row",children:[t.jsx("span",{className:"compare-terms-label",children:"Move-in Date"}),t.jsx("span",{className:"compare-terms-value compare-terms-value--highlight",children:f.moveInDisplay})]}),t.jsxs("div",{className:"compare-terms-row",children:[t.jsx("span",{className:"compare-terms-label",children:"Duration"}),t.jsxs("span",{className:`compare-terms-value ${f.reservationWeeks!==c.reservationWeeks?"compare-terms-value--highlight":""}`,children:[f.reservationWeeks," weeks"]})]}),t.jsxs("div",{className:"compare-terms-row",children:[t.jsx("span",{className:"compare-terms-label",children:"Schedule"}),t.jsx(vt,{daysSelected:f.daysSelected,isCounteroffer:!0})]}),t.jsxs("div",{className:"compare-terms-row",children:[t.jsx("span",{className:"compare-terms-label",children:"Days/Nights"}),t.jsxs("span",{className:`compare-terms-value ${f.daysSelected.length!==c.daysSelected.length?"compare-terms-value--highlight":""}`,children:[f.daysSelected.length," days, ",Math.max(0,f.daysSelected.length-1)," nights"]})]}),t.jsxs("div",{className:"compare-terms-row",children:[t.jsx("span",{className:"compare-terms-label",children:"House Rules"}),t.jsx(xt,{rules:w})]})]})]}),t.jsx(kn,{original:c,counteroffer:f,isExpanded:m})]}),t.jsxs("div",{className:"compare-terms-footer",children:[t.jsxs("div",{className:"compare-terms-actions",children:[t.jsx("button",{className:"compare-terms-btn compare-terms-btn--cancel",onClick:p,disabled:a,children:"Cancel Proposal"}),t.jsx("button",{className:"compare-terms-btn compare-terms-btn--close",onClick:I,disabled:a,children:"Close"}),t.jsx("button",{className:"compare-terms-btn compare-terms-btn--accept",onClick:h,disabled:a,children:i?"Processing...":"Accept Host Terms"})]}),t.jsx("div",{className:"compare-terms-document-link",children:t.jsx("button",{type:"button",onClick:L,className:"compare-terms-expand-btn",disabled:a,children:m?"Collapse to changes only":"Check the full document"})})]})]}),g&&t.jsx(Ye,{isOpen:g,proposal:e,userType:"guest",buttonText:"Decline Counteroffer",onClose:k,onConfirm:o})]});return Gt.createPortal(u,document.body)}function Dn(e){if(!e)return!1;const{lat:s,lng:n}=e;return typeof s=="number"&&typeof n=="number"&&!isNaN(s)&&!isNaN(n)&&s>=-90&&s<=90&&n>=-180&&n<=180}function Pn(e){const s=e==null?void 0:e.listing;if(!s)return null;let n=s["Location - slightly different address"];if(n||(n=s["Location - Address"]),!n)return null;if(typeof n=="string")try{n=JSON.parse(n)}catch(i){return console.warn("FullscreenProposalMapModal: Failed to parse location data:",i),null}return!(n!=null&&n.lat)||!(n!=null&&n.lng)?null:{lat:n.lat,lng:n.lng}}function In(e){return e["counter offer happened"]?e["hc nightly price"]:e["proposal nightly price"]||0}function Cn(e){return e.filter(s=>{const n=s.Status;return!ss(n)})}function _n(e,s){return e.map(n=>{var a;const i=Pn(n);return!i||!Dn(i)?null:{id:n._id,coordinates:i,price:In(n),listingName:((a=n.listing)==null?void 0:a.Name)||"Listing",isHighlighted:n._id===s}}).filter(Boolean)}function Mn({isOpen:e,onClose:s,proposals:n=[],currentProposalId:i,onProposalSelect:a}){const r=d.useRef(null),c=d.useRef(null),f=d.useRef([]),[N,w]=d.useState(!1),[g,m]=d.useState(!0),[h,p]=d.useState(i),o=Cn(n),I=_n(o,h);d.useEffect(()=>{p(i)},[i]);const k=d.useCallback(j=>{const D=j.target.value;p(D),c.current&&f.current.length>0&&u(D)},[]),L=d.useCallback(j=>{var x;const D=o.find(E=>E._id===j),T=((x=D==null?void 0:D.listing)==null?void 0:x.Name)||"Proposal";a&&a(j),s();const O=document.createElement("div");O.className="proposal-selected-toast",O.innerHTML=`<span>âœ“</span> Viewing: ${T}`,O.style.cssText=`
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #31135d;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      font-family: 'Lato', 'Inter', sans-serif;
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      z-index: 9999;
      animation: slideUp 0.3s ease-out;
    `,document.body.appendChild(O),setTimeout(()=>{O.style.animation="fadeOut 0.3s ease-out forwards",setTimeout(()=>O.remove(),300)},2e3)},[a,s,o]),u=d.useCallback(j=>{f.current.forEach(D=>{if(D.div){const T=D.proposalId===j;D.div.className=`proposal-price-marker ${T?"highlighted":"normal"}`,D.div.style.zIndex=T?"1002":"1001"}})},[]),W=d.useCallback((j,D,T)=>{const O=new window.google.maps.OverlayView;return O.onAdd=function(){const x=document.createElement("div");x.innerHTML=`$${Math.round(D.price)}`,x.className=`proposal-price-marker ${D.isHighlighted?"highlighted":"normal"}`,x.dataset.proposalId=D.id,x.addEventListener("click",A=>{A.stopPropagation(),T(D.id)}),this.div=x,this.getPanes().overlayMouseTarget.appendChild(x)},O.draw=function(){if(!this.div)return;const x=this.getProjection();if(!x)return;const E=x.fromLatLngToDivPixel(new window.google.maps.LatLng(D.coordinates.lat,D.coordinates.lng));this.div&&E&&(this.div.style.transform=`translate3d(${E.x}px, ${E.y}px, 0) translate(-50%, -50%)`,this.div.style.left="0px",this.div.style.top="0px")},O.onRemove=function(){this.div&&(this.div.parentNode.removeChild(this.div),this.div=null)},O.setMap(j),O.proposalId=D.id,O},[]);if(d.useEffect(()=>{if(!e)return;const j=()=>{if(console.log("ðŸ—ºï¸ FullscreenProposalMapModal: Initializing map..."),!r.current){console.warn("âš ï¸ FullscreenProposalMapModal: mapRef not available"),m(!1);return}if(c.current){console.log("âœ… FullscreenProposalMapModal: Map already exists, skipping init"),m(!1);return}const D=ms("default"),T=new window.google.maps.Map(r.current,{center:D.center,zoom:D.zoom,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,zoomControl:!0,zoomControlOptions:{position:window.google.maps.ControlPosition.RIGHT_CENTER},styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]});c.current=T,w(!0),m(!1),console.log("âœ… FullscreenProposalMapModal: Map initialized successfully")};if(window.google&&window.google.maps&&window.google.maps.ControlPosition)console.log("âœ… FullscreenProposalMapModal: Google Maps API already loaded"),j();else return console.log("â³ FullscreenProposalMapModal: Waiting for Google Maps API to load..."),m(!0),window.addEventListener("google-maps-loaded",j),()=>window.removeEventListener("google-maps-loaded",j)},[e]),d.useEffect(()=>{e||(f.current.forEach(j=>j.setMap(null)),f.current=[],c.current=null,w(!1),m(!0))},[e]),d.useEffect(()=>{if(!N||!c.current||I.length===0)return;const j=c.current;f.current.forEach(T=>T.setMap(null)),f.current=[];const D=new window.google.maps.LatLngBounds;if(I.forEach(T=>{const O=W(j,T,L);f.current.push(O),D.extend({lat:T.coordinates.lat,lng:T.coordinates.lng})}),I.length>0){j.fitBounds(D,{top:80,bottom:40,left:40,right:40});const T=window.google.maps.event.addListener(j,"idle",()=>{j.getZoom()>16&&j.setZoom(16),window.google.maps.event.removeListener(T)})}},[N,I,W,L]),d.useEffect(()=>{f.current.length>0&&u(h)},[h,u]),d.useEffect(()=>{if(!e)return;const j=D=>{D.key==="Escape"&&s()};return document.addEventListener("keydown",j),()=>document.removeEventListener("keydown",j)},[e,s]),d.useEffect(()=>(e?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[e]),!e)return null;const H=o.map(j=>{var D;return{id:j._id,label:((D=j.listing)==null?void 0:D.Name)||"Listing"}}),J=I.length>0;return t.jsx("div",{className:"fullscreen-proposal-map-modal-backdrop",onClick:s,children:t.jsxs("div",{className:"fullscreen-proposal-map-modal",onClick:j=>j.stopPropagation(),children:[t.jsxs("div",{className:"fullscreen-proposal-map-header",children:[t.jsxs("div",{className:"fullscreen-proposal-map-header-left",children:[t.jsx("h2",{className:"fullscreen-proposal-map-title",children:"Your Proposals"}),t.jsxs("span",{className:"fullscreen-proposal-map-subtitle",children:[o.length," ",o.length===1?"proposal":"proposals"]})]}),H.length>1&&t.jsxs("div",{className:"fullscreen-proposal-map-selector",children:[t.jsx("label",{htmlFor:"proposal-selector",className:"sr-only",children:"Select Proposal"}),t.jsx("select",{id:"proposal-selector",value:h||"",onChange:k,className:"fullscreen-proposal-map-dropdown",children:H.map(j=>t.jsx("option",{value:j.id,children:j.label},j.id))})]}),t.jsx("button",{className:"fullscreen-proposal-map-close-btn",onClick:s,"aria-label":"Close map",children:t.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:t.jsx("path",{d:"M18 6L6 18M6 6l12 12",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),t.jsxs("div",{className:"fullscreen-proposal-map-container",children:[g&&t.jsxs("div",{className:"fullscreen-proposal-map-loading",children:[t.jsx("div",{className:"spinner"}),t.jsx("p",{children:"Loading map..."})]}),!g&&!J&&t.jsxs("div",{className:"fullscreen-proposal-map-empty",children:[t.jsx("div",{className:"fullscreen-proposal-map-empty-icon",children:t.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[t.jsx("path",{d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z",strokeLinecap:"round",strokeLinejoin:"round"}),t.jsx("path",{d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z",strokeLinecap:"round",strokeLinejoin:"round"})]})}),t.jsx("p",{children:"No proposal locations available"})]}),t.jsx("div",{ref:r,className:"fullscreen-proposal-map",style:{display:g||!J?"none":"block"}})]})]})})}const En=({isExpanded:e})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:`expand-chevron ${e?"expanded":""}`,children:t.jsx("polyline",{points:"6 9 12 15 18 9"})});function Fn(e){const s=e||[];if(s.length>0&&typeof s[0]=="string"&&isNaN(parseInt(s[0],10))){const i=new Set(s);return ut.map((a,r)=>({index:r,letter:a,selected:i.has(Z[r])}))}else{const i=new Set(s.map(a=>typeof a=="number"?a:parseInt(a,10)));return ut.map((a,r)=>({index:r,letter:a,selected:i.has(r)}))}}function Rn(e){const s=e["counter offer happened"],n=s?e["hc check in day"]??e["check in day"]:e["check in day"]??e["hc check in day"],i=s?e["hc check out day"]??e["check out day"]:e["check out day"]??e["hc check out day"];if(n!=null&&i!=null){const m=typeof n=="number"?n:parseInt(n,10),h=typeof i=="number"?i:parseInt(i,10);if(!isNaN(m)&&!isNaN(h)&&m>=0&&m<=6&&h>=0&&h<=6)return`${Z[m]} to ${Z[h]}`}let a=e["Days Selected"]||e.hcDaysSelected||[];if(typeof a=="string")try{a=JSON.parse(a)}catch{a=[]}if(!Array.isArray(a)||a.length===0)return null;const r=a.map(m=>{if(typeof m=="number")return m;if(typeof m=="string"){const h=m.trim(),p=parseInt(h,10);if(!isNaN(p)&&String(p)===h)return p;const o=Z.indexOf(h);return o>=0?o:-1}return-1}).filter(m=>m>=0&&m<=6);if(r.length===0)return null;const c=[...r].sort((m,h)=>m-h),f=c.some(m=>m<=2),N=c.some(m=>m>=4);if(f&&N&&c.length<7){let m=-1;for(let h=1;h<c.length;h++)if(c[h]-c[h-1]>1){m=h;break}if(m!==-1){const h=c[m],p=c[m-1];return`${Z[h]} to ${Z[p]}`}}const w=c[0],g=c[c.length-1];return`${Z[w]} to ${Z[g]}`}function Ln(e){const s=e["check in day"],n=e["check out day"];if(s!=null&&n!=null){const g=typeof s=="number"?s:parseInt(s,10),m=typeof n=="number"?n:parseInt(n,10);if(!isNaN(g)&&!isNaN(m)&&g>=0&&g<=6&&m>=0&&m<=6)return`${Z[g]} to ${Z[m]}`}let i=e["Days Selected"]||[];if(typeof i=="string")try{i=JSON.parse(i)}catch{i=[]}if(!Array.isArray(i)||i.length===0)return null;const a=i.map(g=>{if(typeof g=="number")return g;if(typeof g=="string"){const m=g.trim(),h=parseInt(m,10);if(!isNaN(h)&&String(h)===m)return h;const p=Z.indexOf(m);return p>=0?p:-1}return-1}).filter(g=>g>=0&&g<=6);if(a.length===0)return null;const r=[...a].sort((g,m)=>g-m),c=r.some(g=>g<=2),f=r.some(g=>g>=4);if(c&&f&&r.length<7){let g=-1;for(let m=1;m<r.length;m++)if(r[m]-r[m-1]>1){g=m;break}if(g!==-1){const m=r[g],h=r[g-1];return`${Z[m]} to ${Z[h]}`}}const N=r[0],w=r[r.length-1];return`${Z[N]} to ${Z[w]}`}function Tn(e){let s=e["Days Selected"]||e.hcDaysSelected||[];if(typeof s=="string")try{s=JSON.parse(s)}catch{return[]}return!Array.isArray(s)||s.length===0?[]:s.map(n=>{if(typeof n=="number")return n;if(typeof n=="string"){const i=n.trim(),a=parseInt(i,10);if(!isNaN(a)&&String(a)===i)return a;const r=Z.indexOf(i);return r>=0?r:-1}return-1}).filter(n=>n>=0&&n<=6)}function An(e){return e["counter offer happened"]?e["hc reservation span (weeks)"]:e["Reservation Span (Weeks)"]}const Y={purple:"#6D31C2",green:"#1F8E16",red:"#DB2E2E",gray:"#DEDEDE",labelGray:"#9CA3AF"};function Wn(e,s,n,i,a={}){if(i)return Y.red;const r=typeof s=="string"?s.trim():s,c=a["rental application"];return e===0?Y.purple:e===1?r!=null&&r.includes("Awaiting Rental Application")||r!=null&&r.includes("Pending")?Y.green:c||n>=1?Y.purple:Y.gray:e===2?r==="Host Review"||r!=null&&r.includes("Counteroffer")?Y.green:n>=3?Y.purple:Y.gray:e===3?r!=null&&r.includes("Documents Sent for Review")?Y.green:n>=4?Y.purple:Y.gray:e===4?r!=null&&r.includes("Signatures")?Y.green:n>=5?Y.purple:Y.gray:e===5?r!=null&&r.includes("Awaiting Initial payment")||r!=null&&r.includes("Awaiting Initial Payment")?Y.green:jt(r)?Y.purple:Y.gray:Y.gray}function Bn({status:e,usualOrder:s=0,isTerminal:n=!1,proposal:i={}}){const a=ds(),r=Math.min(s+1,a.length);return t.jsx("div",{className:"epc-progress-row",role:"progressbar","aria-label":"Proposal progress","aria-valuenow":r,"aria-valuemin":1,"aria-valuemax":a.length,"aria-valuetext":`Step ${r} of ${a.length}: ${a[r-1]||a[0]}`,children:a.map((c,f)=>{const N=Wn(f,e,s,n,i),w=f===a.length-1,g=f<s,m=f===s;return t.jsxs("div",{className:"epc-progress-step",children:[t.jsx("div",{className:"epc-progress-dot",style:{backgroundColor:N},"aria-hidden":"true"}),t.jsx("span",{className:"epc-progress-label",style:{color:N!==Y.gray?N:Y.labelGray},"aria-label":`${c}${g?", completed":m?", current step":""}`,children:c}),!w&&t.jsx("div",{className:"epc-progress-line",style:{backgroundColor:N===Y.purple?Y.purple:Y.gray},"aria-hidden":"true"})]},f)})})}function On({status:e,cancelReason:s,isCounteroffer:n}){var w;const i=typeof e=="string"?e.trim():e;if(!ns(i))return null;let a="",r="i",c="",f="";i!=null&&i.includes("Cancelled")?(a="cancelled",r="âœ•",c="Proposal Cancelled",f=s?`Reason: ${s}`:"This proposal has been cancelled."):i!=null&&i.includes("Rejected")?(a="cancelled",r="âœ•",c="Proposal Declined",f=s?`Reason: ${s}`:"This proposal was declined by the host."):i!=null&&i.includes("Accepted")||i!=null&&i.includes("Drafting")?(a="success",r="âœ“",c=n?"Host Terms Accepted":"Proposal Accepted",f="Lease Documents being prepared."):i!=null&&i.includes("Counteroffer")?(a="attention",r="!",c="Host Counteroffer",f="Review the new terms below."):i!=null&&i.includes("activated")?(a="success",r="âœ“",c="Lease Activated",f="Visit My Leases for details."):i!=null&&i.includes("Awaiting Rental Application")?(a="attention",r="!",c="Action Required",f="Please complete your rental application."):c=((w=$e(i))==null?void 0:w.label)||i;const N=a==="attention"||a==="cancelled";return t.jsxs("div",{className:`epc-status-banner ${a}`,role:N?"alert":"status","aria-live":N?"assertive":"polite",children:[t.jsx("span",{className:"epc-status-icon","aria-hidden":"true",children:r}),t.jsxs("div",{className:"epc-status-text",children:[t.jsx("strong",{children:c}),f&&` â€” ${f}`]})]})}function bt({proposal:e,isExpanded:s,onToggle:n,allProposals:i=[],onProposalSelect:a,onProposalDeleted:r}){var it,rt,lt;const c=d.useRef(null),[f,N]=d.useState(0),[w,g]=d.useState(!1),[m,h]=d.useState(!1),[p,o]=d.useState(!1),[I,k]=d.useState("pristine"),[L,u]=d.useState(!1),[W,H]=d.useState(""),[J,j]=d.useState(!1),[D,T]=d.useState(!1),[O,x]=d.useState(!1),[E,A]=d.useState(!1),[b,F]=d.useState(!1),[R,S]=d.useState(!1),[$,U]=d.useState(!1);d.useEffect(()=>{if(!c.current)return;if(!s){N(0);return}N(c.current.scrollHeight);const G=new ResizeObserver(ge=>{for(const qt of ge)N(qt.target.scrollHeight)});return G.observe(c.current),()=>{G.disconnect()}},[s,e]);const P=e==null?void 0:e.listing,C=P==null?void 0:P.host,q=e==null?void 0:e.Status,ae=$e(q),l=Mt(e),v=as(P),B=(P==null?void 0:P.Name)||"Listing",te=[P==null?void 0:P.hoodName,P==null?void 0:P.boroughName].filter(Boolean).join(", ")||"New York",Q=is(C),ie=rs(C),V=e==null?void 0:e["counter offer happened"];let se=(e==null?void 0:e["Days Selected"])||[];if(typeof se=="string")try{se=JSON.parse(se)}catch{se=[]}const ue=(e==null?void 0:e["nights per week (num)"])||se.length,pe=(e==null?void 0:e["Reservation Span (Weeks)"])||4,ye=(e==null?void 0:e["proposal nightly price"])||0,he=(e==null?void 0:e["Total Price for Reservation (guest)"])||0,oe=e==null?void 0:e["Move in range start"];let ce=(e==null?void 0:e["hc days selected"])||[];if(typeof ce=="string")try{ce=JSON.parse(ce)}catch{ce=[]}const ve=(e==null?void 0:e["hc nights per week"])||ce.length,Se=e==null?void 0:e["hc reservation span (weeks)"],xe=e==null?void 0:e["hc nightly price"],be=e==null?void 0:e["hc total price"],Ne=e==null?void 0:e["hc move in date"],Me=V&&ce.length>0?ce:se,Te=Fn(Me),fe=V&&ve?ve:ue,De=V&&Se?Se:pe,Pe=V&&xe!=null?xe:ye,Ee=V&&be!=null?be:he,Fe=Rn(e),Ie=Ln(e),Re=(e==null?void 0:e["cleaning fee"])||0,y=V&&Se!=null&&Se!==pe,_=V&&xe!=null&&xe!==ye,M=V&&be!=null&&be!==he,K=V&&Ne&&Ne!==oe,re=V&&ce.length>0&&JSON.stringify([...ce].sort())!==JSON.stringify([...se].sort()),ne=re&&Ie&&Fe!==Ie,Ve=dt(V&&Ne?Ne:oe),Qe=K?dt(oe):null,Rt=(P==null?void 0:P["Check in time"])||"2:00 pm",Lt=(P==null?void 0:P["Check Out time"])||"11:00 am",Ue=(e==null?void 0:e.houseRules)||[],Xe=Array.isArray(Ue)&&Ue.length>0,Ze=(e==null?void 0:e.negotiationSummaries)||[],et=(e==null?void 0:e.counterofferSummary)||null,tt=kt(q);St(q);const st=qe(q),Tt=jt(q),At=(e==null?void 0:e["Cancelled Reason"])||(e==null?void 0:e["reason for cancellation"]),Wt=e==null?void 0:e["some nights unavailable"],me=e==null?void 0:e.virtualMeeting,Ae=e==null?void 0:e.Guest,de=d.useMemo(()=>!q||_t(q)?{visible:!1}:me?me["meeting declined"]===!0?{visible:!0,view:"request",disabled:!1,label:"VM Declined",className:"btn-vm-declined"}:me["booked date"]&&me.confirmedBySplitLease===!0?{visible:!0,view:"details",disabled:!1,label:"Meeting Confirmed",className:"btn-vm-confirmed"}:me["booked date"]&&!me.confirmedBySplitLease?{visible:!0,view:"details",disabled:!0,label:"VM Accepted",className:"btn-vm-accepted"}:me["requested by"]===Ae?{visible:!0,view:null,disabled:!0,label:"VM Requested",className:"btn-vm-requested"}:me["requested by"]&&me["requested by"]!==Ae?{visible:!0,view:"respond",disabled:!1,label:"Respond to VM",className:"btn-vm-respond"}:{visible:!0,view:"request",disabled:!1,label:"Request VM",className:"btn-vm-request"}:{visible:!0,view:"request",disabled:!1,label:"Request Virtual Meeting",className:"btn-vm-request"},[me,Ae,q]),Bt=()=>{de.view&&!de.disabled&&(H(de.view),u(!0))},Ot=async()=>{if(!(!(e!=null&&e._id)||$)){if(!Ks(e)){we({title:"Cannot confirm this proposal",type:"error"});return}U(!0);try{const G=Qs(e),{error:ge}=await z.from("proposal").update({Status:G,"Modified Date":new Date().toISOString()}).eq("_id",e._id);if(ge)throw new Error(ge.message);we({title:"Proposal confirmed!",type:"success"}),window.location.reload()}catch(G){we({title:"Failed to confirm proposal",content:G.message,type:"error"}),U(!1)}}},nt=async()=>{if(!(!(e!=null&&e._id)||R)){S(!0);try{await Zs(e._id),we({title:"Proposal deleted",type:"info"}),r&&r(e._id)}catch(G){we({title:"Failed to delete proposal",content:G.message,type:"error"}),S(!1)}}},$t=async G=>{if(!(!(e!=null&&e._id)||b)){F(!0);try{await Kt(e._id,G),we({title:"Proposal dismissed",type:"info"}),x(!1),r&&r(e._id)}catch(ge){we({title:"Failed to dismiss proposal",content:ge.message,type:"error"})}finally{F(!1)}}};if(!e)return null;const He=ls(q),Vt=cs(q),Ut=os(Me,De),Ht={_id:Ae,typeUserSignup:"guest"},at=`proposal-content-${e._id}`;return t.jsxs("div",{className:`epc-card ${s?"expanded":""} ${tt?"suggested":""}`,role:"listitem",children:[t.jsxs("div",{className:"epc-header",onClick:n,role:"button",tabIndex:0,"aria-expanded":s,"aria-controls":at,"aria-label":`${B}, ${He}. ${s?"Collapse":"Expand"} to ${s?"hide":"view"} details`,onKeyDown:G=>{(G.key==="Enter"||G.key===" ")&&(G.preventDefault(),n())},children:[v?t.jsx("img",{src:v,alt:"",className:"epc-thumb","aria-hidden":"true"}):t.jsx("div",{className:"epc-thumb epc-thumb--placeholder","aria-hidden":"true"}),t.jsxs("div",{className:"epc-info",children:[t.jsx("div",{className:"epc-name",children:B}),t.jsx("div",{className:"epc-meta",children:Ut})]}),t.jsx("div",{className:`epc-status ${Vt}`,"aria-label":`Status: ${He}`,children:He}),t.jsx(En,{isExpanded:s})]}),t.jsx("div",{id:at,className:"epc-content-wrapper",style:{height:f},role:"region","aria-labelledby":`proposal-header-${e._id}`,hidden:!s&&f===0,children:t.jsxs("div",{ref:c,className:"epc-content",children:[tt&&t.jsx(Us,{proposal:e}),Ze.length>0&&t.jsx(qs,{summaries:Ze}),V&&et&&t.jsx(zs,{summary:et}),t.jsx(On,{status:q,cancelReason:At,isCounteroffer:V}),t.jsxs("div",{className:"epc-detail-header",children:[t.jsxs("div",{className:"epc-detail-title-area",children:[t.jsx("div",{className:"epc-detail-title",children:B}),t.jsx("div",{className:"epc-detail-location",children:te})]}),t.jsxs("div",{className:"epc-detail-host",children:[ie?t.jsx("img",{src:ie,alt:Q,className:"epc-host-photo"}):t.jsx("div",{className:"epc-host-photo-placeholder",children:Q.charAt(0).toUpperCase()}),t.jsx("div",{className:"epc-host-name",children:Q}),t.jsx("div",{className:"epc-host-label",children:"Host"})]})]}),t.jsxs("div",{className:"epc-links-row",children:[t.jsx("a",{href:tn(P==null?void 0:P._id,{daysSelected:Tn(e),reservationSpan:An(e),moveInDate:e["Move in range start"]}),className:"epc-link-item",target:"_blank",rel:"noopener noreferrer",children:"View Listing"}),t.jsx("button",{className:"epc-link-item",onClick:()=>j(!0),children:"Map"}),t.jsx("button",{className:"epc-link-item",onClick:()=>Ys(C==null?void 0:C._id,e._id),children:"Message Host"}),t.jsx("button",{className:"epc-link-item",onClick:()=>h(!0),children:"Host Profile"}),Xe&&t.jsx("button",{className:"epc-link-item",onClick:()=>g(!w),children:w?"Hide Rules":"House Rules"})]}),w&&Xe&&t.jsx("div",{className:"epc-house-rules-grid",children:Ue.map((G,ge)=>t.jsx("div",{className:"epc-house-rule-badge",children:G},ge))}),t.jsxs("div",{className:"epc-info-grid",children:[t.jsxs("div",{className:"epc-info-item",children:[t.jsx("div",{className:"epc-info-label",children:"Ideal Move-in"}),t.jsxs("div",{className:"epc-info-value",children:[K&&Qe&&t.jsx("span",{className:"epc-strikethrough",children:Qe}),t.jsx("span",{className:K?"epc-changed-value":"",children:Ve||"TBD"})]})]}),t.jsxs("div",{className:"epc-info-item",children:[t.jsx("div",{className:"epc-info-label",children:"Duration"}),t.jsxs("div",{className:"epc-info-value",children:[y&&t.jsxs("span",{className:"epc-strikethrough",children:[pe," weeks"]}),t.jsxs("span",{className:y?"epc-changed-value":"",children:[De," weeks"]})]})]}),t.jsxs("div",{className:"epc-info-item",children:[t.jsx("div",{className:"epc-info-label",children:"Schedule"}),t.jsxs("div",{className:"epc-info-value",children:[ne&&t.jsx("span",{className:"epc-strikethrough",children:Ie}),t.jsx("span",{className:ne?"epc-changed-value":"",children:Fe||"Flexible"})]})]}),t.jsxs("div",{className:"epc-info-item",children:[t.jsx("div",{className:"epc-info-label",children:"Nights/week"}),t.jsxs("div",{className:"epc-info-value",children:[re&&t.jsxs("span",{className:"epc-strikethrough",children:[ue," nights"]}),t.jsxs("span",{className:re?"epc-changed-value":"",children:[fe," nights"]})]})]})]}),t.jsxs("div",{className:"epc-days-row",children:[t.jsx("span",{className:"epc-days-label",id:`days-label-${e._id}`,children:"Schedule"}),t.jsx("div",{className:"epc-days-pills",role:"group","aria-labelledby":`days-label-${e._id}`,"aria-label":"Selected days of the week",children:Te.map(G=>t.jsx("div",{className:`epc-day-pill ${G.selected?"selected":""}`,"aria-label":`${Z[G.index]}${G.selected?", selected":""}`,"aria-pressed":G.selected,children:G.letter},G.index))}),t.jsxs("div",{className:"epc-days-info",children:[t.jsxs("div",{className:"epc-days-count",children:[fe+1," days, ",fe," nights",Wt&&t.jsx("span",{className:"epc-nights-warning",title:"Some nights unavailable",children:"âš "})]}),t.jsxs("div",{className:"epc-days-range",children:["Check-in ",Rt,", Check-out ",Lt]})]})]}),t.jsxs("div",{className:"epc-pricing-row",children:[t.jsxs("div",{className:"epc-pricing-breakdown",children:[t.jsxs("span",{children:[_&&t.jsx("span",{className:"epc-strikethrough",children:X(ye)}),t.jsx("span",{className:_?"epc-changed-value":"",children:X(Pe)}),"/night"]}),t.jsx("span",{children:"Ã—"}),t.jsxs("span",{children:[fe," nights"]}),t.jsx("span",{children:"Ã—"}),t.jsxs("span",{children:[De," weeks"]}),Re>0&&t.jsxs(t.Fragment,{children:[t.jsx("span",{children:"+"}),t.jsxs("span",{children:[X(Re)," fee"]})]})]}),t.jsxs("div",{className:"epc-pricing-total-area",children:[t.jsxs("div",{className:"epc-pricing-total-label",children:["Estimated Total",M&&t.jsx("span",{className:"epc-pricing-original",children:X(he)})]}),t.jsx("div",{className:`epc-pricing-total ${M?"epc-changed-value":""}`,children:X(Ee)})]})]}),t.jsx(Bn,{status:q,usualOrder:(ae==null?void 0:ae.usualOrder)||0,isTerminal:st,proposal:e}),t.jsxs("div",{className:"epc-actions-row",children:[de.visible&&de.disabled&&t.jsx("span",{className:`epc-vm-text ${de.className==="btn-vm-requested"?"waiting":""}`,children:de.label}),((it=l==null?void 0:l.guestAction1)==null?void 0:it.visible)&&(l.guestAction1.action==="go_to_leases"?t.jsx("a",{href:"/my-leases",className:"epc-btn epc-btn--primary",children:l.guestAction1.label}):t.jsx("button",{className:`epc-btn ${l.guestAction1.action==="delete_proposal"?"epc-btn--danger":"epc-btn--primary"}`,disabled:l.guestAction1.action==="confirm_proposal"&&$,onClick:()=>{l.guestAction1.action==="modify_proposal"?(k("pristine"),o(!0)):l.guestAction1.action==="submit_rental_app"?gt(e._id):l.guestAction1.action==="delete_proposal"?nt():l.guestAction1.action==="confirm_proposal"&&Ot()},children:l.guestAction1.label})),de.visible&&!de.disabled&&t.jsx("button",{className:"epc-btn epc-btn--outline",onClick:Bt,children:de.view==="request"?"Schedule Meeting":de.label}),((rt=l==null?void 0:l.guestAction2)==null?void 0:rt.visible)&&t.jsx("button",{className:`epc-btn ${l.guestAction2.action==="reject_suggestion"?"epc-btn--not-interested":l.guestAction2.action==="review_counteroffer"?"epc-btn--attention":"epc-btn--outline"}`,onClick:()=>{l.guestAction2.action==="see_details"?(k("pristine"),o(!0)):l.guestAction2.action==="submit_rental_app"?gt(e._id):l.guestAction2.action==="reject_suggestion"?x(!0):l.guestAction2.action==="review_counteroffer"&&A(!0)},children:l.guestAction2.label}),!st&&!Tt&&t.jsx("button",{className:"epc-btn epc-btn--ghost",onClick:()=>{k("pristine"),o(!0)},children:"Edit"}),((lt=l==null?void 0:l.cancelButton)==null?void 0:lt.visible)&&t.jsx("button",{className:`epc-btn ${l.cancelButton.action==="delete_proposal"?"epc-btn--danger":l.cancelButton.action==="see_house_manual"?"epc-btn--ghost":"epc-btn--danger"}`,disabled:l.cancelButton.disabled,onClick:()=>{l.cancelButton.action==="delete_proposal"?nt():["cancel_proposal","reject_counteroffer","reject_proposal"].includes(l.cancelButton.action)&&T(!0)},children:l.cancelButton.label})]})]})}),m&&t.jsx(on,{host:C,listing:P,onClose:()=>h(!1)}),p&&t.jsx(yn,{proposal:e,listing:P,user:{type:"guest"},initialView:I,isVisible:p,onClose:()=>{o(!1),k("pristine")},onProposalCancel:()=>{o(!1),window.location.reload()},pricePerNight:Pe,totalPriceForReservation:Ee,priceRentPer4Weeks:e["Price Rent per 4 weeks"]||Pe*fe*4}),t.jsx(Ye,{isOpen:D,proposal:e,buttonText:"Cancel Proposal",onClose:()=>T(!1),onConfirm:()=>T(!1)}),t.jsx(Jt,{isOpen:O,proposal:e,onClose:()=>!b&&x(!1),onConfirm:$t,isProcessing:b}),L&&t.jsx(Dt,{proposal:e,initialView:W,currentUser:Ht,onClose:()=>{u(!1),H("")},onSuccess:()=>window.location.reload()}),t.jsx(Mn,{isOpen:J,onClose:()=>j(!1),proposals:i,currentProposalId:e._id,onProposalSelect:a}),E&&V&&t.jsx(Sn,{proposal:e,onClose:()=>A(!1),onAcceptCounteroffer:()=>{A(!1),window.location.reload()}})]})}const $n=()=>t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",stroke:"#6B4EFF",strokeWidth:"2"}),t.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10",stroke:"#6B4EFF",strokeWidth:"2"}),t.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6",stroke:"#6B4EFF",strokeWidth:"2",strokeLinecap:"round"}),t.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6",stroke:"#6B4EFF",strokeWidth:"2",strokeLinecap:"round"})]}),Vn=()=>t.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("circle",{cx:"24",cy:"24",r:"24",fill:"#E8E8E8"}),t.jsx("circle",{cx:"24",cy:"18",r:"8",fill:"#6B4EFF"}),t.jsx("path",{d:"M8 42c0-8.837 7.163-16 16-16s16 7.163 16 16",fill:"#6B4EFF"})]});function Un(e){if(!e)return"";try{const s=new Date(e);return isNaN(s.getTime())?"":s.toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return""}}function Nt(e){if(!e)return"";try{const s=new Date(e);if(isNaN(s.getTime()))return e;const n={month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0};return s.toLocaleString("en-US",n).replace(",","")}catch{return e}}function Hn(e){if(!e)return!1;try{return new Date(e).getTime()>Date.now()}catch{return!1}}function qn(e){if(!e)return[];if(Array.isArray(e))return e;if(typeof e=="string")try{const s=JSON.parse(e);return Array.isArray(s)?s:[]}catch{return[]}return[]}function Gn(e){return e?{...e,meetingDeclined:e["meeting declined"]??e.meetingDeclined??!1,bookedDate:e["booked date"]??e.bookedDate??null,confirmedBySplitlease:e.confirmedBySplitLease??e.confirmedBySplitlease??!1,requestedBy:e["requested by"]??e.requestedBy??null,meetingLink:e["meeting link"]??e.meetingLink??null,suggestedDates:e["suggested dates and times"]??e.suggestedDates??[]}:null}function zn(e,s){switch(e){case ee.REQUESTED_BY_OTHER:return`${s} has suggested times for a virtual meeting:`;case ee.REQUESTED_BY_ME:return`You've requested a virtual meeting. Waiting for ${s}'s response.`;case ee.BOOKED_AWAITING_CONFIRMATION:return"Your meeting is scheduled. Waiting for Split Lease confirmation.";case ee.CONFIRMED:return"Your virtual meeting is confirmed!";case ee.EXPIRED:return"Your meeting request expired without a response. You can request new times.";default:return`A virtual meeting with ${s} has been suggested:`}}function Yn(e){switch(e){case ee.REQUESTED_BY_ME:return{text:"Awaiting Response",className:"vm-section-badge-waiting"};case ee.BOOKED_AWAITING_CONFIRMATION:return{text:"Pending Confirmation",className:"vm-section-badge-pending"};case ee.CONFIRMED:return{text:"Confirmed",className:"vm-section-badge-confirmed"};case ee.EXPIRED:return{text:"Expired",className:"vm-section-badge-expired"};default:return null}}function Jn(e,s){switch(s){case ee.REQUESTED_BY_OTHER:return{text:"Respond to Virtual Meeting",className:"vm-section-primary-btn vm-section-primary-btn--respond",disabled:!1,view:"respond"};case ee.REQUESTED_BY_ME:return null;case ee.BOOKED_AWAITING_CONFIRMATION:return{text:"View Meeting Details",className:"vm-section-primary-btn vm-section-primary-btn--details",disabled:!1,view:"details"};case ee.CONFIRMED:return{text:"Join Virtual Meeting",className:"vm-section-primary-btn vm-section-primary-btn--join",disabled:!1,view:"details"};case ee.EXPIRED:return{text:"Request New Times",className:"vm-section-primary-btn vm-section-primary-btn--expired",disabled:!1,view:"request"};default:return null}}function Kn(e){if(!e||!Array.isArray(e))return[];const s=["Proposal Cancelled by Guest","Proposal Rejected by Host","Proposal Cancelled by Split Lease"];return e.filter(n=>{var r;const i=n.virtualMeeting;if(!i)return!1;const a=(r=n.Status)==null?void 0:r.trim();return!(s.includes(a)||i["meeting declined"]===!0)})}function Qn({proposal:e,currentUserId:s,onOpenVMModal:n}){const i=e.listing,a=i==null?void 0:i.host,r=e.virtualMeeting,c=Gn(r),f=us(c,s),N=hs(c,s),w=(a==null?void 0:a["Name - First"])||(a==null?void 0:a["Name - Full"])||"Host",g=(i==null?void 0:i.Name)||"Listing",m=`${w} - ${g}`,h=Un(e["Created Date"]||e.createdDate),p=h?`Proposal from ${h}`:null,o=qn(r==null?void 0:r["suggested dates and times"]),I=c==null?void 0:c.bookedDate,k=zn(f,w),L=Yn(f),u=Jn(N,f),W=!!I,H=!I&&o.length>0;return t.jsxs("div",{className:"vm-section-card",children:[t.jsxs("div",{className:"vm-section-card-content",children:[t.jsxs("div",{className:"vm-section-header-row",children:[t.jsx("div",{className:"vm-section-profile-icon",children:a!=null&&a["Profile Photo"]?t.jsx("img",{src:a["Profile Photo"],alt:w,className:"vm-section-profile-img"}):t.jsx(Vn,{})}),t.jsxs("div",{className:"vm-section-text-content",children:[t.jsxs("div",{className:"vm-section-title-row",children:[t.jsx("div",{className:"vm-section-title",children:m}),L&&t.jsx("span",{className:`vm-section-badge ${L.className}`,children:L.text})]}),p&&t.jsx("div",{className:"vm-section-subtitle",children:p}),t.jsxs("div",{className:"vm-section-message-row",children:[t.jsx($n,{}),t.jsx("span",{className:"vm-section-message",children:k})]})]})]}),W&&t.jsx("div",{className:"vm-section-dates-row",children:t.jsx("div",{className:"vm-section-date-pill vm-section-date-pill--booked",children:Nt(I)})}),H&&t.jsx("div",{className:"vm-section-dates-row",children:o.map((J,j)=>{const D=!Hn(J);return t.jsx("div",{className:`vm-section-date-pill ${D?"vm-section-date-pill--expired":""}`,children:Nt(J)},j)})})]}),t.jsxs("div",{className:`vm-section-action-bar ${u?"vm-section-action-bar--multi":""}`,children:[u&&t.jsx("button",{className:u.className,onClick:()=>!u.disabled&&n(e,u.view),disabled:u.disabled,children:u.text}),f!==ee.CONFIRMED&&f!==ee.EXPIRED&&t.jsx("button",{className:"vm-section-cancel-btn",onClick:()=>n(e,"cancel"),children:f===ee.REQUESTED_BY_ME?"Cancel Request":"Cancel Virtual Meeting"})]})]})}function Xn({proposals:e,currentUserId:s}){const[n,i]=d.useState(!1),[a,r]=d.useState(null),[c,f]=d.useState(""),N=d.useMemo(()=>Kn(e),[e]);if(N.length===0)return null;const w=(p,o)=>{r(p),f(o),i(!0)},g=()=>{i(!1),r(null),f("")},m=()=>{window.location.reload()},h={_id:s,typeUserSignup:"guest"};return t.jsxs("div",{className:"vm-section-wrapper",children:[t.jsx("h2",{className:"vm-section-heading",children:"Virtual Meetings"}),t.jsx("div",{className:"vm-section-list",children:N.map(p=>t.jsx(Qn,{proposal:p,currentUserId:s,onOpenVMModal:w},p._id))}),n&&a&&t.jsx(Dt,{proposal:a,initialView:c,currentUser:h,onClose:g,onSuccess:m})]})}function wt(){return t.jsxs("div",{className:"loading-state",role:"status","aria-live":"polite",children:[t.jsx("div",{className:"spinner","aria-hidden":"true"}),t.jsx("p",{children:"Loading your proposals..."})]})}function Zn({error:e,onRetry:s}){return t.jsxs("div",{className:"error-state",role:"alert",children:[t.jsx("div",{className:"error-icon","aria-hidden":"true",children:"!"}),t.jsx("h2",{children:"Something went wrong"}),t.jsx("p",{className:"error-message",children:e}),t.jsx("button",{className:"retry-button",onClick:s,children:"Try Again"})]})}function ea(){return t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-icon","aria-hidden":"true",children:"0"}),t.jsx("h2",{children:"No Proposals Yet"}),t.jsx("p",{children:"You haven't submitted any proposals yet."}),t.jsx("p",{className:"empty-subtext",children:"Browse listings and submit a proposal to get started."}),t.jsx("a",{href:"/search",className:"btn btn-primary",style:{marginTop:"1rem",display:"inline-block",textDecoration:"none"},children:"Browse Listings"})]})}function ta(){const{authState:e,user:s,proposals:n,categorizedProposals:i,expandedProposalId:a,isLoading:r,error:c,handleProposalSelect:f,handleToggleExpand:N,handleRetry:w,handleProposalDeleted:g}=Ws();if(e.shouldRedirect)return t.jsxs(t.Fragment,{children:[t.jsx(ct,{}),t.jsx("main",{className:"main-content",children:t.jsx("div",{className:"proposals-page",children:t.jsx(wt,{})})}),t.jsx(ot,{})]});const{suggested:m,userCreated:h}=i||{suggested:[],userCreated:[]};return t.jsxs(t.Fragment,{children:[t.jsx(ct,{}),t.jsxs("main",{className:"main-content",role:"main",id:"main-content",children:[t.jsx("h1",{className:"sr-only",children:"Your Proposals"}),t.jsxs("div",{className:"proposals-page proposals-page--v7",children:[r&&t.jsx(wt,{}),!r&&c&&t.jsx(Zn,{error:c,onRetry:w}),!r&&!c&&n.length===0&&t.jsx(ea,{}),!r&&!c&&n.length>0&&t.jsxs("div",{className:"proposals-sections",children:[m.length>0&&t.jsxs("section",{className:"proposals-section proposals-section--suggested","aria-labelledby":"suggested-proposals-heading",children:[t.jsxs("h2",{id:"suggested-proposals-heading",className:"sr-only",children:["Suggested for You - ",m.length," ",m.length===1?"proposal":"proposals"]}),t.jsx(ft,{type:"suggested",count:m.length}),t.jsx("div",{className:"proposals-section__cards",role:"list",children:m.map(p=>t.jsx(bt,{proposal:p,isExpanded:a===p._id,onToggle:()=>N(p._id),allProposals:n,onProposalSelect:f,onProposalDeleted:g},p._id))})]}),h.length>0&&t.jsxs("section",{className:"proposals-section proposals-section--user","aria-labelledby":"user-proposals-heading",children:[t.jsxs("h2",{id:"user-proposals-heading",className:"sr-only",children:["Your Proposals - ",h.length," ",h.length===1?"proposal":"proposals"]}),t.jsx(ft,{type:"user",count:h.length}),t.jsx("div",{className:"proposals-section__cards",role:"list",children:h.map(p=>t.jsx(bt,{proposal:p,isExpanded:a===p._id,onToggle:()=>N(p._id),allProposals:n,onProposalSelect:f,onProposalDeleted:g},p._id))})]}),t.jsx(Xn,{proposals:n,currentUserId:s==null?void 0:s._id})]})]})]}),t.jsx(ot,{})]})}zt(document.getElementById("root")).render(t.jsx(Yt.StrictMode,{children:t.jsx(gs,{children:t.jsx(fs,{children:t.jsx(ta,{})})})}));

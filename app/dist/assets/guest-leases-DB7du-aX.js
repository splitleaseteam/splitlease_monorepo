import{r as o,j as e,c as _e,R as pe}from"./client-BJVKzfAi.js";import{H as Z}from"./Header-BJKWma2V.js";import{F as ee}from"./Footer-Bzf1rLKh.js";import{c as xe,v as fe,k as je}from"./auth-QZ4BJadW.js";import{s as q}from"./supabase-BoCLEw6R.js";import{a as be}from"./adaptLeaseFromSupabase-pMJWDmu_.js";import{u as Ne,a as ye}from"./Toast-BQk6Nzgd.js";import{C as F}from"./clock-BT0kKcUb.js";import{C as X}from"./circle-check-big-42edTrxg.js";import{C as O}from"./calendar-CDI4qHEX.js";import{S as he,C as ve}from"./star-OtPMgcH9.js";import{E as we}from"./eye-J9MlnJAi.js";import{c as P}from"./createLucideIcon-CgZZH2OU.js";import{C as ue}from"./check-B34HRHn5.js";import{X as U}from"./x-CrJVeoCh.js";import{C as se}from"./circle-alert-C7SsrRDS.js";import{I as ke}from"./info-CcVWtG4-.js";import{H as Ce}from"./house-_O8RlyPO.js";import{C as Se}from"./chevron-up-BHVOGcSe.js";import{F as Le}from"./file-text-Bqp_Hw0X.js";import{D as Ae}from"./dollar-sign-Dn2-KjNW.js";import{T as De}from"./triangle-alert-Bp6DQQmR.js";import{M as Re}from"./map-pin-Be7EkBk1.js";import{S as Ee}from"./send-C4mziT0-.js";import{C as ae}from"./camera-DeVyJAXE.js";import{E as Pe}from"./ErrorBoundary-9_HbXv1y.js";/* empty css             */import"./constants-CPVJY5eo.js";import"./proposalDataFetcher-CipdyWU2.js";import"./proposalStatuses-1Bj0NYR4.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],Ge=P("award",Ie);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],te=P("download",$e);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],qe=P("log-out",Te);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M5 12h14",key:"1ays0h"}]],Oe=P("minus",Fe);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]],ze=P("navigation",Ue);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],He=P("trending-down",Me);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],We=P("trending-up",Be);async function Ye(){const{data:{session:s}}=await q.auth.getSession(),a=s==null?void 0:s.access_token;if(!a)throw new Error("Authentication required. Please log in.");return a}async function I(s,a,t={}){const r=await Ye();console.log(`[guestLeases] Invoking ${s}/${a}`,t);const{data:i,error:l}=await q.functions.invoke(s,{headers:{Authorization:`Bearer ${r}`},body:{action:a,payload:t}});if(l)throw console.error(`[guestLeases] Error in ${s}/${a}:`,l),new Error(l.message||`Failed to ${a}`);if(!(i!=null&&i.success))throw console.error(`[guestLeases] ${s}/${a} returned error:`,i),new Error((i==null?void 0:i.error)||`Operation failed: ${a}`);return i}async function ne(){try{const a=((await I("lease","get_guest_leases",{})).data||[]).map(t=>be(t));return console.log(`[guestLeases] Fetched ${a.length} leases`),a}catch(s){throw console.error("[guestLeases] Error fetching leases:",s),s}}async function Y(s,a,t="custom"){try{return await I("guest-leases","send_checkin_message",{stayId:s,message:a,type:t})}catch(r){throw console.error("[guestLeases] Error sending checkin message:",r),r}}async function le(s,a){try{return await I("guest-leases","update_stay_status",{stayId:s,status:a})}catch(t){throw console.error("[guestLeases] Error updating stay status:",t),t}}async function Ke(s,a,t=""){try{return await I("guest-leases","submit_cleaning_photos",{stayId:s,photoUrls:a,comment:t})}catch(r){throw console.error("[guestLeases] Error submitting cleaning photos:",r),r}}async function Ve(s,a){try{return await I("guest-leases","submit_storage_photos",{stayId:s,photoUrls:a})}catch(t){throw console.error("[guestLeases] Error submitting storage photos:",t),t}}async function Xe(s){try{return await I("date-change-request","accept",{requestId:s})}catch(a){throw console.error("[guestLeases] Error approving date change request:",a),a}}async function Je(s,a=""){try{return await I("date-change-request","decline",{requestId:s,reason:a})}catch(t){throw console.error("[guestLeases] Error rejecting date change request:",t),t}}function Qe(){const{showToast:s}=Ne(),[a,t]=o.useState({isChecking:!0,isAuthenticated:!1,isGuest:!1,shouldRedirect:!1,redirectReason:null}),[r,i]=o.useState(null),[l,d]=o.useState([]),[h,m]=o.useState(null),[j,g]=o.useState({isOpen:!1,mode:"checkin",stay:null}),[y,b]=o.useState(!0),[v,N]=o.useState(null);o.useEffect(()=>{async function n(){var M,H,T,B,Q;if(console.log("ðŸ” Guest Leases: Checking authentication..."),!await xe()){console.log("âŒ Guest Leases: User not authenticated, redirecting to home"),t({isChecking:!1,isAuthenticated:!1,isGuest:!1,shouldRedirect:!0,redirectReason:"NOT_AUTHENTICATED"}),window.location.href="/";return}const k=await fe({clearOnFailure:!1});let _=null,G=!1;if(k)_=k.userType,G=_==="Guest"||((M=_==null?void 0:_.includes)==null?void 0:M.call(_,"Guest")),console.log("âœ… Guest Leases: User data loaded, userType:",_),i(k);else{const{data:{session:D}}=await q.auth.getSession();if(D!=null&&D.user){if(_=((H=D.user.user_metadata)==null?void 0:H.user_type)||je()||null,G=_==="Guest"||((T=_==null?void 0:_.includes)==null?void 0:T.call(_,"Guest")),console.log("âš ï¸ Guest Leases: Using fallback session data, userType:",_),!_){console.log("âŒ Guest Leases: Cannot determine user type, redirecting"),t({isChecking:!1,isAuthenticated:!0,isGuest:!1,shouldRedirect:!0,redirectReason:"USER_TYPE_UNKNOWN"}),window.location.href="/";return}i({_id:D.user.id,email:D.user.email,firstName:((B=D.user.user_metadata)==null?void 0:B.first_name)||"Guest",lastName:((Q=D.user.user_metadata)==null?void 0:Q.last_name)||"",userType:_})}else{console.log("âŒ Guest Leases: No valid session, redirecting to home"),t({isChecking:!1,isAuthenticated:!1,isGuest:!1,shouldRedirect:!0,redirectReason:"TOKEN_INVALID"}),window.location.href="/";return}}if(!G){console.log("âŒ Guest Leases: User is not a Guest, redirecting"),t({isChecking:!1,isAuthenticated:!0,isGuest:!1,shouldRedirect:!0,redirectReason:"NOT_GUEST"}),window.location.href="/host-leases";return}t({isChecking:!1,isAuthenticated:!0,isGuest:!0,shouldRedirect:!1,redirectReason:null})}n()},[]),o.useEffect(()=>{async function n(){if(!(a.isChecking||a.shouldRedirect||!r)){console.log("ðŸ“¦ Guest Leases: Fetching leases for user:",r._id),b(!0),N(null);try{const c=await ne();c&&Array.isArray(c)?(d(c),console.log(`âœ… Guest Leases: Loaded ${c.length} leases`),c.length>0&&!h&&m(c[0]._id)):d([])}catch(c){console.error("âŒ Guest Leases: Error fetching leases:",c),N(c.message||"Failed to load leases. Please try again.")}finally{b(!1)}}}n()},[a.isChecking,a.shouldRedirect,r]);const C=o.useCallback(n=>{m(c=>c===n?null:n)},[]),p=o.useCallback(async()=>{b(!0),N(null);try{const n=await ne();n&&Array.isArray(n)&&(d(n),n.length>0&&!h&&m(n[0]._id))}catch(n){N(n.message||"Failed to load leases. Please try again.")}finally{b(!1)}},[h]),S=o.useCallback((n,c)=>{console.log(`ðŸšª Guest Leases: Opening ${c} modal for stay:`,n._id),g({isOpen:!0,mode:c,stay:n})},[]),f=o.useCallback(()=>{g({isOpen:!1,mode:"checkin",stay:null})},[]),R=o.useCallback(async(n,c)=>{console.log("ðŸ“¨ Guest Leases: Sending message for stay:",c._id,n);try{await Y(c._id,n,"custom"),s({title:"Message Sent",message:"Your message has been sent to the host.",type:"success"}),f()}catch(k){console.error("âŒ Guest Leases: Error sending message:",k),s({title:"Error",message:k.message||"Failed to send message. Please try again.",type:"error"})}},[s,f]),L=o.useCallback(async n=>{console.log("ðŸš— Guest Leases: I'm on my way for stay:",n._id);try{await Y(n._id,"I'm on my way!","on_my_way"),s({title:"Notification Sent",message:"The host has been notified that you're on your way.",type:"success"}),f()}catch(c){console.error("âŒ Guest Leases: Error sending on my way notification:",c),s({title:"Error",message:c.message||"Failed to send notification. Please try again.",type:"error"})}},[s,f]),A=o.useCallback(async n=>{console.log("ðŸ  Guest Leases: I'm here for stay:",n._id);try{await Y(n._id,"I've arrived!","im_here"),await le(n._id,"in_progress"),s({title:"Check-In Complete",message:"The host has been notified that you've arrived.",type:"success"}),f(),p()}catch(c){console.error("âŒ Guest Leases: Error sending arrival notification:",c),s({title:"Error",message:c.message||"Failed to send notification. Please try again.",type:"error"})}},[s,p,f]),u=o.useCallback(async(n,c,k)=>{console.log(`ðŸ“· Guest Leases: Submitting ${n.length} ${c} photos for stay:`,k._id);try{const _=[];for(const G of n){const M=`${k._id}/${c}/${Date.now()}-${G.name}`,{data:H,error:T}=await q.storage.from("stay-photos").upload(M,G);if(T)throw new Error(`Failed to upload photo: ${T.message}`);const{data:B}=q.storage.from("stay-photos").getPublicUrl(H.path);_.push(B.publicUrl)}c==="cleaning"?await Ke(k._id,_):await Ve(k._id,_),s({title:"Photos Submitted",message:`Your ${c} photos have been submitted successfully.`,type:"success"}),f()}catch(_){console.error("âŒ Guest Leases: Error submitting photos:",_),s({title:"Error",message:_.message||"Failed to submit photos. Please try again.",type:"error"})}},[s,f]),x=o.useCallback(async n=>{console.log("ðŸ‘‹ Guest Leases: Leaving property for stay:",n._id);try{await le(n._id,"completed"),s({title:"Check-Out Complete",message:"Thank you! Safe travels!",type:"success"}),f(),p()}catch(c){console.error("âŒ Guest Leases: Error completing checkout:",c),s({title:"Error",message:c.message||"Failed to complete checkout. Please try again.",type:"error"})}},[s,f,p]),w=o.useCallback(n=>{console.log("â­ Guest Leases: Submit review for stay:",n._id),s({title:"Coming Soon",message:"Review submission will be available soon.",type:"info"})},[s]),E=o.useCallback(n=>{console.log("ðŸ‘ï¸ Guest Leases: See review for stay:",n._id),n.reviewSubmittedByHost&&s({title:`Host Review: ${n.reviewSubmittedByHost.rating}/5`,message:n.reviewSubmittedByHost.comment||"No comment provided.",type:"info"})},[s]),z=o.useCallback(async n=>{console.log("âœ… Guest Leases: Approve date change request:",n._id);try{await Xe(n._id),s({title:"Request Approved",message:"The date change request has been approved.",type:"success"}),p()}catch(c){console.error("âŒ Guest Leases: Error approving date change:",c),s({title:"Error",message:c.message||"Failed to approve request. Please try again.",type:"error"})}},[s,p]),J=o.useCallback(async n=>{console.log("âŒ Guest Leases: Reject date change request:",n._id);try{await Je(n._id),s({title:"Request Rejected",message:"The date change request has been rejected.",type:"info"}),p()}catch(c){console.error("âŒ Guest Leases: Error rejecting date change:",c),s({title:"Error",message:c.message||"Failed to reject request. Please try again.",type:"error"})}},[s,p]),W=o.useCallback(()=>{console.log("ðŸ“… Guest Leases: Request date change"),s({title:"Coming Soon",message:"Date change requests will be available soon.",type:"info"})},[s]),$=o.useCallback((n,c)=>{if(console.log("ðŸ“„ Guest Leases: Download document:",n,c),!c){s({title:"Document Unavailable",message:`The ${n} document is not available.`,type:"warning"});return}window.open(c,"_blank")},[s]),me=o.useCallback(()=>{console.log("ðŸš¨ Guest Leases: Emergency assistance requested"),window.location.href="/report-emergency"},[]),ge=o.useCallback(()=>{console.log("ðŸ“Š Guest Leases: See reputation"),s({title:"Coming Soon",message:"Reputation details will be available soon.",type:"info"})},[s]);return{authState:a,user:r,leases:l,expandedLeaseId:h,checkInOutModal:j,isLoading:y,error:v,handleToggleExpand:C,handleRetry:p,handleCheckInOut:S,handleCloseCheckInOutModal:f,handleSendMessage:R,handleImOnMyWay:L,handleImHere:A,handleSubmitPhotos:u,handleLeavingProperty:x,handleSubmitReview:w,handleSeeReview:E,handleDateChangeApprove:z,handleDateChangeReject:J,handleRequestDateChange:W,handleDownloadDocument:$,handleEmergencyAssistance:me,handleSeeReputation:ge}}function re(s){if(!s)return"N/A";const a=new Date(s);return isNaN(a.getTime())?"N/A":a.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function Ze(s){switch(s){case"not_started":return{label:"Upcoming",className:"upcoming",icon:F};case"started":return{label:"Starting",className:"starting",icon:O};case"in_progress":return{label:"In Progress",className:"active",icon:X};case"completed":return{label:"Completed",className:"completed",icon:X};default:return{label:s||"Unknown",className:"unknown",icon:F}}}function es(s,a,t,r){const{status:i,reviewSubmittedByGuest:l,reviewSubmittedByHost:d}=s,h=[];return(i==="not_started"||i==="started")&&h.push({key:"checkin",label:"Check In",onClick:()=>a(s,"checkin"),className:"btn-primary"}),i==="in_progress"&&h.push({key:"checkout",label:"Check Out",onClick:()=>a(s,"checkout"),className:"btn-primary"}),i==="completed"&&!l&&h.push({key:"submit-review",label:"Submit Review",onClick:()=>t(s),className:"btn-outline",icon:he}),d&&h.push({key:"see-review",label:"See Review",onClick:()=>r(s),className:"btn-text",icon:we}),h}function ss({stays:s=[],showAll:a=!1,onToggleShowAll:t,onCheckInOut:r,onSubmitReview:i,onSeeReview:l}){const d=a?s:s.slice(0,4),h=s.length>4;return s.length===0?e.jsx("div",{className:"stays-table__empty",children:e.jsx("p",{children:"No stays found for this lease."})}):e.jsxs("div",{className:"stays-table",children:[e.jsx("div",{className:"stays-table__list",children:d.map(m=>{const j=Ze(m.status),g=es(m,r,i,l),y=j.icon;return e.jsxs("div",{className:"stays-table__row",children:[e.jsxs("div",{className:"stays-table__info",children:[e.jsxs("div",{className:"stays-table__week",children:["Week ",m.weekNumber||"?"]}),e.jsxs("div",{className:"stays-table__dates",children:[re(m.checkIn)," - ",re(m.checkOut)]}),e.jsxs("div",{className:`stays-table__status stays-table__status--${j.className}`,children:[e.jsx(y,{size:14}),j.label]})]}),e.jsx("div",{className:"stays-table__actions",children:g.map(({key:b,label:v,onClick:N,className:C,icon:p})=>e.jsxs("button",{className:`btn btn-sm ${C}`,onClick:N,children:[p&&e.jsx(p,{size:14}),v]},b))})]},m._id||m.id)})}),h&&e.jsx("button",{className:"stays-table__toggle",onClick:t,children:a?"Show Less":`Show All ${s.length} Stays`})]})}function ce(s){return s==null?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s)}function K(s){if(!s)return"N/A";const a=new Date(s);return isNaN(a.getTime())?"N/A":a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function as({records:s=[],onDownloadReceipt:a}){return s.length===0?e.jsx("div",{className:"payment-records__empty",children:e.jsx("p",{children:"No payment records available."})}):e.jsxs("div",{className:"payment-records",children:[e.jsxs("table",{className:"payment-records__table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Receipt"})]})}),e.jsx("tbody",{children:s.map(t=>{const r=t.isPaid||t.actualDate,l=r?X:F;return e.jsxs("tr",{children:[e.jsxs("td",{className:"payment-records__date",children:[K(t.scheduledDate),t.actualDate&&t.actualDate!==t.scheduledDate&&e.jsxs("span",{className:"payment-records__actual-date",children:["(Paid: ",K(t.actualDate),")"]})]}),e.jsx("td",{className:"payment-records__amount",children:ce(t.totalAmount||t.rent)}),e.jsxs("td",{className:`payment-records__status ${r?"paid":"pending"}`,children:[e.jsx(l,{size:14}),r?"Paid":"Pending"]}),e.jsx("td",{className:"payment-records__receipt",children:t.receiptUrl?e.jsx("button",{className:"btn btn-icon btn-sm",onClick:()=>a(t),"aria-label":"Download receipt",children:e.jsx(te,{size:16})}):e.jsx("span",{className:"payment-records__no-receipt",children:"-"})})]},t._id||t.id)})})]}),e.jsx("div",{className:"payment-records__cards",children:s.map(t=>{const r=t.isPaid||t.actualDate;return e.jsxs("div",{className:"payment-records__card",children:[e.jsxs("div",{className:"payment-records__card-header",children:[e.jsx("span",{className:"payment-records__card-date",children:K(t.scheduledDate)}),e.jsx("span",{className:`payment-records__card-status ${r?"paid":"pending"}`,children:r?"Paid":"Pending"})]}),e.jsx("div",{className:"payment-records__card-amount",children:ce(t.totalAmount||t.rent)}),t.receiptUrl&&e.jsxs("button",{className:"btn btn-outline btn-sm",onClick:()=>a(t),children:[e.jsx(te,{size:14}),"Download Receipt"]})]},t._id||t.id)})})]})}function V(s){if(!s)return"N/A";const a=new Date(s);return isNaN(a.getTime())?"N/A":a.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function ts(s){switch(s){case"waiting_for_answer":return{label:"Pending",className:"pending",icon:F};case"accepted":return{label:"Accepted",className:"accepted",icon:ue};case"rejected":return{label:"Rejected",className:"rejected",icon:U};case"expired":return{label:"Expired",className:"expired",icon:se};case"soon_to_expire":return{label:"Expiring Soon",className:"expiring",icon:se};case"cancelled":return{label:"Cancelled",className:"cancelled",icon:U};default:return{label:s||"Unknown",className:"unknown",icon:F}}}function ns(s,a){var r;return s.requestStatus!=="waiting_for_answer"||!a?!1:(((r=s.requestedBy)==null?void 0:r._id)||s.requestedById)!==a}function ls({requests:s=[],currentUserId:a,onApprove:t,onReject:r,onRequestChanges:i}){return s.length===0?e.jsxs("div",{className:"date-change-requests__empty",children:[e.jsx("p",{children:"No date change requests."}),e.jsxs("button",{className:"btn btn-outline btn-sm",onClick:i,children:[e.jsx(O,{size:14}),"Request Date Change"]})]}):e.jsxs("div",{className:"date-change-requests",children:[e.jsx("div",{className:"date-change-requests__list",children:s.map(l=>{var j,g;const d=ts(l.requestStatus),h=d.icon,m=ns(l,a);return e.jsxs("div",{className:"date-change-requests__item",children:[e.jsxs("div",{className:"date-change-requests__header",children:[e.jsxs("div",{className:`date-change-requests__status date-change-requests__status--${d.className}`,children:[e.jsx(h,{size:14}),d.label]}),e.jsx("span",{className:"date-change-requests__date",children:V(l.dateAdded)})]}),e.jsxs("div",{className:"date-change-requests__details",children:[e.jsxs("div",{className:"date-change-requests__change",children:[e.jsx("span",{className:"date-change-requests__label",children:"Original:"}),e.jsx("span",{className:"date-change-requests__value",children:((j=l.listOfOldDates)==null?void 0:j.length)>0?l.listOfOldDates.map(y=>V(y)).join(", "):"N/A"})]}),e.jsxs("div",{className:"date-change-requests__change",children:[e.jsx("span",{className:"date-change-requests__label",children:"Requested:"}),e.jsx("span",{className:"date-change-requests__value",children:((g=l.listOfNewDates)==null?void 0:g.length)>0?l.listOfNewDates.map(y=>V(y)).join(", "):"N/A"})]}),l.messageFromRequester&&e.jsxs("div",{className:"date-change-requests__message",children:[e.jsx("span",{className:"date-change-requests__label",children:"Message:"}),e.jsx("p",{children:l.messageFromRequester})]})]}),m&&e.jsxs("div",{className:"date-change-requests__actions",children:[e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>t(l),children:[e.jsx(ue,{size:14}),"Approve"]}),e.jsxs("button",{className:"btn btn-outline btn-sm",onClick:()=>r(l),children:[e.jsx(U,{size:14}),"Reject"]})]})]},l._id||l.id)})}),e.jsxs("button",{className:"btn btn-outline",onClick:i,children:[e.jsx(O,{size:16}),"Request Date Change"]})]})}function rs(s=[]){if(s.length===0)return{score:100,trend:"neutral",label:"Excellent"};const a=s.filter(m=>m.requestStatus==="accepted").length,t=s.filter(m=>m.requestStatus==="rejected").length,r=a+t;if(r===0)return{score:100,trend:"neutral",label:"Excellent"};const i=a/r,l=Math.round(50+i*50);let d="neutral",h="Good";return l>=90?(h="Excellent",d="up"):l>=70?(h="Good",d="neutral"):l>=50?(h="Fair",d="down"):(h="Needs Improvement",d="down"),{score:l,trend:d,label:h}}function cs(s){return s>=80?"excellent":s>=60?"good":s>=40?"fair":"poor"}function is({lease:s,dateChangeRequests:a=[],currentUserId:t,onSeeReputation:r}){const{score:i,trend:l,label:d}=rs(a),h=cs(i),m=(s==null?void 0:s.guestReputationScore)||null,j=l==="up"?We:l==="down"?He:Oe;return e.jsxs("div",{className:"flexibility-score",children:[e.jsxs("div",{className:"flexibility-score__header",children:[e.jsxs("h3",{className:"flexibility-score__title",children:[e.jsx(Ge,{size:18}),"Flexibility Score"]}),e.jsx("button",{className:"flexibility-score__info-btn",onClick:r,"aria-label":"Learn more about flexibility score",children:e.jsx(ke,{size:16})})]}),e.jsxs("div",{className:"flexibility-score__content",children:[e.jsxs("div",{className:`flexibility-score__gauge flexibility-score__gauge--${h}`,children:[e.jsx("div",{className:"flexibility-score__score-value",children:i}),e.jsx("div",{className:"flexibility-score__score-label",children:d})]}),e.jsxs("div",{className:`flexibility-score__trend flexibility-score__trend--${l}`,children:[e.jsx(j,{size:16}),e.jsxs("span",{children:[l==="up"&&"Improving",l==="down"&&"Declining",l==="neutral"&&"Stable"]})]}),e.jsxs("div",{className:"flexibility-score__stats",children:[e.jsxs("div",{className:"flexibility-score__stat",children:[e.jsx("span",{className:"flexibility-score__stat-value",children:a.filter(g=>g.requestStatus==="accepted").length}),e.jsx("span",{className:"flexibility-score__stat-label",children:"Approved"})]}),e.jsxs("div",{className:"flexibility-score__stat",children:[e.jsx("span",{className:"flexibility-score__stat-value",children:a.filter(g=>g.requestStatus==="rejected").length}),e.jsx("span",{className:"flexibility-score__stat-label",children:"Declined"})]}),e.jsxs("div",{className:"flexibility-score__stat",children:[e.jsx("span",{className:"flexibility-score__stat-value",children:a.filter(g=>g.requestStatus==="waiting_for_answer").length}),e.jsx("span",{className:"flexibility-score__stat-label",children:"Pending"})]})]}),m!==null&&e.jsxs("div",{className:"flexibility-score__reputation",children:[e.jsx("span",{className:"flexibility-score__reputation-label",children:"Overall Reputation:"}),e.jsxs("span",{className:"flexibility-score__reputation-value",children:[m,"%"]})]})]})]})}function ie(s){if(!s)return"N/A";const a=new Date(s);return isNaN(a.getTime())?"N/A":a.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function os(s){switch(s){case"active":case"started":return"active";case"completed":return"completed";case"terminated":case"cancelled":return"terminated";default:return"pending"}}function ds({lease:s,isExpanded:a,currentUserId:t,onToggleExpand:r,onCheckInOut:i,onSubmitReview:l,onSeeReview:d,onDateChangeApprove:h,onDateChangeReject:m,onRequestDateChange:j,onDownloadDocument:g,onEmergencyAssistance:y,onSeeReputation:b}){const[v,N]=o.useState(!1);if(!s)return null;const{_id:C,agreementNumber:p,status:S,startDate:f,endDate:R,currentWeekNumber:L,totalWeekCount:A,listing:u,host:x,stays:w=[],dateChangeRequests:E=[],paymentRecords:z=[],documents:J=[]}=s,W=os(S);return e.jsxs("article",{className:`lease-card ${a?"lease-card--expanded":""}`,children:[e.jsxs("header",{className:"lease-card__header",onClick:r,role:"button",tabIndex:0,"aria-expanded":a,onKeyDown:$=>$.key==="Enter"&&r(),children:[e.jsxs("div",{className:"lease-card__header-main",children:[e.jsx("div",{className:"lease-card__image",children:u!=null&&u.imageUrl?e.jsx("img",{src:u.imageUrl,alt:u.name||"Listing"}):e.jsx("div",{className:"lease-card__image-placeholder",children:e.jsx(Ce,{size:24})})}),e.jsxs("div",{className:"lease-card__info",children:[e.jsx("h2",{className:"lease-card__title",children:(u==null?void 0:u.name)||"Unnamed Listing"}),e.jsx("p",{className:"lease-card__address",children:(u==null?void 0:u.neighborhood)||(u==null?void 0:u.address)||"Address not available"}),e.jsxs("div",{className:"lease-card__meta",children:[e.jsx("span",{className:`lease-card__status lease-card__status--${W}`,children:S||"Unknown"}),L&&A&&e.jsxs("span",{className:"lease-card__week",children:["Week ",L," of ",A]})]})]})]}),e.jsx("div",{className:"lease-card__toggle",children:a?e.jsx(Se,{size:24}):e.jsx(ve,{size:24})})]}),a&&e.jsxs("div",{className:"lease-card__content",children:[e.jsxs("section",{className:"lease-card__section",children:[e.jsxs("h3",{className:"lease-card__section-title",children:[e.jsx(O,{size:18}),"Lease Details"]}),e.jsxs("div",{className:"lease-card__details-grid",children:[e.jsxs("div",{className:"lease-card__detail",children:[e.jsx("span",{className:"lease-card__detail-label",children:"Agreement #"}),e.jsx("span",{className:"lease-card__detail-value",children:p||"N/A"})]}),e.jsxs("div",{className:"lease-card__detail",children:[e.jsx("span",{className:"lease-card__detail-label",children:"Start Date"}),e.jsx("span",{className:"lease-card__detail-value",children:ie(f)})]}),e.jsxs("div",{className:"lease-card__detail",children:[e.jsx("span",{className:"lease-card__detail-label",children:"End Date"}),e.jsx("span",{className:"lease-card__detail-value",children:ie(R)})]})]})]}),x&&e.jsxs("section",{className:"lease-card__section",children:[e.jsx("h3",{className:"lease-card__section-title",children:"Host Contact"}),e.jsxs("div",{className:"lease-card__host-info",children:[e.jsxs("span",{className:"lease-card__host-name",children:[x.firstName," ",x.lastName]}),x.email&&e.jsx("a",{href:`mailto:${x.email}`,className:"lease-card__host-email",children:x.email})]})]}),e.jsxs("section",{className:"lease-card__section",children:[e.jsxs("h3",{className:"lease-card__section-title",children:[e.jsx(Le,{size:18}),"Documents"]}),e.jsxs("div",{className:"lease-card__documents",children:[e.jsx("button",{className:"btn btn-outline btn-sm",onClick:()=>g("PT Agreement",s.periodicTenancyAgreement),disabled:!s.periodicTenancyAgreement,children:"PT Agreement (PDF)"}),e.jsx("button",{className:"btn btn-outline btn-sm",onClick:()=>g("Supplemental Terms",s.supplementalAgreement),disabled:!s.supplementalAgreement,children:"Supplemental Terms (PDF)"}),e.jsx("button",{className:"btn btn-outline btn-sm",onClick:()=>g("CC Auth Form",s.creditCardAuthorizationForm),disabled:!s.creditCardAuthorizationForm,children:"CC Auth Form"})]})]}),z.length>0&&e.jsxs("section",{className:"lease-card__section",children:[e.jsxs("h3",{className:"lease-card__section-title",children:[e.jsx(Ae,{size:18}),"Payment History"]}),e.jsx(as,{records:z,onDownloadReceipt:$=>g("Receipt",$.receiptUrl)})]}),e.jsxs("section",{className:"lease-card__section",children:[e.jsxs("h3",{className:"lease-card__section-title",children:[e.jsx(O,{size:18}),"Your Stays (",w.length,")"]}),e.jsx(ss,{stays:w,showAll:v,onToggleShowAll:()=>N(!v),onCheckInOut:i,onSubmitReview:l,onSeeReview:d})]}),E.length>0&&e.jsxs("section",{className:"lease-card__section",children:[e.jsx("h3",{className:"lease-card__section-title",children:"Date Change Requests"}),e.jsx(ls,{requests:E,currentUserId:t,onApprove:h,onReject:m,onRequestChanges:j})]}),e.jsx("section",{className:"lease-card__section",children:e.jsx(is,{lease:s,dateChangeRequests:E,currentUserId:t,onSeeReputation:b})}),e.jsx("section",{className:"lease-card__section lease-card__section--emergency",children:e.jsxs("button",{className:"btn btn-emergency",onClick:y,children:[e.jsx(De,{size:18}),"Emergency Assistance"]})})]})]})}function oe(s){if(!s)return"N/A";const a=new Date(s);return isNaN(a.getTime())?"N/A":a.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}function hs({isOpen:s,mode:a,stay:t,onClose:r,onSendMessage:i,onImOnMyWay:l,onImHere:d,onSubmitPhotos:h,onSubmitReview:m,onLeavingProperty:j}){const[g,y]=o.useState(""),[b,v]=o.useState([]),[N,C]=o.useState("cleaning");if(!s||!t)return null;const p=a==="checkin",S=p?"Check In":"Check Out",f=()=>{g.trim()&&(i(g,t),y(""))},R=u=>{const x=Array.from(u.target.files||[]);v(w=>[...w,...x])},L=()=>{b.length>0&&(h(b,N,t),v([]))},A=u=>{v(x=>x.filter((w,E)=>E!==u))};return e.jsx("div",{className:"check-flow-overlay",onClick:r,children:e.jsxs("div",{className:"check-flow-modal",onClick:u=>u.stopPropagation(),children:[e.jsxs("header",{className:"check-flow__header",children:[e.jsx("h2",{className:"check-flow__title",children:S}),e.jsx("button",{className:"check-flow__close",onClick:r,"aria-label":"Close",children:e.jsx(U,{size:24})})]}),e.jsxs("div",{className:"check-flow__stay-info",children:[e.jsxs("span",{className:"check-flow__stay-week",children:["Week ",t.weekNumber||"?"]}),e.jsxs("span",{className:"check-flow__stay-dates",children:[oe(t.checkIn)," - ",oe(t.checkOut)]})]}),e.jsx("div",{className:"check-flow__content",children:p?e.jsxs("div",{className:"check-flow__checkin",children:[e.jsxs("div",{className:"check-flow__quick-actions",children:[e.jsxs("button",{className:"check-flow__action-btn check-flow__action-btn--on-way",onClick:()=>l(t),children:[e.jsx(ze,{size:20}),"I'm on my way"]}),e.jsxs("button",{className:"check-flow__action-btn check-flow__action-btn--here",onClick:()=>d(t),children:[e.jsx(Re,{size:20}),"I'm here"]})]}),e.jsxs("div",{className:"check-flow__message-section",children:[e.jsx("label",{className:"check-flow__label",children:"Send a message to your host:"}),e.jsx("textarea",{className:"check-flow__textarea",placeholder:"Hi! I just wanted to let you know...",value:g,onChange:u=>y(u.target.value),rows:3}),e.jsxs("button",{className:"btn btn-primary",onClick:f,disabled:!g.trim(),children:[e.jsx(Ee,{size:16}),"Send Message"]})]})]}):e.jsxs("div",{className:"check-flow__checkout",children:[e.jsxs("div",{className:"check-flow__photo-section",children:[e.jsxs("h3",{className:"check-flow__section-title",children:[e.jsx(ae,{size:18}),"Submit Photos"]}),e.jsxs("div",{className:"check-flow__photo-type-toggle",children:[e.jsx("button",{className:`check-flow__toggle-btn ${N==="cleaning"?"active":""}`,onClick:()=>C("cleaning"),children:"Cleaning Photos"}),e.jsx("button",{className:`check-flow__toggle-btn ${N==="storage"?"active":""}`,onClick:()=>C("storage"),children:"Storage Photos"})]}),e.jsxs("div",{className:"check-flow__photo-upload",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:R,id:"photo-upload",className:"check-flow__file-input"}),e.jsxs("label",{htmlFor:"photo-upload",className:"check-flow__file-label",children:[e.jsx(ae,{size:24}),e.jsx("span",{children:"Select Photos"})]})]}),b.length>0&&e.jsx("div",{className:"check-flow__photo-preview",children:b.map((u,x)=>e.jsxs("div",{className:"check-flow__photo-item",children:[e.jsx("img",{src:URL.createObjectURL(u),alt:`Photo ${x+1}`}),e.jsx("button",{className:"check-flow__photo-remove",onClick:()=>A(x),children:e.jsx(U,{size:16})})]},x))}),e.jsxs("button",{className:"btn btn-primary",onClick:L,disabled:b.length===0,children:["Submit ",N==="cleaning"?"Cleaning":"Storage"," Photos"]})]}),e.jsx("div",{className:"check-flow__review-section",children:e.jsxs("button",{className:"btn btn-outline",onClick:()=>m(t),children:[e.jsx(he,{size:16}),"Submit Review"]})}),e.jsxs("div",{className:"check-flow__leave-section",children:[e.jsxs("button",{className:"btn btn-primary check-flow__leave-btn",onClick:()=>j(t),children:[e.jsx(qe,{size:16}),"I'm Leaving the Property"]}),e.jsx("p",{className:"check-flow__leave-hint",children:"Click this when you've completed checkout and are leaving."})]})]})})]})})}function de(){return e.jsxs("div",{className:"loading-state",role:"status","aria-live":"polite",children:[e.jsx("div",{className:"spinner","aria-hidden":"true"}),e.jsx("p",{children:"Loading your leases..."})]})}function us({error:s,onRetry:a}){return e.jsxs("div",{className:"error-state",role:"alert",children:[e.jsx("div",{className:"error-icon","aria-hidden":"true",children:"!"}),e.jsx("h2",{children:"Something went wrong"}),e.jsx("p",{className:"error-message",children:s}),e.jsx("button",{className:"retry-button",onClick:a,children:"Try Again"})]})}function ms(){return e.jsxs("div",{className:"empty-state",children:[e.jsx("div",{className:"empty-icon","aria-hidden":"true",children:e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]})}),e.jsx("h2",{children:"No Leases Yet"}),e.jsx("p",{children:"You don't have any active leases."}),e.jsx("p",{className:"empty-subtext",children:"Browse listings and submit a proposal to get started with your first rental."}),e.jsx("a",{href:"/search",className:"btn btn-primary",style:{marginTop:"1rem",display:"inline-block",textDecoration:"none"},children:"Browse Listings"})]})}function gs(){const{authState:s,user:a,leases:t,expandedLeaseId:r,checkInOutModal:i,isLoading:l,error:d,handleToggleExpand:h,handleRetry:m,handleCheckInOut:j,handleCloseCheckInOutModal:g,handleSendMessage:y,handleImOnMyWay:b,handleImHere:v,handleSubmitPhotos:N,handleLeavingProperty:C,handleSubmitReview:p,handleSeeReview:S,handleDateChangeApprove:f,handleDateChangeReject:R,handleRequestDateChange:L,handleDownloadDocument:A,handleEmergencyAssistance:u,handleSeeReputation:x}=Qe();return s.shouldRedirect?e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsx("main",{className:"main-content",children:e.jsx("div",{className:"guest-leases-page",children:e.jsx(de,{})})}),e.jsx(ee,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{}),e.jsxs("main",{className:"main-content",role:"main",id:"main-content",children:[e.jsx("h1",{className:"sr-only",children:"Your Leases"}),e.jsx("div",{className:"guest-leases-page",children:e.jsxs("div",{className:"page-container",children:[a&&e.jsx("div",{className:"page-header",children:e.jsxs("h1",{className:"page-title",children:[a.firstName,"'s Leases"]})}),l&&e.jsx(de,{}),!l&&d&&e.jsx(us,{error:d,onRetry:m}),!l&&!d&&t.length===0&&e.jsx(ms,{}),!l&&!d&&t.length>0&&e.jsx("div",{className:"leases-list",children:t.map(w=>e.jsx(ds,{lease:w,isExpanded:r===w._id,currentUserId:a==null?void 0:a._id,onToggleExpand:()=>h(w._id),onCheckInOut:j,onSubmitReview:p,onSeeReview:S,onDateChangeApprove:f,onDateChangeReject:R,onRequestDateChange:L,onDownloadDocument:A,onEmergencyAssistance:u,onSeeReputation:x},w._id))})]})})]}),e.jsx(ee,{}),e.jsx(hs,{isOpen:i.isOpen,mode:i.mode,stay:i.stay,onClose:g,onSendMessage:y,onImOnMyWay:b,onImHere:v,onSubmitPhotos:N,onSubmitReview:p,onLeavingProperty:C})]})}_e(document.getElementById("root")).render(e.jsx(pe.StrictMode,{children:e.jsx(Pe,{children:e.jsx(ye,{children:e.jsx(gs,{})})})}));

import{r as p,j as e,c as se}from"./client-BJVKzfAi.js";/* empty css             */import{H as q}from"./Header-BJKWma2V.js";import{F as B}from"./Footer-Bzf1rLKh.js";import{c as te,v as ie}from"./auth-QZ4BJadW.js";import{s as F}from"./supabase-BoCLEw6R.js";import"./constants-CPVJY5eo.js";import"./Toast-BQk6Nzgd.js";import"./proposalDataFetcher-CipdyWU2.js";import"./proposalStatuses-1Bj0NYR4.js";const ae="simulation-host";async function b(s,t={}){console.log(`[simulationHostService] Invoking action: ${s}`);const{data:a,error:l}=await F.functions.invoke(ae,{body:{action:s,payload:t}});if(l)throw console.error(`[simulationHostService] ${s} failed:`,l),new Error(l.message||`Failed to execute ${s}`);if(!(a!=null&&a.success))throw new Error((a==null?void 0:a.error)||`Action ${s} was not successful`);return a.data}async function ne(){return b("init_simulation",{})}async function oe(s){return b("mark_tester",{simulationId:s})}async function le(s){return b("create_test_guest",{simulationId:s})}async function re(s,t,a,l,d="weekly"){return b("create_test_proposals",{simulationId:s,guestId:t,listingId:a,hostId:l,rentalType:d})}async function ce(s,t,a={}){return b("send_counteroffer",{simulationId:s,proposalId:t,counterofferData:a})}async function ue(s,t){return b("accept_proposal",{simulationId:s,proposalId:t})}async function de(s,t,a="early_checkin",l="approve"){return b("handle_guest_request",{simulationId:s,leaseId:t,requestType:a,hostResponse:l})}async function me(s,t,a){return b("complete_stay",{simulationId:s,leaseId:t,proposalId:a})}async function pe(s){return b("cleanup",{simulationId:s})}const he={A:{id:"A",label:"Mark as Tester",shortLabel:"Tester",description:"Mark yourself as a usability tester to enable simulation features",action:"mark_tester"},B:{id:"B",label:"Receive Proposals",shortLabel:"Proposals",description:"A test guest will submit 3 proposals (Weekly, Monthly, Nightly) to your listing",action:"create_test_proposals"},C:{id:"C",label:"Counteroffer Rejected",shortLabel:"Counteroffer",description:"Send a counteroffer to the guest, who will reject it",action:"send_counteroffer"},D:{id:"D",label:"Accept & Create Lease",shortLabel:"Lease",description:"Accept a different proposal and create a lease document",action:"accept_proposal"},E:{id:"E",label:"Guest Request",shortLabel:"Request",description:"Guest submits a request, you respond to it",action:"handle_guest_request"},F:{id:"F",label:"Complete Stay",shortLabel:"Complete",description:"Mark the stay as complete and exchange reviews",action:"complete_stay"}},E=["A","B","C","D","E","F"],ge=[{id:"weekly",label:"Weekly",description:"4 nights per week"},{id:"monthly",label:"Monthly",description:"7 nights per week (full time)"},{id:"nightly",label:"Nightly",description:"2 nights per week"}];function fe(s){return E.indexOf(s)}function _e(s,t){const a=fe(s);if(a===0)return!0;const l=E[a-1];return t.includes(l)}function xe(s,t,a){return a.includes(s)?"completed":s===t?"active":"pending"}const H="simulation_host_mobile_state";function je(){const s=new URLSearchParams(window.location.search);return{step:s.get("step")||null,simulationId:s.get("simId")||null}}function Se(s,t){const a=new URLSearchParams;s&&a.set("simId",s),t&&t!=="pre-start"&&a.set("step",t);const l=a.toString()?`?${a.toString()}`:window.location.pathname;window.history.replaceState({},"",l)}function Ne(){try{const s=localStorage.getItem(H);if(s)return JSON.parse(s)}catch(s){console.warn("[useSimulationHostMobilePageLogic] Failed to load persisted state:",s)}return null}function be(s){try{localStorage.setItem(H,JSON.stringify(s))}catch(t){console.warn("[useSimulationHostMobilePageLogic] Failed to persist state:",t)}}function $(){try{localStorage.removeItem(H)}catch(s){console.warn("[useSimulationHostMobilePageLogic] Failed to clear persisted state:",s)}}function ye(){const[s,t]=p.useState({isChecking:!0,isAuthenticated:!1,isHost:!1,shouldRedirect:!1}),[a,l]=p.useState(null),[d,c]=p.useState([]),[g,f]=p.useState(null),j=je(),r=Ne(),[n,u]=p.useState({simulationId:j.simulationId||(r==null?void 0:r.simulationId)||null,hostId:(r==null?void 0:r.hostId)||null,currentStep:j.step||(r==null?void 0:r.currentStep)||"pre-start",completedSteps:(r==null?void 0:r.completedSteps)||[],testGuestId:(r==null?void 0:r.testGuestId)||null,testGuestName:(r==null?void 0:r.testGuestName)||null,testProposals:(r==null?void 0:r.testProposals)||[],testLeaseId:(r==null?void 0:r.testLeaseId)||null,selectedProposalId:(r==null?void 0:r.selectedProposalId)||null,selectedRentalType:(r==null?void 0:r.selectedRentalType)||"weekly",mobileConfirmed:(r==null?void 0:r.mobileConfirmed)||!1,isLoading:!1,stepInProgress:null,error:null,toast:null}),C=s.isAuthenticated,O=s.isHost,G=n.currentStep,I=n.completedSteps,U=n.isLoading,Y=n.stepInProgress,v=n.mobileConfirmed,k=n.selectedRentalType,h=n.simulationId,W=p.useMemo(()=>new Date().toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),[]);p.useEffect(()=>{n.simulationId&&(be({simulationId:n.simulationId,hostId:n.hostId,currentStep:n.currentStep,completedSteps:n.completedSteps,testGuestId:n.testGuestId,testGuestName:n.testGuestName,testProposals:n.testProposals,testLeaseId:n.testLeaseId,selectedProposalId:n.selectedProposalId,selectedRentalType:n.selectedRentalType,mobileConfirmed:n.mobileConfirmed}),Se(n.simulationId,n.currentStep))},[n.simulationId,n.hostId,n.currentStep,n.completedSteps,n.testGuestId,n.testProposals,n.testLeaseId,n.selectedProposalId,n.selectedRentalType,n.mobileConfirmed]),p.useEffect(()=>{async function i(){var o;console.log("[SimulationHostMobile] Checking authentication...");try{if(!await te()){t({isChecking:!1,isAuthenticated:!1,isHost:!1,shouldRedirect:!1});return}const y=await ie({clearOnFailure:!1});if(y){l(y);const S=y.userType||"",N=S.includes("Host")||S.includes("Landlord");t({isChecking:!1,isAuthenticated:!0,isHost:N,shouldRedirect:!1}),N&&await M(y._id||y.userId)}else{const{data:{session:S}}=await F.auth.getSession();if(S!=null&&S.user){const N=S.user.user_metadata||{};l({userId:N.user_id||S.user.id,_id:N.user_id||S.user.id,firstName:N.first_name||((o=S.user.email)==null?void 0:o.split("@")[0])||"User",email:S.user.email,userType:N.user_type||""});const D=(N.user_type||"").includes("Host");t({isChecking:!1,isAuthenticated:!0,isHost:D,shouldRedirect:!1}),D&&N.user_id&&await M(N.user_id)}else t({isChecking:!1,isAuthenticated:!1,isHost:!1,shouldRedirect:!1})}}catch(_){console.error("[SimulationHostMobile] Auth check failed:",_),t({isChecking:!1,isAuthenticated:!1,isHost:!1,shouldRedirect:!1})}}i()},[]);const M=async i=>{console.log("[SimulationHostMobile] Loading host listings for:",i);try{const{data:o,error:_}=await F.from("listing").select('_id, "Name", "Cover Photo", "Primary Address", "Listing Status"').eq("Host User",i).eq("Listing Status","Published").limit(10);if(_){console.error("[SimulationHostMobile] Failed to load listings:",_);return}c(o||[]),(o==null?void 0:o.length)>0&&!g&&f(o[0]),console.log("[SimulationHostMobile] Loaded",(o==null?void 0:o.length)||0,"listings")}catch(o){console.error("[SimulationHostMobile] Error loading listings:",o)}},m=p.useCallback(i=>{u(o=>({...o,toast:i})),setTimeout(()=>{u(o=>({...o,toast:null}))},5e3)},[]),J=p.useCallback(()=>{u(i=>({...i,toast:null}))},[]),x=p.useCallback((i,o)=>{console.error(`[SimulationHostMobile] Step ${i} failed:`,o),m({title:`Step ${i} Failed`,message:o.message||"An unexpected error occurred",type:"error"}),u(_=>({..._,isLoading:!1,stepInProgress:null,error:o.message}))},[m]),K=p.useCallback(i=>{u(o=>({...o,mobileConfirmed:i}))},[]),z=p.useCallback(i=>{u(o=>({...o,selectedRentalType:i}))},[]),Q=p.useCallback(async()=>{if(!v){m({title:"Confirmation Required",message:"Please confirm you are testing on a mobile device",type:"error"});return}if(!g){m({title:"Listing Required",message:"Please select a listing to use for the simulation",type:"error"});return}u(i=>({...i,isLoading:!0}));try{const i=await ne();u(o=>({...o,simulationId:i.simulationId,hostId:i.hostId,currentStep:"A",isLoading:!1})),m({title:"Simulation Started",message:`Session ID: ${i.simulationId.substring(0,10)}...`,type:"success"})}catch(i){x("init",i)}},[v,g,m,x]),L=p.useCallback(async()=>{if(h){u(i=>({...i,isLoading:!0,stepInProgress:"A"}));try{await oe(h),u(i=>({...i,isLoading:!1,stepInProgress:null,currentStep:"B",completedSteps:[...i.completedSteps,"A"]})),m({title:"Step A Complete",message:"You are now marked as a usability tester",type:"success"})}catch(i){x("A",i)}}},[h,m,x]),P=p.useCallback(async()=>{if(!(!h||!g)){u(i=>({...i,isLoading:!0,stepInProgress:"B"}));try{const i=await le(h),o=await re(h,i.guestId,g._id,n.hostId,k);u(_=>({..._,isLoading:!1,stepInProgress:null,currentStep:"C",completedSteps:[..._.completedSteps,"B"],testGuestId:i.guestId,testGuestName:i.guestName,testProposals:o.proposals})),m({title:"Step B Complete",message:`Created ${o.proposals.length} test proposals from ${i.guestName}`,type:"success"})}catch(i){x("B",i)}}},[h,g,n.hostId,k,m,x]),w=p.useCallback(async()=>{if(!h)return;const i=n.testProposals[0];if(!i){m({title:"No Proposal Found",message:"Complete Step B first to create test proposals",type:"error"});return}u(o=>({...o,isLoading:!0,stepInProgress:"C"}));try{await ce(h,i.proposalId),u(o=>({...o,isLoading:!1,stepInProgress:null,currentStep:"D",completedSteps:[...o.completedSteps,"C"]})),m({title:"Step C Complete",message:"Counteroffer sent - Guest rejected it (simulated)",type:"success"})}catch(o){x("C",o)}},[h,n.testProposals,m,x]),A=p.useCallback(async()=>{if(!h)return;const i=n.testProposals[1]||n.testProposals[0];if(!i){m({title:"No Proposal Found",message:"Complete Step B first to create test proposals",type:"error"});return}u(o=>({...o,isLoading:!0,stepInProgress:"D"}));try{const o=await ue(h,i.proposalId);u(_=>({..._,isLoading:!1,stepInProgress:null,currentStep:"E",completedSteps:[..._.completedSteps,"D"],testLeaseId:o.leaseId,selectedProposalId:i.proposalId})),m({title:"Step D Complete",message:o.leaseId?"Proposal accepted & lease created":"Proposal accepted",type:"success"})}catch(o){x("D",o)}},[h,n.testProposals,m,x]),R=p.useCallback(async()=>{if(h){u(i=>({...i,isLoading:!0,stepInProgress:"E"}));try{await de(h,n.testLeaseId,"early_checkin","approve"),u(i=>({...i,isLoading:!1,stepInProgress:null,currentStep:"F",completedSteps:[...i.completedSteps,"E"]})),m({title:"Step E Complete",message:"Guest request handled - Early check-in approved",type:"success"})}catch(i){x("E",i)}}},[h,n.testLeaseId,m,x]),T=p.useCallback(async()=>{if(h){u(i=>({...i,isLoading:!0,stepInProgress:"F"}));try{const i=await me(h,n.testLeaseId,n.selectedProposalId);u(o=>({...o,isLoading:!1,stepInProgress:null,currentStep:"complete",completedSteps:[...o.completedSteps,"F"]})),m({title:"Simulation Complete! üéâ",message:`Stay completed with ${i.reviews.length} reviews generated`,type:"success"})}catch(i){x("F",i)}}},[h,n.testLeaseId,n.selectedProposalId,m,x]),V=p.useCallback(async()=>{if(!h){$(),window.history.replaceState({},"",window.location.pathname),u({simulationId:null,hostId:null,currentStep:"pre-start",completedSteps:[],testGuestId:null,testGuestName:null,testProposals:[],testLeaseId:null,selectedProposalId:null,selectedRentalType:"weekly",mobileConfirmed:!1,isLoading:!1,stepInProgress:null,error:null,toast:null});return}u(i=>({...i,isLoading:!0}));try{const i=await pe(h);$(),window.history.replaceState({},"",window.location.pathname),u({simulationId:null,hostId:null,currentStep:"pre-start",completedSteps:[],testGuestId:null,testGuestName:null,testProposals:[],testLeaseId:null,selectedProposalId:null,selectedRentalType:"weekly",mobileConfirmed:!1,isLoading:!1,stepInProgress:null,error:null,toast:null});const o=Object.values(i.deletedCounts).reduce((_,y)=>_+y,0);m({title:"Cleanup Complete",message:`Deleted ${o} test records`,type:"info"})}catch(i){console.error("[SimulationHostMobile] Cleanup failed:",i),m({title:"Cleanup Failed",message:i.message,type:"error"}),u(o=>({...o,isLoading:!1}))}},[h,m]),X=p.useCallback(()=>{sessionStorage.setItem("returnTo",window.location.href),window.dispatchEvent(new CustomEvent("openLoginModal"))},[]),Z=p.useCallback(i=>{f(i)},[]),ee=p.useCallback(i=>{switch(i){case"A":return L();case"B":return P();case"C":return w();case"D":return A();case"E":return R();case"F":return T();default:console.warn("Unknown step:",i)}},[L,P,w,A,R,T]);return{authState:s,isAuthenticated:C,isHost:O,currentUser:a,currentDateTime:W,hostListings:d,selectedListing:g,simulationId:h,currentStep:G,completedSteps:I,selectedRentalType:k,mobileConfirmed:v,isLoading:U,stepInProgress:Y,testGuestId:n.testGuestId,testGuestName:n.testGuestName,testProposals:n.testProposals,testLeaseId:n.testLeaseId,toast:n.toast,error:n.error,SIMULATION_STEPS:he,STEP_ORDER:E,RENTAL_TYPES:ge,handleLogin:X,handleMobileConfirmChange:K,handleSelectRentalType:z,handleSelectListing:Z,handleStartSimulation:Q,handleStepAction:ee,handleStepA:L,handleStepB:P,handleStepC:w,handleStepD:A,handleStepE:R,handleStepF:T,handleCleanup:V,showToast:m,dismissToast:J,canActivateStep:i=>_e(i,I),getStepStatus:i=>xe(i,G,I)}}function Ce({currentUser:s,currentDateTime:t}){var l;const a=(s==null?void 0:s.firstName)||(s==null?void 0:s["Name - First"])||((l=s==null?void 0:s.email)==null?void 0:l.split("@")[0])||"Host";return e.jsxs("header",{className:"simulation-host-header",children:[e.jsx("h1",{className:"simulation-host-header__title",children:"Host Simulation"}),e.jsx("p",{className:"simulation-host-header__subtitle",children:"Walk through the guest proposal workflow on mobile"}),e.jsxs("div",{className:"simulation-host-header__info",children:[e.jsxs("span",{className:"simulation-host-header__user",children:["üë§ ",a]}),e.jsxs("span",{className:"simulation-host-header__datetime",children:["üïê ",t]})]})]})}function Ie({currentStep:s,completedSteps:t,steps:a,stepOrder:l}){return e.jsx("div",{className:"simulation-host-progress",children:e.jsx("div",{className:"simulation-host-progress__track",children:l.map((d,c)=>{const g=a[d],f=t.includes(d),j=d===s;let r="simulation-host-progress__step--pending";return f&&(r="simulation-host-progress__step--completed"),j&&(r="simulation-host-progress__step--current"),e.jsxs("div",{className:"simulation-host-progress__step-wrapper",children:[e.jsxs("div",{className:`simulation-host-progress__step ${r}`,children:[e.jsx("div",{className:"simulation-host-progress__icon",children:f?e.jsx("span",{children:"‚úì"}):e.jsx("span",{children:d})}),e.jsx("span",{className:"simulation-host-progress__label",children:g.shortLabel})]}),c<l.length-1&&e.jsx("span",{className:"simulation-host-progress__connector",children:"‚Üí"})]},d)})})})}function ve({confirmed:s,onChange:t,onStart:a,isLoading:l,disabled:d}){return e.jsxs("div",{className:"simulation-host-mobile-confirm",children:[e.jsx("h3",{className:"simulation-host-mobile-confirm__title",children:"Ready to Start?"}),e.jsxs("label",{className:"simulation-host-mobile-confirm__checkbox",children:[e.jsx("input",{type:"checkbox",checked:s,onChange:c=>t(c.target.checked),disabled:l}),e.jsx("span",{children:"I confirm I am testing on a mobile device"})]}),e.jsx("button",{className:"simulation-host-start-button",onClick:a,disabled:!s||l||d,children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"simulation-host-spinner"}),"Starting..."]}):"üöÄ Start Simulation"}),d&&!l&&e.jsx("p",{className:"simulation-host-mobile-confirm__hint",children:"Please select a listing above first"})]})}function ke({listings:s,selectedListing:t,onSelect:a}){return!s||s.length===0?null:e.jsxs("div",{className:"simulation-host-listing-selector",children:[e.jsx("h3",{className:"simulation-host-listing-selector__title",children:"Select a Listing"}),e.jsx("p",{className:"simulation-host-listing-selector__description",children:"Choose which listing to use for receiving test proposals"}),e.jsx("div",{className:"simulation-host-listing-selector__grid",children:s.map(l=>{const d=(t==null?void 0:t._id)===l._id,c=l.Name||l.Name||"Unnamed Listing",g=l["Primary Address"]||"";return e.jsxs("button",{className:`simulation-host-listing-card ${d?"simulation-host-listing-card--selected":""}`,onClick:()=>a(l),children:[l["Cover Photo"]&&e.jsx("div",{className:"simulation-host-listing-card__image",style:{backgroundImage:`url(${l["Cover Photo"]})`}}),e.jsxs("div",{className:"simulation-host-listing-card__content",children:[e.jsx("h4",{className:"simulation-host-listing-card__name",children:c}),g&&e.jsx("p",{className:"simulation-host-listing-card__address",children:g}),d&&e.jsx("span",{className:"simulation-host-listing-card__selected-badge",children:"‚úì Selected"})]})]},l._id)})})]})}function Le({isActive:s,isCompleted:t,isLoading:a,onAction:l,disabled:d}){let c="simulation-host-step";return s&&(c+=" simulation-host-step--active"),t&&(c+=" simulation-host-step--completed"),d&&!t&&(c+=" simulation-host-step--disabled"),e.jsxs("div",{className:c,children:[e.jsxs("div",{className:"simulation-host-step__header",children:[e.jsx("span",{className:"simulation-host-step__number",children:"A"}),e.jsx("h3",{className:"simulation-host-step__title",children:"Mark as Usability Tester"}),t&&e.jsx("span",{className:"simulation-host-step__check",children:"‚úì"})]}),e.jsx("p",{className:"simulation-host-step__description",children:"Mark yourself as a usability tester to enable simulation features. This flags your account for testing purposes."}),!t&&e.jsx("button",{className:"simulation-host-step__button",onClick:l,disabled:d||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"simulation-host-spinner"}),"Marking..."]}):"üéØ Mark as Tester"}),t&&e.jsx("div",{className:"simulation-host-step__completed-message",children:"‚úÖ You are now marked as a usability tester"})]})}function Pe({isActive:s,isCompleted:t,isLoading:a,onAction:l,disabled:d,selectedRentalType:c,onSelectRentalType:g,rentalTypes:f,testProposals:j,testGuestName:r}){let n="simulation-host-step";return s&&(n+=" simulation-host-step--active"),t&&(n+=" simulation-host-step--completed"),d&&!t&&(n+=" simulation-host-step--disabled"),e.jsxs("div",{className:n,children:[e.jsxs("div",{className:"simulation-host-step__header",children:[e.jsx("span",{className:"simulation-host-step__number",children:"B"}),e.jsx("h3",{className:"simulation-host-step__title",children:"Receive Proposals"}),t&&e.jsx("span",{className:"simulation-host-step__check",children:"‚úì"})]}),e.jsx("p",{className:"simulation-host-step__description",children:"A test guest will submit 3 proposals (Weekly, Monthly, Nightly) to your selected listing."}),!t&&s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"simulation-host-rental-types",children:[e.jsx("label",{className:"simulation-host-rental-types__label",children:"Primary Rental Type:"}),e.jsx("div",{className:"simulation-host-rental-types__options",children:f.map(u=>e.jsxs("button",{className:`simulation-host-rental-type ${c===u.id?"simulation-host-rental-type--selected":""}`,onClick:()=>g(u.id),disabled:a,children:[e.jsx("span",{className:"simulation-host-rental-type__label",children:u.label}),e.jsx("span",{className:"simulation-host-rental-type__description",children:u.description})]},u.id))})]}),e.jsx("button",{className:"simulation-host-step__button",onClick:l,disabled:d||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"simulation-host-spinner"}),"Creating Guest & Proposals..."]}):"üì• Receive Test Proposals"})]}),t&&j.length>0&&e.jsxs("div",{className:"simulation-host-step__completed-message",children:[e.jsxs("p",{children:["‚úÖ Received ",j.length," proposals from ",r]}),e.jsx("ul",{className:"simulation-host-proposal-list",children:j.map((u,C)=>e.jsxs("li",{children:[u.rentalType,": ",u.status]},u.proposalId||C))})]})]})}function we({isActive:s,isCompleted:t,isLoading:a,onAction:l,disabled:d,testProposals:c}){let g="simulation-host-step";s&&(g+=" simulation-host-step--active"),t&&(g+=" simulation-host-step--completed"),d&&!t&&(g+=" simulation-host-step--disabled");const f=c==null?void 0:c[0];return e.jsxs("div",{className:g,children:[e.jsxs("div",{className:"simulation-host-step__header",children:[e.jsx("span",{className:"simulation-host-step__number",children:"C"}),e.jsx("h3",{className:"simulation-host-step__title",children:"Counteroffer Rejected"}),t&&e.jsx("span",{className:"simulation-host-step__check",children:"‚úì"})]}),e.jsx("p",{className:"simulation-host-step__description",children:"Send a counteroffer to the first proposal. The guest will reject it (simulated)."}),s&&f&&e.jsx("div",{className:"simulation-host-step__info",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Proposal to counter:"})," ",f.rentalType]})}),!t&&e.jsx("button",{className:"simulation-host-step__button",onClick:l,disabled:d||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"simulation-host-spinner"}),"Sending Counteroffer..."]}):"üì§ Send Counteroffer"}),t&&e.jsxs("div",{className:"simulation-host-step__completed-message",children:[e.jsx("p",{children:"‚úÖ Counteroffer sent"}),e.jsx("p",{children:"‚ùå Guest rejected the counteroffer"})]})]})}function Ae({isActive:s,isCompleted:t,isLoading:a,onAction:l,disabled:d,testProposals:c,leaseId:g}){let f="simulation-host-step";s&&(f+=" simulation-host-step--active"),t&&(f+=" simulation-host-step--completed"),d&&!t&&(f+=" simulation-host-step--disabled");const j=(c==null?void 0:c[1])||(c==null?void 0:c[0]);return e.jsxs("div",{className:f,children:[e.jsxs("div",{className:"simulation-host-step__header",children:[e.jsx("span",{className:"simulation-host-step__number",children:"D"}),e.jsx("h3",{className:"simulation-host-step__title",children:"Accept & Create Lease"}),t&&e.jsx("span",{className:"simulation-host-step__check",children:"‚úì"})]}),e.jsx("p",{className:"simulation-host-step__description",children:"Accept a different proposal and create a lease document."}),s&&j&&e.jsx("div",{className:"simulation-host-step__info",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Proposal to accept:"})," ",j.rentalType]})}),!t&&e.jsx("button",{className:"simulation-host-step__button",onClick:l,disabled:d||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"simulation-host-spinner"}),"Creating Lease..."]}):"‚úÖ Accept & Create Lease"}),t&&e.jsxs("div",{className:"simulation-host-step__completed-message",children:[e.jsx("p",{children:"‚úÖ Proposal accepted"}),g&&e.jsxs("p",{children:["üìÑ Lease created: ",g.substring(0,8),"..."]})]})]})}function Re({isActive:s,isCompleted:t,isLoading:a,onAction:l,disabled:d}){let c="simulation-host-step";return s&&(c+=" simulation-host-step--active"),t&&(c+=" simulation-host-step--completed"),d&&!t&&(c+=" simulation-host-step--disabled"),e.jsxs("div",{className:c,children:[e.jsxs("div",{className:"simulation-host-step__header",children:[e.jsx("span",{className:"simulation-host-step__number",children:"E"}),e.jsx("h3",{className:"simulation-host-step__title",children:"Guest Request"}),t&&e.jsx("span",{className:"simulation-host-step__check",children:"‚úì"})]}),e.jsx("p",{className:"simulation-host-step__description",children:"The guest submits an early check-in request. You will approve it."}),!t&&e.jsx("button",{className:"simulation-host-step__button",onClick:l,disabled:d||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"simulation-host-spinner"}),"Processing Request..."]}):"üìù Handle Guest Request"}),t&&e.jsxs("div",{className:"simulation-host-step__completed-message",children:[e.jsx("p",{children:"üì® Guest requested: Early Check-in"}),e.jsx("p",{children:"‚úÖ Request approved"})]})]})}function Te({isActive:s,isCompleted:t,isLoading:a,onAction:l,disabled:d}){let c="simulation-host-step";return s&&(c+=" simulation-host-step--active"),t&&(c+=" simulation-host-step--completed"),d&&!t&&(c+=" simulation-host-step--disabled"),e.jsxs("div",{className:c,children:[e.jsxs("div",{className:"simulation-host-step__header",children:[e.jsx("span",{className:"simulation-host-step__number",children:"F"}),e.jsx("h3",{className:"simulation-host-step__title",children:"Complete Stay"}),t&&e.jsx("span",{className:"simulation-host-step__check",children:"‚úì"})]}),e.jsx("p",{className:"simulation-host-step__description",children:"Mark the stay as complete and exchange reviews with the guest."}),!t&&e.jsx("button",{className:"simulation-host-step__button",onClick:l,disabled:d||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"simulation-host-spinner"}),"Completing Stay..."]}):"üèÅ Complete Stay & Reviews"}),t&&e.jsxs("div",{className:"simulation-host-step__completed-message",children:[e.jsx("p",{children:"‚úÖ Stay marked as complete"}),e.jsx("p",{children:"‚≠ê Reviews exchanged (5 stars each)"})]})]})}function Fe({testGuestName:s,proposalCount:t,onCleanup:a,isLoading:l}){return e.jsxs("div",{className:"simulation-host-complete",children:[e.jsx("div",{className:"simulation-host-complete__icon",children:"üéâ"}),e.jsx("h2",{className:"simulation-host-complete__title",children:"Simulation Complete!"}),e.jsx("p",{className:"simulation-host-complete__message",children:"Congratulations! You have successfully completed the host-side proposal workflow simulation."}),e.jsxs("div",{className:"simulation-host-complete__summary",children:[e.jsx("h3",{children:"Summary"}),e.jsxs("ul",{children:[e.jsx("li",{children:"‚úÖ Marked as usability tester"}),e.jsxs("li",{children:["üì• Received ",t," proposals from ",s||"Test Guest"]}),e.jsx("li",{children:"üì§ Sent counteroffer (rejected by guest)"}),e.jsx("li",{children:"‚úÖ Accepted proposal & created lease"}),e.jsx("li",{children:"üìù Handled guest request"}),e.jsx("li",{children:"üèÅ Completed stay with reviews"})]})]}),e.jsx("div",{className:"simulation-host-complete__actions",children:e.jsx("button",{className:"simulation-host-complete__cleanup-button",onClick:a,disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"simulation-host-spinner"}),"Cleaning Up..."]}):"üßπ Clean Up & Start Over"})}),e.jsx("p",{className:"simulation-host-complete__note",children:'Clicking "Clean Up" will remove all test data created during this simulation.'})]})}function Ee({message:s="Loading..."}){return e.jsxs("div",{className:"simulation-host-loading",children:[e.jsx("div",{className:"simulation-host-loading__spinner"}),e.jsx("p",{className:"simulation-host-loading__message",children:s})]})}function He({onLogin:s}){return e.jsxs("div",{className:"simulation-host-login-prompt",children:[e.jsx("h2",{children:"Authentication Required"}),e.jsx("p",{children:"Please log in as a host to start the simulation."}),e.jsx("button",{className:"simulation-host-login-button",onClick:s,children:"Log In to Continue"})]})}function Ge(){return e.jsxs("div",{className:"simulation-host-not-host",children:[e.jsx("h2",{children:"Host Account Required"}),e.jsx("p",{children:"This simulation is for hosts only. Please log in with a host account."}),e.jsx("a",{href:"/",className:"simulation-host-home-link",children:"Return to Home"})]})}function Me(){return e.jsxs("div",{className:"simulation-host-no-listings",children:[e.jsx("h2",{children:"No Listings Found"}),e.jsx("p",{children:"You need at least one published listing to run this simulation."}),e.jsx("a",{href:"/self-listing",className:"simulation-host-create-listing-link",children:"Create a Listing"})]})}function De({toast:s,onDismiss:t}){if(!s)return null;const a=`simulation-host-toast--${s.type||"info"}`;return e.jsxs("div",{className:`simulation-host-toast ${a}`,onClick:t,children:[e.jsx("strong",{className:"simulation-host-toast__title",children:s.title}),s.message&&e.jsx("p",{className:"simulation-host-toast__message",children:s.message})]})}function qe(){const s=ye();return s.authState.isChecking?e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsx("main",{className:"main-content",children:e.jsx("div",{className:"simulation-host-page",children:e.jsx(Ee,{message:"Checking authentication..."})})}),e.jsx(B,{})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsx("main",{className:"main-content",children:e.jsxs("div",{className:"simulation-host-page",children:[e.jsxs("div",{className:"simulation-host-warning",children:[e.jsx("span",{className:"simulation-host-warning__icon",children:"‚ö†Ô∏è"}),e.jsx("span",{children:"Please keep this page open. Progress is saved automatically."})]}),e.jsx(Ce,{currentUser:s.currentUser,currentDateTime:s.currentDateTime}),s.isAuthenticated?s.isHost?s.hostListings.length===0?e.jsx(Me,{}):s.currentStep==="pre-start"?e.jsxs("div",{className:"simulation-host-setup",children:[e.jsx(ke,{listings:s.hostListings,selectedListing:s.selectedListing,onSelect:s.handleSelectListing}),e.jsx(ve,{confirmed:s.mobileConfirmed,onChange:s.handleMobileConfirmChange,onStart:s.handleStartSimulation,isLoading:s.isLoading,disabled:!s.selectedListing})]}):s.currentStep==="complete"?e.jsx(Fe,{testGuestName:s.testGuestName,proposalCount:s.testProposals.length,onCleanup:s.handleCleanup,isLoading:s.isLoading}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{currentStep:s.currentStep,completedSteps:s.completedSteps,steps:s.SIMULATION_STEPS,stepOrder:s.STEP_ORDER}),e.jsxs("div",{className:"simulation-host-steps",children:[e.jsx(Le,{isActive:s.currentStep==="A",isCompleted:s.completedSteps.includes("A"),isLoading:s.stepInProgress==="A",onAction:s.handleStepA,disabled:!s.canActivateStep("A")}),e.jsx(Pe,{isActive:s.currentStep==="B",isCompleted:s.completedSteps.includes("B"),isLoading:s.stepInProgress==="B",onAction:s.handleStepB,disabled:!s.canActivateStep("B"),selectedRentalType:s.selectedRentalType,onSelectRentalType:s.handleSelectRentalType,rentalTypes:s.RENTAL_TYPES,testProposals:s.testProposals,testGuestName:s.testGuestName}),e.jsx(we,{isActive:s.currentStep==="C",isCompleted:s.completedSteps.includes("C"),isLoading:s.stepInProgress==="C",onAction:s.handleStepC,disabled:!s.canActivateStep("C"),testProposals:s.testProposals}),e.jsx(Ae,{isActive:s.currentStep==="D",isCompleted:s.completedSteps.includes("D"),isLoading:s.stepInProgress==="D",onAction:s.handleStepD,disabled:!s.canActivateStep("D"),testProposals:s.testProposals,leaseId:s.testLeaseId}),e.jsx(Re,{isActive:s.currentStep==="E",isCompleted:s.completedSteps.includes("E"),isLoading:s.stepInProgress==="E",onAction:s.handleStepE,disabled:!s.canActivateStep("E")}),e.jsx(Te,{isActive:s.currentStep==="F",isCompleted:s.completedSteps.includes("F"),isLoading:s.stepInProgress==="F",onAction:s.handleStepF,disabled:!s.canActivateStep("F")})]}),e.jsx("div",{className:"simulation-host-cleanup-section",children:e.jsx("button",{className:"simulation-host-cleanup-button",onClick:s.handleCleanup,disabled:s.isLoading,children:"üßπ Reset & Clean Up Test Data"})})]}):e.jsx(Ge,{}):e.jsx(He,{onLogin:s.handleLogin}),e.jsx(De,{toast:s.toast,onDismiss:s.dismissToast})]})}),e.jsx(B,{})]})}const Be=se(document.getElementById("root"));Be.render(e.jsx(qe,{}));

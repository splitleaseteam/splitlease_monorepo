import{N as i,O as u,P as d,Q as h,R as n,S as t}from"./auth-QZ4BJadW.js";import"./supabase-BoCLEw6R.js";import"./client-BJVKzfAi.js";let l=!1,c=null;function g(){const o=new URLSearchParams(window.location.hash.substring(1)).get("access_token"),e=new URLSearchParams(window.location.search).get("code");return!!(o||e)}async function p(){if(l)return console.log("[OAuth] Callback already processed in this session"),{processed:!1,reason:"already_processed"};const a=i(),o=u();if(!a&&!o)return{processed:!1,reason:"not_login_flow"};if(!g())return{processed:!1,reason:"no_tokens_in_url"};const s=o?"Google":"LinkedIn";console.log(`[OAuth] Detected ${s} OAuth login callback, processing...`),l=!0;try{await new Promise(r=>setTimeout(r,100));const e=o?await d():await h();if(c=e,e.success){if(console.log(`[OAuth] ${s} login callback processed successfully`),window.location.hash){const r=window.location.pathname+window.location.search;window.history.replaceState(null,"",r)}return window.dispatchEvent(new CustomEvent("oauth-login-success",{detail:e.data})),{processed:!0,success:!0,result:e.data}}else return e.userNotFound?(console.log(`[OAuth] User not found for ${s} OAuth login:`,e.email),window.dispatchEvent(new CustomEvent("oauth-login-user-not-found",{detail:{email:e.email}})),{processed:!0,success:!1,userNotFound:!0,email:e.email}):(console.log(`[OAuth] ${s} login callback failed:`,e.error),o?n():t(),window.dispatchEvent(new CustomEvent("oauth-login-error",{detail:{error:e.error}})),{processed:!0,success:!1,error:e.error})}catch(e){return console.error("[OAuth] Error processing callback:",e),o?n():t(),c={success:!1,error:e.message},window.dispatchEvent(new CustomEvent("oauth-login-error",{detail:{error:e.message}})),{processed:!0,success:!1,error:e.message}}}export{p as processOAuthLoginCallback};

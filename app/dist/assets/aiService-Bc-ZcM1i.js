import{s as p}from"./supabase-BoCLEw6R.js";async function w(e){var c,i;console.log("[aiService] Generating listing description with data:",e);const a=Array.isArray(e.amenitiesInsideUnit)?e.amenitiesInsideUnit.join(", "):e.amenitiesInsideUnit||"",r=Array.isArray(e.amenitiesOutsideUnit)?e.amenitiesOutsideUnit.join(", "):e.amenitiesOutsideUnit||"",t={listingName:e.listingName||"",address:e.address||"",neighborhood:e.neighborhood||"",typeOfSpace:e.typeOfSpace||"",bedrooms:e.bedrooms??"",beds:e.beds??"",bathrooms:e.bathrooms??"",kitchenType:e.kitchenType||"",amenitiesInsideUnit:a||"None specified",amenitiesOutsideUnit:r||"None specified"};console.log("[aiService] Calling ai-gateway with variables:",t);const{data:o,error:n}=await p.functions.invoke("ai-gateway",{body:{action:"complete",payload:{prompt_key:"listing-description",variables:t}}});if(n)throw console.error("[aiService] Edge Function error:",n),new Error(`Failed to generate description: ${n.message}`);if(!(o!=null&&o.success))throw console.error("[aiService] AI Gateway error:",o==null?void 0:o.error),new Error((o==null?void 0:o.error)||"Failed to generate description");return console.log("[aiService] Generated description:",(c=o.data)==null?void 0:c.content),((i=o.data)==null?void 0:i.content)||""}const u=["washer","dryer","w/d","laundry","dishwasher","terrace","balcony","patio","outdoor","backyard","garden","deck","rooftop","roof deck","doorman","concierge","gym","fitness","parking","garage","pool","swimming","elevator","exposed brick","high ceiling","skylight","fireplace","view","views"];function f(e){return Array.isArray(e)?[...e].sort((a,r)=>{const t=a.toLowerCase(),o=r.toLowerCase(),n=u.some(i=>t.includes(i)),c=u.some(i=>o.includes(i));return n&&!c?-1:!n&&c?1:0}):[]}const b=["Focus on the LOCATION - mention the neighborhood name prominently","Focus on the BEST AMENITY - lead with the most unique feature","Focus on the SPACE TYPE - emphasize what kind of space it is","Focus on the VIBE - capture the neighborhood character","Focus on LIFESTYLE - who would love living here"];async function S(e){var l;console.log("[aiService] Generating listing title with data:",e);const a=f(e.amenitiesInsideUnit||[]),r=f(e.amenitiesOutsideUnit||[]),t=a.slice(0,5).join(", "),o=r.slice(0,5).join(", "),n=b[Math.floor(Math.random()*b.length)],c={neighborhood:e.neighborhood||"",borough:e.borough||"",typeOfSpace:e.typeOfSpace||"",bedrooms:e.bedrooms??"",bathrooms:e.bathrooms??"",amenitiesInsideUnit:t||"None specified",amenitiesInBuilding:o||"None specified",variationHint:n};console.log("[aiService] Calling ai-gateway for title with variables:",c);const{data:i,error:h}=await p.functions.invoke("ai-gateway",{body:{action:"complete",payload:{prompt_key:"listing-title",variables:c}}});if(h)throw console.error("[aiService] Edge Function error:",h),new Error(`Failed to generate title: ${h.message}`);if(!(i!=null&&i.success))throw console.error("[aiService] AI Gateway error:",i==null?void 0:i.error),new Error((i==null?void 0:i.error)||"Failed to generate title");let d=((l=i.data)==null?void 0:l.content)||"";return d=d.trim().replace(/^["']|["']$/g,""),console.log("[aiService] Generated title:",d),d}async function v(e){var o,n;console.log("[aiService] Generating neighborhood description for address:",e);const a={address:e.fullAddress||"",city:e.city||"",state:e.state||"",zipCode:e.zip||""};console.log("[aiService] Calling ai-gateway for neighborhood with variables:",a);const{data:r,error:t}=await p.functions.invoke("ai-gateway",{body:{action:"complete",payload:{prompt_key:"neighborhood-description",variables:a}}});if(t)throw console.error("[aiService] Edge Function error:",t),new Error(`Failed to generate neighborhood description: ${t.message}`);if(!(r!=null&&r.success))throw console.error("[aiService] AI Gateway error:",r==null?void 0:r.error),new Error((r==null?void 0:r.error)||"Failed to generate neighborhood description");return console.log("[aiService] Generated neighborhood description:",(o=r.data)==null?void 0:o.content),((n=r.data)==null?void 0:n.content)||""}function I(){var a,r,t,o,n,c,i,h,d,l,g,m;const e=localStorage.getItem("selfListingDraft");if(!e)return console.warn("[aiService] No draft found in localStorage"),null;try{const s=JSON.parse(e);return{listingName:((a=s.spaceSnapshot)==null?void 0:a.listingName)||"",address:((t=(r=s.spaceSnapshot)==null?void 0:r.address)==null?void 0:t.fullAddress)||"",neighborhood:((n=(o=s.spaceSnapshot)==null?void 0:o.address)==null?void 0:n.neighborhood)||"",typeOfSpace:((c=s.spaceSnapshot)==null?void 0:c.typeOfSpace)||"",bedrooms:((i=s.spaceSnapshot)==null?void 0:i.bedrooms)??0,beds:((h=s.spaceSnapshot)==null?void 0:h.beds)??0,bathrooms:((d=s.spaceSnapshot)==null?void 0:d.bathrooms)??0,kitchenType:((l=s.spaceSnapshot)==null?void 0:l.typeOfKitchen)||"",amenitiesInsideUnit:((g=s.features)==null?void 0:g.amenitiesInsideUnit)||[],amenitiesOutsideUnit:((m=s.features)==null?void 0:m.amenitiesOutsideUnit)||[]}}catch(s){return console.error("[aiService] Error parsing draft from localStorage:",s),null}}export{w as a,S as b,I as e,v as g};

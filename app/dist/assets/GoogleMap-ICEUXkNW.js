import{r as m,j as e}from"./client-BJVKzfAi.js";import{C as ae,g as he}from"./constants-CPVJY5eo.js";import{s as se}from"./supabase-BoCLEw6R.js";import{X as Ne}from"./x-CrJVeoCh.js";import{c as le}from"./createLucideIcon-CgZZH2OU.js";import{C as Se}from"./chevron-right-DMpFmStq.js";import{M as Fe}from"./map-pin-Be7EkBk1.js";import{S as $e}from"./square-BGeZC4Cm.js";import{l}from"./auth-QZ4BJadW.js";import{f as De,e as Re}from"./supabaseUtils-B40jh603.js";import{c as Te}from"./ListingScheduleSelector-B9O1H-bT.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["path",{d:"M10 4 8 6",key:"1rru8s"}],["path",{d:"M17 19v2",key:"ts1sot"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"M7 19v2",key:"12npes"}],["path",{d:"M9 5 7.621 3.621A2.121 2.121 0 0 0 4 5v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5",key:"14ym8i"}]],Ae=le("bath",Ee);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]],ze=le("bed",Ge);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Ie=le("chevron-left",Be),Oe=({listingId:a,userId:p,initialFavorited:P=!1,onToggle:N,onRequireAuth:k,disabled:w=!1,size:I="medium",variant:V="overlay"})=>{const[S,R]=m.useState(P),[Z,O]=m.useState(!1),[T,q]=m.useState(!1);m.useEffect(()=>{R(P)},[P]);const Y=m.useCallback(async U=>{if(U.preventDefault(),U.stopPropagation(),w||T)return;if(!p){k&&k();return}const b=!S;R(b),O(!0),setTimeout(()=>O(!1),300),q(!0);try{const{data:f,error:y}=await se.from("user").select('"Favorited Listings"').eq("_id",p).single();if(y)throw y;const v=(f==null?void 0:f["Favorited Listings"])||[];let A;b?v.includes(a)?A=v:A=[...v,a]:A=v.filter(Q=>Q!==a);const{error:j}=await se.from("user").update({"Favorited Listings":A}).eq("_id",p);if(j)throw j;N&&N(b,a),console.log(`[FavoriteButton] ${b?"Added":"Removed"} listing ${a} ${b?"to":"from"} favorites`)}catch(f){console.error("[FavoriteButton] Error toggling favorite:",f),R(!b)}finally{q(!1)}},[a,p,S,T,w,N,k]),F={small:"favorite-button--small",medium:"favorite-button--medium",large:"favorite-button--large"}[I]||"favorite-button--medium",E={small:16,medium:20,large:24}[I]||20;return e.jsx("button",{type:"button",className:`favorite-button-shared ${F} ${V==="inline"?"favorite-button--inline":""} ${S?"favorited":""} ${Z?"animating":""} ${T?"loading":""}`,onClick:Y,disabled:w||T,"aria-label":S?"Remove from favorites":"Add to favorites",title:S?"Remove from favorites":"Add to favorites",children:e.jsx("svg",{width:E,height:E,viewBox:"0 0 24 24",fill:S?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"favorite-button-icon",children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})})};function _e({listing:a,onClose:p,isVisible:P,position:N={x:0,y:0},onMessageClick:k,isLoggedIn:w=!1,isFavorited:I=!1,onToggleFavorite:V,userId:S=null,onRequireAuth:R=null,showMessageButton:Z=!0}){var Q,W;const[O,T]=m.useState(0);if(!P||!a)return null;const q=x=>{x.stopPropagation(),T($=>$===0?a.images.length-1:$-1)},Y=x=>{x.stopPropagation(),T($=>($+1)%a.images.length)},F=a.id||a._id,E=()=>{const x=a.id||a._id;if(!x){console.error("[ListingCardForMap] No listing ID found",{listing:a});return}console.log("[ListingCardForMap] Opening listing:",x),window.open(`/view-split-lease/${x}`,"_blank")},U=x=>{x.preventDefault(),x.stopPropagation(),console.log("[ListingCardForMap] Message button clicked",{listingId:a.id,listingTitle:a.title,hasCallback:!!k}),k?k(a):console.warn("[ListingCardForMap] No onMessageClick callback provided")},b=x=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0}).format(x),f=(Q=a.images)==null?void 0:Q[O],y=((W=a.price)==null?void 0:W.starting)||a["Starting nightly price"]||0,v=a.bedrooms||0,A=a.bathrooms||0,j=a.squareFeet||0;return e.jsxs("div",{className:"listing-card-for-map-wrapper",style:{position:"absolute",left:`${N.x}px`,top:`${N.y}px`,transform:"translate(-50%, 0)",zIndex:1e3},onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"listing-card-for-map-container",children:[e.jsx("button",{className:"listing-card-close-btn",onClick:p,"aria-label":"Close listing information",children:e.jsx(Ne,{size:16,color:"#4D4D4D"})}),e.jsx(Oe,{listingId:F,userId:S,initialFavorited:I,onToggle:(x,$)=>{V&&V($,a.title,x)},onRequireAuth:R,size:"small"}),e.jsxs("div",{className:"listing-card-image-container",children:[a.isNew&&e.jsx("span",{className:"listing-card-new-badge",children:"NEW"}),e.jsx("img",{src:f,alt:`Photo of ${a.title}`,className:"listing-card-image",onClick:E}),a.images&&a.images.length>1&&e.jsxs("div",{className:"listing-card-gallery-controls",children:[e.jsx("button",{className:"listing-card-gallery-btn",onClick:q,"aria-label":"Previous photo",children:e.jsx(Ie,{size:20})}),e.jsx("button",{className:"listing-card-gallery-btn",onClick:Y,"aria-label":"Next photo",children:e.jsx(Se,{size:20})})]})]}),e.jsxs("div",{className:"listing-card-content",children:[e.jsxs("div",{className:"listing-card-header-row",children:[e.jsx("h3",{className:"listing-card-title",onClick:E,children:a.title}),e.jsxs("div",{className:"listing-card-price-section",children:[e.jsx("div",{className:"listing-card-price-highlight",children:b(y)}),e.jsx("div",{className:"listing-card-price-subtext",children:"per night"})]})]}),e.jsxs("div",{className:"listing-card-location",onClick:E,children:[e.jsx(Fe,{size:12}),a.location]}),e.jsxs("div",{className:"listing-card-features-row",children:[v>0&&e.jsxs("span",{className:"listing-card-feature-item",children:[e.jsx(ze,{size:12}),v," bd"]}),A>0&&e.jsxs("span",{className:"listing-card-feature-item",children:[e.jsx(Ae,{size:12}),A," ba"]}),j>0&&e.jsxs("span",{className:"listing-card-feature-item",children:[e.jsx($e,{size:12}),j.toLocaleString()," sqft"]})]}),e.jsx("div",{className:"listing-card-divider"}),e.jsxs("div",{className:"listing-card-action-row",children:[e.jsx("button",{className:"listing-card-view-details-btn",onClick:E,children:"View Details"}),Z&&e.jsx("button",{className:"listing-card-send-message-btn",onClick:U,children:"Message"})]})]})]}),e.jsx("div",{className:"listing-card-arrow"}),e.jsx("div",{className:"listing-card-arrow-border"})]})}const fe=m.memo(({showAllListings:a,onToggle:p})=>e.jsxs("div",{className:"map-legend",children:[e.jsx("div",{className:"legend-header",children:e.jsx("h4",{children:"Map Legend"})}),e.jsxs("div",{className:"legend-items",children:[e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-marker",style:{backgroundColor:ae.SECONDARY}}),e.jsx("span",{children:"Search Results"})]}),e.jsxs("div",{className:"legend-item",children:[e.jsx("span",{className:"legend-marker",style:{backgroundColor:ae.MUTED}}),e.jsx("span",{children:"All Active Listings"})]})]}),e.jsxs("label",{className:"legend-toggle",children:[e.jsx("input",{type:"checkbox",checked:a,onChange:P=>p(P.target.checked)}),e.jsx("span",{children:"Show all listings"})]})]}));fe.displayName="MapLegend";const ve=m.memo(({onAIResearchClick:a})=>a?e.jsxs("button",{className:"ai-research-button",onClick:p=>{p.stopPropagation(),a()},"aria-label":"Generate Market Report",children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 3v18M3 12h18"}),e.jsx("path",{d:"M5.6 5.6l12.8 12.8M18.4 5.6L5.6 18.4"}),e.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"currentColor"})]}),e.jsx("span",{children:"Generate Market Report"})]}):null);ve.displayName="AIResearchButton";const He=m.forwardRef(({listings:a=[],filteredListings:p=[],selectedListing:P=null,onMarkerClick:N=null,selectedBorough:k=null,simpleMode:w=!1,initialZoom:I=null,disableAutoZoom:V=!1,onAIResearchClick:S=null,onMessageClick:R=null,isLoggedIn:Z=!1,favoritedListingIds:O=new Set,onToggleFavorite:T=null,userId:q=null,onRequireAuth:Y=null,selectedNightsCount:F=0,showMessageButton:E=!0},U)=>{l.debug("üó∫Ô∏è GoogleMap: Component rendered with props:",{listingsCount:a.length,filteredListingsCount:p.length,selectedBorough:k,hasMessageCallback:!!R,messageCallbackType:typeof R,listingsSample:a.slice(0,2).map(t=>{var o,s;return{id:t.id,title:t.title,coordinates:t.coordinates,hasValidCoords:!!((o=t.coordinates)!=null&&o.lat&&((s=t.coordinates)!=null&&s.lng))}}),filteredListingsSample:p.slice(0,2).map(t=>{var o,s;return{id:t.id,title:t.title,coordinates:t.coordinates,hasValidCoords:!!((o=t.coordinates)!=null&&o.lat&&((s=t.coordinates)!=null&&s.lng))}})});const b=m.useRef(null),f=m.useRef(null),y=m.useRef([]),[v,A]=m.useState(!1),[j,Q]=m.useState(!0),W=m.useRef(null),x=m.useRef(null),$=m.useCallback(t=>{var o,s,g;if(F<1)return((o=t.price)==null?void 0:o.starting)||t["Starting nightly price"]||0;try{const d=Array(F).fill({nightNumber:0});return Te(d,t,13,null).pricePerNight||((s=t.price)==null?void 0:s.starting)||t["Starting nightly price"]||0}catch{return((g=t.price)==null?void 0:g.starting)||t["Starting nightly price"]||0}},[F]),[J,K]=m.useState(null),[oe,ee]=m.useState(!1),[re,ce]=m.useState({x:0,y:0}),[de,pe]=m.useState(!1);m.useImperativeHandle(U,()=>({highlightListing(t){if(!f.current||!v){l.error("Map not initialized yet");return}const o=p.find(c=>c.id===t)||a.find(c=>c.id===t);if(!o){l.error("Listing not found:",t);return}const s=o.coordinates;if(!s||!s.lat||!s.lng){l.error("Invalid coordinates for listing:",t);return}f.current.panTo({lat:s.lat,lng:s.lng});const d=y.current.find(c=>c.listingId===t);if(d&&d.div&&(y.current.forEach(c=>{c.div&&c.div.classList.remove("pulse")}),d.div.classList.add("pulse"),oe&&J)){const c=b.current;if(c&&d.div){const n=c.getBoundingClientRect(),u=d.div.getBoundingClientRect(),i=300,r=10,h=5,C=u.left-n.left+u.width/2,L=u.top-n.top-i-r-h;ce({x:C,y:L})}K(o)}},stopPulse(){y.current.forEach(t=>{t.div&&t.div.classList.remove("pulse")})},zoomToListing(t){if(!f.current||!v){l.error("Map not initialized yet");return}const o=p.find(h=>h.id===t)||a.find(h=>h.id===t);if(!o){l.error("Listing not found:",t);return}const s=o.coordinates;if(!s||!s.lat||!s.lng){l.error("Invalid coordinates for listing:",t);return}const g=f.current;let d=16;o.borough==="Manhattan"?d=17:(o.borough==="Staten Island"||o.borough==="Queens")&&(d=15);const c=new window.google.maps.LatLngBounds;c.extend({lat:s.lat,lng:s.lng});const n=b.current;n&&n.offsetHeight,g.fitBounds(c,{top:150,bottom:50,left:50,right:50}),window.google.maps.event.addListenerOnce(g,"bounds_changed",()=>{g.setZoom(d)});const r=y.current.find(h=>h.listingId===t);r&&r.div&&(r.div.classList.add("pulse"),setTimeout(()=>{r.div.classList.remove("pulse")},3e3),setTimeout(()=>{ge(o,r.div)},600))}}));const xe=async t=>{pe(!0);try{l.debug("üìä fetchDetailedListingData: Querying Supabase...");const{data:o,error:s}=await se.from("listing").select("*").eq("_id",t).single();if(s)throw l.error("‚ùå fetchDetailedListingData: Supabase error:",s),s;l.debug("‚úÖ fetchDetailedListingData: Listing data received:",{id:o._id,name:o.Name,borough:o["Location - Borough"]}),l.debug("üì∏ fetchDetailedListingData: Fetching photos...");const g=o["Features - Photos"],d=[];if(Array.isArray(g))d.push(...g);else if(typeof g=="string")try{const i=JSON.parse(g);Array.isArray(i)&&d.push(...i)}catch(i){l.error("üì∏ fetchDetailedListingData: Failed to parse photos field:",i)}l.debug("üì∏ fetchDetailedListingData: Extracted photo IDs:",d);const c=await De(d),n=Re(g,c,t);l.debug("üì∏ fetchDetailedListingData: Photos received:",n.length,"images");const u={id:o._id,title:o.Name,images:n,location:o["Location - Borough"],bedrooms:o["Features - Qty Bedrooms"]||0,bathrooms:o["Features - Qty Bathrooms"]||0,squareFeet:o["Features - SQFT Area"]||0,price:{starting:o["Standarized Minimum Nightly Price (Filter)"]||0},isNew:!1,isAvailable:o.Active||!1};return l.debug("‚úÖ fetchDetailedListingData: Detailed listing built:",u),u}catch(o){return l.error("‚ùå fetchDetailedListingData: Failed to fetch listing details:",o),null}finally{pe(!1)}},ge=m.useCallback(async(t,o,s={})=>{const{skipParentCallback:g=!1}=s;l.debug("üñ±Ô∏è handlePinClick (React callback): Pin clicked:",{listingId:t.id,listingTitle:t.title,skipParentCallback:g}),N&&!g&&N(t);const d=b.current;if(!d){l.error("‚ùå handlePinClick: Map container ref not available");return}const c=f.current,n=d.getBoundingClientRect(),u=o.getBoundingClientRect(),i=u.left-n.left+u.width/2,r=u.top-n.top,h=300,C=300,L=10,G=5,z=20;let D=i,B=r-C-L-G;const _=z+h/2,H=n.width-z-h/2;if(D=Math.max(_,Math.min(H,D)),B<z&&c&&t.coordinates){const te=C+L+G+z;n.height/2;const X=c.getProjection();if(X){const ne=c.getCenter(),ke=Math.pow(2,c.getZoom()),me=X.fromLatLngToPoint(ne),Ce=te-r+50,Me=new window.google.maps.Point(me.x,me.y-Ce/ke),je=X.fromPointToLatLng(Me);c.panTo(je),await new Promise(Pe=>setTimeout(Pe,350));const ie=o.getBoundingClientRect();B=ie.top-n.top-C-L-G;const Le=ie.left-n.left+ie.width/2;D=Math.max(_,Math.min(H,Le))}}ce({x:D,y:B}),ee(!0);let M;t.images&&t.images.length>0?(l.debug("‚úÖ handlePinClick: Listing already has images, using existing data:",{id:t.id,imageCount:t.images.length}),M=t):M=await xe(t.id),M&&M.images&&M.images.length>0?K(M):(l.error("‚ùå handlePinClick: Failed to get listing details or no images available, not showing card"),ee(!1))},[N]);x.current=ge,m.useEffect(()=>{const t=()=>{var d,c;if(l.debug("üó∫Ô∏è GoogleMap: Initializing map...",{mapRefExists:!!b.current,googleMapsLoaded:!!(window.google&&window.google.maps),simpleMode:w,hasFilteredListings:p.length>0,hasListings:a.length>0,mapAlreadyExists:!!f.current}),!b.current||!window.google){l.warn("‚ö†Ô∏è GoogleMap: Cannot initialize - missing mapRef or Google Maps API");return}if(f.current)return;let o,s;if(w&&(p.length===1||a.length===1)){const n=p[0]||a[0];(d=n==null?void 0:n.coordinates)!=null&&d.lat&&((c=n==null?void 0:n.coordinates)!=null&&c.lng)&&(o={lat:n.coordinates.lat,lng:n.coordinates.lng},s=I||17)}if(!o){const n=he("default");o=n.center,s=n.zoom}const g=new window.google.maps.Map(b.current,{center:o,zoom:s,mapTypeControl:!0,streetViewControl:!0,fullscreenControl:!0,zoomControl:!0,zoomControlOptions:{position:window.google.maps.ControlPosition.RIGHT_CENTER},styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]});f.current=g,W.current=null,A(!0)};if(window.google&&window.google.maps&&window.google.maps.ControlPosition)t();else return window.addEventListener("google-maps-loaded",t),()=>window.removeEventListener("google-maps-loaded",t)},[p,a,w,I]),m.useEffect(()=>{if(!v||!f.current)return;const t=`${a.map(s=>s.id).join(",")}-${p.map(s=>s.id).join(",")}-${j}`;if(W.current===t)return;W.current=t;function o(){y.current.forEach(c=>c.setMap(null)),y.current=[];const s=f.current,g=new window.google.maps.LatLngBounds;let d=!1;if(p&&p.length>0){l.debug(`üó∫Ô∏è GoogleMap: Starting ${w?"simple":"purple"} marker creation for filtered listings:`,p.length),l.debug("üó∫Ô∏è GoogleMap: First 3 filtered listings:",p.slice(0,3).map(i=>{var r,h;return{id:i.id,title:i.title,coordinates:i.coordinates,hasCoordinates:!!((r=i.coordinates)!=null&&r.lat&&((h=i.coordinates)!=null&&h.lng))}}));let c=0,n=0;const u=[];p.forEach((i,r)=>{var G,z,D,B,_,H,M;if(l.debug(`üó∫Ô∏è GoogleMap: [${r+1}/${p.length}] Processing filtered listing:`,{id:i.id,title:i.title,coordinates:i.coordinates,hasCoordinatesObject:!!i.coordinates,hasLat:((G=i.coordinates)==null?void 0:G.lat)!==void 0,hasLng:((z=i.coordinates)==null?void 0:z.lng)!==void 0,lat:(D=i.coordinates)==null?void 0:D.lat,lng:(B=i.coordinates)==null?void 0:B.lng}),!i.coordinates||!i.coordinates.lat||!i.coordinates.lng){l.error(`‚ùå GoogleMap: Skipping filtered listing ${i.id} - Missing or invalid coordinates:`,{coordinates:i.coordinates,hasCoordinates:!!i.coordinates,lat:(_=i.coordinates)==null?void 0:_.lat,lng:(H=i.coordinates)==null?void 0:H.lng}),n++,u.push({id:i.id,title:i.title,coordinates:i.coordinates});return}const h={lat:i.coordinates.lat,lng:i.coordinates.lng},C=$(i);l.debug(`‚úÖ GoogleMap: Creating ${w?"simple":"purple"} marker for listing ${i.id}:`,{position:h,displayPrice:C,startingPrice:((M=i.price)==null?void 0:M.starting)||i["Starting nightly price"],selectedNightsCount:F,title:i.title,simpleMode:w});const L=w?we(s,h,i):ue(s,h,C,ae.SECONDARY,i);y.current.push(L),g.extend(h),d=!0,c++,l.debug(`‚úÖ GoogleMap: ${w?"Simple":"Purple"} marker created successfully for ${i.id}, total markers so far: ${y.current.length}`)}),l.debug(`üìä GoogleMap: ${w?"Simple":"Purple"} marker creation summary:`,{totalFiltered:p.length,markersCreated:c,skippedNoCoordinates:n,skippedInvalidCoordinates:u.length,invalidListings:u})}if(j&&a&&a.length>0){l.debug("üó∫Ô∏è GoogleMap: Starting grey marker creation for all listings (background layer):",a.length),l.debug("üó∫Ô∏è GoogleMap: First 3 all listings:",a.slice(0,3).map(r=>{var h,C;return{id:r.id,title:r.title,coordinates:r.coordinates,hasCoordinates:!!((h=r.coordinates)!=null&&h.lat&&((C=r.coordinates)!=null&&C.lng))}}));let c=0,n=0,u=0;const i=[];a.forEach((r,h)=>{var D,B,_,H,M,te,X;if(p==null?void 0:p.some(ne=>ne.id===r.id)){l.debug(`‚è≠Ô∏è GoogleMap: [${h+1}/${a.length}] Skipping ${r.id} - Already shown as purple marker`),n++;return}if(l.debug(`üó∫Ô∏è GoogleMap: [${h+1}/${a.length}] Processing all listing:`,{id:r.id,title:r.title,coordinates:r.coordinates,hasCoordinatesObject:!!r.coordinates,hasLat:((D=r.coordinates)==null?void 0:D.lat)!==void 0,hasLng:((B=r.coordinates)==null?void 0:B.lng)!==void 0,lat:(_=r.coordinates)==null?void 0:_.lat,lng:(H=r.coordinates)==null?void 0:H.lng}),!r.coordinates||!r.coordinates.lat||!r.coordinates.lng){l.error(`‚ùå GoogleMap: Skipping all listing ${r.id} - Missing or invalid coordinates:`,{coordinates:r.coordinates,hasCoordinates:!!r.coordinates,lat:(M=r.coordinates)==null?void 0:M.lat,lng:(te=r.coordinates)==null?void 0:te.lng}),u++,i.push({id:r.id,title:r.title,coordinates:r.coordinates});return}const L={lat:r.coordinates.lat,lng:r.coordinates.lng},G=$(r);l.debug(`‚úÖ GoogleMap: Creating grey marker for listing ${r.id}:`,{position:L,displayPrice:G,startingPrice:((X=r.price)==null?void 0:X.starting)||r["Starting nightly price"],selectedNightsCount:F,title:r.title});const z=ue(s,L,G,ae.MUTED,r);y.current.push(z),g.extend(L),d=!0,c++,l.debug(`‚úÖ GoogleMap: Grey marker created successfully for ${r.id}, total markers so far: ${y.current.length}`)}),l.debug("üìä GoogleMap: Grey marker creation summary:",{totalAllListings:a.length,markersCreated:c,skippedAlreadyFiltered:n,skippedNoCoordinates:u,skippedInvalidCoordinates:i.length,invalidListings:i})}else l.debug("‚ö†Ô∏è GoogleMap: No all listings to create grey markers for (showAllListings:",j,", listings.length:",a==null?void 0:a.length,")");if(d){if(!(w&&y.current.length===1)){if(!V&&(s.fitBounds(g),!I)){const c=window.google.maps.event.addListener(s,"idle",()=>{s.getZoom()>16&&s.setZoom(16),window.google.maps.event.removeListener(c)})}}}else l.warn("‚ö†Ô∏è GoogleMap: No valid markers to display")}o()},[a,p,v,j,F,$]),m.useEffect(()=>{if(!v||!f.current||!k)return;const t=he(k),o=f.current;o.panTo(t.center),o.setZoom(t.zoom),l.debug(`‚úÖ GoogleMap: Map recentered to ${t.name}`)},[k,v]),m.useEffect(()=>{},[P,v]);const we=(t,o,s)=>{const g=new window.google.maps.Marker({position:{lat:o.lat,lng:o.lng},map:t,title:"",animation:window.google.maps.Animation.DROP});return g.listingId=s.id,l.debug("‚úÖ GoogleMap: Simple marker created successfully for listing:",{id:s.id,title:s.title,position:{lat:o.lat,lng:o.lng}}),g},ue=(t,o,s,g,d)=>{const c=new window.google.maps.OverlayView;c.onAdd=function(){const n=document.createElement("div");n.innerHTML=`$${parseFloat(s).toFixed(2)}`,n.className="map-price-marker",n.dataset.color=g,n.style.cssText=`
        position: absolute;
        left: 0;
        top: 0;
        background: ${g};
        color: white;
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 14px;
        font-family: 'Inter', sans-serif;
        white-space: nowrap;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        cursor: pointer;
        transition: background-color 0.2s ease;
        transform: translate(-50%, -50%);
        z-index: ${g==="#5B21B6"?"1002":"1001"};
        will-change: transform;
        pointer-events: auto;
        display: block;
        visibility: visible;
        opacity: 1;
        min-width: 50px;
        text-align: center;
      `;const u=(r,h)=>{f.current&&(h?n.style.zIndex=String(window.google.maps.Marker.MAX_ZINDEX+1):n.style.zIndex=g==="#5B21B6"?"1002":"1001")};n.addEventListener("mouseenter",()=>u(d,!0)),n.addEventListener("mouseleave",()=>u(d,!1)),n.addEventListener("click",r=>{r.stopPropagation(),x.current&&x.current(d,n)}),this.div=n,this.getPanes().overlayMouseTarget.appendChild(n),l.debug("üìç MarkerOverlay.onAdd: marker appended to DOM",{listingId:d.id,price:s,innerHTML:n.innerHTML,paneType:"overlayMouseTarget",divExists:!!this.div})},c.draw=function(){if(!this.div){l.warn("üìç MarkerOverlay.draw: div not found for listing:",d.id);return}const n=this.getProjection();if(!n){l.warn("üìç MarkerOverlay.draw: projection not available for listing:",d.id);return}const u=n.fromLatLngToDivPixel(new window.google.maps.LatLng(o.lat,o.lng));l.debug("üìç MarkerOverlay.draw: positioning marker",{listingId:d.id,coordinates:{lat:o.lat,lng:o.lng},pixelPosition:u?{x:u.x,y:u.y}:null}),this.div&&u&&(this.div.style.transform=`translate3d(${u.x}px, ${u.y}px, 0) translate(-50%, -50%)`,this.div.style.left="0px",this.div.style.top="0px")},c.onRemove=function(){this.div&&(this.div.parentNode.removeChild(this.div),this.div=null)};try{c.setMap(t),c.listingId=d.id,l.debug("üìç createPriceMarker: marker set on map",{listingId:d.id,hasDiv:!!c.div,mapSet:c.getMap()===t})}catch(n){l.error("üìç createPriceMarker: error setting map",{listingId:d.id,error:n.message})}return c},be=()=>{ee(!1),K(null)},ye=m.useCallback(t=>{Q(t)},[]);return e.jsxs("div",{className:"google-map-container",children:[e.jsx("div",{ref:b,className:"google-map",style:{width:"100%",height:"100%",minHeight:"500px",borderRadius:"12px"},onClick:be}),v&&!w&&e.jsx(fe,{showAllListings:j,onToggle:ye}),v&&!w&&e.jsx(ve,{onAIResearchClick:S}),!v&&e.jsxs("div",{className:"map-loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading map..."})]}),null,v&&oe&&!w&&e.jsxs(e.Fragment,{children:[de&&e.jsxs("div",{style:{position:"absolute",left:`${re.x}px`,top:`${re.y}px`,transform:"translate(-50%, 0)",background:"white",padding:"20px",borderRadius:"12px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.15)",zIndex:1e3},children:[e.jsx("div",{className:"spinner",style:{margin:"0 auto"}}),e.jsx("p",{style:{margin:"10px 0 0 0",textAlign:"center"},children:"Loading listing details..."})]}),!de&&J&&(()=>{const t=J.id||J._id;return e.jsx(_e,{listing:J,onClose:()=>{ee(!1),K(null)},isVisible:oe,position:re,onMessageClick:R,isLoggedIn:Z,isFavorited:O==null?void 0:O.has(t),onToggleFavorite:T,userId:q,onRequireAuth:Y,showMessageButton:E})})()]})]})});He.displayName="GoogleMap";export{Oe as F,He as G};

import{r as c,j as r}from"./client-BJVKzfAi.js";import{s as F,d as se,b as ne,g as ae,e as oe,c as ie,f as le,h as ce,i as ue}from"./nightCalculations-BvAtd4RD.js";const de={6:1.5,7:1.75,8:2,9:2.25,10:2.5,12:3,13:3.25,16:4,17:4.25,20:5,22:5.5,26:6.5},he=(t,e,s=13,a=null)=>{const l=t.length;if(console.log("=== CALCULATE PRICE ==="),console.log("nightsCount:",l),console.log("listing rental type:",(e==null?void 0:e["rental type"])||(e==null?void 0:e.rentalType)),console.log("reservationSpan:",s),l===0)return ke();const d=a||{overallSiteMarkup:.17,weeklyMarkup:0,fullTimeDiscount:.13,unusedNightsDiscountMultiplier:.03,avgDaysPerMonth:31},i=e.rentalType||e["rental type"]||"Nightly",h=e.weeksOffered||e["Weeks offered"]||"Every week",n=parseFloat(e.unitMarkup||e["ðŸ’°Unit Markup"]||0)/100,m=parseFloat(e.cleaningFee||e["ðŸ’°Cleaning Cost / Maintenance Fee"]||0),k=parseFloat(e.damageDeposit||e["ðŸ’°Damage Deposit"]||0);let u=0,o=0,g=0;if(i==="Monthly"){const f=fe(l,e,s,d,n,h);u=f.pricePerNight,o=f.fourWeekRent,g=f.reservationTotal}else if(i==="Weekly"){const f=me(l,e,s,d,n,h);u=f.pricePerNight,o=f.fourWeekRent,g=f.reservationTotal}else{const f=ye(l,e,s,d,h);u=f.pricePerNight,o=f.fourWeekRent,g=f.reservationTotal}const N=o+m+k;return console.log("=== PRICE CALCULATION RESULT ==="),console.log("pricePerNight:",u),console.log("fourWeekRent:",o),console.log("reservationTotal:",g),console.log("initialPayment:",N),{basePrice:o,nightlyRate:Math.round(u*100)/100,discountAmount:0,markupAmount:0,totalPrice:g,pricePerNight:Math.round(u*100)/100,numberOfNights:l,fourWeekRent:Math.round(o),reservationTotal:Math.round(g),initialPayment:Math.round(N),cleaningFee:m,damageDeposit:k,rentalType:i,weeksOffered:h,reservationSpan:s,valid:!0}};function fe(t,e,s,a,l,d){const i=parseFloat(e.monthlyHostRate||e["ðŸ’°Monthly Host Rate"]||0);if(!i)return{pricePerNight:0,fourWeekRent:0,reservationTotal:0};const h=i/a.avgDaysPerMonth,n=h*7,m=n/t,k=7-t,u=k*a.unusedNightsDiscountMultiplier,o=a.overallSiteMarkup+l-u+1,g=m*t*o,N=g/t,f=J(d),p=N*t*4/f,v=z(N,t,s,d);return console.log("Monthly calculation:",{monthlyAvgNightly:h,averageWeeklyPrice:n,nightlyHostRate:m,unusedNights:k,unusedNightsDiscountValue:u,multiplier:o,totalWeeklyPrice:g,pricePerNight:N,weeklySchedulePeriod:f,fourWeekRent:p,reservationTotal:v}),{pricePerNight:N,fourWeekRent:p,reservationTotal:v}}function me(t,e,s,a,l,d){const i=parseFloat(e.weeklyHostRate||e["ðŸ’°Weekly Host Rate"]||0);if(!i)return{pricePerNight:0,fourWeekRent:0,reservationTotal:0};const h=i/t,m=(7-t)*a.unusedNightsDiscountMultiplier,k=a.overallSiteMarkup+l-m+a.weeklyMarkup+1,o=h*t*k/t,g=J(d),N=o*t*4/g,f=z(o,t,s,d);return{pricePerNight:o,fourWeekRent:N,reservationTotal:f}}function ye(t,e,s,a,l){const d=Ne(t,e);if(!d)return{pricePerNight:0,fourWeekRent:0,reservationTotal:0};const i=d*t,h=t===7?i*a.fullTimeDiscount:0,m=(i-h)*a.overallSiteMarkup,u=(i-h+m)/t,o=J(l),g=u*t*4/o,N=z(u,t,s,l);return{pricePerNight:u,fourWeekRent:g,reservationTotal:N}}function z(t,e,s,a){const l=ge(a),d=de[s]||s/4,i=Math.ceil(l*d);return t*e*i}function J(t){const e=(t||"every week").toLowerCase();return e.includes("1 on 1 off")||e.includes("1on1off")||e.includes("one week on")&&e.includes("one week off")||e.includes("1 week on")&&e.includes("1 week off")||e.includes("2 on 2 off")||e.includes("2on2off")||e.includes("two week")&&e.includes("two week")||e.includes("2 week on")&&e.includes("2 week off")?2:e.includes("1 on 3 off")||e.includes("1on3off")||e.includes("one week on")&&e.includes("three week")||e.includes("1 week on")&&e.includes("3 week off")?4:1}function ge(t){const e=(t||"every week").toLowerCase();return e.includes("1 on 1 off")||e.includes("1on1off")||e.includes("one week on")&&e.includes("one week off")||e.includes("1 week on")&&e.includes("1 week off")||e.includes("2 on 2 off")||e.includes("2on2off")||e.includes("two week")&&e.includes("two week")||e.includes("2 week on")&&e.includes("2 week off")?2:e.includes("1 on 3 off")||e.includes("1on3off")||e.includes("one week on")&&e.includes("three week")||e.includes("1 week on")&&e.includes("3 week off")?1:4}function Ne(t,e){const s={1:e.nightlyHostRateFor1Night||e["ðŸ’°Nightly Host Rate for 1 night"],2:e.nightlyHostRateFor2Nights||e["ðŸ’°Nightly Host Rate for 2 nights"],3:e.nightlyHostRateFor3Nights||e["ðŸ’°Nightly Host Rate for 3 nights"],4:e.nightlyHostRateFor4Nights||e["ðŸ’°Nightly Host Rate for 4 nights"],5:e.nightlyHostRateFor5Nights||e["ðŸ’°Nightly Host Rate for 5 nights"],7:e.nightlyHostRateFor7Nights||e["ðŸ’°Nightly Host Rate for 7 nights"]},a=parseFloat(s[t]||0);return!a||a===0?parseFloat(e["ðŸ’°Nightly Host Rate for 4 nights"]||0):a}function ke(){return{basePrice:0,nightlyRate:0,discountAmount:0,markupAmount:0,totalPrice:0,pricePerNight:0,numberOfNights:0,fourWeekRent:0,reservationTotal:0,initialPayment:0,cleaningFee:0,damageDeposit:0,valid:!1}}const pe=(t,e,s)=>{if(e.some(l=>l.dayOfWeek===t.dayOfWeek))return{isValid:!1,error:"Day already selected"};if(e.length>=7)return{isValid:!1,error:"Maximum 7 days can be selected"};if(!s.daysAvailable.includes(t.dayOfWeek))return{isValid:!1,error:"Day not available for this listing"};if(!t.isAvailable)return{isValid:!1,error:"This day is not available"};const a=F([...e,t]);return a.length>1&&!K(a)?{isValid:!1,error:"Days must be consecutive"}:s.maximumNights&&e.length>=s.maximumNights?{isValid:!1,error:`Maximum ${s.maximumNights} days allowed by host`}:{isValid:!0}},xe=(t,e,s)=>{const a=e.filter(d=>d.dayOfWeek!==t.dayOfWeek);return a.length-1<s?{isValid:!1,error:`Minimum ${s+1} days required`}:a.length>1&&!K(a)?{isValid:!1,error:"Removal would create non-consecutive selection"}:{isValid:!0}},K=t=>{if(t.length<=1)return!0;const s=F(t).map(i=>i.dayOfWeek);if(s.length>=6)return!0;const a=s.includes(0),l=s.includes(6);if(a&&l){const h=[0,1,2,3,4,5,6].filter(o=>!s.includes(o));if(h.length===0)return!0;const n=Math.min(...h),m=Math.max(...h),k=[];for(let o=n;o<=m;o++)k.push(o);return h.length===k.length&&h.every((o,g)=>o===k[g])}let d=!0;for(let i=0;i<s.length-1;i++)if(s[i+1]-s[i]!==1){d=!1;break}return d},ve=({listing:t,initialSelectedDays:e=[],limitToFiveNights:s=!1,reservationSpan:a=13,zatConfig:l=null,onSelectionChange:d,onPriceChange:i,onScheduleChange:h})=>{const[n,m]=c.useState(e),[k,u]=c.useState({hasError:!1,errorType:null,errorMessage:""});c.useEffect(()=>{e&&e.length>0&&(console.log("ðŸ“… useScheduleSelector: Syncing with initialSelectedDays:",e.map(y=>y.name||y.dayOfWeek)),m(e))},[e]);const[o,g]=c.useState(!0),[N,f]=c.useState(!1),[p,v]=c.useState(!1),[O,_]=c.useState(!1),[P,H]=c.useState(!1),[w,Q]=c.useState(!1),D=c.useMemo(()=>se(t.daysAvailable),[t.daysAvailable]),b=c.useMemo(()=>ne(n),[n]),L=c.useMemo(()=>ae(D,n),[D,n]),{checkIn:j,checkOut:V}=c.useMemo(()=>oe(n),[n]),S=c.useMemo(()=>ie(n),[n]),{startNightNumber:I,endNightNumber:U}=c.useMemo(()=>le(n),[n]),E=c.useMemo(()=>K(n),[n]),M=c.useMemo(()=>he(b,t,a,l),[b,t,a,l]),$=c.useMemo(()=>{const y=ce(D);return ue(y,b)},[D,b]),q=c.useMemo(()=>({selectedDays:n,notSelectedDays:L,selectedNights:b,unusedNights:$,selectedCheckinDays:n.filter((y,T)=>T===0),checkInDay:j,checkOutDay:V,startNight:I,endNight:U,startDayNumber:(j==null?void 0:j.dayOfWeek)??null,nightsCount:S,isContiguous:E,acceptableSchedule:p,autobindListing:O,limitToFiveNights:s,recalculateState:N,actualWeeksDaysAM:[],actualWeeksDaysPM:[],changeListings:[],changePricing:"",labels:[],listingNightlyN:[],monthly:[],priceMultiplier:[],numberOfMonths:null,otherReservation:[],proratedNights:[],reservationSpecificDays:[],guestDesiredUserDate:[],fourWeekRent:M.fourWeekRent?[M.fourWeekRent]:[],totalReservation:[M.totalPrice],listingMaximumNights:t.maximumNights}),[n,L,b,$,j,V,I,U,S,E,p,O,s,N,M,t.maximumNights]);c.useEffect(()=>{d==null||d(n)},[n]),c.useEffect(()=>{console.log("useEffect onPriceChange - priceBreakdown:",M),console.log("useEffect onPriceChange - callback exists:",!!i),i==null||i(M)},[M]),c.useEffect(()=>{h==null||h(q)},[q]);const G=c.useCallback(y=>{if(!o)return!1;const T=s?5:t.maximumNights,A={...t,maximumNights:T},x=pe(y,n,A);if(!x.isValid){const C=x.error&&x.error.includes("Maximum");if(C&&!P)return u({hasError:!0,errorType:"maximum_nights_warning",errorMessage:x.error||"Cannot select this day"}),H(!0),!1;if(C&&P){const R=F([...n,y]);return m(R),f(!0),!0}else return u({hasError:!0,errorType:"availability",errorMessage:x.error||"Cannot select this day"}),!1}const W=F([...n,y]);return m(W),u({hasError:!1,errorType:null,errorMessage:""}),f(!0),!0},[n,t,o,s,P]),Y=c.useCallback(y=>{if(!o)return!1;const A=n.filter(R=>R.dayOfWeek!==y.dayOfWeek).length-1,x=2;if(A<x)return u({hasError:!0,errorType:"absolute_minimum",errorMessage:`Minimum ${x} nights (${x+1} days) required`}),!1;const W=xe(y,n,t.minimumNights);if(!W.isValid){const R=W.error&&W.error.toLowerCase().includes("minimum");if(R&&!w)return u({hasError:!0,errorType:"minimum_nights_warning",errorMessage:W.error||"Cannot remove this day"}),Q(!0),!1;if(R&&w){const te=n.filter(re=>re.dayOfWeek!==y.dayOfWeek);return m(te),f(!0),!0}else return u({hasError:!0,errorType:"validation",errorMessage:W.error||"Cannot remove this day"}),!1}const C=n.filter(R=>R.dayOfWeek!==y.dayOfWeek);return m(C),u({hasError:!1,errorType:null,errorMessage:""}),f(!0),!0},[n,t.minimumNights,o,w]),X=c.useCallback(y=>n.some(A=>A.dayOfWeek===y.dayOfWeek)?Y(y):G(y),[n,G,Y]),Z=c.useCallback(()=>{m([]),u({hasError:!1,errorType:null,errorMessage:""}),f(!0),H(!1),Q(!1)},[]),B=c.useCallback(()=>{u({hasError:!1,errorType:null,errorMessage:""})},[]),ee=c.useCallback(y=>{g(y)},[]);return c.useEffect(()=>{const y=n.length>=2&&E&&S>=t.minimumNights;v(y)},[n,E,S,t.minimumNights]),{selectedDays:n,selectedNights:b,notSelectedDays:L,unusedNights:$,checkInDay:j,checkOutDay:V,startNight:I,endNight:U,nightsCount:S,priceBreakdown:M,errorState:k,isClickable:o,isContiguous:E,acceptableSchedule:p,recalculateState:N,scheduleState:q,allDays:D,handleDayClick:X,handleDaySelect:G,handleDayRemove:Y,clearSelection:Z,clearError:B,setClickableState:ee,setRecalculateState:f,setAutobindListing:_}};function Me({day:t,isSelected:e,isClickable:s,onClick:a}){const l=()=>{t.isAvailable&&s&&a(t)},d=["day-button",e&&"selected",!t.isAvailable&&"disabled",!s&&"not-clickable"].filter(Boolean).join(" ");return r.jsx("button",{className:d,onClick:l,disabled:!t.isAvailable||!s,title:t.name,"aria-label":`${t.name}, ${e?"selected":"not selected"}`,"aria-pressed":e,type:"button",children:r.jsx("span",{children:t.singleLetter})})}function Re({errorState:t,onClose:e}){if(!t.hasError)return null;const s=()=>{switch(t.errorType){case"minimum_nights":return"Minimum Days Required";case"maximum_nights":return"Maximum Days Exceeded";case"maximum_nights_warning":return"Host Preference Notice";case"contiguity":return"Days Not Consecutive";case"availability":return"Day Not Available";case"days_selected":return"Invalid Selection";case"nights_outside_host":return"Outside Host Availability";default:return"Error"}},a=()=>t.errorType==="maximum_nights_warning"?"You can continue selecting more days, but please note that exceeding the host's preferred maximum may reduce the likelihood of your reservation being approved.":null;return r.jsx("div",{className:"error-overlay-backdrop",children:r.jsxs("div",{className:"error-overlay",onClick:l=>l.stopPropagation(),children:[r.jsx("div",{className:"error-header",children:r.jsx("h3",{children:s()})}),r.jsxs("div",{className:"error-content",children:[r.jsx("p",{children:t.errorMessage}),a()&&r.jsx("p",{className:"error-additional-info",children:a()})]}),r.jsx("div",{className:"error-actions",children:r.jsx("button",{className:"error-button",onClick:e,children:"I Understand"})})]})})}function Pe({priceBreakdown:t,currency:e="USD"}){if(t.numberOfNights===0)return null;const s=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:e}).format(a);return r.jsxs("div",{className:"price-display",children:[r.jsx("h4",{children:"Price Breakdown"}),r.jsxs("div",{className:"price-row",children:[r.jsxs("span",{children:["Base Price (",t.numberOfNights," nights):"]}),r.jsx("span",{children:s(t.basePrice)})]}),r.jsxs("div",{className:"price-row",children:[r.jsx("span",{children:"Nightly Rate:"}),r.jsx("span",{children:s(t.nightlyRate)})]}),t.discountAmount>0&&r.jsxs("div",{className:"price-row discount",children:[r.jsx("span",{children:"Discounts:"}),r.jsxs("span",{children:["-",s(t.discountAmount)]})]}),t.markupAmount>0&&r.jsxs("div",{className:"price-row markup",children:[r.jsx("span",{children:"Fees & Markups:"}),r.jsxs("span",{children:["+",s(t.markupAmount)]})]}),r.jsxs("div",{className:"price-row total",children:[r.jsx("span",{children:"Total Price:"}),r.jsx("span",{children:s(t.totalPrice)})]}),r.jsxs("div",{className:"price-row per-night",children:[r.jsx("span",{children:"Per Night:"}),r.jsx("span",{children:s(t.pricePerNight)})]}),t.fourWeekRent&&t.fourWeekRent>0&&r.jsxs("div",{className:"price-row",children:[r.jsx("span",{children:"4-Week Rent:"}),r.jsx("span",{children:s(t.fourWeekRent)})]}),t.initialPayment&&t.initialPayment>0&&r.jsxs("div",{className:"price-row initial-payment",children:[r.jsx("span",{children:"Initial Payment:"}),r.jsx("span",{children:s(t.initialPayment)})]})]})}function je({listing:t,initialSelectedDays:e=[],limitToFiveNights:s=!1,reservationSpan:a=13,zatConfig:l=null,onScheduleSave:d,onSelectionChange:i,onPriceChange:h,showPricing:n=!0}){const{selectedDays:m,allDays:k,nightsCount:u,priceBreakdown:o,errorState:g,isClickable:N,isContiguous:f,checkInDay:p,checkOutDay:v,handleDayClick:O,clearError:_}=ve({listing:t,initialSelectedDays:e,limitToFiveNights:s,reservationSpan:a,zatConfig:l,onSelectionChange:i,onPriceChange:h});return r.jsxs("div",{className:"listing-schedule-selector",children:[r.jsxs("div",{className:"selector-header",children:[r.jsx("h3",{children:"Weekly Schedule"}),r.jsx("p",{className:"selector-description",children:"Choose consecutive days for your stay"})]}),r.jsx("div",{className:"day-grid",children:k.map(P=>{const H=m.some(w=>w.dayOfWeek===P.dayOfWeek);return r.jsx(Me,{day:P,isSelected:H,isClickable:N,onClick:O},P.id)})}),r.jsx("div",{className:"selection-info",children:m.length>0&&r.jsxs(r.Fragment,{children:[m.length===7?r.jsx("div",{className:"info-row",children:r.jsx("span",{className:"info-value",children:r.jsx("strong",{children:"Full-time stay"})})}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"info-row",children:r.jsxs("span",{className:"info-value",children:[r.jsxs("strong",{children:[m.length," days, ",u," nights"]})," Selected"]})}),r.jsx("div",{className:"check-dates",style:{fontSize:"12px",color:"#6B7280",fontWeight:400,lineHeight:"1.6"},children:`Check-in day is ${(p==null?void 0:p.name)||""}
Check-out day is ${(v==null?void 0:v.name)||""}`})]}),!f&&r.jsx("div",{className:"info-row",children:r.jsx("span",{className:"info-value error",children:"Days must be consecutive"})})]})}),n&&u>0&&r.jsx(Pe,{priceBreakdown:o}),r.jsx(Re,{errorState:g,onClose:_})]})}export{je as L,he as c};

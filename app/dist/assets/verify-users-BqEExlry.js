import{r as n,j as e,c as F}from"./client-BJVKzfAi.js";import{s as A}from"./supabase-BoCLEw6R.js";import{u as W,a as z}from"./Toast-BQk6Nzgd.js";import{A as H}from"./AdminHeader-tCInZd3n.js";import"./auth-QZ4BJadW.js";import"./star-OtPMgcH9.js";import"./createLucideIcon-CgZZH2OU.js";import"./file-text-Bqp_Hw0X.js";import"./triangle-alert-Bp6DQQmR.js";import"./users-d0RSvnp4.js";import"./pen-line-Duo49k9O.js";import"./calendar-CDI4qHEX.js";import"./mail-CRbL90NL.js";import"./user-check-CoCGzn5Y.js";import"./dollar-sign-Dn2-KjNW.js";import"./send-C4mziT0-.js";import"./x-CrJVeoCh.js";const Q="https://qcfifybkaddcoimjroca.supabase.co";function q(){const{showToast:s}=W(),[a,t]=n.useState(null),[o,l]=n.useState(""),[c,d]=n.useState([]),[u,v]=n.useState(!1),[m,f]=n.useState(!1),[h,j]=n.useState(!1),[b,N]=n.useState(null),[C,w]=n.useState(!1),[S,y]=n.useState(null),p=n.useRef(null);n.useEffect(()=>{const i=new URLSearchParams(window.location.search).get("user");i&&E(i)},[]),n.useEffect(()=>{const r=setTimeout(()=>{o.trim().length>=2?P(o):o.trim().length===0&&m&&L()},300);return()=>clearTimeout(r)},[o,m]),n.useEffect(()=>{function r(i){p.current&&!p.current.contains(i.target)&&f(!1)}return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);async function g(r,i={}){const{data:{session:k}}=await A.auth.getSession();if(!k)throw new Error("You must be logged in to perform this action");const x=await fetch(`${Q}/functions/v1/verify-users`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${k.access_token}`},body:JSON.stringify({action:r,payload:i})}),I=await x.json();if(!x.ok||!I.success)throw new Error(I.error||"Request failed");return I.data}async function P(r){try{v(!0),y(null);const i=await g("search_users",{query:r});d(i.users||[])}catch(i){console.error("[useVerifyUsersPageLogic] Search error:",i),y(i.message),d([])}finally{v(!1)}}async function L(){try{v(!0);const r=await g("list_users",{limit:20});d(r.users||[])}catch(r){console.error("[useVerifyUsersPageLogic] Load recent users error:",r),d([])}finally{v(!1)}}async function E(r){try{w(!0),y(null);const i=await g("get_user",{userId:r});i.user&&(t(i.user),l(i.user.email||""))}catch(i){console.error("[useVerifyUsersPageLogic] Load user error:",i),y(i.message),s(i.message||"Failed to load user","error")}finally{w(!1)}}const V=n.useCallback(r=>{t(r),l(r.email||""),f(!1);const i=new URL(window.location.href);i.searchParams.set("user",r._id),window.history.replaceState({},"",i)},[]),T=n.useCallback(()=>{t(null),l(""),d([]);const r=new URL(window.location.href);r.searchParams.delete("user"),window.history.replaceState({},"",r)},[]),U=n.useCallback(r=>{l(r),r.length>0&&f(!0)},[]),M=n.useCallback(()=>{f(r=>!r),!m&&c.length===0&&L()},[m,c.length]),D=n.useCallback(async r=>{if(a){j(!0);try{const i=await g("toggle_verification",{userId:a._id,isVerified:r});t(i.user),d(k=>k.map(x=>x._id===i.user._id?i.user:x)),s(r?`${a.fullName||"User"} has been verified`:`Verification removed for ${a.fullName||"User"}`,"success")}catch(i){console.error("[useVerifyUsersPageLogic] Toggle verification error:",i),s(i.message||"Failed to update verification","error")}finally{j(!1)}}},[a,s]),B=n.useCallback((r,i)=>{r&&N({url:r,title:i})},[]),R=n.useCallback(()=>{N(null)},[]),_=n.useCallback(r=>{r&&window.open(r,"_blank","noopener,noreferrer")},[]),$=n.useCallback(r=>r>=80?"#059669":r>=50?"#d97706":"#dc2626",[]),O=n.useMemo(()=>[{key:"profilePhoto",label:"Profile Picture",title:"Profile Photo"},{key:"selfieWithId",label:"Selfie with ID",title:"Selfie with ID"},{key:"idFront",label:"Front of ID",title:"Front of Government ID"},{key:"idBack",label:"Back of ID",title:"Back of Government ID"}],[]);return{selectedUser:a,searchQuery:o,searchResults:c,isSearching:u,isDropdownOpen:m,dropdownRef:p,isProcessing:h,modalImage:b,loading:C,error:S,handleSelectUser:V,clearSelection:T,handleSearchChange:U,handleDropdownToggle:M,setIsDropdownOpen:f,toggleVerification:D,openImageModal:B,closeImageModal:R,openImageExternal:_,getCompletenessColor:$,documentSections:O}}function G(){const{selectedUser:s,searchQuery:a,searchResults:t,isSearching:o,isDropdownOpen:l,dropdownRef:c,isProcessing:d,modalImage:u,loading:v,error:m,handleSelectUser:f,clearSelection:h,handleSearchChange:j,handleDropdownToggle:b,setIsDropdownOpen:N,toggleVerification:C,openImageModal:w,closeImageModal:S,openImageExternal:y,getCompletenessColor:p,documentSections:g}=q();return e.jsxs("div",{className:"verify-users-page",children:[e.jsx(H,{}),e.jsxs("header",{className:"verify-users-header",children:[e.jsx("h1",{className:"verify-users-title",children:"User Verification"}),e.jsx("p",{className:"verify-users-subtitle",children:"Verify user identity by reviewing their submitted documents"})]}),e.jsxs("main",{className:"verify-users-main",children:[e.jsx(J,{selectedUser:s,searchQuery:a,searchResults:t,isSearching:o,isDropdownOpen:l,dropdownRef:c,onSearchChange:j,onDropdownToggle:b,onSelectUser:f,onClear:h,setIsDropdownOpen:N}),v?e.jsx(se,{}):m?e.jsx(re,{message:m}):s?e.jsx(K,{user:s,isProcessing:d,onToggleVerification:C,onImageClick:w,documentSections:g,getCompletenessColor:p}):e.jsx(ie,{}),e.jsx(ae,{})]}),e.jsx("footer",{className:"verify-users-footer",children:e.jsx("p",{className:"verify-users-footer-text",children:"Split Lease Admin Dashboard - Internal Use Only"})}),u&&e.jsx(ee,{imageUrl:u.url,title:u.title,onClose:S,onOpenExternal:()=>y(u.url)})]})}function J({selectedUser:s,searchQuery:a,searchResults:t,isSearching:o,isDropdownOpen:l,dropdownRef:c,onSearchChange:d,onDropdownToggle:u,onSelectUser:v,onClear:m,setIsDropdownOpen:f}){return e.jsxs("div",{className:"verify-users-select-container",children:[e.jsx("h2",{className:"verify-users-section-title",children:"Select User"}),e.jsxs("div",{className:"verify-users-select-row",children:[e.jsx("div",{className:"verify-users-email-container",children:e.jsx("input",{type:"text",placeholder:"Type user's email",value:a,onChange:h=>d(h.target.value),onFocus:()=>f(!0),className:"verify-users-email-input",disabled:!!s})}),e.jsxs("div",{className:"verify-users-dropdown-container",ref:c,children:[e.jsxs("div",{onClick:u,className:`verify-users-dropdown-trigger ${l?"verify-users-dropdown-trigger--active":""}`,tabIndex:0,children:[e.jsx("span",{className:s?"verify-users-dropdown-text--selected":"verify-users-dropdown-text--placeholder",children:s?`${s.fullName} - ${s.email}`:"Choose an option..."}),e.jsx(ne,{isOpen:l})]}),l&&e.jsx("div",{className:"verify-users-dropdown-list",children:o?e.jsx("div",{className:"verify-users-dropdown-loading",children:"Searching..."}):t.length>0?t.map(h=>e.jsx(Y,{user:h,isSelected:(s==null?void 0:s._id)===h._id,onSelect:v},h._id)):e.jsx("div",{className:"verify-users-dropdown-empty",children:"No users found"})})]}),s&&e.jsx("button",{onClick:m,className:"verify-users-clear-button",children:"Clear"})]})]})}function Y({user:s,isSelected:a,onSelect:t}){var o;return e.jsx("div",{onClick:()=>t(s),className:`verify-users-dropdown-item ${a?"verify-users-dropdown-item--selected":""}`,children:e.jsxs("div",{className:"verify-users-dropdown-item-content",children:[s.profilePhoto?e.jsx("img",{src:s.profilePhoto,alt:s.fullName,className:"verify-users-dropdown-avatar"}):e.jsx("div",{className:"verify-users-dropdown-avatar-placeholder",children:e.jsx("span",{className:"verify-users-dropdown-avatar-initial",children:((o=s.fullName)==null?void 0:o.charAt(0))||"?"})}),e.jsxs("div",{children:[e.jsx("p",{className:"verify-users-dropdown-item-name",children:s.fullName}),e.jsx("p",{className:"verify-users-dropdown-item-email",children:s.email})]}),s.isVerified&&e.jsx("span",{className:"verify-users-verified-badge",children:"Verified"})]})})}function K({user:s,isProcessing:a,onToggleVerification:t,onImageClick:o,documentSections:l,getCompletenessColor:c}){var d;return e.jsxs("div",{className:"verify-users-verification-container",children:[e.jsx("h2",{className:"verify-users-verification-title",children:"Identity Verification"}),e.jsxs("div",{className:"verify-users-verification-content",children:[e.jsx("div",{className:"verify-users-image-grid",children:l.map(u=>e.jsx(X,{imageUrl:s[u.key],label:`${s.fullName}'s ${u.label}`,title:u.title,userName:s.fullName,onClick:o},u.key))}),e.jsxs("div",{className:"verify-users-toggle-section",children:[e.jsx(Z,{isVerified:s.isVerified,onToggle:t,disabled:a}),a&&e.jsx("p",{className:"verify-users-processing-text",children:"Processing..."})]})]}),e.jsxs("div",{className:"verify-users-summary",children:[e.jsxs("div",{className:"verify-users-summary-item",children:[e.jsx("span",{className:"verify-users-summary-label",children:"Email:"})," ",s.email]}),e.jsxs("div",{className:"verify-users-summary-item",children:[e.jsx("span",{className:"verify-users-summary-label",children:"Phone:"})," ",s.phoneNumber||"Not provided"]}),e.jsxs("div",{className:"verify-users-summary-item",children:[e.jsx("span",{className:"verify-users-summary-label",children:"Profile Completeness:"})," ",e.jsxs("span",{style:{color:c(s.profileCompleteness||0)},children:[s.profileCompleteness||0,"%"]})]}),e.jsxs("div",{className:"verify-users-summary-item",children:[e.jsx("span",{className:"verify-users-summary-label",children:"Tasks Completed:"})," ",((d=s.tasksCompleted)==null?void 0:d.length)>0?s.tasksCompleted.join(", "):"None"]})]})]})}function X({imageUrl:s,label:a,title:t,userName:o,onClick:l}){const c=()=>{s&&l(s,`${o}'s ${t}`)};return e.jsxs("div",{className:"verify-users-image-card-container",children:[e.jsx("label",{className:"verify-users-image-card-label",children:a}),e.jsx("div",{onClick:c,className:`verify-users-image-card ${s?"verify-users-image-card--with-image":"verify-users-image-card--empty"}`,children:s?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:s,alt:a,className:"verify-users-image-card-img"}),e.jsx("div",{className:"verify-users-image-card-overlay",children:e.jsx("span",{className:"verify-users-image-card-overlay-text",children:"Click to view"})})]}):e.jsxs("div",{className:"verify-users-image-card-placeholder",children:[e.jsx(oe,{}),e.jsx("span",{className:"verify-users-placeholder-text",children:"No image available"})]})})]})}function Z({isVerified:s,onToggle:a,disabled:t}){const o=["verify-users-toggle-button",s?"verify-users-toggle-button--active":"verify-users-toggle-button--inactive",t?"verify-users-toggle-button--disabled":""].filter(Boolean).join(" "),l=["verify-users-toggle-knob",s?"verify-users-toggle-knob--active":"verify-users-toggle-knob--inactive"].join(" "),c=["verify-users-toggle-status",s?"verify-users-toggle-status--verified":"verify-users-toggle-status--not-verified"].join(" ");return e.jsxs("div",{className:"verify-users-toggle-container",children:[e.jsx("label",{className:"verify-users-toggle-label",children:"User Verified?"}),e.jsx("button",{type:"button",onClick:()=>!t&&a(!s),disabled:t,className:o,role:"switch","aria-checked":s,children:e.jsx("span",{className:l})}),e.jsx("span",{className:c,children:s?"Verified":"Not Verified"})]})}function ee({imageUrl:s,title:a,onClose:t,onOpenExternal:o}){const l=c=>{c.target===c.currentTarget&&t()};return e.jsx("div",{className:"verify-users-modal-overlay",onClick:l,children:e.jsxs("div",{className:"verify-users-modal-content",children:[e.jsxs("div",{className:"verify-users-modal-header",children:[e.jsx("h3",{className:"verify-users-modal-title",children:a}),e.jsxs("div",{className:"verify-users-modal-actions",children:[e.jsx("button",{onClick:o,className:"verify-users-modal-icon-button",title:"Open in new tab",children:e.jsx(le,{})}),e.jsx("button",{onClick:t,className:"verify-users-modal-icon-button",title:"Close",children:e.jsx(ce,{})})]})]}),e.jsx("div",{className:"verify-users-modal-image-container",children:e.jsx("img",{src:s,alt:a,className:"verify-users-modal-image"})})]})})}function se(){return e.jsxs("div",{className:"verify-users-state-container",children:[e.jsx("div",{className:"verify-users-spinner"}),e.jsx("span",{children:"Loading user..."})]})}function re({message:s}){return e.jsx("div",{className:"verify-users-error-container",children:e.jsx("span",{children:s})})}function ie(){return e.jsxs("div",{className:"verify-users-empty-container",children:[e.jsx(te,{}),e.jsx("h3",{className:"verify-users-empty-title",children:"No User Selected"}),e.jsx("p",{className:"verify-users-empty-text",children:"Search for a user by email or select from the dropdown above to begin verification"})]})}function ae(){return e.jsxs("div",{className:"verify-users-instructions",children:[e.jsx("h4",{className:"verify-users-instructions-title",children:"Verification Instructions"}),e.jsxs("ul",{className:"verify-users-instructions-list",children:[e.jsx("li",{children:"1. Select a user from the dropdown or search by email address"}),e.jsx("li",{children:"2. Review all four identity documents (profile photo, selfie with ID, front and back of government ID)"}),e.jsx("li",{children:"3. Click on any image to view it in full size"}),e.jsx("li",{children:'4. Once verified, toggle the "User Verified?" switch to ON'}),e.jsx("li",{children:"5. The system will automatically update the user's profile and send notifications"})]})]})}function ne({isOpen:s}){return e.jsx("svg",{className:`verify-users-chevron-icon ${s?"verify-users-chevron-icon--open":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})}function te(){return e.jsx("svg",{className:"verify-users-user-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}function oe(){return e.jsx("svg",{className:"verify-users-placeholder-icon",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}function le(){return e.jsx("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})})}function ce(){return e.jsx("svg",{width:"20",height:"20",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}const de=document.getElementById("root"),ue=F(de);ue.render(e.jsx(z,{children:e.jsx(G,{})}));

import{r as i,j as e,b as Fe}from"./client-BJVKzfAi.js";import{g as Ue,a as We,b as ee,e as fe,d as qe,B as Be,v as xe,C as X,m as $e,f as ze}from"./auth-QZ4BJadW.js";import{S as V,H as Ve}from"./constants-CPVJY5eo.js";import{s as b}from"./supabase-BoCLEw6R.js";import{s as Q}from"./Toast-BQk6Nzgd.js";import{l as Ye,L as Qe,S as Ke}from"./proposalDataFetcher-CipdyWU2.js";import{c as we}from"./proposalStatuses-1Bj0NYR4.js";const Je=()=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),Xe=()=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e.jsx("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})]}),Ze=()=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]});function es({isVisible:t,onClose:n,onSuccess:s,currentUser:o,existingListings:r=[],onNavigateToListing:h}){const[d,g]=i.useState("create"),[w,v]=i.useState(""),[p,y]=i.useState(""),[S,P]=i.useState(!1);i.useEffect(()=>{t&&(console.log("ðŸ  CreateDuplicateListingModal: Modal opened"),g("create"),v(""),y(""))},[t]),i.useEffect(()=>{if(d==="copy"&&p){const f=r.find(x=>x._id===p);f&&v(`${f.Name} copy`)}},[d,p,r]);const I=!!o,k=()=>{if(!w.trim()){Q("Please enter a listing title","error",3e3);return}console.log("ðŸ  CreateDuplicateListingModal: Starting new listing flow"),console.log("Listing name:",w.trim()),localStorage.setItem("pendingListingName",w.trim()),n(),Q("Redirecting to listing form...","success",2e3),console.log("ðŸ”„ Redirecting to self-listing page"),setTimeout(()=>{window.location.href="/self-listing.html"},500)},A=async()=>{var f;if(!p){Q("Please select a listing to duplicate","error",3e3);return}if(!w.trim()){Q("Please enter a listing title","error",3e3);return}P(!0);try{const x=r.find(W=>W._id===p);if(!x)throw new Error("Selected listing not found");const C={...x,_id:void 0,Name:w.trim(),active:!1,"Operator Last Updated AUT":new Date().toISOString(),"Created Date":void 0,"Modified Date":void 0};delete C._id,delete C["Created Date"],delete C["Modified Date"];const{data:U,error:B}=await b.from("zat_listings").insert(C).select().single();if(B)throw B;o&&!((f=o.tasksCompleted)!=null&&f.includes("listing"))&&await q(o._id,"listing"),n(),Q("Listing duplicated successfully!","success",3e3),s&&s(U),h&&h(U._id)}catch(x){console.error("Error duplicating listing:",x),Q("Failed to duplicate listing. Please try again.","error",3e3)}finally{P(!1)}},O=()=>{g("copy"),v(""),y("")},G=()=>{g("create"),v(""),y("")},N=()=>{n()},q=async(f,x)=>{try{const{error:C}=await b.from("zat_user").update({tasksCompleted:b.raw(`array_append(tasksCompleted, '${x}')`)}).eq("_id",f);if(C)throw C}catch(C){console.error("Error updating profile completeness:",C)}},T=f=>{f.target===f.currentTarget&&N()};i.useEffect(()=>{const f=x=>{x.key==="Escape"&&t&&N()};return document.addEventListener("keydown",f),()=>document.removeEventListener("keydown",f)},[t]);const c=d==="create"?Je:Xe,E=d==="create"?"Create New Listing":"Copy Existing Listing",F=d==="create"?"Enter the title guests will see when browsing.":"Select a listing to duplicate and customize the name.";return t?e.jsx("div",{className:"create-listing-modal-overlay",onClick:T,role:"dialog","aria-modal":"true","aria-labelledby":"create-listing-modal-title",children:e.jsxs("div",{className:"create-listing-modal-container",onClick:f=>f.stopPropagation(),children:[e.jsx("div",{className:"create-listing-grab-handle","aria-hidden":"true"}),e.jsxs("header",{className:"create-listing-header",children:[e.jsxs("div",{className:"create-listing-header-content",children:[e.jsxs("div",{className:"create-listing-header-top",children:[e.jsx("span",{className:"create-listing-icon","aria-hidden":"true",children:e.jsx(c,{})}),e.jsx("h2",{id:"create-listing-modal-title",className:"create-listing-title",children:E})]}),e.jsx("p",{className:"create-listing-subtitle",children:F})]}),e.jsx("button",{className:"create-listing-close-btn",onClick:N,"aria-label":"Close modal",type:"button",children:e.jsx(Ze,{})})]}),e.jsxs("div",{className:"create-listing-body",children:[d==="copy"&&e.jsxs("div",{className:"create-listing-section",children:[e.jsx("label",{htmlFor:"listing-select",className:"create-listing-label",children:"Select Listing to Copy"}),e.jsxs("select",{id:"listing-select",className:"create-listing-select",value:p,onChange:f=>y(f.target.value),children:[e.jsx("option",{value:"",children:"-- Select a listing --"}),r.map(f=>e.jsx("option",{value:f._id,children:f.Name},f._id))]})]}),e.jsxs("div",{className:"create-listing-section",children:[e.jsx("label",{htmlFor:"listing-title",className:"create-listing-label",children:"Listing Title"}),e.jsx("input",{id:"listing-title",type:"text",className:"create-listing-input",value:w,onChange:f=>v(f.target.value),placeholder:"Enter listing title",disabled:S}),e.jsx("p",{className:"create-listing-helper",children:"Don't worry, you can change it later"})]})]}),e.jsx("footer",{className:"create-listing-footer",children:d==="create"?e.jsxs(e.Fragment,{children:[I&&r.length>0&&e.jsx("button",{type:"button",className:"create-listing-btn create-listing-btn-secondary",onClick:O,disabled:S,children:"Copy Existing"}),e.jsx("button",{type:"button",className:"create-listing-btn create-listing-btn-primary",onClick:k,disabled:!w.trim()||S,children:S?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner","aria-hidden":"true"}),"Creating..."]}):"Create New"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"create-listing-btn create-listing-btn-back",onClick:G,disabled:S,children:"Back"}),e.jsx("button",{type:"button",className:"create-listing-btn create-listing-btn-primary",onClick:A,disabled:!w.trim()||!p||S,children:S?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner","aria-hidden":"true"}),"Duplicating..."]}):"Duplicate"})]})})]})}):null}const L={LOGGED_OUT:"LOGGED_OUT",NO_LISTING:"NO_LISTING",WITH_LISTING_NO_PROPOSALS:"WITH_LISTING_NO_PROPOSALS",WITH_PROPOSALS:"WITH_PROPOSALS",WITH_LEASES:"WITH_LEASES"},ie={[L.LOGGED_OUT]:{title:"Become a Host",desc:"List your property and start earning with flexible scheduling.",cta:"Get Started",ctaHref:"/self-listing-v2",image:"https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=400&h=260&fit=crop&q=80"},[L.NO_LISTING]:{title:"List Your First Property",desc:"Create your listing in minutes and start receiving proposals.",cta:"Create Listing",ctaHref:"/self-listing-v2",image:"https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=400&h=260&fit=crop&q=80"},[L.WITH_LISTING_NO_PROPOSALS]:{title:"Your Listings",desc:"Manage your properties and optimize for more proposals.",cta:"View Listings",ctaHref:"/host-overview",image:"https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=400&h=260&fit=crop&q=80"},[L.WITH_PROPOSALS]:{title:"Host Dashboard",desc:"Manage your listings and respond to guest proposals.",cta:"View Proposals",ctaHref:"/host-proposals",image:"https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=400&h=260&fit=crop&q=80"},[L.WITH_LEASES]:{title:"Host Dashboard",desc:"Manage your leases, earnings, and property calendar.",cta:"View Earnings",ctaHref:"/host-overview#leases",image:"https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=400&h=260&fit=crop&q=80"}};function ss(t,n){const s={whyList:{id:"why-list",href:"/list-with-us",title:"Why List with Us",desc:"New to Split Lease? Learn more about hosting",icon:"/assets/icons/star-purple.svg"},successStories:{id:"success",href:"/host-success",title:"Success Stories",desc:"Explore other hosts' feedback",icon:"/assets/icons/favorite-purple.svg"},legalInfo:{id:"legal",href:"/policies",title:"Legal Information",desc:"Review most important policies",icon:"/assets/icons/legal-purple.svg"},faqs:{id:"faq",href:"/faq?section=hosts",title:"FAQs",desc:"Frequently Asked Questions",icon:"/assets/icons/faq-purple.svg"},createHouseManual:{id:"house-manual",href:"/host-overview#house-manuals",title:"Create House Manual",desc:"Set up your property guide",icon:"/assets/icons/house-manual-purple.svg"},manageHouseManual:{id:"house-manual",href:"/host-overview#house-manuals",title:"House Manual",desc:"Set up or edit your property guide",icon:"/assets/icons/house-manual-purple.svg"},listProperty:{id:"list-property",href:"/self-listing-v2",title:"List Property",desc:"Create your first listing",icon:"/assets/icons/listing-purple.svg"},manageListing:{id:"manage-listing",href:"/host-overview",title:"Manage Listing",desc:"View and edit your listings",icon:"/assets/icons/listing-purple.svg"},manageProposals:{id:"manage-proposals",href:"/host-proposals",title:"Manage Proposals",desc:"Review guest proposals",icon:"/assets/icons/document-purple.svg"}},o=ie[t]||ie[L.LOGGED_OUT];switch(t){case L.LOGGED_OUT:return{items:[s.whyList,s.successStories,s.listProperty,s.legalInfo,s.faqs],cta:{label:"Sign Up",action:n,icon:"/assets/icons/user-bubble-purple.svg"},featured:o,showAuthCta:!0};case L.NO_LISTING:return{items:[s.createHouseManual,s.successStories,s.listProperty,s.legalInfo,s.faqs],cta:{label:"List Property",href:"/self-listing-v2",icon:"/assets/icons/listing-purple.svg"},featured:o,showAuthCta:!1};case L.WITH_LISTING_NO_PROPOSALS:return{items:[s.manageHouseManual,s.successStories,s.manageListing,s.legalInfo,s.faqs],cta:{label:"Manage Listing",href:"/host-overview",icon:"/assets/icons/listing-purple.svg"},featured:o,showAuthCta:!1};case L.WITH_PROPOSALS:return{items:[s.manageHouseManual,s.successStories,s.manageListing,s.manageProposals,s.legalInfo,s.faqs],cta:{label:"Manage Proposals",href:"/host-proposals",icon:"/assets/icons/document-purple.svg"},featured:o,showAuthCta:!1};case L.WITH_LEASES:return{items:[s.manageHouseManual,s.successStories,s.manageListing,s.manageProposals,s.legalInfo,s.faqs],cta:{label:"Manage Leases",href:"/host-overview#leases",icon:"/assets/icons/leases-purple.svg"},featured:o,showAuthCta:!1};default:return{items:[s.whyList,s.successStories,s.listProperty,s.legalInfo,s.faqs],cta:{label:"Sign Up",action:n,icon:"/assets/icons/user-bubble-purple.svg"},featured:ie[L.LOGGED_OUT],showAuthCta:!0}}}function ts(t,n){const[s,o]=i.useState(L.LOGGED_OUT),[r,h]=i.useState(!1),[d,g]=i.useState(null),w=i.useCallback(async()=>{var v;if(!n||!t){o(L.LOGGED_OUT);return}h(!0),g(null);try{const[p,y,S]=await Promise.all([b.rpc("get_host_listings",{host_user_id:t}),b.from("proposal").select("_id",{count:"exact",head:!0}).eq("Host User",t).or('"Deleted".is.null,"Deleted".eq.false').neq("Status","Proposal Cancelled by Guest"),b.from("bookings_leases").select("_id",{count:"exact",head:!0}).eq("Created By",t)]),P=((v=p.data)==null?void 0:v.length)||0,I=y.count||0;(S.count||0)>0?o(L.WITH_LEASES):I>0?o(L.WITH_PROPOSALS):P>0?o(L.WITH_LISTING_NO_PROPOSALS):o(L.NO_LISTING)}catch(p){console.error("[useHostMenuData] Error:",p),g(p.message),o(L.NO_LISTING)}finally{h(!1)}},[t,n]);return i.useEffect(()=>{w()},[w]),{state:s,loading:r,error:d,refetch:w}}const as=["Proposal Submitted for guest by Split Lease - Awaiting Rental Application","Proposal Submitted for guest by Split Lease - Pending Confirmation"],j={LOGGED_OUT:"LOGGED_OUT",NO_PROPOSALS_NO_APP:"NO_PROPOSALS_NO_APP",NO_PROPOSALS_WITH_APP:"NO_PROPOSALS_WITH_APP",WITH_PROPOSALS:"WITH_PROPOSALS",WITH_SUGGESTED:"WITH_SUGGESTED",WITH_LEASES:"WITH_LEASES"},le={[j.LOGGED_OUT]:{title:"Find Your Stay",desc:"Flexible rentals in NYC with weekly and monthly options.",cta:"Explore Rentals",ctaHref:V,image:"https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=400&h=260&fit=crop&q=80"},[j.NO_PROPOSALS_NO_APP]:{title:"Start Your Search",desc:"Browse 200+ verified listings and find your NYC home base.",cta:"Find a Place",ctaHref:V,image:"https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=400&h=260&fit=crop&q=80"},[j.NO_PROPOSALS_WITH_APP]:{title:"Start Your Search",desc:"Your rental profile is ready! Now find your perfect place.",cta:"Browse Listings",ctaHref:V,image:"https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=400&h=260&fit=crop&q=80"},[j.WITH_PROPOSALS]:{title:"Your Search",desc:"Track your proposals and manage your favorites.",cta:"View Proposals",ctaHref:"/guest-proposals",image:"https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=400&h=260&fit=crop&q=80"},[j.WITH_SUGGESTED]:{title:"Suggested for You",desc:"We found listings that match your preferences!",cta:"View Suggestions",ctaHref:"/guest-proposals?filter=suggested",image:"https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=400&h=260&fit=crop&q=80"},[j.WITH_LEASES]:{title:"Your Stays",desc:"Manage your active leases and upcoming visits.",cta:"View Leases",ctaHref:"/guest-proposals#leases",image:"https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=400&h=260&fit=crop&q=80"}};function ns(t,n){const s={exploreRentals:{id:"explore",href:V,title:"Explore Rentals",desc:"See available listings!",icon:"/assets/icons/listing-purple.svg"},successStories:{id:"success",href:"/guest-success",title:"Success Stories",desc:"Explore other guests' feedback",icon:"/assets/icons/favorite-purple.svg"},faqs:{id:"faq",href:"/faq?section=travelers",title:"FAQs",desc:"Frequently Asked Questions",icon:"/assets/icons/faq-purple.svg"},rentalApplication:{id:"rental-app",href:"/rental-application",title:"Rental Application",desc:"Complete your rental profile",icon:"/assets/icons/clipboard-purple.svg"},rentalAppActive:{id:"rental-app",href:"/rental-application",title:"Rental App (Active)",desc:"View your rental profile",icon:"/assets/icons/clipboard-purple.svg"},favoriteListings:{id:"favorites",href:"/favorite-listings",title:"Favorite Listings",desc:"View your saved listings",icon:"/assets/icons/favorite-purple.svg"},manageProposals:{id:"manage-proposals",href:"/guest-proposals",title:"Manage Proposals",desc:"Track your booking requests",icon:"/assets/icons/document-purple.svg"},manageLeases:{id:"manage-leases",href:"/guest-proposals#leases",title:"Manage Leases",desc:"View your active leases",icon:"/assets/icons/leases-purple.svg"}},o=le[t]||le[j.LOGGED_OUT];switch(t){case j.LOGGED_OUT:return{items:[s.exploreRentals,s.successStories,s.faqs],cta:{label:"Sign Up",action:n,icon:"/assets/icons/user-bubble-purple.svg"},featured:o,showAuthCta:!0};case j.NO_PROPOSALS_NO_APP:return{items:[s.exploreRentals,s.rentalApplication,s.successStories,s.favoriteListings,s.faqs],cta:{label:"Explore Rentals",href:V,icon:"/assets/icons/listing-purple.svg"},featured:o,showAuthCta:!1};case j.NO_PROPOSALS_WITH_APP:return{items:[s.exploreRentals,s.rentalAppActive,s.successStories,s.favoriteListings,s.faqs],cta:{label:"Explore Rentals",href:V,icon:"/assets/icons/listing-purple.svg"},featured:o,showAuthCta:!1};case j.WITH_PROPOSALS:return{items:[s.exploreRentals,s.rentalAppActive,s.successStories,s.favoriteListings,s.manageProposals,s.faqs],cta:{label:"Manage Proposals",href:"/guest-proposals",icon:"/assets/icons/document-purple.svg"},featured:o,showAuthCta:!1};case j.WITH_SUGGESTED:return{items:[s.exploreRentals,s.rentalAppActive,s.successStories,s.favoriteListings,s.faqs],cta:{label:"See Suggested Proposal",href:"/guest-proposals?filter=suggested",icon:"/assets/icons/star-purple.svg"},featured:o,showAuthCta:!1};case j.WITH_LEASES:return{items:[s.exploreRentals,s.rentalAppActive,s.successStories,s.favoriteListings,s.manageLeases,s.faqs],cta:{label:"Manage Leases",href:"/guest-proposals#leases",icon:"/assets/icons/leases-purple.svg"},featured:o,showAuthCta:!1};default:return{items:[s.exploreRentals,s.successStories,s.faqs],cta:{label:"Sign Up",action:n,icon:"/assets/icons/user-bubble-purple.svg"},featured:le[j.LOGGED_OUT],showAuthCta:!0}}}function os(t,n){const[s,o]=i.useState(j.LOGGED_OUT),[r,h]=i.useState(!1),[d,g]=i.useState(null),w=i.useCallback(async()=>{var v;if(!n||!t){o(j.LOGGED_OUT);return}h(!0),g(null);try{const[p,y,S,P]=await Promise.all([b.from("proposal").select("_id",{count:"exact",head:!0}).eq("Guest",t).or('"Deleted".is.null,"Deleted".eq.false').neq("Status","Proposal Cancelled by Guest"),b.from("proposal").select("_id",{count:"exact",head:!0}).eq("Guest",t).in("Status",as).or('"Deleted".is.null,"Deleted".eq.false'),b.from("user").select('_id, "Rental Application"').eq("_id",t).single(),b.from("bookings_leases").select("_id",{count:"exact",head:!0}).eq("Guest",t)]),I=p.count||0,k=y.count||0,A=P.count||0,O=!!((v=S.data)!=null&&v["Rental Application"]);A>0?o(j.WITH_LEASES):k>0?o(j.WITH_SUGGESTED):I>0?o(j.WITH_PROPOSALS):o(O?j.NO_PROPOSALS_WITH_APP:j.NO_PROPOSALS_NO_APP)}catch(p){console.error("[useGuestMenuData] Error:",p),g(p.message),o(j.NO_PROPOSALS_NO_APP)}finally{h(!1)}},[t,n]);return i.useEffect(()=>{w()},[w]),{state:s,loading:r,error:d,refetch:w}}function rs({photos:t=[],listingName:n="Listing"}){const[s,o]=i.useState(0),r=t.map(d=>typeof d=="string"?d:(d==null?void 0:d.url)||(d==null?void 0:d.src)||d).filter(Boolean);if(r.length===0)return e.jsx("div",{className:"sp-gallery",children:e.jsx("div",{className:"sp-gallery-main sp-gallery-placeholder",children:e.jsx("span",{children:"No photos available"})})});const h=r[s]||r[0];return e.jsxs("div",{className:"sp-gallery",children:[e.jsx("div",{className:"sp-gallery-main",children:e.jsx("img",{src:h,alt:`${n} - Photo ${s+1}`,className:"sp-gallery-main-img"})}),r.length>1&&e.jsxs("div",{className:"sp-gallery-thumbs",children:[r.slice(0,5).map((d,g)=>e.jsx("button",{className:`sp-gallery-thumb ${g===s?"sp-gallery-thumb--active":""}`,onClick:()=>o(g),"aria-label":`View photo ${g+1}`,type:"button",children:e.jsx("img",{src:d,alt:`${n} - Thumbnail ${g+1}`})},g)),r.length>5&&e.jsxs("div",{className:"sp-gallery-thumb sp-gallery-thumb--more",children:["+",r.length-5]})]})]})}const se=({children:t,className:n=""})=>e.jsx("svg",{className:`sp-amenity-icon-svg ${n}`,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:t}),is=()=>e.jsxs(se,{children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),ls=()=>e.jsxs(se,{children:[e.jsx("path",{d:"M2 4v16"}),e.jsx("path",{d:"M2 8h18a2 2 0 0 1 2 2v10"}),e.jsx("path",{d:"M2 17h20"}),e.jsx("path",{d:"M6 8v9"})]}),cs=()=>e.jsx(se,{children:e.jsx("path",{d:"M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"})}),ds=()=>e.jsxs(se,{children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),us={"1569530159044x216130979074711000":"Private Room","1569530331984x152755544104023800":"Entire Place","1585742011301x719941865479153400":"Shared Room","1588063597111x228486447854442800":"All Spaces"};function ps({listing:t={}}){const n=t["Features - Qty Bedrooms"]||0,s=t["Features - Qty Bathrooms"]||0,o=t["Features - Qty Guests"]||0,r=t["Features - Type of Space"],h=r&&!r.includes("x")&&r.length<20,d=us[r]||(h?r:null)||"Space";return e.jsxs("div",{className:"sp-amenities",children:[e.jsxs("div",{className:"sp-amenity",title:d,children:[e.jsx("span",{className:"sp-amenity-icon",children:e.jsx(is,{})}),e.jsx("span",{className:"sp-amenity-text",children:d})]}),n>0&&e.jsxs("div",{className:"sp-amenity",title:`${n} bedroom${n!==1?"s":""}`,children:[e.jsx("span",{className:"sp-amenity-icon",children:e.jsx(ls,{})}),e.jsxs("span",{className:"sp-amenity-text",children:[n," bed",n!==1?"s":""]})]}),s>0&&e.jsxs("div",{className:"sp-amenity",title:`${s} bathroom${s!==1?"s":""}`,children:[e.jsx("span",{className:"sp-amenity-icon",children:e.jsx(cs,{})}),e.jsxs("span",{className:"sp-amenity-text",children:[s," bath",s!==1?"s":""]})]}),o>0&&e.jsxs("div",{className:"sp-amenity",title:`Up to ${o} guest${o!==1?"s":""}`,children:[e.jsx("span",{className:"sp-amenity-icon",children:e.jsx(ds,{})}),e.jsxs("span",{className:"sp-amenity-text",children:[o," guest",o!==1?"s":""]})]})]})}function ye(t){return typeof t!="number"||isNaN(t)?"$0":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(t)}function hs({nightlyPrice:t,totalPrice:n}){return e.jsxs("div",{className:"sp-pricing",children:[e.jsxs("div",{className:"sp-pricing-row",children:[e.jsx("span",{className:"sp-pricing-label",children:"Nightly Rate"}),e.jsx("span",{className:"sp-pricing-value",children:ye(t)})]}),e.jsxs("div",{className:"sp-pricing-row sp-pricing-row--total",children:[e.jsx("span",{className:"sp-pricing-label",children:"Total"}),e.jsx("span",{className:"sp-pricing-value sp-pricing-value--total",children:ye(n)})]})]})}function gs({onInterested:t,onRemove:n,isProcessing:s=!1}){return e.jsxs("div",{className:"sp-actions",children:[e.jsx("button",{className:"sp-action-btn sp-action-btn--primary",onClick:t,disabled:s,type:"button",children:s?e.jsx("span",{className:"sp-action-spinner"}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"sp-action-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}),"I'm Interested"]})}),e.jsxs("button",{className:"sp-action-btn sp-action-btn--secondary",onClick:n,disabled:s,type:"button",children:[e.jsxs("svg",{className:"sp-action-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),"Not Interested"]})]})}function ms({geoPoint:t,address:n}){const s=i.useRef(null),o=i.useRef(null),r=i.useRef(null),[h,d]=i.useState(!1),[g,w]=i.useState(!1),v=t&&typeof t.lat=="number"&&typeof t.lng=="number";return i.useEffect(()=>{if(!v||!s.current)return;const p=()=>{if(!o.current)try{const{lat:y,lng:S}=t,P=new window.google.maps.Map(s.current,{center:{lat:y,lng:S},zoom:15,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,zoomControl:!0,zoomControlOptions:{position:window.google.maps.ControlPosition.RIGHT_CENTER},gestureHandling:"cooperative",styles:[{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]}]}),I=new window.google.maps.Marker({position:{lat:y,lng:S},map:P,icon:{path:window.google.maps.SymbolPath.CIRCLE,fillColor:"#5B21B6",fillOpacity:1,strokeColor:"#FFFFFF",strokeWeight:3,scale:10},title:n||"Property Location"});o.current=P,r.current=I,d(!0)}catch(y){console.error("MapSection: Failed to initialize Google Map:",y),w(!0)}};if(window.google&&window.google.maps&&window.google.maps.ControlPosition)p();else{const y=()=>{p()};return window.addEventListener("google-maps-loaded",y),()=>{window.removeEventListener("google-maps-loaded",y)}}},[v,t,n]),i.useEffect(()=>()=>{r.current&&(r.current.setMap(null),r.current=null),o.current=null},[]),e.jsxs("div",{className:"sp-map-section",children:[e.jsx("h3",{className:"sp-map-title",children:"Location"}),e.jsx("div",{className:"sp-map-container",children:v&&!g?e.jsxs(e.Fragment,{children:[e.jsx("div",{ref:s,className:"sp-map-interactive",style:{width:"100%",height:"100%"}}),!h&&e.jsx("div",{className:"sp-map-loading",children:e.jsx("div",{className:"sp-map-spinner"})})]}):e.jsxs("div",{className:"sp-map-placeholder",children:[e.jsx("span",{className:"sp-map-placeholder-icon",children:"ðŸ“"}),e.jsx("span",{className:"sp-map-placeholder-text",children:n||"Location not available"})]})}),n&&e.jsx("p",{className:"sp-map-address",children:n})]})}const ve=()=>e.jsxs("svg",{className:"sp-why-icon-svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]});function fs(t){return t&&t.split(/\*\*([^*]+)\*\*/g).map((s,o)=>o%2===1?e.jsx("strong",{children:s},o):s)}function xs({summary:t}){return t?e.jsxs("div",{className:"sp-why-section",children:[e.jsxs("h3",{className:"sp-why-title",children:[e.jsx("span",{className:"sp-why-icon",children:e.jsx(ve,{})}),"Why This Listing?"]}),e.jsx("p",{className:"sp-why-text",children:fs(t)})]}):e.jsxs("div",{className:"sp-why-section",children:[e.jsxs("h3",{className:"sp-why-title",children:[e.jsx("span",{className:"sp-why-icon",children:e.jsx(ve,{})}),"Why This Listing?"]}),e.jsx("p",{className:"sp-why-text sp-why-text--placeholder",children:"Our team selected this listing based on your preferences and requirements."})]})}function ys({isOpen:t,proposal:n,onClose:s,onConfirm:o,isProcessing:r=!1}){const[h,d]=i.useState(""),g=500;i.useEffect(()=>{t||d("")},[t]),i.useEffect(()=>{if(!t)return;const _=$=>{$.key==="Escape"&&!r&&s()};return window.addEventListener("keydown",_),()=>window.removeEventListener("keydown",_)},[t,r,s]);const w=i.useCallback(async()=>{r||await o(h.trim()||null)},[h,r,o]),v=i.useCallback(()=>{r||s()},[r,s]),p=i.useCallback(_=>{_.target===_.currentTarget&&!r&&s()},[r,s]);if(!t)return null;const y=(n==null?void 0:n._listing)||(n==null?void 0:n.listing)||{},S=y.Name||(y==null?void 0:y.Name)||"this property",P={position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10001,animation:"fadeIn 0.2s ease"},I={backgroundColor:"#ffffff",borderRadius:"16px",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)",width:"100%",maxWidth:"440px",margin:"0 20px",fontFamily:"'Inter', -apple-system, BlinkMacSystemFont, sans-serif",animation:"slideUp 0.25s ease"},k={display:"flex",alignItems:"center",justifyContent:"space-between",padding:"20px 24px",borderBottom:"1px solid #DFDFF6"},A={display:"flex",alignItems:"center",gap:"12px"},O={width:"40px",height:"40px",borderRadius:"50%",backgroundColor:"#FEF3C7",display:"flex",alignItems:"center",justifyContent:"center"},G={fontSize:"18px",fontWeight:"600",color:"#111827",margin:0},N={color:"#9CA3AF",fontSize:"24px",lineHeight:1,padding:"4px",background:"none",border:"none",cursor:r?"not-allowed":"pointer",opacity:r?.5:1},q={padding:"24px"},T={fontSize:"15px",color:"#4B5563",marginBottom:"16px",lineHeight:1.5},c={display:"block",fontSize:"14px",fontWeight:"500",color:"#374151",marginBottom:"8px"},E={position:"relative"},F={width:"100%",minHeight:"100px",padding:"12px",fontSize:"15px",border:"1px solid #D1D5DB",borderRadius:"8px",resize:"vertical",boxSizing:"border-box",fontFamily:"inherit",lineHeight:1.5,transition:"border-color 0.15s ease"},f={position:"absolute",bottom:"8px",right:"12px",fontSize:"12px",color:h.length>g*.9?"#EF4444":"#9CA3AF"},x={display:"flex",gap:"12px",padding:"16px 24px",borderTop:"1px solid #DFDFF6"},C={flex:1,padding:"12px 20px",backgroundColor:"#F3F4F6",color:"#374151",borderRadius:"20px",border:"none",fontSize:"15px",fontWeight:"600",cursor:r?"not-allowed":"pointer",opacity:r?.5:1,transition:"background-color 0.15s ease"},U={flex:1,padding:"12px 20px",backgroundColor:"#6B7280",color:"#FFFFFF",borderRadius:"20px",border:"none",fontSize:"15px",fontWeight:"600",cursor:r?"not-allowed":"pointer",opacity:r?.7:1,transition:"background-color 0.15s ease",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},B={width:"16px",height:"16px",border:"2px solid currentColor",borderTopColor:"transparent",borderRadius:"50%",animation:"spin 0.8s linear infinite"},W=e.jsxs("div",{style:P,onClick:p,children:[e.jsx("style",{children:`
          @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
          }
          @keyframes slideUp {
            from {
              opacity: 0;
              transform: translateY(10px);
            }
            to {
              opacity: 1;
              transform: translateY(0);
            }
          }
          @keyframes spin {
            to { transform: rotate(360deg); }
          }
        `}),e.jsxs("div",{style:I,onClick:_=>_.stopPropagation(),children:[e.jsxs("div",{style:k,children:[e.jsxs("div",{style:A,children:[e.jsx("div",{style:O,children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#F59E0B",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M8 15s1.5-2 4-2 4 2 4 2"}),e.jsx("line",{x1:"9",y1:"9",x2:"9.01",y2:"9"}),e.jsx("line",{x1:"15",y1:"9",x2:"15.01",y2:"9"})]})}),e.jsx("h2",{style:G,children:"Not Interested?"})]}),e.jsx("button",{style:N,onClick:v,disabled:r,"aria-label":"Close",children:"Ã—"})]}),e.jsxs("div",{style:q,children:[e.jsxs("p",{style:T,children:["We'll remove ",e.jsx("strong",{children:S})," from your suggestions. If you'd like, let us know why it wasn't a good fit:"]}),e.jsxs("label",{style:c,children:["Feedback ",e.jsx("span",{style:{color:"#9CA3AF",fontWeight:400},children:"(optional)"})]}),e.jsxs("div",{style:E,children:[e.jsx("textarea",{value:h,onChange:_=>d(_.target.value.slice(0,g)),placeholder:"e.g., Too far from my workplace, price is outside my budget, looking for a different neighborhood...",style:F,disabled:r,"aria-label":"Feedback about why this suggestion doesn't work"}),e.jsxs("span",{style:f,children:[h.length,"/",g]})]})]}),e.jsxs("div",{style:x,children:[e.jsx("button",{style:C,onClick:v,disabled:r,children:"Cancel"}),e.jsx("button",{style:U,onClick:w,disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{style:B}),"Processing..."]}):"Confirm"})]})]})]});return Fe.createPortal(W,document.body)}const vs={"1607041299637x913970439175620100":"Brooklyn","1607041299687x679479834266385900":"Manhattan","1607041299715x741251947580746200":"Bronx","1607041299828x406969561802059650":"Queens","1686599616073x348655546878883200":"Weehawken, NJ","1686674905048x436838997624262400":"Newark, NJ","1607041299795x174606299553766500":"Staten Island"},Se=t=>!t||typeof t!="string"?!1:t.includes("x")&&t.length>20;function Ss({proposal:t,currentIndex:n,totalCount:s,onInterested:o,onRemove:r,onNext:h,onPrevious:d,onClose:g,isVisible:w,isProcessing:v=!1,googleMapsApiKey:p,isNotInterestedModalOpen:y=!1,onCloseNotInterestedModal:S,onConfirmNotInterested:P}){var _;const I=i.useCallback($=>{$.target===$.currentTarget&&g()},[g]);if(!w||!t)return null;const k=t._listing||{},A=k["Features - Photos"]||[],O=k.Name||"Unnamed Listing",G=k["Location - Address"],N=typeof G=="string"?(()=>{try{return JSON.parse(G)}catch{return null}})():G,q=(N==null?void 0:N.address)||"",T=N!=null&&N.lat&&(N!=null&&N.lng)?{lat:N.lat,lng:N.lng}:k["Location - Coordinates"]||null,c=k["Location - Borough"]||"",E=vs[c]||(Se(c)?"":c),F=k["Location - Hood"]||k["neighborhood (manual input by user)"]||"",f=Se(F)?"":F,C=((_=(t._negotiationSummaries||[])[0])==null?void 0:_.Summary)||null,U=t["Move in range start"]?new Date(t["Move in range start"]).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"TBD",B=t["Reservation Span (Weeks)"]||0,W=Math.round(B/4);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sp-popup-backdrop",onClick:I,"aria-hidden":"true"}),e.jsx("div",{className:"sp-popup-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"sp-popup-title",children:e.jsxs("div",{className:"sp-popup-card",children:[e.jsx("div",{className:"sp-popup-grab-handle","aria-hidden":"true"}),e.jsxs("div",{className:"sp-popup-header",children:[e.jsxs("div",{className:"sp-popup-header-left",children:[e.jsx("span",{className:"sp-popup-badge",children:"Suggested for You"}),e.jsxs("span",{className:"sp-popup-counter",children:[n+1," of ",s]})]}),e.jsxs("div",{className:"sp-popup-header-right",children:[s>1&&e.jsxs("div",{className:"sp-popup-nav",children:[e.jsx("button",{className:"sp-popup-nav-btn",onClick:d,"aria-label":"Previous proposal",type:"button",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})})}),e.jsx("button",{className:"sp-popup-nav-btn",onClick:h,"aria-label":"Next proposal",type:"button",children:e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:e.jsx("polyline",{points:"9 18 15 12 9 6"})})})]}),e.jsx("button",{className:"sp-popup-close-btn",onClick:g,"aria-label":"Close popup",type:"button",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}),e.jsxs("div",{className:"sp-popup-content",children:[e.jsxs("div",{className:"sp-popup-left",children:[e.jsx(rs,{photos:A,listingName:O}),e.jsx("h2",{id:"sp-popup-title",className:"sp-popup-title",children:O}),e.jsx("p",{className:"sp-popup-address",children:f&&E?`${f}, ${E}`:f||E||q||"Location not available"}),e.jsxs("div",{className:"sp-popup-dates",children:[e.jsx("span",{className:"sp-popup-date-label",children:"Move-in:"}),e.jsx("span",{className:"sp-popup-date-value",children:U}),e.jsx("span",{className:"sp-popup-date-separator",children:"Â·"}),e.jsx("span",{className:"sp-popup-date-label",children:"Duration:"}),e.jsxs("span",{className:"sp-popup-date-value",children:[W," month",W!==1?"s":""]})]}),e.jsx(ps,{listing:k}),e.jsx(hs,{nightlyPrice:t["proposal nightly price"],totalPrice:t["Total Price for Reservation (guest)"]}),e.jsx(gs,{onInterested:o,onRemove:r,isProcessing:v})]}),e.jsxs("div",{className:"sp-popup-right",children:[e.jsx(ms,{geoPoint:T,address:q,googleMapsApiKey:p}),e.jsx(xs,{summary:C})]})]})]})}),e.jsx(ys,{isOpen:y,proposal:t,onClose:S,onConfirm:P,isProcessing:v})]})}function ws({onClick:t,isActive:n=!1,proposalCount:s=0}){const o=i.useRef(null);i.useEffect(()=>{if(document.querySelector('script[src*="lottie-player"]'))return;const h=document.createElement("script");h.src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js",h.async=!0,document.body.appendChild(h)},[]),i.useEffect(()=>{if(s===0)return;const d=setTimeout(()=>{const g=o.current;g&&g.play&&(g.seek(0),g.play())},100);return()=>clearTimeout(d)},[s]);const r=()=>{const h=o.current;h&&h.play&&(h.seek(0),h.play())};return s===0?null:e.jsxs("button",{className:`header-sp-trigger ${n?"header-sp-trigger--active":""}`,onClick:t,onMouseEnter:r,"aria-label":`View ${s} suggested proposal${s!==1?"s":""}`,type:"button",title:"You have suggested listings waiting for your review",children:[e.jsx("span",{className:"header-sp-trigger__icon","aria-hidden":"true",children:e.jsx("lottie-player",{ref:o,src:"/assets/lotties/proposals-suggested.json",background:"transparent",speed:"0.4",style:{width:"88px",height:"88px"}})}),e.jsx("span",{className:"header-sp-trigger__badge","aria-hidden":"true",children:s>9?"9+":s})]})}async function js(t){if(!t)return{success:!1,error:"No proposal ID provided"};try{const{error:n}=await b.from("proposal").update({Status:"Proposal Submitted by guest - Awaiting Rental Application","Modified Date":new Date().toISOString()}).eq("_id",t);return n?(console.error("Error marking proposal interested:",n),{success:!1,error:n.message}):(console.log(`Marked proposal ${t} as interested`),{success:!0})}catch(n){return console.error("Exception marking proposal interested:",n),{success:!1,error:n.message}}}async function Ns(t,n=null){if(!t)return{success:!1,error:"No proposal ID provided"};try{const s={Deleted:!0,"Modified Date":new Date().toISOString()};n&&n.trim()&&(s["Guest Comments"]=`[Not Interested] ${n.trim()}`);const{error:o}=await b.from("proposal").update(s).eq("_id",t);return o?(console.error("Error dismissing proposal:",o),{success:!1,error:o.message}):(console.log(`Dismissed proposal ${t}${n?" with feedback":""}`),{success:!0})}catch(s){return console.error("Exception dismissing proposal:",s),{success:!1,error:s.message}}}async function bs(t){if(!t)return 0;try{const{data:n,error:s}=await b.from("user").select('"Proposals List"').eq("_id",t).single();if(s||!(n!=null&&n["Proposals List"]))return 0;const o=n["Proposals List"];if(!Array.isArray(o)||o.length===0)return 0;const{data:r,error:h}=await b.from("proposal").select("_id, Status").in("_id",o).or("Deleted.is.null,Deleted.eq.false");return h||!r?0:r.filter(g=>we(g.Status)).length}catch(n){return console.error("Exception in fetchPendingConfirmationCount:",n),0}}async function Ls(t){if(!t)return console.warn("fetchPendingConfirmationProposals: No userId provided"),[];try{const{data:n,error:s}=await b.from("user").select('"Proposals List"').eq("_id",t).single();if(s)return console.error("Error fetching user proposals list:",s),[];const o=n==null?void 0:n["Proposals List"];if(!o||!Array.isArray(o)||o.length===0)return[];const{data:r,error:h}=await b.from("proposal").select("*").in("_id",o).or("Deleted.is.null,Deleted.eq.false").order("Created Date",{ascending:!1});if(h)return console.error("Error fetching proposals:",h),[];const d=(r||[]).filter(p=>we(p.Status));if(d.length===0)return[];const g=await Promise.all(d.map(p=>Ye(p))),w=g.map(p=>p._id),{data:v}=await b.from("negotiationsummary").select("*").in('"Proposal associated"',w).eq('"To Account"',t).order('"Created Date"',{ascending:!1});if(v&&v.length>0){const p={};v.forEach(y=>{const S=y["Proposal associated"];p[S]||(p[S]=[]),p[S].push(y)}),g.forEach(y=>{y._negotiationSummaries=p[y._id]||[]})}return g}catch(n){return console.error("Exception in fetchPendingConfirmationProposals:",n),[]}}function Os({autoShowLogin:t=!1}){var ge;const[n,s]=i.useState(!1),[o,r]=i.useState(null),[h,d]=i.useState(!0),[g,w]=i.useState(0),[v,p]=i.useState(t),[y,S]=i.useState("initial"),[P,I]=i.useState(null),[k,A]=i.useState(null),O=Ue(),G=We(),N=ee(),q=fe(),T=!!(O&&qe()),[c,E]=i.useState(()=>T?{userId:q,firstName:O,profilePhoto:G,userType:N,_isOptimistic:!0}:null),[F,f]=i.useState(T),[x,C]=i.useState(N),[U,B]=i.useState(!1),[W,_]=i.useState(0),[$,K]=i.useState(!1),[z,te]=i.useState([]),[H,J]=i.useState(0),[je,Z]=i.useState(!1),[Ne,ae]=i.useState(!1),ce=(c==null?void 0:c.userId)||(c==null?void 0:c.id)||"",de=!!c,{state:be}=ts(ce,de),{state:Le}=os(ce,de);i.useEffect(()=>{const a=Be(),u=async()=>{var D,R,me;let l=!1,m=null;try{const{data:M}=await b.auth.getSession();if(m=M==null?void 0:M.session,l=!!m,!l){console.log("[Header] No immediate Supabase session, waiting briefly for initialization..."),await new Promise(Ge=>setTimeout(Ge,200));const{data:Y}=await b.auth.getSession();m=Y==null?void 0:Y.session,l=!!m,l&&console.log("[Header] âœ… Found Supabase session after brief wait")}}catch(M){console.log("[Header] Error checking Supabase session:",M.message)}if(!a&&!l&&!T){console.log("[Header] No auth state - confirming logged-out UI"),f(!0),E(null);return}console.log(`[Header] Auth found (legacy token: ${!!a}, Supabase session: ${l}, cached auth: ${T}) - validating...`);try{const M=await xe({clearOnFailure:!1});if(M)E(M),C(ee()),console.log("[Header] Background validation successful:",M.firstName);else if(console.log("[Header] Background validation returned no user data"),l){if(console.log("[Header] Supabase session exists - preserving auth state"),m!=null&&m.user){const Y=((D=m.user.user_metadata)==null?void 0:D.user_id)||fe()||m.user.id;E({userId:Y,firstName:((R=m.user.user_metadata)==null?void 0:R.first_name)||((me=m.user.email)==null?void 0:me.split("@")[0])||"User",email:m.user.email,_isFromSession:!0})}}else E(null),console.log("[Header] Background validation failed - clearing auth UI"),X()&&!t?$e()?console.log("âš ï¸ Auth error present in URL, not redirecting to prevent loop"):(console.log("âš ï¸ Invalid token on protected page - redirecting to home"),window.location.replace("/")):X()&&t&&console.log("âš ï¸ Invalid token on protected page - auth modal will be shown")}catch(M){console.error("Auth validation error:",M),l||E(null)}f(!0)};document.readyState==="complete"?u():window.addEventListener("load",u,{once:!0})},[t,T]);const ne=i.useRef(!1);i.useEffect(()=>{const{data:{subscription:a}}=b.auth.onAuthStateChange((u,l)=>{if(console.log("[Header] Auth state changed:",u),(u==="SIGNED_IN"||u==="INITIAL_SESSION")&&l){if(ne.current){console.log("[Header] Sign-in already handled, skipping duplicate event:",u);return}ne.current=!0,console.log("[Header] User signed in, deferring UI update to avoid deadlock..."),setTimeout(async()=>{var m,D;try{console.log("[Header] Now updating UI...");const R=await xe({clearOnFailure:!1});R?(E(R),C(ee()),f(!0),console.log("[Header] UI updated for:",R.firstName)):(console.log("[Header] User profile fetch failed, using session data"),l!=null&&l.user&&(E({firstName:((m=l.user.user_metadata)==null?void 0:m.first_name)||((D=l.user.email)==null?void 0:D.split("@")[0])||"User",email:l.user.email,_isFromSession:!0}),f(!0)))}catch(R){console.error("[Header] Error updating user data after sign in:",R)}},0)}else u==="SIGNED_OUT"&&(ne.current=!1,console.log("[Header] User signed out, reloading page..."),X()?window.location.href="/":window.location.reload())});return()=>{a.unsubscribe()}},[]),i.useEffect(()=>{const a=m=>{console.log("[Header] OAuth login success:",m.detail)},u=m=>{console.log("[Header] OAuth login error:",m.detail.error)},l=m=>{console.log("[Header] OAuth user not found:",m.detail.email),I(m.detail.email),S("signup"),p(!0)};return window.addEventListener("oauth-login-success",a),window.addEventListener("oauth-login-error",u),window.addEventListener("oauth-login-user-not-found",l),()=>{window.removeEventListener("oauth-login-success",a),window.removeEventListener("oauth-login-error",u),window.removeEventListener("oauth-login-user-not-found",l)}},[]),i.useEffect(()=>{const a=()=>{const u=ee();C(u)};return document.readyState==="complete"?a():window.addEventListener("load",a),c&&a(),window.addEventListener("storage",a),()=>{window.removeEventListener("load",a),window.removeEventListener("storage",a)}},[c]);const ue=()=>x?x.includes("Host")||x==="Split Lease":!1,oe=()=>x?x.includes("Guest")||x==="Split Lease":!1;i.useEffect(()=>{c&&F&&(async()=>{if(!(c!=null&&c.userId)&&!(c!=null&&c.id)||!oe())return;const u=c.userId||c.id,l=await bs(u);_(l)})()},[c,F,x]),i.useEffect(()=>{const a=()=>{const u=window.scrollY;u>g&&u>100?d(!1):d(!0),w(u)};return window.addEventListener("scroll",a,{passive:!0}),()=>{window.removeEventListener("scroll",a)}},[g]),i.useEffect(()=>{const a=u=>{u.target.closest(".nav-dropdown")||r(null)};return document.addEventListener("click",a),()=>{document.removeEventListener("click",a)}},[]);const ke=()=>{s(!n)},re=a=>{r(o===a?null:a)},Ce=()=>{S("login"),p(!0)},pe=()=>{A(null),S("signup"),p(!0)},_e=()=>{A("host"),S("signup"),p(!0)},Pe=()=>{p(!1),I(null),A(null)},Ee=a=>{console.log("âœ… Authentication successful:",a)},he=(a,u)=>{a.key==="Enter"||a.key===" "?(a.preventDefault(),re(u)):a.key==="Escape"&&r(null)},Ie=async()=>{console.log("ðŸ”“ Logging out...");const a=await ze();a.success?(console.log("âœ… Logout successful"),X()?(console.log("ðŸ“ On protected page - redirecting to home"),window.location.href="/"):(console.log("ðŸ“ On public page - reloading"),window.location.reload())):console.error("âŒ Logout failed:",a.error)},Ae=async()=>{if($){K(!1);return}const a=(c==null?void 0:c.userId)||(c==null?void 0:c.id);if(!a)return;const u=await Ls(a);te(u),J(0),K(!0)},Oe=async()=>{const a=z[H];if(!a)return;Z(!0);const u=await js(a._id);if(Z(!1),u.success){const l=z.filter((m,D)=>D!==H);te(l),_(m=>Math.max(0,m-1)),l.length===0?K(!1):H>=l.length&&J(l.length-1)}},Te=()=>{z[H]&&ae(!0)},He=()=>{ae(!1)},Me=async(a=null)=>{const u=z[H];if(!u)return;Z(!0);const l=await Ns(u._id,a);if(Z(!1),l.success){ae(!1);const m=z.filter((D,R)=>R!==H);te(m),_(D=>Math.max(0,D-1)),m.length===0?K(!1):H>=m.length&&J(m.length-1)}},De=()=>{H<z.length-1&&J(a=>a+1)},Re=()=>{H>0&&J(a=>a-1)};return e.jsxs("header",{className:`main-header ${h?"header-visible":"header-hidden"}`,children:[e.jsxs("nav",{className:"nav-container",children:[e.jsx("div",{className:"nav-left",children:e.jsxs("a",{href:"/",className:"logo",children:[e.jsx("img",{src:"/assets/images/logo.png",alt:"Split Lease",className:"logo-image"}),e.jsx("span",{className:"logo-text",children:"Split Lease"})]})}),e.jsxs("button",{className:`hamburger-menu ${n?"active":""}`,"aria-label":"Toggle navigation menu",onClick:ke,children:[e.jsx("span",{className:"hamburger-line"}),e.jsx("span",{className:"hamburger-line"}),e.jsx("span",{className:"hamburger-line"})]}),e.jsxs("div",{className:`nav-center ${n?"mobile-active":""}`,children:[(!c||!x||ue())&&e.jsxs("div",{className:"nav-dropdown",children:[e.jsxs("a",{href:"#host",className:"nav-link dropdown-trigger",role:"button","aria-expanded":o==="host","aria-haspopup":"true",onClick:a=>{a.preventDefault(),a.stopPropagation(),re("host")},onKeyDown:a=>he(a,"host"),children:[e.jsx("span",{className:"mobile-text",children:"Host"}),e.jsx("span",{className:"desktop-text",children:"Host with Us"}),e.jsx("svg",{className:"dropdown-arrow",width:"12",height:"8",viewBox:"0 0 12 8",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]}),e.jsx("div",{className:`dropdown-menu dropdown-menu-host ${o==="host"?"active":""}`,role:"menu","aria-label":"Host with Us menu",children:(()=>{const a=ss(be,_e),u=a.featured;return e.jsxs("div",{className:"mega-menu-content",children:[e.jsxs("div",{className:"mega-menu-featured",children:[e.jsx("div",{className:"featured-image",children:e.jsx("img",{src:u.image,alt:""})}),e.jsx("h3",{className:"featured-title",children:u.title}),e.jsx("p",{className:"featured-desc",children:u.desc}),e.jsxs("a",{href:u.ctaHref,className:"featured-link",onClick:()=>{r(null),s(!1)},children:[e.jsx("span",{children:u.cta}),e.jsx("svg",{className:"featured-link-arrow",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:e.jsx("path",{d:"M3 8H13M13 8L9 4M13 8L9 12",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}),e.jsx("div",{className:"menu-separator"}),e.jsxs("div",{className:"mega-menu-columns",children:[e.jsxs("div",{className:"menu-column",children:[e.jsx("div",{className:"menu-column-title",children:"Learn"}),a.items.slice(0,Math.ceil(a.items.length/2)).map(l=>e.jsx("a",{href:l.href,className:"dropdown-item",role:"menuitem",onClick:l.action?m=>{m.preventDefault(),r(null),s(!1),l.action()}:()=>{r(null),s(!1)},children:e.jsx("span",{className:"dropdown-title",children:l.title})},l.id))]}),e.jsxs("div",{className:"menu-column",children:[e.jsx("div",{className:"menu-column-title",children:"Get Started"}),a.items.slice(Math.ceil(a.items.length/2)).map(l=>e.jsx("a",{href:l.href,className:"dropdown-item",role:"menuitem",onClick:l.action?m=>{m.preventDefault(),r(null),s(!1),l.action()}:()=>{r(null),s(!1)},children:e.jsx("span",{className:"dropdown-title",children:l.title})},l.id)),e.jsx("div",{className:"dropdown-separator"}),e.jsx("a",{href:a.cta.href||"#",className:"dropdown-cta",role:"menuitem",onClick:a.cta.action?l=>{l.preventDefault(),r(null),s(!1),a.cta.action()}:()=>{r(null),s(!1)},children:a.cta.label})]})]})]})})()})]}),(!c||!x||oe())&&e.jsxs("div",{className:"nav-dropdown",children:[e.jsxs("a",{href:"#stay",className:"nav-link dropdown-trigger",role:"button","aria-expanded":o==="stay","aria-haspopup":"true",onClick:a=>{a.preventDefault(),a.stopPropagation(),re("stay")},onKeyDown:a=>he(a,"stay"),children:[e.jsx("span",{className:"mobile-text",children:"Guest"}),e.jsx("span",{className:"desktop-text",children:"Stay with Us"}),e.jsx("svg",{className:"dropdown-arrow",width:"12",height:"8",viewBox:"0 0 12 8",fill:"none","aria-hidden":"true",children:e.jsx("path",{d:"M1 1.5L6 6.5L11 1.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]}),e.jsx("div",{className:`dropdown-menu dropdown-menu-guest ${o==="stay"?"active":""}`,role:"menu","aria-label":"Stay with Us menu",children:(()=>{const a=ns(Le,pe),u=a.featured;return e.jsxs("div",{className:"mega-menu-content",children:[e.jsxs("div",{className:"mega-menu-featured",children:[e.jsx("div",{className:"featured-image",children:e.jsx("img",{src:u.image,alt:""})}),e.jsx("h3",{className:"featured-title",children:u.title}),e.jsx("p",{className:"featured-desc",children:u.desc}),e.jsxs("a",{href:u.ctaHref,className:"featured-link",onClick:()=>{r(null),s(!1)},children:[e.jsx("span",{children:u.cta}),e.jsx("svg",{className:"featured-link-arrow",width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:e.jsx("path",{d:"M3 8H13M13 8L9 4M13 8L9 12",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}),e.jsx("div",{className:"menu-separator"}),e.jsxs("div",{className:"mega-menu-columns",children:[e.jsxs("div",{className:"menu-column",children:[e.jsx("div",{className:"menu-column-title",children:"Discover"}),a.items.slice(0,Math.ceil(a.items.length/2)).map(l=>e.jsx("a",{href:l.href,className:"dropdown-item",role:"menuitem",onClick:l.action?m=>{m.preventDefault(),r(null),s(!1),l.action()}:()=>{r(null),s(!1)},children:e.jsx("span",{className:"dropdown-title",children:l.title})},l.id))]}),e.jsxs("div",{className:"menu-column",children:[e.jsx("div",{className:"menu-column-title",children:"Get Started"}),a.items.slice(Math.ceil(a.items.length/2)).map(l=>e.jsx("a",{href:l.href,className:"dropdown-item",role:"menuitem",onClick:l.action?m=>{m.preventDefault(),r(null),s(!1),l.action()}:()=>{r(null),s(!1)},children:e.jsx("span",{className:"dropdown-title",children:l.title})},l.id)),e.jsx("div",{className:"dropdown-separator"}),e.jsx("a",{href:a.cta.href||"#",className:"dropdown-cta",role:"menuitem",onClick:a.cta.action?l=>{l.preventDefault(),r(null),s(!1),a.cta.action()}:()=>{r(null),s(!1)},children:a.cta.label})]})]})]})})()})]})]}),e.jsxs("div",{className:`nav-right ${n?"mobile-active":""}`,children:[c&&oe()&&W>0&&window.location.pathname!=="/guest-proposals"&&e.jsx(ws,{onClick:Ae,isActive:$,proposalCount:W}),c&&ue()?e.jsx("a",{href:Ve,className:"explore-rentals-btn",children:"Host Overview"}):e.jsx("a",{href:V,className:"explore-rentals-btn",children:"Explore Rentals"}),c&&c.firstName?e.jsx(Qe,{user:{id:c.userId||c.id||"",name:`${c.firstName} ${c.lastName||""}`.trim(),email:c.email||"",userType:x?x==="Host"||x==="A Host (I have a space available to rent)"||x==="Split Lease"?"HOST":x==="Trial Host"?"TRIAL_HOST":x==="Guest"||x==="A Guest (I would like to rent a space)"?"GUEST":x.includes("Host")&&!x.includes("Trial")?"HOST":x.includes("Trial")?"TRIAL_HOST":"GUEST":"GUEST",avatarUrl:(ge=c.profilePhoto)!=null&&ge.startsWith("//")?`https:${c.profilePhoto}`:c.profilePhoto,proposalsCount:c.proposalsCount||0,listingsCount:c.listingsCount||0,virtualMeetingsCount:c.virtualMeetingsCount||0,houseManualsCount:c.houseManualsCount||0,leasesCount:c.leasesCount||0,favoritesCount:c.favoritesCount||0,unreadMessagesCount:c.unreadMessagesCount||0},currentPath:window.location.pathname,onNavigate:a=>{window.location.href=a},onLogout:Ie}):e.jsxs(e.Fragment,{children:[e.jsx("a",{href:"#",className:"nav-link",onClick:a=>{a.preventDefault(),Ce()},children:"Sign In"}),e.jsx("a",{href:"#",className:"nav-link",onClick:a=>{a.preventDefault(),pe()},children:"Sign Up"})]})]})]}),e.jsx(Ke,{isOpen:v,onClose:Pe,initialView:y,onAuthSuccess:Ee,disableClose:t&&X(),prefillEmail:P,defaultUserType:k}),U&&e.jsx(es,{isVisible:U,onClose:()=>B(!1),currentUser:c}),e.jsx(Ss,{proposal:z[H],currentIndex:H,totalCount:z.length,onInterested:Oe,onRemove:Te,onNext:De,onPrevious:Re,onClose:()=>K(!1),isVisible:$,isProcessing:je,isNotInterestedModalOpen:Ne,onCloseNotInterestedModal:He,onConfirmNotInterested:Me})]})}export{es as C,Os as H,ys as N,Ns as d};

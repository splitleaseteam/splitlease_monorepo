import{r as o,j as e,c as qe,R as We}from"./client-BJVKzfAi.js";import{H as ge,C as Ae}from"./Header-BJKWma2V.js";import{F as fe,I as Ye}from"./Footer-Bzf1rLKh.js";import{S as Ge}from"./ScheduleCohost-BCDCqUUA.js";import{e as Je}from"./supabaseUtils-B40jh603.js";import{v as ye,c as je,i as ze,g as Ke}from"./auth-QZ4BJadW.js";import{s as L}from"./supabase-BoCLEw6R.js";import{i as Qe,a as _e}from"./dataLookups-zG18yzis.js";import{E as Xe}from"./ErrorBoundary-9_HbXv1y.js";/* empty css             */import"./config-QPKPRtag.js";import"./constants-CPVJY5eo.js";import"./Toast-BQk6Nzgd.js";import"./proposalDataFetcher-CipdyWU2.js";import"./proposalStatuses-1Bj0NYR4.js";const Ne=()=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),Ze=()=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),es=()=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),ss=({isOpen:s=!1,onClose:l=()=>{},onConfirm:n=()=>{},title:p="Delete Item",itemName:h="",message:y="",warning:N="",confirmText:j="Delete",cancelText:w="Cancel",isLoading:x=!1})=>{o.useEffect(()=>{const C=_=>{_.key==="Escape"&&s&&l()};return document.addEventListener("keydown",C),()=>document.removeEventListener("keydown",C)},[s,l]),o.useEffect(()=>(s?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[s]);const v=C=>{C.target===C.currentTarget&&l()},R=()=>{n()};if(!s)return null;const F=y||`Are you sure you want to delete "${h}"? This action cannot be undone.`;return e.jsx("div",{className:"confirm-delete-modal-overlay",onClick:v,role:"dialog","aria-modal":"true","aria-labelledby":"confirm-delete-modal-title",children:e.jsxs("div",{className:"confirm-delete-modal-container",onClick:C=>C.stopPropagation(),children:[e.jsx("div",{className:"confirm-delete-modal-grab-handle","aria-hidden":"true"}),e.jsxs("header",{className:"confirm-delete-modal-header",children:[e.jsxs("div",{className:"confirm-delete-modal-header-content",children:[e.jsx("span",{className:"confirm-delete-modal-icon confirm-delete-modal-icon--danger","aria-hidden":"true",children:e.jsx(Ne,{})}),e.jsx("h2",{id:"confirm-delete-modal-title",className:"confirm-delete-modal-title",children:p})]}),e.jsx("button",{onClick:l,className:"confirm-delete-modal-close-btn","aria-label":"Close modal",type:"button",children:e.jsx(Ze,{})})]}),e.jsxs("div",{className:"confirm-delete-modal-body",children:[h&&e.jsxs("div",{className:"confirm-delete-modal-item-preview",children:[e.jsx("div",{className:"confirm-delete-modal-item-icon",children:e.jsx(Ne,{})}),e.jsxs("div",{className:"confirm-delete-modal-item-info",children:[e.jsx("span",{className:"confirm-delete-modal-item-name",children:h}),e.jsx("span",{className:"confirm-delete-modal-item-label",children:"Will be permanently deleted"})]})]}),e.jsx("p",{className:"confirm-delete-modal-message",children:F}),N&&e.jsxs("div",{className:"confirm-delete-modal-warning",role:"alert",children:[e.jsx("div",{className:"confirm-delete-modal-warning-icon",children:e.jsx(es,{})}),e.jsx("p",{className:"confirm-delete-modal-warning-text",children:N})]})]}),e.jsxs("footer",{className:"confirm-delete-modal-footer",children:[e.jsx("button",{type:"button",className:"confirm-delete-modal-btn confirm-delete-modal-btn--secondary",onClick:l,disabled:x,children:w}),e.jsx("button",{type:"button",disabled:x,className:"confirm-delete-modal-btn confirm-delete-modal-btn--danger",onClick:R,children:x?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"confirm-delete-modal-spinner","aria-hidden":"true"}),"Deleting..."]}):j})]})]})})};function de({children:s,className:l="",onClick:n,hover:p=!1}){const h=["host-card",p&&"host-card--hover",n&&"host-card--clickable",l].filter(Boolean).join(" ");return e.jsx("div",{className:h,onClick:n,children:s})}function O(s){if(s==null)return null;const l=parseFloat(s);return isNaN(l)?null:`$${l.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:0})}`}function ts({listing:s,onEdit:l,onPreview:n,onDelete:p,onProposals:h,onCardClick:y,isMobile:N=!1}){var K;const j=s.name||s.Name||"Unnamed Listing",w=((K=s.location)==null?void 0:K.borough)||s["Location - Borough"]||"Location not specified",x=s.complete||s.Complete,v=s.leasesCount||s["Leases Count"]||0,R=s.proposalsCount||s["Proposals Count"]||0,F=s.photos||s["Features - Photos"]||[],C=Je(F,{},s.id||s._id),_=C.length>0?C[0]:null,S=s.rental_type||s["rental type"]||"Nightly",Y=s.monthly_rate||s["ðŸ’°Monthly Host Rate"],G=s.weekly_rate||s["ðŸ’°Weekly Host Rate"],J=s.cleaning_fee||s["ðŸ’°Cleaning Cost / Maintenance Fee"],U=s.damage_deposit||s["ðŸ’°Damage Deposit"],B=s.nightly_pricing,$=[s.nightly_rate_2||s["ðŸ’°Nightly Host Rate for 2 nights"],s.nightly_rate_3||s["ðŸ’°Nightly Host Rate for 3 nights"],s.nightly_rate_4||s["ðŸ’°Nightly Host Rate for 4 nights"],s.nightly_rate_5||s.rate_5_nights||s["ðŸ’°Nightly Host Rate for 5 nights"],s.nightly_rate_7||s["ðŸ’°Nightly Host Rate for 7 nights"]].filter(g=>g!=null&&!isNaN(parseFloat(g))),H=()=>{if($.length===0)return null;const g=$.map(W=>parseFloat(W));return{min:Math.min(...g),max:Math.max(...g)}},M=(()=>{if(S==="Monthly"&&Y)return{amount:O(Y),period:"/month",label:"Monthly Rate",isRange:!1};if(S==="Weekly"&&G)return{amount:O(G),period:"/week",label:"Weekly Rate",isRange:!1};const g=H();return g?g.min===g.max?{amount:O(g.min),period:"/night",label:"Nightly Rate",isRange:!1}:{amount:`${O(g.min)} - ${O(g.max)}`,period:"/night",label:"Nightly Rate Range",isRange:!0}:B!=null&&B.oneNightPrice?{amount:O(B.oneNightPrice),period:"/night",label:"Nightly Rate",isRange:!1}:null})(),q=()=>{y&&y(s)},Z=g=>{g.stopPropagation(),h&&h(s)};return e.jsxs(de,{className:"listing-card",hover:!0,onClick:q,children:[e.jsx("div",{className:"listing-card__image-section",children:_?e.jsx("div",{className:"listing-card__images",children:e.jsx("img",{src:_,alt:j,className:"listing-card__image"})}):e.jsxs("div",{className:"listing-card__image-placeholder",children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]}),e.jsx("span",{children:"No photos"})]})}),e.jsxs("div",{className:"listing-card__content",children:[e.jsxs("div",{className:"listing-card__left",children:[e.jsxs("div",{className:"listing-card__header",children:[e.jsxs("div",{className:"listing-card__info",children:[e.jsx("h3",{className:"listing-card__name",children:j}),e.jsx("p",{className:"listing-card__location",children:w}),e.jsx("p",{className:"listing-card__status",children:x?"Complete":"Draft"})]}),e.jsx("button",{className:"listing-card__delete",onClick:g=>{g.stopPropagation(),p(s)},"aria-label":"Delete listing",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]}),v>0&&e.jsx("div",{className:"listing-card__badges",children:e.jsxs("div",{className:"badge badge--leases",children:["Leases: ",v]})}),e.jsxs("div",{className:"listing-card__actions",children:[e.jsx("button",{className:"btn btn--primary",onClick:g=>{g.stopPropagation(),l(s)},children:"Manage"}),e.jsx("button",{className:"btn btn--secondary",onClick:g=>{g.stopPropagation(),n(s)},children:"Preview"}),R>0&&e.jsxs("button",{className:"btn btn--proposals",onClick:Z,children:["Proposals (",R,")"]})]})]}),e.jsx("div",{className:"listing-card__right",children:M?e.jsxs("div",{className:"listing-card__pricing",children:[e.jsxs("div",{className:"listing-card__pricing-main",children:[e.jsx("span",{className:"listing-card__price",children:M.amount}),e.jsx("span",{className:"listing-card__period",children:M.period})]}),e.jsxs("div",{className:"listing-card__pricing-label",children:[S," Lease"]}),e.jsxs("div",{className:"listing-card__pricing-details",children:[J>0&&e.jsxs("div",{className:"listing-card__pricing-item",children:[e.jsx("span",{className:"label",children:"Cleaning:"}),e.jsx("span",{className:"value",children:O(J)})]}),U>0&&e.jsxs("div",{className:"listing-card__pricing-item",children:[e.jsx("span",{className:"label",children:"Deposit:"}),e.jsx("span",{className:"value",children:O(U)})]})]})]}):e.jsx("div",{className:"listing-card__pricing listing-card__pricing--empty",children:e.jsx("span",{className:"listing-card__pricing-empty",children:"No pricing"})})})]})]})}function as({listing:s,onSeeDetails:l,onDelete:n}){var N;const p=s.name||s.Name||"Unnamed Listing",h=((N=s.location)==null?void 0:N.borough)||s["Location - Borough"]||"Location not specified",y=s.complete||s.Complete;return e.jsx(de,{className:"claim-listing-card",children:e.jsxs("div",{className:"claim-listing-card__content",children:[e.jsxs("div",{className:"claim-listing-card__info",children:[e.jsx("h3",{className:"claim-listing-card__name",children:p}),e.jsx("p",{className:"claim-listing-card__status",children:y?"Complete":"Incomplete"}),e.jsx("p",{className:"claim-listing-card__location",children:h})]}),e.jsxs("div",{className:"claim-listing-card__actions",children:[e.jsx("button",{className:"btn btn--action",onClick:()=>l(s),children:"See Details"}),e.jsx("button",{className:"claim-listing-card__delete",onClick:()=>n(s),"aria-label":"Remove from list",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]})]})})}function ns({manual:s,onEdit:l,onDelete:n,onViewVisits:p,isMobile:h=!1}){var x;const y=s.display||s.Display||"House Manual",N=s.audience||((x=s.Audience)==null?void 0:x.Display)||"Not specified",j=s.createdOn||s["Created Date"],w=v=>{if(!v)return"Unknown date";try{return new Date(v).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch{return"Unknown date"}};return e.jsx(de,{className:"house-manual-card",hover:!0,children:e.jsxs("div",{className:"house-manual-card__content",children:[e.jsxs("div",{className:"house-manual-card__header",children:[e.jsxs("div",{className:"house-manual-card__info",children:[e.jsx("h3",{className:"house-manual-card__title",children:y}),e.jsxs("p",{className:"house-manual-card__audience",children:["Audience: ",N]}),e.jsxs("p",{className:"house-manual-card__date",children:["Created: ",w(j)]})]}),e.jsx("button",{className:"house-manual-card__delete",onClick:v=>{v.stopPropagation(),n(s)},"aria-label":"Delete house manual",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]})})]}),e.jsxs("div",{className:"house-manual-card__actions",children:[e.jsx("button",{className:"btn btn--primary",onClick:()=>l(s),children:"View/Edit Manual"}),e.jsx("button",{className:"btn btn--ghost",onClick:()=>p(s),children:"Visits"})]})]})})}function os({meeting:s,onRespond:l}){var j,w;const n=((j=s.guest)==null?void 0:j.firstName)||s.guestFirstName||"Guest",p=((w=s.listing)==null?void 0:w.name)||s.listingName||"Listing",h=s.bookedDate||s.booked_date,y=s.notifications||[],N=x=>{if(!x)return"Date not set";try{return new Date(x).toLocaleString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}catch{return"Date not set"}};return e.jsx(de,{className:"virtual-meeting-card",children:e.jsxs("div",{className:"virtual-meeting-card__content",children:[e.jsxs("div",{className:"virtual-meeting-card__header",children:[e.jsx("h3",{className:"virtual-meeting-card__guest",children:n}),e.jsx("p",{className:"virtual-meeting-card__listing",children:p})]}),e.jsxs("div",{className:"virtual-meeting-card__info",children:[e.jsx("div",{className:"virtual-meeting-card__status",children:"Virtual meeting booked"}),e.jsx("div",{className:"virtual-meeting-card__date",children:N(h)})]}),y.length>0&&e.jsx("div",{className:"virtual-meeting-card__notifications",children:y.map((x,v)=>e.jsx("div",{className:"virtual-meeting-notification",children:x},v))}),e.jsx("button",{className:"btn btn--primary",onClick:()=>l(s),children:"Respond to Virtual Meeting"})]})})}function is({id:s,title:l,message:n,type:p="information",duration:h=3e3,onClose:y}){const[N,j]=o.useState(100),[w,x]=o.useState(!1);o.useEffect(()=>{if(h>0){const F=Date.now(),C=setInterval(()=>{const _=Date.now()-F,S=Math.max(0,100-_/h*100);j(S),S===0&&(clearInterval(C),v())},16);return()=>clearInterval(C)}},[h]);const v=()=>{x(!0),setTimeout(()=>{y(s)},300)},R={error:"âœ•",information:"â“˜",warning:"âš ",success:"âœ“"};return e.jsxs("div",{className:`host-toast host-toast--${p} ${w?"host-toast--exiting":""}`,children:[e.jsx("div",{className:"host-toast__icon",children:R[p]}),e.jsxs("div",{className:"host-toast__content",children:[e.jsx("div",{className:"host-toast__title",children:l}),n&&e.jsx("div",{className:"host-toast__message",children:n})]}),e.jsx("button",{className:"host-toast__close",onClick:v,"aria-label":"Close notification",children:"Ã—"}),h>0&&e.jsx("div",{className:"host-toast__progress",children:e.jsx("div",{className:"host-toast__progress-bar",style:{width:`${N}%`}})})]})}function rs({toasts:s,removeToast:l}){return e.jsx("div",{className:"host-toast-container",children:s.map(n=>e.jsx(is,{...n,onClose:l},n.id))})}function ce({children:s,variant:l="primary",size:n="medium",fullWidth:p=!1,disabled:h=!1,onClick:y,type:N="button",className:j="",...w}){const x=["btn",`btn--${l}`,`btn--${n}`,p&&"btn--full-width",h&&"btn--disabled",j].filter(Boolean).join(" ");return e.jsx("button",{type:N,className:x,onClick:y,disabled:h,...w,children:s})}function be(s){if(!s)return"";const l=typeof s=="object"?s.address:s;if(!l||typeof l!="string")return"";const n=[{pattern:/,\s*Brooklyn\s*,/i,name:"Brooklyn"},{pattern:/,\s*Manhattan\s*,/i,name:"Manhattan"},{pattern:/,\s*Queens\s*,/i,name:"Queens"},{pattern:/,\s*Bronx\s*,/i,name:"Bronx"},{pattern:/,\s*Staten Island\s*,/i,name:"Staten Island"},{pattern:/,\s*New York\s*,\s*NY/i,name:"Manhattan"}];for(const{pattern:p,name:h}of n)if(p.test(l))return h;return""}function ls(){const[s,l]=o.useState({isChecking:!0,shouldRedirect:!1}),[n,p]=o.useState(null),[h,y]=o.useState([]),[N,j]=o.useState([]),[w,x]=o.useState([]),[v,R]=o.useState([]),[F,C]=o.useState(!0),[_,S]=o.useState(null),[Y,G]=o.useState(!0),[J,U]=o.useState([]),[B,$]=o.useState(!1),[H,z]=o.useState(null),[M,q]=o.useState(null),[Z,K]=o.useState(!1),[g,W]=o.useState(!1),[he,oe]=o.useState(!1),[me,ee]=o.useState(!1),c=o.useCallback((t,m,r="information",d=3e3)=>{const i={id:Date.now(),title:t,message:m,type:r,duration:d};U(b=>[...b,i])},[]),ue=o.useCallback(t=>{U(m=>m.filter(r=>r.id!==t))},[]);o.useCallback(async()=>{try{const t=await ye({clearOnFailure:!1});return t?(p({id:t.userId||t._id||t.id,firstName:t["Name - First"]||t.firstName||"Host",lastName:t["Name - Last"]||t.lastName||"",email:t.email||"",accountHostId:t.accountHostId||t.userId||t._id}),t):null}catch(t){return console.error("Error fetching user data:",t),null}},[]);const Q=o.useCallback(async(t,m)=>{var r,d,E;if(!t&&!m)return[];try{await Qe();const i=[];t&&i.push(L.functions.invoke("bubble-proxy",{body:{endpoint:"listing",method:"GET",params:{constraints:JSON.stringify([{key:"Creator",constraint_type:"equals",value:t},{key:"Complete",constraint_type:"equals",value:!0}])}}}).then(a=>a.error?(console.warn("Bubble listings fetch failed:",a.error),{type:"bubble",data:{response:{results:[]}}}):{type:"bubble",...a}).catch(a=>(console.warn("Bubble listings fetch failed:",a),{type:"bubble",data:{response:{results:[]}}}))),t&&i.push(L.rpc("get_host_listings",{host_user_id:t}).then(a=>(console.log("[HostOverview] listing query result:",a),{type:"listing_rpc",...a})).catch(a=>(console.warn("listing fetch failed:",a),{type:"listing_rpc",data:[],error:a}))),t&&i.push(L.from("user").select("Listings").eq("_id",t).maybeSingle().then(a=>({type:"user_listings",...a})).catch(a=>(console.warn("user Listings fetch failed:",a),{type:"user_listings",data:null,error:a})));const b=await Promise.all(i),T=b.find(a=>(a==null?void 0:a.type)==="bubble"),se=(((d=(r=T==null?void 0:T.data)==null?void 0:r.response)==null?void 0:d.results)||[]).map(a=>{var I;return{id:a._id,_id:a._id,name:a.Name||a.name||"Unnamed Listing",Name:a.Name,complete:a.Complete||a.complete,source:"bubble",location:{borough:((I=a["Location - Borough"])==null?void 0:I.Display)||a.borough||""},leasesCount:a["Leases Count"]||0,proposalsCount:a["Proposals Count"]||0,photos:a["Features - Photos"]||[],rental_type:a["rental type"]||"Nightly",monthly_rate:a["ðŸ’°Monthly Host Rate"],weekly_rate:a["ðŸ’°Weekly Host Rate"],nightly_rate_2:a["ðŸ’°Nightly Host Rate for 2 nights"],nightly_rate_3:a["ðŸ’°Nightly Host Rate for 3 nights"],nightly_rate_4:a["ðŸ’°Nightly Host Rate for 4 nights"],nightly_rate_5:a["ðŸ’°Nightly Host Rate for 5 nights"],nightly_rate_7:a["ðŸ’°Nightly Host Rate for 7 nights"],cleaning_fee:a["ðŸ’°Cleaning Cost / Maintenance Fee"],damage_deposit:a["ðŸ’°Damage Deposit"]}});let V=[];const A=b.find(a=>(a==null?void 0:a.type)==="listing_rpc");A!=null&&A.data&&!A.error&&(V=A.data.map(a=>{const I=_e(a["Location - Borough"]),u=be(a["Location - Address"]),P=I||u||"";return{id:a.id,_id:a._id,name:a.Name||"Unnamed Listing",Name:a.Name,complete:a.Complete||!1,source:a.source||"listing",location:{borough:P,city:a["Location - City"]||"",state:a["Location - State"]||""},leasesCount:0,proposalsCount:0,photos:a["Features - Photos"]||[],rental_type:a.rental_type,monthly_rate:a.monthly_rate,weekly_rate:a.weekly_rate,nightly_rate_2:a.rate_2_nights,nightly_rate_3:a.rate_3_nights,nightly_rate_4:a.rate_4_nights,nightly_rate_5:a.rate_5_nights,nightly_rate_7:a.rate_7_nights,rate_5_nights:a.rate_5_nights,cleaning_fee:a.cleaning_fee,damage_deposit:a.damage_deposit,pricing_list:a.pricing_list}}));const te=b.find(a=>(a==null?void 0:a.type)==="user_listings"),D=((E=te==null?void 0:te.data)==null?void 0:E.Listings)||[],ae=new Set([...se.map(a=>a.id),...V.map(a=>a.id)]),xe=D.filter(a=>!ae.has(a));if(xe.length>0){const{data:a}=await L.from("listing").select("*").in("_id",xe).eq("Deleted",!1);if(a){const I=a.map(u=>{const P=_e(u["Location - Borough"]),X=be(u["Location - Address"]),k=P||X||"";return{id:u._id,_id:u._id,name:u.Name||"Unnamed Listing",Name:u.Name,complete:u.Complete||!1,source:"listing",location:{borough:k,city:u["Location - City"]||"",state:u["Location - State"]||""},leasesCount:0,proposalsCount:0,photos:u["Features - Photos"]||[],rental_type:u["rental type"],monthly_rate:u["ðŸ’°Monthly Host Rate"],weekly_rate:u["ðŸ’°Weekly Host Rate"],nightly_rate_2:u["ðŸ’°Nightly Host Rate for 2 nights"],nightly_rate_3:u["ðŸ’°Nightly Host Rate for 3 nights"],nightly_rate_4:u["ðŸ’°Nightly Host Rate for 4 nights"],nightly_rate_5:u["ðŸ’°Nightly Host Rate for 5 nights"],nightly_rate_7:u["ðŸ’°Nightly Host Rate for 7 nights"],rate_5_nights:u["ðŸ’°Nightly Host Rate for 5 nights"],cleaning_fee:u["ðŸ’°Cleaning Cost / Maintenance Fee"],damage_deposit:u["ðŸ’°Damage Deposit"],pricing_list:u.pricing_list}});V=[...V,...I]}}const ne=[...se,...V].filter((a,I,u)=>I===u.findIndex(P=>P.id===a.id));if(console.log("[HostOverview] Fetched listings:",{bubble:se.length,rpc:V.length,total:ne.length}),ne.length>0){const a=ne.map(k=>k.id),{data:I}=await L.from("proposal").select("Listing").in("Listing",a),{data:u}=await L.from("bookings_leases").select("Listing").in("Listing",a),P={};(I||[]).forEach(k=>{k.Listing&&(P[k.Listing]=(P[k.Listing]||0)+1)});const X={};(u||[]).forEach(k=>{k.Listing&&(X[k.Listing]=(X[k.Listing]||0)+1)}),ne.forEach(k=>{k.proposalsCount=P[k.id]||0,k.leasesCount=X[k.id]||0}),console.log("[HostOverview] Proposal counts:",P),console.log("[HostOverview] Lease counts:",X)}return ne}catch(i){return console.error("Error fetching host listings:",i),[]}},[]),ie=o.useCallback(async t=>{var m;if(!t)return[];try{const{data:r,error:d}=await L.functions.invoke("bubble-proxy",{body:{endpoint:"listing",method:"GET",params:{constraints:JSON.stringify([{key:"Complete",constraint_type:"equals",value:!0},{key:"Claimable By",constraint_type:"contains",value:t}])}}});if(d)throw d;return(((m=r==null?void 0:r.response)==null?void 0:m.results)||[]).map(i=>{var b;return{id:i._id,_id:i._id,name:i.Name||i.name||"Unnamed Listing",Name:i.Name,complete:i.Complete||i.complete,location:{borough:((b=i["Location - Borough"])==null?void 0:b.Display)||i.borough||""}}})}catch(r){return console.error("Error fetching listings to claim:",r),[]}},[]),re=o.useCallback(async t=>{var m;if(!t)return[];try{const{data:r,error:d}=await L.functions.invoke("bubble-proxy",{body:{endpoint:"House manual",method:"GET",params:{constraints:JSON.stringify([{key:"Host",constraint_type:"equals",value:t}])}}});if(d)throw d;return(((m=r==null?void 0:r.response)==null?void 0:m.results)||[]).map(i=>{var b;return{id:i._id,_id:i._id,display:i.Display||i.display||"House Manual",Display:i.Display,audience:((b=i.Audience)==null?void 0:b.Display)||i.audience||"Guests",createdOn:i["Created Date"]||i.createdOn}})}catch(r){return console.error("Error fetching house manuals:",r),[]}},[]),le=o.useCallback(async t=>{if(!t)return[];try{const{data:m,error:r}=await L.from("virtualmeetingschedulesandlinks").select("*").eq("host_account_id",t).order("booked_date",{ascending:!0});if(r)throw r;return(m||[]).map(d=>({id:d.id,_id:d.id,guest:{firstName:d.guest_first_name||"Guest"},listing:{name:d.listing_name||"Listing"},bookedDate:d.booked_date,notifications:d.notifications||[]}))}catch(m){return console.error("Error fetching virtual meetings:",m),[]}},[]),f=o.useCallback(async()=>{var t,m,r,d;C(!0),S(null);try{if(!await je()){console.log("[HostOverview] User not authenticated, redirecting to home"),l({isChecking:!1,shouldRedirect:!0}),setTimeout(()=>{window.location.href="/?login=true"},100);return}const i=await ye({clearOnFailure:!1});let b=null;if(i)b={id:i.userId||i.accountHostId||i._id||i.id,firstName:i["Name - First"]||i.firstName||"Host",lastName:i["Name - Last"]||i.lastName||"",email:i.email||"",accountHostId:i.accountHostId||i.userId||i._id},p(b),console.log("[HostOverview] User data loaded:",b.firstName);else{const{data:{session:D}}=await L.auth.getSession();if(D!=null&&D.user){const ae={id:D.user.id,firstName:((t=D.user.user_metadata)==null?void 0:t.first_name)||Ke()||((m=D.user.email)==null?void 0:m.split("@")[0])||"Host",lastName:((r=D.user.user_metadata)==null?void 0:r.last_name)||"",email:D.user.email,accountHostId:((d=D.user.user_metadata)==null?void 0:d.user_id)||ze()||D.user.id};p(ae),b=ae,console.log("[HostOverview] Using fallback user data from session:",ae.firstName)}else{console.log("[HostOverview] No valid session, redirecting"),l({isChecking:!1,shouldRedirect:!0}),setTimeout(()=>{window.location.href="/?login=true"},100);return}}l({isChecking:!1,shouldRedirect:!1});const T=b.accountHostId||b.id,pe=b.id;console.log("[HostOverview] loadData - hostAccountId:",T,"userId:",pe);const[se,V,A,te]=await Promise.all([Q(T,pe),ie(T),re(T),le(T)]);j(se),y(V),x(A),R(te)}catch(E){console.error("[HostOverview] Error loading data:",E),S("Failed to load your dashboard. Please try again."),c("Error","Failed to load dashboard data","error",5e3)}finally{C(!1)}},[Q,ie,re,le,c]);o.useEffect(()=>{f()},[f]);const ve=o.useCallback(()=>{window.location.href="/self-listing-v2"},[]),Ce=o.useCallback(()=>{K(!1)},[]),we=o.useCallback(()=>{W(!0)},[]),ke=o.useCallback(()=>{W(!1)},[]),Le=o.useCallback(()=>{ee(!0)},[]),Se=o.useCallback(()=>{ee(!1)},[]),He=o.useCallback(()=>{c("Success","Your co-host request has been submitted!","success"),ee(!1)},[c]),De=o.useCallback(async({listingUrl:t,emailAddress:m})=>{oe(!0);try{const r=await fetch("/api/import-listing",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({listingUrl:t,emailAddress:m,userId:n==null?void 0:n.id,userName:`${(n==null?void 0:n.firstName)||""} ${(n==null?void 0:n.lastName)||""}`.trim()})});if(!r.ok){const d=await r.json().catch(()=>({}));throw new Error(d.error||"Failed to submit import request")}c("Success","Import request submitted! We'll notify you when your listing is ready.","success",5e3),W(!1)}catch(r){console.error("Error submitting import request:",r),c("Error","Failed to submit import request. Please try again.","error",5e3)}finally{oe(!1)}},[n,c]),Me=o.useCallback(async()=>{try{c("Creating Manual","Creating new house manual...","information");const{data:t,error:m}=await L.functions.invoke("bubble-proxy",{body:{endpoint:"House manual",method:"POST",body:{Host:n==null?void 0:n.accountHostId,"Host Name":n==null?void 0:n.firstName}}});if(m)throw m;const r=(t==null?void 0:t.id)||(t==null?void 0:t._id);r?(c("Success","House manual created! Redirecting...","success"),window.location.href=`/host-house-manual/${r}`):(c("Success","House manual created!","success"),await f())}catch(t){console.error("Error creating house manual:",t),c("Error","Failed to create house manual","error",5e3)}},[n,c,f]),Re=o.useCallback(t=>{c("Opening Listing",`Opening ${t.name||t.Name}...`,"information"),window.location.href=`/listing-dashboard?id=${t.id||t._id}`},[c]),Ee=o.useCallback(t=>{c("Preview",`Previewing ${t.name||t.Name}...`,"information"),window.open(`/preview-split-lease/${t.id||t._id}`,"_blank")},[c]),Ie=o.useCallback(t=>{window.location.href=`/host-proposals?listingId=${t.id||t._id}`},[]),Pe=o.useCallback(t=>{window.location.href=`/listing-dashboard?id=${t.id||t._id}`},[]),Fe=o.useCallback(t=>{c("Details",`Viewing details for ${t.name||t.Name}...`,"information"),window.location.href=`/view-split-lease/${t.id||t._id}?claim=true`},[c]),Be=o.useCallback(t=>{c("Opening Manual",`Opening ${t.display||t.Display}...`,"information"),window.location.href=`/host-house-manual/${t.id||t._id}`},[c]),Te=o.useCallback(t=>{c("Visits",`Viewing visit statistics for ${t.display||t.Display}...`,"information")},[c]),$e=o.useCallback(t=>{c("Virtual Meeting","Opening virtual meeting...","information"),t.meetingLink&&window.open(t.meetingLink,"_blank")},[c]),Ve=o.useCallback((t,m)=>{z(t),q(m),$(!0)},[]),Oe=o.useCallback(async()=>{if(H)try{const t=H.id||H._id,m=H.name||H.Name||H.display||H.Display||"item";if(M==="listing"){const{data:r,error:d}=await L.functions.invoke("listing",{body:{action:"delete",payload:{listing_id:t,user_email:n==null?void 0:n.email}}});if(d)throw new Error(d.message||"Failed to delete listing");j(E=>E.filter(i=>(i.id||i._id)!==t)),c("Success",`${m} deleted successfully`,"success")}else M==="claim"?(await L.functions.invoke("bubble-proxy",{body:{endpoint:`listing/${t}`,method:"PATCH",body:{"Claimable By":[]}}}),y(r=>r.filter(d=>(d.id||d._id)!==t)),c("Success",`${m} removed from claim list`,"success")):M==="manual"&&(await L.functions.invoke("bubble-proxy",{body:{endpoint:`House manual/${t}`,method:"DELETE"}}),x(r=>r.filter(d=>(d.id||d._id)!==t)),c("Success",`${m} deleted successfully`,"success"));$(!1),z(null),q(null)}catch(t){console.error("Error deleting item:",t),c("Error","Failed to delete item. Please try again.","error",5e3)}},[H,M,c]),Ue=o.useCallback(()=>{$(!1),z(null),q(null)},[]);return{authState:s,user:n,listingsToClaim:h,myListings:N,houseManuals:w,virtualMeetings:v,loading:F,error:_,showHelpBanner:Y,setShowHelpBanner:G,toasts:J,removeToast:ue,showDeleteConfirm:B,itemToDelete:H,deleteType:M,showCreateListingModal:Z,showImportListingModal:g,importListingLoading:he,showScheduleCohost:me,handleCreateNewListing:ve,handleCloseCreateListingModal:Ce,handleImportListing:we,handleCloseImportListingModal:ke,handleImportListingSubmit:De,handleScheduleCohost:Le,handleCloseScheduleCohost:Se,handleCohostRequestSubmitted:He,handleCreateNewManual:Me,handleEditListing:Re,handlePreviewListing:Ee,handleViewProposals:Ie,handleListingCardClick:Pe,handleSeeDetails:Fe,handleEditManual:Be,handleViewVisits:Te,handleDeleteClick:Ve,handleConfirmDelete:Oe,handleCancelDelete:Ue,handleRespondToVirtualMeeting:$e,loadData:f}}function cs({requireAuth:s=!1,isAuthenticated:l=!0}){const{user:n,listingsToClaim:p,myListings:h,houseManuals:y,virtualMeetings:N,loading:j,error:w,showHelpBanner:x,setShowHelpBanner:v,toasts:R,removeToast:F,showDeleteConfirm:C,itemToDelete:_,deleteType:S,showCreateListingModal:Y,showImportListingModal:G,importListingLoading:J,showScheduleCohost:U,handleCreateNewListing:B,handleCloseCreateListingModal:$,handleImportListing:H,handleCloseImportListingModal:z,handleImportListingSubmit:M,handleScheduleCohost:q,handleCloseScheduleCohost:Z,handleCohostRequestSubmitted:K,handleCreateNewManual:g,handleEditListing:W,handlePreviewListing:he,handleViewProposals:oe,handleListingCardClick:me,handleSeeDetails:ee,handleEditManual:c,handleViewVisits:ue,handleDeleteClick:Q,handleConfirmDelete:ie,handleCancelDelete:re,handleRespondToVirtualMeeting:le}=ls();return j?e.jsxs("div",{className:"host-overview-page-wrapper",children:[e.jsx(ge,{autoShowLogin:s&&!l}),e.jsx("main",{className:"host-overview-main",children:e.jsx("div",{className:"host-overview-container",children:e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading your dashboard..."})]})})}),e.jsx(fe,{})]}):w?e.jsxs("div",{className:"host-overview-page-wrapper",children:[e.jsx(ge,{autoShowLogin:s&&!l}),e.jsx("main",{className:"host-overview-main",children:e.jsx("div",{className:"host-overview-container",children:e.jsxs("div",{className:"error-state",children:[e.jsx("div",{className:"error-icon",children:"âš "}),e.jsx("h2",{children:"Unable to Load Dashboard"}),e.jsx("p",{className:"error-message",children:w}),e.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn--primary",children:"Reload Page"})]})})}),e.jsx(fe,{})]}):e.jsxs("div",{className:"host-overview-page-wrapper",children:[e.jsx(ge,{autoShowLogin:s&&!l}),e.jsx("main",{className:"host-overview-main",children:e.jsxs("div",{className:"host-overview-container",children:[e.jsxs("section",{className:"welcome-section",children:[e.jsxs("h1",{className:"welcome-title",children:["Welcome back, ",(n==null?void 0:n.firstName)||"Host"]}),x&&e.jsxs("div",{className:"help-banner",children:[e.jsxs("button",{className:"help-banner__content",onClick:q,type:"button",children:[e.jsx("span",{className:"help-banner__icon",children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"9",y1:"18",x2:"15",y2:"18"}),e.jsx("line",{x1:"10",y1:"22",x2:"14",y2:"22"}),e.jsx("path",{d:"M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"})]})}),e.jsx("p",{className:"help-banner__text",children:"Need help setting up? Ask a Specialist Co-host!"})]}),e.jsx("button",{className:"help-banner__close",onClick:()=>v(!1),"aria-label":"Dismiss help banner",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsx(ce,{variant:"primary",onClick:B,children:"+ Create New Listing"}),e.jsx(ce,{variant:"secondary",onClick:H,children:"Import Listing"})]})]}),p.length>0&&e.jsxs("section",{className:"page-section",children:[e.jsx("h2",{className:"section-heading",children:"Listings to Claim"}),e.jsx("div",{className:"listings-grid",children:p.map(f=>e.jsx(as,{listing:f,onSeeDetails:ee,onDelete:()=>Q(f,"claim")},f.id||f._id))})]}),e.jsxs("section",{className:"page-section",children:[e.jsx("h2",{className:"section-heading",children:"Your Listings"}),h.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx("p",{children:"You don't have any listings yet."}),e.jsx(ce,{variant:"primary",onClick:B,children:"Create Your First Listing"})]}):e.jsx("div",{className:"listings-grid",children:h.map(f=>e.jsx(ts,{listing:f,onEdit:W,onPreview:he,onProposals:oe,onCardClick:me,onDelete:()=>Q(f,"listing")},f.id||f._id))})]}),e.jsxs("section",{className:"page-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h2",{className:"section-heading",children:"House Manuals"}),e.jsx(ce,{variant:"primary",onClick:g,children:"+ Create New Manual"})]}),y.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"You don't have any house manuals yet."})}):e.jsx("div",{className:"manuals-grid",children:y.map(f=>e.jsx(ns,{manual:f,onEdit:c,onDelete:()=>Q(f,"manual"),onViewVisits:ue},f.id||f._id))})]}),N.length>0&&e.jsxs("section",{className:"page-section",children:[e.jsx("h2",{className:"section-heading",children:"Virtual Meetings"}),e.jsx("div",{className:"meetings-grid",children:N.map(f=>e.jsx(os,{meeting:f,onRespond:le},f.id||f._id))})]})]})}),e.jsx(fe,{}),e.jsx(ss,{isOpen:C,onClose:re,onConfirm:ie,title:`Delete ${S==="manual"?"House Manual":S==="claim"?"Claim":"Listing"}`,itemName:(_==null?void 0:_.name)||(_==null?void 0:_.Name)||(_==null?void 0:_.display)||(_==null?void 0:_.Display)||"",warning:S==="listing"?"Deleting a listing with active leases may affect your guests.":"",confirmText:"Delete",cancelText:"Cancel"}),e.jsx(rs,{toasts:R,removeToast:F}),e.jsx(Ae,{isVisible:Y,onClose:$,currentUser:n,existingListings:h}),e.jsx(Ye,{isOpen:G,onClose:z,onSubmit:M,currentUserEmail:(n==null?void 0:n.email)||"",isLoading:J}),U&&e.jsx(Ge,{userId:(n==null?void 0:n.userId)||(n==null?void 0:n.id),userEmail:n==null?void 0:n.email,userName:`${(n==null?void 0:n.firstName)||""} ${(n==null?void 0:n.lastName)||""}`.trim(),onRequestSubmitted:K,onClose:Z})]})}(async()=>{const s=await je();console.log("Host Overview Auth Check:",{isLoggedIn:s}),console.log(s?"User authenticated - rendering Host Overview page":"User not authenticated - will show auth modal"),qe(document.getElementById("root")).render(e.jsx(We.StrictMode,{children:e.jsx(Xe,{children:e.jsx(cs,{requireAuth:!0,isAuthenticated:s})})}))})();

import{r as n,j as e,c as bs,R as Cs}from"./client-BJVKzfAi.js";import{P as Oe}from"./proposalStatuses-1Bj0NYR4.js";import{D as Me,g as ge}from"./dayUtils-C3_GW2W5.js";import{e as ks}from"./nightCalculations-BvAtd4RD.js";import{s as O,_ as ws}from"./supabase-BoCLEw6R.js";import{A as Ps}from"./AdminHeader-tCInZd3n.js";import{E as Is}from"./ErrorBoundary-9_HbXv1y.js";/* empty css             */import"./config-QPKPRtag.js";import"./auth-QZ4BJadW.js";import"./star-OtPMgcH9.js";import"./createLucideIcon-CgZZH2OU.js";import"./file-text-Bqp_Hw0X.js";import"./triangle-alert-Bp6DQQmR.js";import"./users-d0RSvnp4.js";import"./pen-line-Duo49k9O.js";import"./calendar-CDI4qHEX.js";import"./mail-CRbL90NL.js";import"./user-check-CoCGzn5Y.js";import"./dollar-sign-Dn2-KjNW.js";import"./send-C4mziT0-.js";import"./x-CrJVeoCh.js";const Fs={"1607041299637x913970439175620100":"Brooklyn","1607041299687x679479834266385900":"Manhattan","1607041299715x741251947580746200":"Bronx","1607041299828x406969561802059650":"Queens","1686599616073x348655546878883200":"Weehawken, NJ","1686674905048x436838997624262400":"Newark, NJ"},_e=`
  _id,
  "Name",
  "Description",
  "Active",
  "Approved",
  "Host User",
  "Host email",
  "host name",
  "Location - Address",
  "Location - City",
  "Location - State",
  "Location - Borough",
  "Location - Hood",
  "Location - Zip Code",
  "Features - Photos",
  "Features - Qty Bedrooms",
  "Features - Qty Bathrooms",
  "Features - Qty Beds",
  "Features - Type of Space",
  "rental type",
  "Nights Available (List of Nights) ",
  "Days Available (List of Days)",
  "Minimum Nights",
  "Maximum Weeks",
  "ðŸ’°Monthly Host Rate",
  "ðŸ’°Weekly Host Rate",
  "ðŸ’°Nightly Host Rate for 2 nights",
  "ðŸ’°Nightly Host Rate for 3 nights",
  "ðŸ’°Nightly Host Rate for 4 nights",
  "ðŸ’°Nightly Host Rate for 5 nights",
  "ðŸ’°Nightly Host Rate for 6 nights",
  "ðŸ’°Nightly Host Rate for 7 nights",
  "ðŸ’°Cleaning Cost / Maintenance Fee",
  "ðŸ’°Damage Deposit"
`;function Ds(s){const t=s["rental type"];return t?t==="Monthly"?!!s["ðŸ’°Monthly Host Rate"]&&s["ðŸ’°Monthly Host Rate"]>0:t==="Weekly"?!!s["ðŸ’°Weekly Host Rate"]&&s["ðŸ’°Weekly Host Rate"]>0:!!(s["ðŸ’°Nightly Host Rate for 2 nights"]||s["ðŸ’°Nightly Host Rate for 3 nights"]||s["ðŸ’°Nightly Host Rate for 4 nights"]||s["ðŸ’°Nightly Host Rate for 5 nights"]||s["ðŸ’°Nightly Host Rate for 6 nights"]||s["ðŸ’°Nightly Host Rate for 7 nights"]):!1}async function xe(){try{const{data:s,error:t}=await O.from("listing").select(_e).eq("Deleted",!1).eq("Active",!0).not("rental type","is",null).order("Modified Date",{ascending:!1}).limit(50);if(t)throw t;return{data:(s||[]).filter(Ds).slice(0,20),error:null}}catch(s){return console.error("[suggestedProposalService] getDefaultListings error:",s),{data:[],error:s.message}}}async function We(s){try{const{data:t,error:a}=await O.from("listing").select(_e).eq("Deleted",!1).eq("Active",!0).or(`Name.ilike.%${s}%,host name.ilike.%${s}%,Host email.ilike.%${s}%,_id.ilike.%${s}%,rental type.ilike.%${s}%`).limit(20);if(a)throw a;return{data:t||[],error:null}}catch(t){return console.error("[suggestedProposalService] searchListings error:",t),{data:[],error:t.message}}}async function Be(s){try{const{data:t,error:a}=await O.from("listing_photo").select("*").eq("Listing",s).eq("Active",!0).order("SortOrder",{ascending:!0});if(a)throw a;return{data:t||[],error:null}}catch(t){return console.error("[suggestedProposalService] getListingPhotos error:",t),{data:[],error:t.message}}}const Ue=`
  _id,
  "Name - First",
  "Name - Last",
  "Name - Full",
  email,
  "email as text",
  "Phone Number (as text)",
  "Profile Photo",
  "About Me / Bio",
  "need for Space",
  "special needs",
  "Type - User Current",
  "Created Date"
`;async function fe(){try{const{data:s,error:t}=await O.from("user").select(Ue).ilike('"Type - User Current"',"%Guest%").order('"Created Date"',{ascending:!1}).limit(20);if(t)throw t;return{data:s||[],error:null}}catch(s){return console.error("[suggestedProposalService] getDefaultGuests error:",s),{data:[],error:s.message}}}async function Ge(s){try{const{data:t,error:a}=await O.from("user").select(Ue).ilike('"Type - User Current"',"%Guest%").or(`"Name - Full".ilike.%${s}%,"Name - First".ilike.%${s}%,"Name - Last".ilike.%${s}%,email.ilike.%${s}%,"Phone Number (as text)".ilike.%${s}%,_id.ilike.%${s}%`).order('"Created Date"',{ascending:!1}).limit(20);if(a)throw a;return{data:t||[],error:null}}catch(t){return console.error("[suggestedProposalService] searchGuests error:",t),{data:[],error:t.message}}}async function $e(s,t){try{const{data:a,error:l}=await O.from("proposal").select(`
        _id,
        Status,
        "Days Selected",
        "Reservation Span (Weeks)",
        "Move in range start",
        "Created Date"
      `).eq("Guest",s).eq("Listing",t).neq("Deleted",!0).order('"Created Date"',{ascending:!1});if(l)throw l;return{data:a||[],error:null}}catch(a){return console.error("[suggestedProposalService] getUserProposalsForListing error:",a),{data:[],error:a.message}}}async function He(s){console.log("[PREFILL DEBUG] getUserMostRecentProposal called with userId:",s);try{const{data:{session:t}}=await O.auth.getSession(),a=await fetch("https://qcfifybkaddcoimjroca.supabase.co/functions/v1/proposal",{method:"POST",headers:{Authorization:`Bearer ${(t==null?void 0:t.access_token)||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjZmlmeWJrYWRkY29pbWpyb2NhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0NzU0MDUsImV4cCI6MjA3NTA1MTQwNX0.glGwHxds0PzVLF1Y8VBGX0jYz3zrLsgE9KAWWwkYms8"}`,"Content-Type":"application/json"},body:JSON.stringify({action:"get_prefill_data",payload:{guestId:s}})}),l=await a.json();if(console.log("[PREFILL DEBUG] Edge Function result:",l),!a.ok||l.error)throw new Error(l.error||l.message||"Failed to fetch prefill data");const o=l.data;if(!o)return{data:null,error:null};const i={_id:o._id,"Days Selected":o.daysSelected,"Reservation Span (Weeks)":o.reservationSpanWeeks,"Move in range start":o.moveInRangeStart};return console.log("[PREFILL DEBUG] Mapped prefill data:",i),{data:i,error:null}}catch(t){return console.error("[suggestedProposalService] getUserMostRecentProposal error:",t),{data:null,error:t.message}}}async function Je(s){try{const{data:{session:t}}=await O.auth.getSession(),a=await fetch("https://qcfifybkaddcoimjroca.supabase.co/functions/v1/proposal",{method:"POST",headers:{Authorization:`Bearer ${(t==null?void 0:t.access_token)||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjZmlmeWJrYWRkY29pbWpyb2NhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0NzU0MDUsImV4cCI6MjA3NTA1MTQwNX0.glGwHxds0PzVLF1Y8VBGX0jYz3zrLsgE9KAWWwkYms8"}`,"Content-Type":"application/json"},body:JSON.stringify({action:"create_suggested",payload:s})}),l=await a.json();if(!a.ok||l.error)throw new Error(l.error||l.message||"Failed to create proposal");return{data:l.data,error:null}}catch(t){return console.error("[suggestedProposalService] createSuggestedProposal error:",t),{data:null,error:t.message}}}async function Rs(s){var t;try{if(!s||s.trim().length===0)return{data:null,error:"Transcription text is required"};const a=await fetch("https://qcfifybkaddcoimjroca.supabase.co/functions/v1/ai-gateway",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFjZmlmeWJrYWRkY29pbWpyb2NhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0NzU0MDUsImV4cCI6MjA3NTA1MTQwNX0.glGwHxds0PzVLF1Y8VBGX0jYz3zrLsgE9KAWWwkYms8"},body:JSON.stringify({action:"complete",payload:{prompt_key:"parse-call-transcription",variables:{transcription:s.trim()}}})}),l=await a.json();if(!a.ok||l.error)throw new Error(l.error||l.message||"Failed to parse transcription");const o=(t=l.data)==null?void 0:t.content;if(!o)throw new Error("No completion returned from AI");let i;try{i=typeof o=="string"?JSON.parse(o):o}catch{throw console.error("[suggestedProposalService] Failed to parse AI response:",o),new Error("AI returned invalid JSON response")}return{data:{aboutMe:i.aboutMe||"",needForSpace:i.needForSpace||"",specialNeeds:i.specialNeeds||""},error:null}}catch(a){return console.error("[suggestedProposalService] parseCallTranscription error:",a),{data:null,error:a.message}}}function Ne(s){return s?typeof s=="string"?s:s.url||s.Photo||s["Photo (thumbnail)"]||"":""}function Fe(s,t=[]){var l,o;if(t.length>0)return((l=t[0])==null?void 0:l.Photo)||((o=t[0])==null?void 0:o["Photo (thumbnail)"])||"";const a=s==null?void 0:s["Features - Photos"];if(Array.isArray(a)&&a.length>0)return Ne(a[0]);if(typeof a=="string")try{const i=JSON.parse(a);return Array.isArray(i)?Ne(i[0]):""}catch{return a}return""}function Ve(s,t=[]){var l,o;if(t.length>0)return((l=t[t.length-1])==null?void 0:l.Photo)||((o=t[t.length-1])==null?void 0:o["Photo (thumbnail)"])||"";const a=s==null?void 0:s["Features - Photos"];if(Array.isArray(a)&&a.length>0)return Ne(a[a.length-1]);if(typeof a=="string")try{const i=JSON.parse(a);return Array.isArray(i)?Ne(i[i.length-1]):""}catch{return""}return""}function ze(s){return Fs[s]||null}function De(s){if(!s)return"";const t=ze(s["Location - Borough"]),a=s["Location - Address"];return typeof a=="object"&&a!==null&&a.address?t?`${t}, ${a.address}`:a.address:[t,s["Location - State"],s["Location - Zip Code"]].filter(Boolean).join(", ")}function k(){return'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"%3E%3Crect fill="%23E0E0E0" width="100" height="100"/%3E%3Ctext fill="%23999" x="50" y="55" text-anchor="middle" font-size="12"%3ENo Photo%3C/text%3E%3C/svg%3E'}const Es=Object.freeze(Object.defineProperty({__proto__:null,createSuggestedProposal:Je,getAddressString:De,getBoroughName:ze,getDefaultGuests:fe,getDefaultListings:xe,getDefaultPhoto:k,getFirstPhoto:Fe,getLastPhoto:Ve,getListingPhotos:Be,getUserMostRecentProposal:He,getUserProposalsForListing:$e,parseCallTranscription:Rs,searchGuests:Ge,searchListings:We},Symbol.toStringTag,{value:"Module"})),Te=Oe.SUGGESTED_PROPOSAL_PENDING_CONFIRMATION.key,Ms=[{value:"6",label:"6 weeks"},{value:"8",label:"8 weeks"},{value:"12",label:"12 weeks"},{value:"16",label:"16 weeks"},{value:"26",label:"26 weeks"},{value:"52",label:"52 weeks"},{value:"custom",label:"Other (specify weeks)"}],Ts=[{value:7,label:"1 week"},{value:14,label:"2 weeks"},{value:21,label:"3 weeks"},{value:30,label:"1 month"}],Ls=[6,7,8,9,10,12,13,16,17,20,22,26,52];function As(s){return!s||s<=0?{reservationSpan:"",customWeeks:null}:Ls.includes(s)?{reservationSpan:String(s),customWeeks:null}:{reservationSpan:"custom",customWeeks:s}}function Le(){const s=new Date;return s.setDate(s.getDate()+1),s.toISOString().split("T")[0]}function Ae(s,t){let a;return function(...o){const i=()=>{clearTimeout(a),s(...o)};clearTimeout(a),a=setTimeout(i,t)}}function Os(s,t,a){if(!s||!t||!a)return null;const l=s[`ðŸ’°Nightly Host Rate for ${t} nights`]||s["ðŸ’°Nightly Host Rate for 4 nights"]||s["nightly price"]||0,o=s["ðŸ’°Cleaning Cost / Maintenance Fee"]||0,i=s["ðŸ’°Damage Deposit"]||0,d=t*a,N=l*t*4,g=l*d,x=g+o,p=x*.85;return{nightlyPrice:l,nightsPerWeek:t,numberOfWeeks:a,totalNights:d,fourWeekRent:N,cleaningFee:o,damageDeposit:i,reservationTotal:g,grandTotal:x,hostCompensation:p,initialPayment:N+i}}function _s(){const[s,t]=n.useState(1),[a,l]=n.useState(""),[o,i]=n.useState([]),[d,N]=n.useState(null),[g,x]=n.useState([]),[p,v]=n.useState(!1),[P,w]=n.useState(""),[m,j]=n.useState([]),[S,I]=n.useState(null),[_,F]=n.useState(0),[u,D]=n.useState(!1),[je,M]=n.useState(!1),[Q,W]=n.useState(""),[V,T]=n.useState(""),[B,L]=n.useState(""),[z,Y]=n.useState(Te),[R,K]=n.useState(Le()),[ee,le]=n.useState(14),[ve,oe]=n.useState(!1),[b,q]=n.useState([]),[C,se]=n.useState(""),[E,X]=n.useState(null),[ae,ce]=n.useState(!1),[Se,U]=n.useState(!1),[G,ie]=n.useState([]),[ye,de]=n.useState(null),[be,he]=n.useState(null),[Ce,te]=n.useState(!1),ue=b.length,ke=Math.max(0,b.length-1),{checkInDayIndex:re,checkOutDayIndex:ne,checkInDayName:we,checkOutDayName:Pe,nightsSelected:pe}=n.useMemo(()=>{if(b.length===0)return{checkInDayIndex:null,checkOutDayIndex:null,checkInDayName:null,checkOutDayName:null,nightsSelected:[]};const r=b.map($=>({dayOfWeek:$,name:Me[$]})),{checkIn:c,checkOut:h}=ks(r),y=(h==null?void 0:h.dayOfWeek)??null,A=y!==null?b.filter($=>$!==y):b.slice(0,-1);return{checkInDayIndex:(c==null?void 0:c.dayOfWeek)??null,checkOutDayIndex:y,checkInDayName:(c==null?void 0:c.name)??null,checkOutDayName:(h==null?void 0:h.name)??null,nightsSelected:A}},[b]),Z=n.useMemo(()=>C==="custom"?parseInt(E)||0:parseInt(C)||0,[C,E]),f=n.useMemo(()=>Os(d,ue,Z),[d,ue,Z]);n.useEffect(()=>{const r=[];if(s>=1&&!d&&r.push("Please select a listing"),s>=2&&(!S||!u)&&r.push("Please select and confirm a guest"),s>=3){if(!C&&!R&&r.push("Fill out reservation span OR move-in date to proceed"),b.length<3&&r.push("Please select at least 3 days"),C==="custom"){const c=parseInt(E);(!c||c<6||c>52)&&r.push("Number of weeks must be between 6 and 52")}f&&f.grandTotal<=0&&C&&r.push("Price calculation is invalid")}ie(r)},[s,d,S,u,C,R,b,E,f]),n.useEffect(()=>{(async()=>{v(!0);try{const{data:c,error:h}=await xe();h?console.error("[CreateSuggestedProposal] Default listings error:",h):i(c||[])}finally{v(!1)}})()},[]);const Re=n.useCallback(Ae(async r=>{v(!0);try{if(r.length===0){const{data:c,error:h}=await xe();h?(console.error("[CreateSuggestedProposal] Default listings error:",h),i([])):i(c||[])}else{const{data:c,error:h}=await We(r);h?(console.error("[CreateSuggestedProposal] Listing search error:",h),i([])):i(c||[])}}finally{v(!1)}},300),[]),Ye=n.useCallback(r=>{const c=r.target.value;l(c),Re(c)},[Re]),qe=n.useCallback(async()=>{if(o.length===0&&!d){v(!0);try{const{data:r,error:c}=await xe();c||i(r||[])}finally{v(!1)}}},[o.length,d]),Xe=n.useCallback(async r=>{N(r),l(""),i([]);const{data:c}=await Be(r._id);x(c||[]),t(2)},[]),Ze=n.useCallback(()=>{N(null),x([]),t(1),I(null),D(!1),F(0)},[]),Qe=n.useCallback(()=>{l(""),i([])},[]);n.useEffect(()=>{s===2&&m.length===0&&!S&&(async()=>{M(!0);try{const{data:c,error:h}=await fe();h?console.error("[CreateSuggestedProposal] Default guests error:",h):j(c||[])}finally{M(!1)}})()},[s,m.length,S]);const Ee=n.useCallback(Ae(async r=>{M(!0);try{if(r.length===0){const{data:c,error:h}=await fe();h?(console.error("[CreateSuggestedProposal] Default guests error:",h),j([])):j(c||[])}else{const{data:c,error:h}=await Ge(r);h?(console.error("[CreateSuggestedProposal] Guest search error:",h),j([])):j(c||[])}}finally{M(!1)}},300),[]),Ke=n.useCallback(r=>{const c=r.target.value;w(c),Ee(c)},[Ee]),es=n.useCallback(async()=>{if(m.length===0&&!S){M(!0);try{const{data:r,error:c}=await fe();c||j(r||[])}finally{M(!1)}}},[m.length,S]),ss=n.useCallback(async r=>{if(console.log("[PREFILL DEBUG] handleGuestSelect called with full guest object:",r),console.log("[PREFILL DEBUG] Guest _id:",r._id),console.log("[PREFILL DEBUG] Guest email:",r.email),I(r),w(""),j([]),D(!1),d){const{data:y}=await $e(r._id,d._id);F((y==null?void 0:y.length)||0)}console.log("[PREFILL DEBUG] About to call getUserMostRecentProposal for guest:",r._id);const{data:c,error:h}=await He(r._id);if(console.log("[PREFILL DEBUG] Result:",{mostRecentProposal:c,prefillError:h}),c){console.log("[PREFILL DEBUG] Prefilling from proposal:",c._id);const y=c["Days Selected"];Array.isArray(y)&&y.length>0&&q(y);const A=c["Reservation Span (Weeks)"];if(A&&A>0){const{reservationSpan:me,customWeeks:H}=As(A);se(me),H!==null&&X(H)}const $=c["Move in range start"];if($){const me=new Date($),H=new Date;H.setDate(H.getDate()+1),H.setHours(0,0,0,0),me>=H&&K(me.toISOString().split("T")[0])}}r["About Me / Bio"]&&W(r["About Me / Bio"]),r["need for Space"]&&T(r["need for Space"]),r["special needs"]&&L(r["special needs"])},[d]),as=n.useCallback(()=>{D(!0),t(3)},[]),ts=n.useCallback(()=>{I(null),D(!1),F(0),t(2),W(""),T(""),L("")},[]),rs=n.useCallback(()=>{w(""),j([])},[]),ns=n.useCallback(r=>{W(r.target.value)},[]),ls=n.useCallback(r=>{T(r.target.value)},[]),os=n.useCallback(r=>{L(r.target.value)},[]),cs=n.useCallback(r=>{r.aboutMe&&W(r.aboutMe),r.needForSpace&&T(r.needForSpace),r.specialNeeds&&L(r.specialNeeds)},[]),is=n.useCallback(r=>{Y(r.target.value)},[]),ds=n.useCallback(r=>{K(r.target.value)},[]),hs=n.useCallback(r=>{le(parseInt(r.target.value))},[]),us=n.useCallback(r=>{oe(r.target.checked)},[]),ps=n.useCallback(r=>{q(c=>c.includes(r)?c.filter(h=>h!==r):[...c,r].sort((h,y)=>h-y))},[]),ms=n.useCallback(()=>{q([0,1,2,3,4,5,6])},[]),gs=n.useCallback(r=>{se(r.target.value),r.target.value!=="custom"&&X(null)},[]),xs=n.useCallback(r=>{X(r.target.value)},[]),fs=n.useCallback(()=>{u&&(D(!1),t(2)),U(!1)},[u]),Ns=n.useCallback(()=>{G.length>0||U(!0)},[G]),js=n.useCallback(()=>{U(!1)},[]),vs=n.useCallback(async()=>{if(!(G.length>0||ae)){ce(!0);try{const r=new Date(R),c=new Date(r);c.setDate(c.getDate()+ee);const h={listingId:d._id,guestId:S._id,daysSelected:b,nightsSelected:pe,checkIn:re,checkOut:ne,moveInStartRange:r.toISOString(),moveInEndRange:c.toISOString(),reservationSpanWeeks:Z,reservationSpan:C==="custom"?`${E} weeks`:`${C} weeks`,nightlyPrice:(f==null?void 0:f.nightlyPrice)||0,totalPrice:(f==null?void 0:f.grandTotal)||0,hostCompensation:(f==null?void 0:f.hostCompensation)||0,cleaningFee:(f==null?void 0:f.cleaningFee)||0,damageDeposit:(f==null?void 0:f.damageDeposit)||0,fourWeekRent:(f==null?void 0:f.fourWeekRent)||0,aboutMe:Q,needForSpace:V,specialNeeds:B},{data:y,error:A}=await Je(h);if(A)throw new Error(A);de({_id:y.proposalId}),he({_id:y.threadId}),te(!0),U(!1)}catch(r){console.error("[CreateSuggestedProposal] Creation error:",r),ie([`Failed to create proposal: ${r.message}`])}finally{ce(!1)}}},[G,ae,d,S,z,R,ee,b,pe,re,ne,C,E,Z,f,Q,V,B]),Ss=n.useCallback(()=>{t(1),l(""),i([]),N(null),x([]),w(""),j([]),I(null),F(0),D(!1),W(""),T(""),L(""),Y(Te),K(Le()),le(14),oe(!1),q([]),se(""),X(null),U(!1),de(null),he(null),te(!1)},[]),ys=n.useCallback(()=>{te(!1)},[]);return{currentStep:s,listingSearchTerm:a,listingSearchResults:o,selectedListing:d,listingPhotos:g,isSearchingListings:p,guestSearchTerm:P,guestSearchResults:m,selectedGuest:S,existingProposalsCount:_,isGuestConfirmed:u,isSearchingGuests:je,aboutMe:Q,needForSpace:V,specialNeeds:B,proposalStatus:z,moveInDate:R,moveInRange:ee,strictMoveIn:ve,selectedDays:b,reservationSpan:C,customWeeks:E,checkInDayIndex:re,checkOutDayIndex:ne,checkInDayName:we,checkOutDayName:Pe,nightsCount:ke,pricing:f,isCreating:ae,isConfirmationStep:Se,validationErrors:G,createdProposal:ye,createdThread:be,showSuccessModal:Ce,RESERVATION_SPAN_OPTIONS:Ms,MOVE_IN_RANGE_OPTIONS:Ts,DAY_NAMES:Me,handleGoBack:fs,handleListingSearchChange:Ye,handleListingSearchFocus:qe,handleListingSelect:Xe,handleListingClear:Ze,handleClearListingSearch:Qe,handleGuestSearchChange:Ke,handleGuestSearchFocus:es,handleGuestSelect:ss,handleGuestConfirm:as,handleGuestClear:ts,handleClearGuestSearch:rs,handleAboutMeChange:ns,handleNeedForSpaceChange:ls,handleSpecialNeedsChange:os,handleTranscriptionParsed:cs,handleStatusChange:is,handleMoveInDateChange:ds,handleMoveInRangeChange:hs,handleStrictMoveInChange:us,handleDayToggle:ps,handleSelectFullTime:ms,handleReservationSpanChange:gs,handleCustomWeeksChange:xs,handleFirstCreateClick:Ns,handleConfirmProposal:vs,handleCancelConfirmation:js,handleCreateAnother:Ss,handleCloseSuccessModal:ys}}function Ws({currentStep:s}){const t=[{number:1,label:"Select Listing"},{number:2,label:"Select Guest"},{number:3,label:"Configure Proposal"}];return e.jsx("div",{className:"csp-steps-container",children:t.map((a,l)=>e.jsxs("div",{className:"csp-step-wrapper",children:[e.jsxs("div",{className:`csp-step ${s>a.number?"completed":s===a.number?"active":""}`,children:[e.jsx("div",{className:"csp-step-indicator",children:s>a.number?e.jsx("svg",{className:"csp-step-check",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}):e.jsx("span",{className:"csp-step-number",children:a.number})}),e.jsx("span",{className:"csp-step-label",children:a.label})]}),l<t.length-1&&e.jsx("div",{className:"csp-step-connector"})]},a.number))})}function Bs({searchTerm:s,searchResults:t,selectedListing:a,listingPhotos:l,isSearching:o,onSearchChange:i,onSearchFocus:d,onSelect:N,onClear:g,onClearSearch:x}){return e.jsxs("section",{className:"csp-step-section",children:[e.jsx("div",{className:"csp-section-header",children:e.jsx("h2",{children:"Step 1: Select Listing"})}),e.jsxs("div",{className:"csp-search-container",children:[e.jsx("label",{htmlFor:"listingSearch",children:"Filter by host"}),e.jsxs("div",{className:"csp-search-input-wrapper",children:[e.jsx("input",{type:"text",id:"listingSearch",className:"csp-search-input",placeholder:"Search Host Name, email, listing name, unique id, rental type",value:s,onChange:i,onFocus:d,disabled:!!a}),s&&e.jsx("button",{className:"csp-btn-clear-search",onClick:x,title:"Clear",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),!a&&(t.length>0||o)&&e.jsx("div",{className:"csp-search-results",children:o?e.jsx("div",{className:"csp-loading",children:"Searching..."}):t.length===0?e.jsx("div",{className:"csp-no-results",children:"No listings found"}):t.map(p=>e.jsxs("div",{className:"csp-search-result-item",onClick:()=>N(p),children:[e.jsx("img",{src:Fe(p)||k(),alt:p.Name||"Listing",className:"csp-thumbnail",onError:v=>{v.target.src=k()}}),e.jsxs("div",{className:"csp-search-result-info",children:[e.jsxs("h4",{children:[p["host name"]||"Unknown Host"," - ",p.Name||"Unnamed Listing"," - ",p["rental type"]||"Standard"," - ",p["Maximum Weeks"]?`${p["Maximum Weeks"]} weeks`:"Every week"]}),e.jsxs("p",{className:"csp-listing-details-row",children:["unique id: ",p._id]}),e.jsxs("p",{className:"csp-listing-details-row",children:["host email: ",p["Host email"]||""]})]})]},p._id))})]}),a&&e.jsxs("div",{className:"csp-selected-item-card",children:[e.jsxs("div",{className:"csp-item-photos",children:[e.jsx("img",{src:Fe(a,l)||k(),alt:"Listing",className:"csp-item-photo",onError:p=>{p.target.src=k()}}),e.jsx("img",{src:Ve(a,l)||k(),alt:"Listing",className:"csp-item-photo",onError:p=>{p.target.src=k()}})]}),e.jsxs("div",{className:"csp-item-details",children:[e.jsx("h3",{children:a.Name||"Unnamed Listing"}),e.jsx("p",{className:"csp-item-subtitle",children:De(a)}),e.jsxs("p",{className:"csp-item-meta",children:["Host: ",a["host name"]||"Unknown"]}),e.jsx("span",{className:"csp-badge",children:a["rental type"]||"Standard"})]}),e.jsx("button",{className:"csp-btn-remove",onClick:g,title:"Remove selection",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]})}function Us({searchTerm:s,searchResults:t,selectedGuest:a,existingProposalsCount:l,isConfirmed:o,isSearching:i,onSearchChange:d,onSearchFocus:N,onSelect:g,onConfirm:x,onClear:p,onClearSearch:v}){const P=(a==null?void 0:a["Name - Full"])||(a==null?void 0:a["Name - First"])||"Unknown",w=(a==null?void 0:a["Name - First"])||P;return e.jsxs("section",{className:"csp-step-section",children:[e.jsx("div",{className:"csp-section-header",children:e.jsx("h2",{children:"Step 2: Select Guest"})}),e.jsxs("div",{className:"csp-search-container",children:[e.jsx("label",{htmlFor:"guestSearch",children:"Filter by Guest"}),e.jsxs("div",{className:"csp-search-input-wrapper",children:[e.jsx("input",{type:"text",id:"guestSearch",className:"csp-search-input",placeholder:"Search Guest Name, email, phone number, unique ID",value:s,onChange:d,onFocus:N,disabled:!!a}),s&&e.jsx("button",{className:"csp-btn-clear-search",onClick:v,title:"Clear",children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),!a&&(t.length>0||i)&&e.jsx("div",{className:"csp-search-results",children:i?e.jsx("div",{className:"csp-loading",children:"Searching..."}):t.length===0?e.jsx("div",{className:"csp-no-results",children:"No guests found"}):t.map(m=>e.jsxs("div",{className:"csp-search-result-item",onClick:()=>g(m),children:[e.jsx("img",{src:m["Profile Photo"]||k(),alt:m["Name - Full"]||"Guest",className:"csp-thumbnail csp-user-thumbnail",onError:j=>{j.target.src=k()}}),e.jsxs("div",{className:"csp-search-result-info",children:[e.jsx("h4",{children:m["Name - Full"]||m["Name - First"]||"Unknown"}),e.jsx("p",{children:m.email||""}),e.jsx("p",{children:m["Phone Number (as text)"]||""}),e.jsxs("p",{className:"csp-listing-details-row",children:["unique id: ",m._id]})]})]},m._id))})]}),a&&e.jsxs("div",{className:"csp-selected-item-card",children:[e.jsx("button",{className:"csp-btn-remove",onClick:p,title:"Remove selection",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),e.jsx("div",{className:"csp-user-avatar",children:e.jsx("img",{src:a["Profile Photo"]||k(),alt:P,onError:m=>{m.target.src=k()}})}),e.jsxs("div",{className:"csp-item-details",children:[e.jsx("h3",{children:P}),e.jsx("p",{className:"csp-item-subtitle",children:a.email||""}),e.jsx("p",{className:"csp-item-meta",children:a["Phone Number (as text)"]||""}),a["Type - User Current"]&&e.jsx("span",{className:"csp-badge",children:a["Type - User Current"]})]}),!o&&!l&&e.jsx("button",{className:"csp-btn-select-user",onClick:x,children:"Select User"})]}),a&&l>0&&e.jsxs("div",{className:"csp-warning-message",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),e.jsxs("span",{children:["Select Another User, ",w," already has a proposal for the listing selected"]})]})]})}function Gs({onParsedData:s,isDisabled:t=!1}){const[a,l]=n.useState(!1),[o,i]=n.useState(""),[d,N]=n.useState(!1),[g,x]=n.useState(null),p=()=>{t||(l(!a),x(null))},v=m=>{i(m.target.value),x(null)},P=async()=>{if(!(!o.trim()||d)){N(!0),x(null);try{const{parseCallTranscription:m}=await ws(async()=>{const{parseCallTranscription:I}=await Promise.resolve().then(()=>Es);return{parseCallTranscription:I}},void 0),{data:j,error:S}=await m(o);if(S){x(S);return}j&&(s(j),i(""),l(!1))}catch(m){x(m.message||"Failed to parse transcription")}finally{N(!1)}}},w=()=>{i(""),x(null)};return e.jsxs("div",{className:"csp-transcription-tool",children:[e.jsxs("button",{type:"button",className:`csp-transcription-toggle ${a?"expanded":""} ${t?"disabled":""}`,onClick:p,disabled:t,children:[e.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"}),e.jsx("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),e.jsx("line",{x1:"12",x2:"12",y1:"19",y2:"22"})]}),e.jsx("span",{children:"AI: Parse Call Transcription"}),e.jsx("svg",{className:`csp-transcription-chevron ${a?"rotated":""}`,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"6 9 12 15 18 9"})})]}),a&&e.jsxs("div",{className:"csp-transcription-panel",children:[e.jsx("p",{className:"csp-transcription-hint",children:"Paste your call notes or transcription below. AI will extract the guest's bio, need for space, and special requirements."}),e.jsx("textarea",{className:"csp-form-textarea csp-transcription-textarea",placeholder:`Paste call transcription or notes here...\r
\r
Example:\r
'Spoke with Sarah today. She's a traveling nurse from Chicago looking for a place in Brooklyn for 3 months starting mid-January. She works night shifts at a nearby hospital. Needs a quiet place to sleep during the day. Has a small dog named Max (very well-behaved). Budget is around $1800/month. Prefers her own bathroom if possible.'`,rows:"6",value:o,onChange:v,disabled:d}),g&&e.jsxs("div",{className:"csp-transcription-error",children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),g]}),e.jsxs("div",{className:"csp-transcription-actions",children:[e.jsx("button",{type:"button",className:"csp-btn csp-btn-secondary csp-btn-small",onClick:w,disabled:d||!o.trim(),children:"Clear"}),e.jsx("button",{type:"button",className:"csp-btn csp-btn-primary csp-btn-small",onClick:P,disabled:d||!o.trim(),children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"csp-btn-spinner"}),"Parsing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"})}),"Extract with AI"]})})]})]})]})}function $s({guestName:s,aboutMe:t,needForSpace:a,specialNeeds:l,onAboutMeChange:o,onNeedForSpaceChange:i,onSpecialNeedsChange:d,onTranscriptionParsed:N}){return e.jsxs("section",{className:"csp-step-section",children:[e.jsx("div",{className:"csp-section-header",children:e.jsx("h2",{children:"Step 3: Guest Information"})}),e.jsx(Gs,{onParsedData:N}),e.jsxs("div",{className:"csp-user-info-form",children:[e.jsxs("div",{className:"csp-form-group",children:[e.jsxs("label",{htmlFor:"aboutMe",children:["Tell us about ",e.jsx("span",{className:"csp-guest-name-placeholder",children:s})]}),e.jsx("textarea",{id:"aboutMe",className:"csp-form-textarea",placeholder:"About Me / Bio",rows:"3",value:t,onChange:o})]}),e.jsxs("div",{className:"csp-form-group",children:[e.jsxs("label",{htmlFor:"needForSpace",children:["Why does ",e.jsx("span",{className:"csp-guest-name-placeholder",children:s})," want this space?"]}),e.jsx("textarea",{id:"needForSpace",className:"csp-form-textarea",placeholder:"Need for Space",rows:"3",value:a,onChange:i})]}),e.jsxs("div",{className:"csp-form-group",children:[e.jsxs("label",{htmlFor:"specialNeeds",children:["Write ",e.jsx("span",{className:"csp-guest-name-placeholder",children:s}),"'s unique requirements"]}),e.jsx("textarea",{id:"specialNeeds",className:"csp-form-textarea",placeholder:"Special needs",rows:"3",value:l,onChange:d})]})]})]})}const Hs=[{index:0,label:"S",title:"Sunday"},{index:1,label:"M",title:"Monday"},{index:2,label:"T",title:"Tuesday"},{index:3,label:"W",title:"Wednesday"},{index:4,label:"T",title:"Thursday"},{index:5,label:"F",title:"Friday"},{index:6,label:"S",title:"Saturday"}],Js=s=>s>=12?`${s} weeks (${Math.floor(s/4)} months)`:`${s} weeks`,Vs=[6,7,8,9,10,12,13,16,17,20,22,26,52],zs=[{value:"",label:"Select span"},...Vs.map(s=>({value:String(s),label:Js(s)})),{value:"custom",label:"Other (specify weeks)"}],Ys=[{value:7,label:"1 week"},{value:14,label:"2 weeks"},{value:21,label:"3 weeks"},{value:30,label:"1 month"}],qs=[{value:Oe.SUGGESTED_PROPOSAL_PENDING_CONFIRMATION.key,label:"Pending Guest Confirmation (Split Lease created)"}];function Xs({proposalStatus:s,moveInDate:t,moveInRange:a,strictMoveIn:l,selectedDays:o,checkInDayName:i,checkOutDayName:d,nightsCount:N,reservationSpan:g,customWeeks:x,onStatusChange:p,onMoveInDateChange:v,onMoveInRangeChange:P,onStrictMoveInChange:w,onDayToggle:m,onSelectFullTime:j,onReservationSpanChange:S,onCustomWeeksChange:I}){const _=new Date;_.setDate(_.getDate()+1);const F=_.toISOString().split("T")[0];return e.jsxs("div",{className:"csp-config-panel",children:[e.jsxs("div",{className:"csp-config-section",children:[e.jsx("h3",{children:"Proposal Configuration"}),e.jsxs("div",{className:"csp-form-group",children:[e.jsx("label",{htmlFor:"proposalStatus",children:"Proposal Status"}),e.jsx("select",{id:"proposalStatus",className:"csp-form-select",value:s,onChange:p,children:qs.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))})]}),e.jsxs("div",{className:"csp-form-group",children:[e.jsx("label",{htmlFor:"moveInDate",children:"Move-in From"}),e.jsx("input",{type:"date",id:"moveInDate",className:"csp-form-input",value:t,min:F,onChange:v})]}),e.jsxs("div",{className:"csp-form-group",children:[e.jsx("label",{htmlFor:"moveInRange",children:"Move-in Range"}),e.jsx("select",{id:"moveInRange",className:"csp-form-select",value:a,onChange:P,children:Ys.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))})]}),e.jsx("div",{className:"csp-form-group csp-checkbox-group",children:e.jsxs("label",{className:"csp-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:w}),e.jsx("span",{children:"Strict (no negotiation on exact move in)"})]})})]}),e.jsxs("div",{className:"csp-config-section",children:[e.jsx("h3",{children:"Schedule Selection"}),e.jsxs("div",{className:"csp-days-selector",children:[e.jsx("label",{children:"Weekly Schedule"}),e.jsx("div",{className:"csp-days-buttons",children:Hs.map(u=>e.jsx("button",{type:"button",className:`csp-day-btn ${o.includes(u.index)?"active":""}`,title:u.title,onClick:()=>m(u.index),children:u.label},u.index))}),e.jsx("button",{type:"button",className:"csp-btn-link",onClick:j,children:"Select Full Time"})]}),o.length>0&&e.jsx("div",{className:"csp-checkin-checkout-display",children:o.length===7?e.jsx("div",{className:"csp-schedule-summary",children:e.jsx("strong",{children:"Full-time stay"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"csp-schedule-summary",children:[e.jsxs("strong",{children:[o.length," days, ",N," nights"]})," Selected"]}),e.jsxs("div",{className:"csp-check-dates",children:["Check-in day is ",e.jsx("strong",{children:i||"N/A"}),e.jsx("br",{}),"Check-out day is ",e.jsx("strong",{children:d||"N/A"})]})]})})]}),e.jsxs("div",{className:"csp-config-section",children:[e.jsx("h3",{children:"Reservation Span"}),e.jsxs("div",{className:"csp-form-group",children:[e.jsx("label",{htmlFor:"reservationSpan",children:"Reservation Span"}),e.jsx("select",{id:"reservationSpan",className:"csp-form-select",value:g,onChange:S,children:zs.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))})]}),g==="custom"&&e.jsxs("div",{className:"csp-form-group",children:[e.jsx("label",{htmlFor:"customWeeks",children:"Enter # of Weeks"}),e.jsx("input",{type:"number",id:"customWeeks",className:"csp-form-input",min:"6",max:"52",placeholder:"6-52 weeks",value:x||"",onChange:I})]})]})]})}function J(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s||0)}function Zs({pricing:s}){return s?e.jsxs("div",{className:"csp-config-section csp-pricing-section",children:[e.jsx("h3",{children:"Reservation Price Breakdown"}),e.jsxs("div",{className:"csp-price-display",children:[e.jsxs("div",{className:"csp-price-row",children:[e.jsx("span",{className:"csp-price-label",children:"Number of nights:"}),e.jsx("span",{className:"csp-price-value",children:s.totalNights})]}),e.jsxs("div",{className:"csp-price-row",children:[e.jsx("span",{className:"csp-price-label",children:"Price per night:"}),e.jsx("span",{className:"csp-price-value",children:J(s.nightlyPrice)})]}),e.jsxs("div",{className:"csp-price-row",children:[e.jsx("span",{className:"csp-price-label",children:"Nights per week:"}),e.jsx("span",{className:"csp-price-value",children:s.nightsPerWeek})]}),e.jsxs("div",{className:"csp-price-row",children:[e.jsx("span",{className:"csp-price-label",children:"Number of weeks:"}),e.jsx("span",{className:"csp-price-value",children:s.numberOfWeeks})]}),e.jsxs("div",{className:"csp-price-row csp-separator",children:[e.jsx("span",{className:"csp-price-label",children:"Price per 4 weeks:"}),e.jsx("span",{className:"csp-price-value",children:J(s.fourWeekRent)})]}),e.jsxs("div",{className:"csp-price-row",children:[e.jsx("span",{className:"csp-price-label",children:"Security Deposit:"}),e.jsx("span",{className:"csp-price-value",children:J(s.damageDeposit)})]}),e.jsxs("div",{className:"csp-price-row",children:[e.jsx("span",{className:"csp-price-label",children:"Cleaning Cost:"}),e.jsx("span",{className:"csp-price-value",children:J(s.cleaningFee)})]}),e.jsxs("div",{className:"csp-price-row",children:[e.jsx("span",{className:"csp-price-label",children:"Initial Payment (first month):"}),e.jsx("span",{className:"csp-price-value",children:J(s.initialPayment)})]}),e.jsxs("div",{className:"csp-price-row csp-total",children:[e.jsx("span",{className:"csp-price-label",children:"Total Price for Reservation:"}),e.jsx("span",{className:"csp-price-value",children:J(s.grandTotal)})]}),e.jsxs("div",{className:"csp-price-row csp-host",children:[e.jsx("span",{className:"csp-price-label",children:"Host Compensation:"}),e.jsx("span",{className:"csp-price-value",children:J(s.hostCompensation)})]})]})]}):e.jsxs("div",{className:"csp-config-section csp-pricing-section",children:[e.jsx("h3",{children:"Reservation Price Breakdown"}),e.jsx("p",{className:"csp-no-pricing",children:"Select days and reservation span to see pricing"})]})}function Qs({selectedDays:s,nightsCount:t,reservationWeeks:a}){const l=()=>s.length===0?"-":`${[...s].sort((d,N)=>d-N).map(d=>ge(d).slice(0,3)).join(", ")} (${t} nights/week)`;return e.jsxs("div",{className:"csp-config-section csp-validation-panel",children:[e.jsx("h3",{children:"Validation Preview"}),e.jsxs("div",{className:"csp-validation-warning",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"}),e.jsx("line",{x1:"12",y1:"9",x2:"12",y2:"13"}),e.jsx("line",{x1:"12",y1:"17",x2:"12.01",y2:"17"})]}),e.jsx("span",{children:"Before creating the proposal, make sure that the values below are correct and not weird data (like some values being 0)"})]}),e.jsxs("div",{className:"csp-validation-values",children:[e.jsxs("div",{className:"csp-validation-row",children:[e.jsx("span",{className:"csp-validation-label",children:"Guest Desired Pattern:"}),e.jsx("span",{className:"csp-validation-value",children:l()})]}),e.jsxs("div",{className:"csp-validation-row",children:[e.jsx("span",{className:"csp-validation-label",children:"Actual Reservation Span:"}),e.jsx("span",{className:"csp-validation-value",children:a?`${a} weeks`:"-"})]}),e.jsxs("div",{className:"csp-validation-row",children:[e.jsx("span",{className:"csp-validation-label",children:"Actual # of Weeks during 4 weeks:"}),e.jsx("span",{className:"csp-validation-value",children:a?Math.min(a,4):"-"})]})]})]})}function Ie(s){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(s||0)}function Ks({selectedListing:s,selectedGuest:t,selectedDays:a,checkInDayIndex:l,checkOutDayIndex:o,reservationWeeks:i,pricing:d}){if(!s||!t)return null;const N=t["Name - Full"]||t["Name - First"]||"Unknown",g=a.length>0?a.map(x=>ge(x)).join(", "):"-";return e.jsxs("div",{className:"csp-proposal-summary",children:[e.jsx("h3",{children:"Proposal Summary"}),e.jsxs("div",{className:"csp-summary-grid",children:[e.jsxs("div",{className:"csp-summary-section",children:[e.jsx("h4",{children:"Guest Information"}),e.jsxs("div",{className:"csp-summary-item",children:[e.jsx("img",{src:t["Profile Photo"]||k(),alt:N,className:"csp-summary-avatar",onError:x=>{x.target.src=k()}}),e.jsxs("div",{children:[e.jsx("p",{className:"csp-summary-name",children:N}),e.jsx("p",{className:"csp-summary-detail",children:t.email||""}),e.jsx("p",{className:"csp-summary-detail",children:t["Phone Number (as text)"]||""})]})]})]}),e.jsxs("div",{className:"csp-summary-section",children:[e.jsx("h4",{children:"Listing Information"}),e.jsx("p",{className:"csp-summary-name",children:s.Name||"Unnamed Listing"}),e.jsx("p",{className:"csp-summary-detail",children:De(s)}),e.jsxs("p",{className:"csp-summary-detail",children:["Host: ",s["host name"]||""]})]}),e.jsxs("div",{className:"csp-summary-section",children:[e.jsx("h4",{children:"Schedule"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Check-in:"})," ",l!==null?ge(l):"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Check-out:"})," ",o!==null?ge(o):"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Days:"})," ",g]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Duration:"})," ",i?`${i} weeks`:"-"]})]}),e.jsxs("div",{className:"csp-summary-section",children:[e.jsx("h4",{children:"Pricing"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Nightly Price:"})," ",d?Ie(d.nightlyPrice):"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Price:"})," ",d?Ie(d.grandTotal):"-"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Host Compensation:"})," ",d?Ie(d.hostCompensation):"-"]})]})]})]})}function ea({proposalId:s,threadId:t,onCreateAnother:a,onClose:l}){return e.jsx("div",{className:"csp-modal",children:e.jsxs("div",{className:"csp-modal-content",children:[e.jsx("div",{className:"csp-modal-icon csp-success",children:e.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("polyline",{points:"16 8 10 14 8 12"})]})}),e.jsx("h2",{children:"Proposal Created Successfully!"}),e.jsxs("div",{className:"csp-created-ids",children:[e.jsxs("p",{children:["Recently Created Proposal ID: ",e.jsx("span",{className:"csp-id-value",children:s||"N/A"})]}),e.jsxs("p",{children:["Recently Created Thread ID: ",e.jsx("span",{className:"csp-id-value",children:t||"N/A"})]})]}),e.jsxs("div",{className:"csp-modal-actions",children:[e.jsx("button",{className:"csp-btn csp-btn-primary",onClick:a,children:"Go To Create Another Proposal"}),e.jsx("button",{className:"csp-btn csp-btn-secondary",onClick:l,children:"Close"})]})]})})}function sa({onCancel:s}){return e.jsxs("div",{className:"csp-confirmation-panel",children:[e.jsx("div",{className:"csp-confirmation-header",children:e.jsx("h3",{children:"Review Before Creating"})}),e.jsxs("div",{className:"csp-confirmation-ids",children:[e.jsx("p",{className:"csp-confirmation-note",children:"Please review all details above before confirming proposal creation."}),e.jsx("button",{className:"csp-btn csp-btn-secondary csp-btn-small",onClick:s,children:"Go Back to Edit"})]})]})}function aa(){return e.jsxs("div",{className:"csp-loading-overlay",children:[e.jsx("div",{className:"csp-spinner"}),e.jsx("p",{children:"Creating proposal..."})]})}function ta(){const{currentStep:s,listingSearchTerm:t,listingSearchResults:a,selectedListing:l,listingPhotos:o,isSearchingListings:i,guestSearchTerm:d,guestSearchResults:N,selectedGuest:g,existingProposalsCount:x,isGuestConfirmed:p,isSearchingGuests:v,aboutMe:P,needForSpace:w,specialNeeds:m,proposalStatus:j,moveInDate:S,moveInRange:I,strictMoveIn:_,selectedDays:F,reservationSpan:u,customWeeks:D,checkInDayIndex:je,checkOutDayIndex:M,checkInDayName:Q,checkOutDayName:W,nightsCount:V,pricing:T,isCreating:B,isConfirmationStep:L,validationErrors:z,createdProposal:Y,createdThread:R,showSuccessModal:K,handleGoBack:ee,handleListingSearchChange:le,handleListingSearchFocus:ve,handleListingSelect:oe,handleListingClear:b,handleClearListingSearch:q,handleGuestSearchChange:C,handleGuestSearchFocus:se,handleGuestSelect:E,handleGuestConfirm:X,handleGuestClear:ae,handleClearGuestSearch:ce,handleAboutMeChange:Se,handleNeedForSpaceChange:U,handleSpecialNeedsChange:G,handleTranscriptionParsed:ie,handleStatusChange:ye,handleMoveInDateChange:de,handleMoveInRangeChange:be,handleStrictMoveInChange:he,handleDayToggle:Ce,handleSelectFullTime:te,handleReservationSpanChange:ue,handleCustomWeeksChange:ke,handleFirstCreateClick:re,handleConfirmProposal:ne,handleCancelConfirmation:we,handleCreateAnother:Pe,handleCloseSuccessModal:pe}=_s();return e.jsxs(e.Fragment,{children:[e.jsx(Ps,{}),e.jsxs("main",{className:"csp-main",children:[e.jsxs("div",{className:"csp-container",children:[e.jsx("header",{className:"csp-header",children:e.jsxs("div",{className:"csp-header-left",children:[e.jsx("h1",{className:"csp-title",children:"Quick Proposal Creation"}),e.jsx("p",{className:"csp-subtitle",children:"Create suggested proposals on behalf of guests"})]})}),e.jsx(Ws,{currentStep:s}),e.jsxs("div",{className:"csp-content-wrapper",children:[e.jsxs("div",{className:"csp-left-panel",children:[e.jsx(Bs,{searchTerm:t,searchResults:a,selectedListing:l,listingPhotos:o,isSearching:i,onSearchChange:le,onSearchFocus:ve,onSelect:oe,onClear:b,onClearSearch:q}),s>=2&&e.jsx(Us,{searchTerm:d,searchResults:N,selectedGuest:g,existingProposalsCount:x,isConfirmed:p,isSearching:v,onSearchChange:C,onSearchFocus:se,onSelect:E,onConfirm:X,onClear:ae,onClearSearch:ce}),s>=3&&e.jsx($s,{guestName:(g==null?void 0:g["Name - First"])||(g==null?void 0:g["Name - Full"])||"Guest",aboutMe:P,needForSpace:w,specialNeeds:m,onAboutMeChange:Se,onNeedForSpaceChange:U,onSpecialNeedsChange:G,onTranscriptionParsed:ie})]}),s>=3&&e.jsxs("div",{className:"csp-right-panel",children:[e.jsx(Xs,{proposalStatus:j,moveInDate:S,moveInRange:I,strictMoveIn:_,selectedDays:F,checkInDayName:Q,checkOutDayName:W,nightsCount:V,reservationSpan:u,customWeeks:D,onStatusChange:ye,onMoveInDateChange:de,onMoveInRangeChange:be,onStrictMoveInChange:he,onDayToggle:Ce,onSelectFullTime:te,onReservationSpanChange:ue,onCustomWeeksChange:ke}),e.jsx(Qs,{selectedDays:F,nightsCount:V,reservationWeeks:u==="custom"?D:parseInt(u)||0}),e.jsx(Zs,{pricing:T})]})]}),s>=3&&e.jsx(Ks,{selectedListing:l,selectedGuest:g,selectedDays:F,checkInDayIndex:je,checkOutDayIndex:M,reservationWeeks:u==="custom"?D:parseInt(u)||0,pricing:T}),L&&e.jsx(sa,{onCancel:we}),z.length>0&&e.jsx("div",{className:"csp-validation-messages",children:z.map((Z,f)=>e.jsxs("div",{className:"csp-validation-error",children:[e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),Z]},f))}),e.jsxs("div",{className:"csp-action-buttons",children:[s>=3&&e.jsx("button",{className:"csp-btn csp-btn-secondary",onClick:ee,children:"Go Back"}),L?e.jsx("button",{className:"csp-btn csp-btn-success",onClick:ne,disabled:B,children:B?"Creating...":"Confirm Proposal Creation"}):e.jsx("button",{className:"csp-btn csp-btn-primary",onClick:re,disabled:z.length>0||s<3,children:"Create Proposal"})]})]}),B&&e.jsx(aa,{})]}),K&&e.jsx(ea,{proposalId:Y==null?void 0:Y._id,threadId:R==null?void 0:R._id,onCreateAnother:Pe,onClose:pe})]})}bs(document.getElementById("root")).render(e.jsx(Cs.StrictMode,{children:e.jsx(Is,{children:e.jsx(ta,{})})}));

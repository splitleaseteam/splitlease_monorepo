import{j as e,r as o,c as fs,R as Js}from"./client-BJVKzfAi.js";import{F as Xs,G as Ps}from"./GoogleMap-ICEUXkNW.js";import{I as et}from"./InformationalText-C-nhvRBy.js";import{f as Cs,C as st,a as tt,P as ot,c as rt}from"./ProposalSuccessModal-buYBZjpQ.js";import{A as nt}from"./AiSignupMarketReport-BurRj0qM.js";import{u as at,A as Is,s as it,c as lt}from"./useAuthenticatedUser-1bvYaCkm.js";import{L as Bs,f as ct,a as dt,S as Ms}from"./proposalDataFetcher-CipdyWU2.js";import{i as Ds}from"./isGuest-DSCtqO4x.js";import{i as ut}from"./isHost-bTARCkET.js";import{l as j,g as ht,a as pt,b as ft,d as mt,e as gt,f as xt,c as yt}from"./auth-QZ4BJadW.js";import{c as vt,a as Ls}from"./nightCalculations-BvAtd4RD.js";import{c as bt}from"./ListingScheduleSelector-B9O1H-bT.js";import{s as Se}from"./supabase-BoCLEw6R.js";import{u as jt}from"./Toast-BQk6Nzgd.js";import{D as ue,i as Fs,W as wt,P as Nt,a as Es,L as es}from"./constants-CPVJY5eo.js";import{g as kt,a as St,b as Pt,c as Ct,i as It}from"./dataLookups-zG18yzis.js";import{p as Us,a as Mt,f as us,e as hs,b as ps}from"./supabaseUtils-B40jh603.js";import{f as Lt}from"./informationalTextsFetcher-BGizEeKX.js";import{f as Ft}from"./listingDataFetcher-DGGxiGnp.js";import{E as Et}from"./ErrorBoundary-9_HbXv1y.js";/* empty css             */import"./config-QPKPRtag.js";import"./x-CrJVeoCh.js";import"./createLucideIcon-CgZZH2OU.js";import"./chevron-right-DMpFmStq.js";import"./map-pin-Be7EkBk1.js";import"./square-BGeZC4Cm.js";import"./calendar-CDI4qHEX.js";import"./clock-BT0kKcUb.js";import"./send-C4mziT0-.js";import"./dayUtils-C3_GW2W5.js";import"./SearchScheduleSelector-KBnRs4ik.js";function Ws(s){if(!s||s.length<2)throw new Error("calculateCheckInOutFromDays: selectedDays must contain at least 2 days");const t=[...s].sort((a,u)=>a-u),r=t.includes(6),l=t.includes(0);if(r&&l&&t.length<7){let a=-1;for(let u=1;u<t.length;u++)if(t[u]-t[u-1]>1){a=u;break}if(a!==-1)return{checkIn:t[a],checkOut:t[a-1]}}return{checkIn:t[0],checkOut:t[t.length-1]}}function At({isVisible:s}){const r=new URLSearchParams(window.location.search).get("days-selected")||"",l=r?r.split(",").map(p=>parseInt(p,10)).filter(p=>!isNaN(p)):[],c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a=l.length>=2,u=a?Ws(l):null,v=u?c[u.checkIn]:"",f=u?c[u.checkOut]:"";return e.jsxs("div",{className:`compact-schedule-indicator ${s?"compact-schedule-indicator--visible":""}`,children:[e.jsx("span",{className:"compact-schedule-text",children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"compact-label",children:"Check-in:"})," ",v," â€¢ ",e.jsx("span",{className:"compact-label",children:"Check-out:"})," ",f]}):"Select days"}),e.jsx("div",{className:"compact-schedule-dots",children:[0,1,2,3,4,5,6].map(p=>e.jsx("div",{className:`compact-day-dot ${l.includes(p)?"selected":""}`,title:c[p]},p))})]})}function Rt({onFilterClick:s,onMapClick:t,isMapVisible:r,isLoggedIn:l,currentUser:c,favoritesCount:a,onNavigate:u,onLogout:v,onOpenAuthModal:f,isHidden:p}){return e.jsxs("div",{className:`mobile-filter-bar ${p?"mobile-filter-bar--hidden":""}`,children:[e.jsx("a",{href:"/",className:"mobile-logo-link","aria-label":"Go to homepage",children:e.jsx("img",{src:"/assets/images/split-lease-purple-circle.png",alt:"Split Lease Logo",className:"mobile-logo-icon",width:"28",height:"28"})}),e.jsxs("button",{className:"filter-toggle-btn",onClick:s,children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:e.jsx("path",{d:"M4 6h16M4 12h16M4 18h16",strokeWidth:"2",strokeLinecap:"round"})}),e.jsx("span",{children:"Filters"})]}),e.jsxs("button",{className:"map-toggle-btn",onClick:t,children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",strokeWidth:"2"}),e.jsx("path",{d:"M9 3v18M15 3v18M3 9h18M3 15h18",strokeWidth:"2"})]}),e.jsx("span",{children:r?"Show Listings":"Map"})]}),e.jsx("div",{className:"mobile-header-actions",children:l&&c?e.jsxs(e.Fragment,{children:[e.jsx("a",{href:"/favorite-listings",className:"mobile-favorites-link","aria-label":"My Favorite Listings",children:e.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"#5b21b6",stroke:"none",children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})}),e.jsx(Bs,{user:c,currentPath:"/search",onNavigate:u,onLogout:v,size:"small"})]}):e.jsx("button",{className:"mobile-signin-btn",onClick:f,"aria-label":"Sign In",children:"Sign In"})})]})}function ts(s,t={}){if(!s||typeof s!="string")return"";const{maxLength:r=1e3,allowNewlines:l=!1,allowSpecialChars:c=!0}=t;let a=s;return a=a.trim(),a.length>r&&(a=a.substring(0,r)),l?a=a.replace(/[\x00-\x09\x0B-\x0C\x0E-\x1F\x7F]/g,""):a=a.replace(/[\x00-\x1F\x7F]/g,""),a=a.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,""),a=a.replace(/on\w+\s*=\s*["'][^"']*["']/gi,""),a=a.replace(/on\w+\s*=\s*[^\s>]*/gi,""),a=a.replace(/javascript:/gi,""),a=a.replace(/data:text\/html/gi,""),a=a.replace(/<!--[\s\S]*?-->/g,""),c||(a=a.replace(/[<>{}[\]\\\/]/g,"")),a}function $s(s){return ts(s,{maxLength:100,allowNewlines:!1,allowSpecialChars:!1})}function ss(s,t="string"){if(!s)return null;switch(t){case"string":return ts(s,{maxLength:100,allowNewlines:!1,allowSpecialChars:!1});case"number":const r=parseInt(s,10);return isNaN(r)?null:r;case"array":return typeof s!="string"?[]:s.split(",").map(l=>ts(l.trim(),{maxLength:50,allowNewlines:!1,allowSpecialChars:!1})).filter(l=>l.length>0);case"boolean":return s==="true"||s==="1";default:return ts(s)}}const As=new Map;function Tt(){const s=Date.now();for(const[t,r]of As.entries())s>r.resetTime&&As.delete(t)}typeof window<"u"&&setInterval(Tt,5*60*1e3);function Ot({neighborhoods:s,selectedNeighborhoods:t,onNeighborhoodsChange:r,neighborhoodSearch:l,onNeighborhoodSearchChange:c,searchInputId:a}){const u=a||"neighborhoodSearch",v=o.useRef(null),[f,p]=o.useState(!1),C=o.useRef(null),k=d=>{t.includes(d)||r([...t,d]),c(""),p(!1)},M=d=>{r(t.filter(L=>L!==d))},x=$s(l||""),N=s.filter(d=>t.includes(d.id)?!1:x?d.name.toLowerCase().includes(x.toLowerCase()):!0),m=d=>{var L;(L=C.current)!=null&&L.contains(d.relatedTarget)||p(!1)},I=t.length>0;return e.jsxs("div",{className:"filter-group compact neighborhood-search-group",ref:C,onBlur:m,children:[e.jsx("label",{htmlFor:u,children:"Neighborhood"}),I?e.jsxs("div",{className:"neighborhood-chips-row",children:[t.map(d=>{const L=s.find(V=>V.id===d);return L?e.jsxs("span",{className:"neighborhood-chip-compact",children:[L.name,e.jsx("button",{type:"button",onClick:()=>M(d),"aria-label":`Remove ${L.name}`,children:"Ã—"})]},d):null}),e.jsx("button",{type:"button",className:"neighborhood-add-btn",onClick:()=>p(!f),"aria-label":"Add neighborhood",children:"+"})]}):e.jsx("div",{className:"neighborhood-search-container",children:e.jsx("input",{ref:v,type:"text",id:u,placeholder:"Search neighborhoods...",className:"neighborhood-search-input",value:l,onChange:d=>c(d.target.value),onFocus:()=>p(!0),autoComplete:"off"})}),f&&e.jsxs("div",{className:"neighborhood-search-dropdown",children:[I&&e.jsx("div",{className:"neighborhood-dropdown-search",children:e.jsx("input",{ref:v,type:"text",placeholder:"Search to add...",className:"neighborhood-search-input",value:l,onChange:d=>c(d.target.value),autoComplete:"off",autoFocus:!0})}),N.length===0?e.jsx("div",{className:"neighborhood-search-empty",children:s.length===0?"Loading...":"No matches"}):N.slice(0,8).map(d=>e.jsx("button",{type:"button",className:"neighborhood-search-option",onClick:()=>k(d.id),children:d.name},d.id)),N.length>8&&e.jsxs("div",{className:"neighborhood-search-more",children:["+",N.length-8," more â€” type to filter"]})]})]})}function _t(s){const[t,r]=o.useState(0),l=s&&s.length>0,c=s&&s.length>1,a=o.useCallback(v=>{v.preventDefault(),v.stopPropagation(),c&&r(f=>f===0?s.length-1:f-1)},[c,s==null?void 0:s.length]),u=o.useCallback(v=>{v.preventDefault(),v.stopPropagation(),c&&r(f=>f===s.length-1?0:f+1)},[c,s==null?void 0:s.length]);return{currentImageIndex:t,hasImages:l,hasMultipleImages:c,handlePrevImage:a,handleNextImage:u,setCurrentImageIndex:r}}const Hs=o.memo(function({listing:t,onLocationClick:r,onCardHover:l,onCardLeave:c,onOpenContactModal:a,onOpenInfoModal:u,isLoggedIn:v,isFavorited:f,userId:p,onToggleFavorite:C,onRequireAuth:k,showCreateProposalButton:M=!1,onOpenCreateProposalModal:x,proposalForListing:N,selectedNightsCount:m=5,onPhotoClick:I,variant:d="search",userPreferences:L=null}){var je,Z,Ie,we,re,z,R,Y;const{currentImageIndex:V,hasImages:U,hasMultipleImages:J,handlePrevImage:ve,handleNextImage:Pe}=_t(t.images),Ce=o.useRef(null),ge=o.useRef(null),Fe=t.id||t._id,ie=o.useMemo(()=>{if(d!=="search")return null;const O=(t.id||t._id||"").split("").reduce((B,K)=>B+K.charCodeAt(0),0)%4;return[{text:"Available in 1 week",className:"availability-soon"},{text:"Available in 2 weeks",className:"availability-soon"},{text:"Available in 3 weeks",className:"availability-later"},{text:`Message Split Lease
for Availability`,className:""}][O]},[t.id,t._id,d]),le=o.useMemo(()=>{var q,O,X;const h=m;if(h<1)return t["Starting nightly price"]||((q=t.price)==null?void 0:q.starting)||0;try{const B=Array(h).fill({nightNumber:0}),K=bt(B,t,13,null);return d==="search"&&j.debug(`[PropertyCard] Dynamic price for ${t.title}:`,{nightsCount:h,rentalType:t.rentalType,hostRate:t[`ðŸ’°Nightly Host Rate for ${h} nights`],pricePerNight:K.pricePerNight,valid:K.valid}),K.pricePerNight||t["Starting nightly price"]||((O=t.price)==null?void 0:O.starting)||0}catch(B){return d==="search"&&j.warn(`[PropertyCard] Price calculation failed for listing ${t.id}:`,B.message),t["Starting nightly price"]||((X=t.price)==null?void 0:X.starting)||0}},[m,t._id,t["Starting nightly price"],(je=t.price)==null?void 0:je.starting,t.rentalType,d]),Q=t["Starting nightly price"]||((Z=t.price)==null?void 0:Z.starting)||0,se=t.id||t._id,xe=h=>{if(!se){h.preventDefault(),d==="search"?j.error("[PropertyCard] No listing ID found",{listing:t}):console.error("[PropertyCard] No listing ID found",{listing:t});return}h.preventDefault();const O=new URLSearchParams(window.location.search).get("days-selected"),X=O?`/view-split-lease/${se}?days-selected=${O}`:`/view-split-lease/${se}`;d==="search"||console.log("PropertyCard: Opening listing with URL:",X),window.innerWidth<=768||d==="favorites"?window.location.href=X:window.open(X,"_blank","noopener,noreferrer")},be=h=>{h.preventDefault(),h.stopPropagation(),I&&I(t,V)};return e.jsxs("a",{className:"listing-card","data-listing-id":se,href:se?`/view-split-lease/${se}`:"#",target:"_blank",rel:"noopener noreferrer",style:{textDecoration:"none",color:"inherit"},onClick:xe,onMouseEnter:()=>{l&&l(t)},onMouseLeave:()=>{c&&c()},children:[U&&e.jsxs("div",{className:"listing-images",children:[e.jsx("img",{src:t.images[V],alt:t.title,onClick:I?be:void 0,style:{cursor:I?"pointer":"default"}}),J&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"image-nav prev-btn",onClick:ve,children:"â€¹"}),e.jsx("button",{className:"image-nav next-btn",onClick:Pe,children:"â€º"}),e.jsxs("div",{className:"image-counter",children:[e.jsx("span",{className:"current-image",children:V+1})," /"," ",e.jsx("span",{className:"total-images",children:t.images.length})]})]}),e.jsx(Xs,{listingId:Fe,userId:p,initialFavorited:f,onToggle:(h,q)=>{C&&C(q,t.title,h)},onRequireAuth:k,size:"medium"}),t.isNew&&e.jsx("span",{className:"new-badge",children:"New Listing"}),t.type==="Entire Place"&&e.jsxs("span",{className:"family-friendly-tag","aria-label":"Family Friendly - Entire place listing suitable for families",children:[e.jsxs("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M23 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),"Family Friendly"]})]}),e.jsxs("div",{className:"listing-content",children:[e.jsxs("div",{className:"listing-main-info",children:[e.jsxs("div",{className:"listing-info-top",children:[e.jsxs("button",{type:"button",className:"listing-location-pill",onClick:h=>{h.preventDefault(),h.stopPropagation(),r&&r(t)},children:[e.jsx("svg",{className:"location-pin-icon",width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",stroke:"none",children:e.jsx("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})}),e.jsx("span",{className:"location-text",children:t.location}),e.jsxs("svg",{className:"location-arrow-icon",width:"10",height:"10",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"}),e.jsx("polyline",{points:"12 5 19 12 12 19"})]})]}),e.jsx("h3",{className:"listing-title",children:t.title})]}),e.jsxs("div",{className:"listing-meta",children:[e.jsx("span",{className:"meta-item",children:e.jsx("strong",{children:t.type||"Entire Place"})}),e.jsxs("span",{className:"meta-item",children:[e.jsx("strong",{children:t.maxGuests})," guests"]}),e.jsx("span",{className:"meta-item",children:e.jsx("strong",{children:t.bedrooms===0?"Studio":`${t.bedrooms} bedroom${t.bedrooms>1?"s":""}`})}),e.jsxs("span",{className:"meta-item",children:[e.jsx("strong",{children:t.bathrooms})," bath"]})]}),d==="search"?e.jsxs("div",{className:"listing-host-section",children:[e.jsxs("div",{className:"inline-price",children:[e.jsxs("span",{className:"price-current",children:["$",le.toFixed(2)]}),e.jsx("span",{className:"price-period",children:"/ night"}),Q>0&&Q!==le&&e.jsxs("span",{ref:ge,className:"price-min-trigger",onClick:h=>{h.preventDefault(),h.stopPropagation(),u(t,ge)},children:["from $",parseFloat(Q).toFixed(2),"/night",e.jsx("span",{className:"price-info-icon",children:"?"})]})]}),e.jsxs("div",{className:"action-buttons",children:[e.jsxs("button",{className:"action-button secondary",onClick:h=>{h.preventDefault(),h.stopPropagation(),a(t)},children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})}),"Message"]}),M&&(N?e.jsxs("button",{className:"view-proposal-btn",onClick:h=>{h.preventDefault(),h.stopPropagation(),window.location.href=`/guest-proposals?proposal=${N._id}`},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),"View Proposal"]}):e.jsxs("button",{className:"create-proposal-btn",onClick:h=>{h.preventDefault(),h.stopPropagation(),x(t)},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Create Proposal"]}))]}),e.jsxs("div",{className:"host-profile",children:[(Ie=t.host)!=null&&Ie.image?e.jsx("img",{src:t.host.image,alt:t.host.name,className:"host-avatar"}):e.jsx("div",{className:"host-avatar-placeholder",children:"?"}),e.jsxs("span",{className:"host-name",children:["Hosted by ",Cs({fullName:((we=t.host)==null?void 0:we.name)||"Host"}),((re=t.host)==null?void 0:re.verified)&&e.jsx("span",{className:"verified-badge",title:"Verified",children:"âœ“"})]})]})]}):e.jsxs("div",{className:"listing-host-row",children:[e.jsxs("div",{className:"host",children:[(z=t.host)!=null&&z.image?e.jsx("img",{src:t.host.image,alt:t.host.name,className:"host-avatar"}):e.jsx("div",{className:"host-avatar-placeholder",children:"?"}),e.jsxs("span",{className:"host-name",children:[Cs({fullName:((R=t.host)==null?void 0:R.name)||"Host"}),((Y=t.host)==null?void 0:Y.verified)&&e.jsx("span",{className:"verified-badge",title:"Verified",children:"âœ“"})]})]}),e.jsxs("div",{className:"listing-cta-buttons",children:[e.jsxs("button",{className:"message-btn",onClick:h=>{h.preventDefault(),h.stopPropagation(),a(t)},children:[e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})}),"Message"]}),N?e.jsxs("button",{className:"view-proposal-btn",onClick:h=>{h.preventDefault(),h.stopPropagation(),window.location.href=`/guest-proposals?proposal=${N._id}`},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),"View Proposal"]}):e.jsxs("button",{className:"create-proposal-btn",onClick:h=>{h.preventDefault(),h.stopPropagation(),x&&x(t)},children:[e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),"Create Proposal"]})]})]})]}),e.jsxs("div",{className:"listing-price-sidebar",ref:Ce,onClick:h=>{h.preventDefault(),h.stopPropagation(),u(t,Ce)},children:[e.jsxs("div",{className:"price-main",children:["$",le.toFixed(2)]}),e.jsx("div",{className:"price-period",children:"/night"}),e.jsx("div",{className:"price-divider"}),d==="search"?m>=1?e.jsxs("div",{className:"price-context",children:["for ",m," night",m!==1?"s":"","/week"]}):e.jsxs("div",{className:"price-starting",children:["Starting at",e.jsxs("span",{children:["$",parseFloat(Q).toFixed(2),"/night"]})]}):e.jsxs("div",{className:"price-starting",children:["Starting at",e.jsxs("span",{children:["$",parseFloat(Q).toFixed(2),"/night"]})]}),d==="search"&&ie?e.jsx("div",{className:`availability-note ${ie.className}`,children:ie.text.split(`
`).map((h,q)=>q===0?h:e.jsxs(e.Fragment,{children:[e.jsx("br",{},q),h]}))}):e.jsxs("div",{className:"availability-note",children:["Message Split Lease",e.jsx("br",{}),"for Availability"]})]})]})]})});Hs.displayName="PropertyCard";const Rs=768;function Bt(){const[s,t]=o.useState(()=>typeof window>"u"?!0:window.innerWidth>Rs);return o.useEffect(()=>{const r=()=>{t(window.innerWidth>Rs)};return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]),s}async function Dt({email:s,phoneNumber:t,redirectTo:r}){var l,c,a,u,v;try{const{data:f,error:p}=await Se.functions.invoke("auth-user",{body:{action:"send_magic_link_sms",payload:{email:s,phoneNumber:t,redirectTo:r||window.location.href}}});if(p){j.error("[UsabilityPopup] Edge Function error:",p);let C="Failed to send login link";if(p.context&&typeof p.context.json=="function")try{const k=await p.context.json();k!=null&&k.error&&(C=k.error)}catch{}throw new Error(C)}if(!(f!=null&&f.success)){const C=(f==null?void 0:f.error)||"Failed to send login link";throw j.error("[UsabilityPopup] API returned failure:",C),new Error(C)}return j.debug("[UsabilityPopup] SMS sent successfully"),j.debug("[UsabilityPopup] Message SID:",(l=f.data)==null?void 0:l.message_sid),{success:!0,messageSid:(c=f.data)==null?void 0:c.message_sid,sentAt:(a=f.data)==null?void 0:a.sent_at}}catch(f){throw j.error("[UsabilityPopup] sendMagicLinkViaSms error:",f),(u=f.message)!=null&&u.includes("E.164")?new Error("Please enter a valid US phone number"):(v=f.message)!=null&&v.includes("delivery failed")?new Error("Unable to send SMS. Please check the phone number and try again."):f}}const os={DIGITS_ONLY:/^1?\d{10}$/,FORMATTED:/^\(?(\d{3})\)?[-.\s]?(\d{3})[-.\s]?(\d{4})$/,E164:/^\+1\d{10}$/},ms=s=>s?s.replace(/\D/g,""):"",Ut=s=>{if(!s||typeof s!="string")return!1;const t=s.trim();if(os.E164.test(t)||os.FORMATTED.test(t))return!0;const r=ms(t);return os.DIGITS_ONLY.test(r)},Wt=s=>{if(!s||typeof s!="string")return null;const t=s.trim();if(os.E164.test(t))return t;const r=ms(t);return r.length===11&&r.startsWith("1")?`+${r}`:r.length===10?`+1${r}`:null},$t=s=>{if(!s)return"";const r=ms(s).slice(0,10);return r.length===0?"":r.length<=3?`(${r}`:r.length<=6?`(${r.slice(0,3)}) ${r.slice(3)}`:`(${r.slice(0,3)}) ${r.slice(3,6)}-${r.slice(6)}`},Ts="usability_popup_dismissed";function Ht({userData:s,onSuccess:t,onError:r}){const l=Bt(),[c,a]=o.useState((s==null?void 0:s.phoneNumber)||""),[u,v]=o.useState(!1),[f,p]=o.useState(null),[C,k]=o.useState(null),[M,x]=o.useState(()=>typeof window>"u"?!1:sessionStorage.getItem(Ts)==="true");o.useEffect(()=>{s!=null&&s.phoneNumber&&!c&&a(s.phoneNumber)},[s==null?void 0:s.phoneNumber]);const N=(s==null?void 0:s.isUsabilityTester)===!0&&l&&!M&&!C,m=o.useCallback(()=>{x(!0),typeof window<"u"&&sessionStorage.setItem(Ts,"true")},[]),I=o.useCallback(()=>{p(null)},[]),d=o.useCallback(U=>{a(U),f&&p(null)},[f]),L=o.useCallback(()=>!c||c.trim()===""?(p("Please enter your phone number"),!1):Ut(c)?!0:(p("Please enter a valid US phone number"),!1),[c]),V=o.useCallback(async()=>{if(L()){if(!(s!=null&&s.email)){p("Unable to send link. Please try logging in again.");return}v(!0),p(null);try{const U=Wt(c);if(!U)throw new Error("Invalid phone number format");j.debug("[UsabilityPopup] Sending magic link...");const J=await Dt({email:s.email,phoneNumber:U,redirectTo:window.location.href});j.debug("[UsabilityPopup] Magic link sent successfully"),k("Check your phone! Login link sent."),t&&t(J),setTimeout(()=>{m()},3e3)}catch(U){j.error("[UsabilityPopup] Failed to send link:",U);const J=U.message||"Failed to send link. Please try again.";p(J),r&&r(U)}finally{v(!1)}}},[c,s,L,m,t,r]);return{shouldShowPopup:N,phoneNumber:c,setPhoneNumber:d,isLoading:u,error:f,successMessage:C,dismissPopup:m,clearError:I,handleSendLink:V}}const Vt=()=>e.jsx("svg",{className:"usability-popup-phone-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"})}),zt=()=>e.jsxs("svg",{className:"usability-popup-mobile-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"5",y:"2",width:"14",height:"20",rx:"2",ry:"2"}),e.jsx("line",{x1:"12",y1:"18",x2:"12.01",y2:"18"})]}),qt=()=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Gt=()=>e.jsxs("svg",{className:"usability-popup-check-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),Yt=()=>e.jsx("div",{className:"usability-popup-spinner",children:e.jsx("div",{className:"usability-popup-spinner-circle"})});function Kt({userData:s,onSuccess:t,onError:r}){const{showToast:l}=jt(),c=o.useCallback(d=>{l({title:"Link Sent!",content:"Check your phone for the login link.",type:"success"}),t&&t(d)},[l,t]),a=o.useCallback(d=>{l({title:"Failed to send",content:d.message||"Please try again.",type:"error"}),r&&r(d)},[l,r]),{shouldShowPopup:u,phoneNumber:v,setPhoneNumber:f,isLoading:p,error:C,successMessage:k,dismissPopup:M,handleSendLink:x}=Ht({userData:s,onSuccess:c,onError:a}),N=o.useCallback(d=>{const L=$t(d.target.value);f(L)},[f]),m=o.useCallback(d=>{d.preventDefault(),x()},[x]),I=o.useCallback(d=>{d.key==="Enter"&&!p&&x()},[x,p]);return u?e.jsx("div",{className:"usability-popup-overlay",role:"dialog","aria-modal":"true","aria-labelledby":"usability-popup-title",children:e.jsxs("div",{className:"usability-popup",children:[e.jsx("button",{className:"usability-popup-close",onClick:M,"aria-label":"Close popup",type:"button",children:e.jsx(qt,{})}),e.jsxs("div",{className:"usability-popup-header",children:[e.jsx(zt,{}),e.jsx("h2",{id:"usability-popup-title",className:"usability-popup-title",children:"Continue on Mobile"})]}),e.jsx("p",{className:"usability-popup-description",children:"For the best testing experience, continue this session on your phone. We'll text you a login link."}),k?e.jsxs("div",{className:"usability-popup-success",children:[e.jsx(Gt,{}),e.jsx("span",{children:k})]}):e.jsxs("form",{className:"usability-popup-form",onSubmit:m,children:[e.jsxs("div",{className:"usability-popup-input-wrapper",children:[e.jsx(Vt,{}),e.jsx("input",{type:"tel",className:`usability-popup-input ${C?"usability-popup-input-error":""}`,placeholder:"(555) 123-4567",value:v,onChange:N,onKeyPress:I,disabled:p,"aria-label":"Phone number","aria-invalid":!!C,"aria-describedby":C?"usability-popup-error":void 0,autoComplete:"tel"})]}),C&&e.jsx("p",{id:"usability-popup-error",className:"usability-popup-error",role:"alert",children:C}),e.jsx("button",{type:"submit",className:"usability-popup-submit",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(Yt,{}),e.jsx("span",{children:"Sending..."})]}):e.jsx("span",{children:"Send Login Link"})})]}),e.jsx("p",{className:"usability-popup-footer",children:"Standard messaging rates may apply. Link expires in 15 minutes."})]})}):null}function Vs(){if(typeof window>"u")return eo();const s=new URLSearchParams(window.location.search);return{selectedBorough:ss(s.get("borough"),"string")||ue.DEFAULT_BOROUGH,weekPattern:ss(s.get("weekly-frequency"),"string")||ue.DEFAULT_WEEK_PATTERN,priceTier:ss(s.get("pricetier"),"string")||ue.DEFAULT_PRICE_TIER,sortBy:ss(s.get("sort"),"string")||ue.DEFAULT_SORT_BY,selectedNeighborhoods:Qt(s.get("neighborhoods"))}}function Qt(s){if(!s)return[];try{return s.split(",").map(r=>r.trim()).filter(r=>r.length>0)}catch(t){return console.error("Failed to parse neighborhoods parameter:",t),[]}}function Zt(s){const t=new URLSearchParams;return s.selectedBorough&&s.selectedBorough!==ue.DEFAULT_BOROUGH&&t.set("borough",s.selectedBorough),s.weekPattern&&s.weekPattern!==ue.DEFAULT_WEEK_PATTERN&&t.set("weekly-frequency",s.weekPattern),s.priceTier&&s.priceTier!==ue.DEFAULT_PRICE_TIER&&t.set("pricetier",s.priceTier),s.sortBy&&s.sortBy!==ue.DEFAULT_SORT_BY&&t.set("sort",s.sortBy),s.selectedNeighborhoods&&s.selectedNeighborhoods.length>0&&t.set("neighborhoods",s.selectedNeighborhoods.join(",")),t.toString()}function Jt(s,t=!1){if(typeof window>"u")return;const r=Zt(s),c=new URLSearchParams(window.location.search).get("days-selected");let a;if(r){const u=new URLSearchParams(r);c&&u.set("days-selected",c),a=`${window.location.pathname}?${u.toString()}`}else c?a=`${window.location.pathname}?days-selected=${c}`:a=window.location.pathname;t?window.history.replaceState(null,"",a):window.history.pushState(null,"",a)}function Xt(s){if(typeof window>"u")return()=>{};const t=()=>{const r=Vs();s(r)};return window.addEventListener("popstate",t),()=>{window.removeEventListener("popstate",t)}}function eo(){return{selectedBorough:ue.DEFAULT_BOROUGH,weekPattern:ue.DEFAULT_WEEK_PATTERN,priceTier:ue.DEFAULT_PRICE_TIER,sortBy:ue.DEFAULT_SORT_BY,selectedNeighborhoods:[]}}function so({locationSlightlyDifferent:s,locationAddress:t,listingId:r}){if(!r||typeof r!="string")throw new Error("extractListingCoordinates: listingId is required and must be a string");let l=s,c=t;if(typeof s=="string")try{l=JSON.parse(s)}catch(a){console.error("âŒ extractListingCoordinates: Failed to parse Location - slightly different address:",{listingId:r,rawValue:s,error:a.message}),l=null}if(typeof t=="string")try{c=JSON.parse(t)}catch(a){console.error("âŒ extractListingCoordinates: Failed to parse Location - Address:",{listingId:r,rawValue:t,error:a.message}),c=null}return l&&Fs(l.lat,l.lng)?{lat:l.lat,lng:l.lng,source:"slightly-different-address"}:c&&Fs(c.lat,c.lng)?{lat:c.lat,lng:c.lng,source:"main-address"}:(console.warn("âš ï¸ extractListingCoordinates: No valid coordinates found for listing:",{listingId:r,hasSlightlyDifferent:!!l,hasMainAddress:!!c}),null)}const to=Object.freeze({UNDER_200:"under-200",TIER_200_350:"200-350",TIER_350_500:"350-500",OVER_500:"500-plus",ALL:"all"}),oo=Object.freeze(Object.values(to)),ro=Object.freeze({RECOMMENDED:"recommended",PRICE_LOW:"price-low",MOST_VIEWED:"most-viewed",RECENT:"recent"}),no=Object.freeze(Object.values(ro)),ao=Object.freeze({EVERY_WEEK:"every-week",ONE_ON_OFF:"one-on-off",TWO_ON_OFF:"two-on-off",ONE_THREE_OFF:"one-three-off"}),io=Object.freeze(Object.values(ao));function lo({priceTier:s}){if(typeof s!="string")throw new Error(`isValidPriceTier: priceTier must be a string, got ${typeof s}`);return oo.includes(s)}function co({weekPattern:s}){if(typeof s!="string")throw new Error(`isValidWeekPattern: weekPattern must be a string, got ${typeof s}`);return io.includes(s)}function uo({sortBy:s}){if(typeof s!="string")throw new Error(`isValidSortOption: sortBy must be a string, got ${typeof s}`);return no.includes(s)}function Os(s){const t=new Set;return s.forEach(r=>{const l=r["Features - Photos"];Us({field:l,fieldName:"Features - Photos"}).forEach(a=>t.add(a))}),Array.from(t)}function ho(){const[s,t]=o.useState(!0),[r,l]=o.useState(null),[c,a]=o.useState([]),[u,v]=o.useState([]),[f,p]=o.useState([]),[C,k]=o.useState(0),[M,x]=o.useState([]),[N,m]=o.useState([]),[I,d]=o.useState(0),[L,V]=o.useState(!1),[U,J]=o.useState(!1),[ve,Pe]=o.useState(!1),[Ce,ge]=o.useState(!1),[Fe,ie]=o.useState(!1),[le,Q]=o.useState(null),[se,xe]=o.useState(null),[be,je]=o.useState({}),[Z,Ie]=o.useState([]),[we,re]=o.useState([]),z=o.useMemo(()=>Vs(),[]),[R,Y]=o.useState(z.selectedBorough),[h,q]=o.useState(z.selectedNeighborhoods),[O,X]=o.useState(z.weekPattern),[B,K]=o.useState(z.priceTier),[D,H]=o.useState(z.sortBy),[te,Ee]=o.useState(""),[Ne,Re]=o.useState(!1),[Te,He]=o.useState(!1),[rs,ns]=o.useState(!1),ce=o.useRef(null),he=o.useRef(!1),Ve=o.useRef(null),ze=o.useRef(!0),qe=o.useMemo(()=>({isPriceTierValid:lo({priceTier:B}),isWeekPatternValid:co({weekPattern:O}),isSortOptionValid:uo({sortBy:D})}),[B,O,D]),pe=o.useCallback((i,g,E)=>{const W=kt(i["Location - Hood"]),F=St(i["Location - Borough"]),A=Pt(i["Features - Type of Space"]),oe=[];W&&oe.push(W),F&&oe.push(F);const de=oe.join(", ")||"New York, NY",ne=so({locationSlightlyDifferent:i["Location - slightly different address"],locationAddress:i["Location - Address"],listingId:i._id}),_=(ae,S=null)=>{if(ae==null)return S;const P=Number(ae);return isNaN(P)?S:P};return{id:i._id,title:i.Name||"Unnamed Listing",location:de,neighborhood:W||"",borough:F||"",coordinates:ne?{lat:ne.lat,lng:ne.lng}:null,price:{starting:_(i["Standarized Minimum Nightly Price (Filter)"],0),full:_(i["ðŸ’°Nightly Host Rate for 7 nights"],0)},"Starting nightly price":_(i["Standarized Minimum Nightly Price (Filter)"],0),"Price 2 nights selected":_(i["ðŸ’°Nightly Host Rate for 2 nights"]),"Price 3 nights selected":_(i["ðŸ’°Nightly Host Rate for 3 nights"]),"Price 4 nights selected":_(i["ðŸ’°Nightly Host Rate for 4 nights"]),"Price 5 nights selected":_(i["ðŸ’°Nightly Host Rate for 5 nights"]),"Price 6 nights selected":null,"Price 7 nights selected":_(i["ðŸ’°Nightly Host Rate for 7 nights"]),"rental type":i["rental type"]||"Nightly",rentalType:i["rental type"]||"Nightly","ðŸ’°Monthly Host Rate":_(i["ðŸ’°Monthly Host Rate"]),"ðŸ’°Weekly Host Rate":_(i["ðŸ’°Weekly Host Rate"]),"ðŸ’°Cleaning Cost / Maintenance Fee":_(i["ðŸ’°Cleaning Cost / Maintenance Fee"],0),"ðŸ’°Damage Deposit":_(i["ðŸ’°Damage Deposit"],0),"ðŸ’°Unit Markup":_(i["ðŸ’°Unit Markup"],0),"Weeks offered":i["Weeks offered"]||"Every week",weeksOffered:i["Weeks offered"]||"Every week",type:A,squareFeet:i["Features - SQFT Area"]||null,maxGuests:i["Features - Qty Guests"]||1,bedrooms:i["Features - Qty Bedrooms"]||0,bathrooms:i["Features - Qty Bathrooms"]||0,amenities:Mt(i),host:E||{name:null,image:null,verified:!1},images:g||[],description:`${(i["Features - Qty Bedrooms"]||0)===0?"Studio":`${i["Features - Qty Bedrooms"]} bedroom`} â€¢ ${i["Features - Qty Bathrooms"]||0} bathroom`,weeks_offered:i["Weeks offered"]||"Every week",days_available:Us({field:i["Days Available (List of Days)"],fieldName:"Days Available"}),isNew:!1}},[]),Ge=o.useCallback(async()=>{try{const{data:i,error:g}=await Se.from("listing").select("*").eq("Active",!0).eq("Deleted",!1).eq("isForUsability",!1).or('"Location - Address".not.is.null,"Location - slightly different address".not.is.null');if(g)throw g;j.debug("fetchAllActiveListings: Supabase returned",i.length,"active listings");const E=Os(i),W=await us(E),F={};i.forEach(S=>{F[S._id]=hs(S["Features - Photos"],W,S._id)});const A=new Set;i.forEach(S=>{S["Host User"]&&A.add(S["Host User"])});const oe=await ps(Array.from(A)),de={};i.forEach(S=>{const P=S["Host User"];de[S._id]=oe[P]||null});const ae=i.map(S=>pe(S,F[S._id],de[S._id])).filter(S=>S.coordinates&&S.coordinates.lat&&S.coordinates.lng).filter(S=>S.images&&S.images.length>0);j.debug(`Fetched ${ae.length} active listings with coordinates and photos`),a(ae)}catch(i){j.error("Failed to fetch all active listings:",i)}},[pe]),Oe=o.useCallback(async()=>{if(Z.length===0||!R)return;const i=`${R}-${h.join(",")}-${O}-${B}-${D}`;if(!he.current&&Ve.current!==i){he.current=!0,Ve.current=i,t(!0),l(null);try{const g=Z.find(b=>b.value===R);if(!g)throw new Error("Borough not found");let E=Se.from("listing").select("*").eq('"Complete"',!0).or('"Active".eq.true,"Active".is.null').eq("Deleted",!1).eq('"Location - Borough"',g.id).or('"Location - Address".not.is.null,"Location - slightly different address".not.is.null');if(O!=="every-week"){const b=wt[O];b&&(E=E.eq('"Weeks offered"',b))}if(B!=="all"){const b=Nt[B];b&&(E=E.gte('"Standarized Minimum Nightly Price (Filter)"',b.min).lte('"Standarized Minimum Nightly Price (Filter)"',b.max))}h.length>0&&(E=E.in('"Location - Hood"',h));const W=Es[D]||Es.recommended;E=E.order(W.field,{ascending:W.ascending});const{data:F,error:A}=await E;if(A)throw A;j.debug("SearchPage: Supabase query returned",F.length,"listings");const oe=Os(F),de=await us(oe),ne={};F.forEach(b=>{ne[b._id]=hs(b["Features - Photos"],de,b._id)});const _=new Set;F.forEach(b=>{b["Host User"]&&_.add(b["Host User"])});const ae=await ps(Array.from(_)),S={};F.forEach(b=>{const We=b["Host User"];S[b._id]=ae[We]||null});const me=F.map(b=>pe(b,ne[b._id],S[b._id])).filter(b=>b.coordinates&&b.coordinates.lat&&b.coordinates.lng).filter(b=>b.images&&b.images.length>0);v(me),k(0),j.debug("SearchPage: State updated with",me.length,"listings")}catch(g){j.error("Failed to fetch listings:",g),l("We had trouble loading listings. Please try refreshing the page or adjusting your filters.")}finally{t(!1),he.current=!1}}},[Z,R,h,O,B,D,pe]),Ye=o.useCallback(async()=>{V(!0);try{const i=Se.from("listing").select("*").eq('"Complete"',!0).or('"Active".eq.true,"Active".is.null').or('"Location - Address".not.is.null,"Location - slightly different address".not.is.null').not('"Features - Photos"',"is",null).order('"Modified Date"',{ascending:!1}),{data:g,error:E}=await i;if(E)throw E;j.debug("Fallback query returned",g.length,"listings");const W=new Set;g.forEach(P=>{const fe=P["Features - Photos"];let me=[];if(Array.isArray(fe))me=fe;else if(typeof fe=="string")try{me=JSON.parse(fe)}catch{}Array.isArray(me)&&me.forEach(b=>{typeof b=="string"&&W.add(b)})});const F=W.size>0?await us(Array.from(W)):{},A={};g.forEach(P=>{A[P._id]=hs(P["Features - Photos"],F,P._id)});const oe=new Set;g.forEach(P=>{P["Host User"]&&oe.add(P["Host User"])});const de=await ps(Array.from(oe)),ne={};g.forEach(P=>{const fe=P["Host User"];ne[P._id]=de[fe]||null});const S=g.map(P=>pe(P,A[P._id],ne[P._id])).filter(P=>P.coordinates&&P.coordinates.lat&&P.coordinates.lng).filter(P=>P.images&&P.images.length>0);j.debug("Fallback listings ready:",S.length),x(S),d(0)}catch(i){j.error("Failed to fetch fallback listings:",i),x([]),J(!0)}finally{V(!1)}},[pe]);o.useEffect(()=>{(async()=>{Ct()||await It()})()},[]),o.useEffect(()=>{(async()=>{const g=await Lt();je(g)})()},[]),o.useEffect(()=>{Ge()},[Ge]),o.useEffect(()=>{(async()=>{try{const{data:g,error:E}=await Se.schema("reference_table").from("zat_geo_borough_toplevel").select('_id, "Display Borough"').order('"Display Borough"',{ascending:!0});if(E)throw E;const W=g.filter(F=>F["Display Borough"]&&F["Display Borough"].trim()).map(F=>({id:F._id,name:F["Display Borough"].trim(),value:F["Display Borough"].trim().toLowerCase().replace(/\s+county\s+nj/i,"").replace(/\s+/g,"-")}));if(Ie(W),R){if(!W.find(A=>A.value===R)){j.warn(`Borough "${R}" from URL not found, defaulting to Manhattan`);const A=W.find(oe=>oe.value==="manhattan");A&&Y(A.value)}}else{const F=W.find(A=>A.value==="manhattan");F&&Y(F.value)}}catch(g){j.error("Failed to load boroughs:",g)}})()},[]),o.useEffect(()=>{(async()=>{if(!R||Z.length===0)return;const g=Z.find(E=>E.value===R);if(!g){j.warn("Borough not found for value:",R);return}try{const{data:E,error:W}=await Se.schema("reference_table").from("zat_geo_hood_mediumlevel").select('_id, Display, "Geo-Borough"').eq('"Geo-Borough"',g.id).order("Display",{ascending:!0});if(W)throw W;const F=E.filter(A=>A.Display&&A.Display.trim()).map(A=>({id:A._id,name:A.Display.trim(),boroughId:A["Geo-Borough"]}));re(F),q([])}catch(E){j.error("Failed to load neighborhoods:",E)}})()},[R,Z]),o.useEffect(()=>{Oe()},[Oe]),o.useEffect(()=>{if(u.length===0){p([]);return}const i=es.INITIAL_LOAD_COUNT;p(u.slice(0,i)),k(i)},[u]),o.useEffect(()=>{!s&&u.length===0&&M.length===0&&!L&&!U&&Ye()},[s,u.length,M.length,L,U,Ye]),o.useEffect(()=>{u.length>0&&M.length>0&&(x([]),m([]),d(0))},[u.length,M.length]),o.useEffect(()=>{if(M.length===0){m([]);return}const i=es.INITIAL_LOAD_COUNT;m(M.slice(0,i)),d(i)},[M]),o.useEffect(()=>{if(ze.current){ze.current=!1;return}Jt({selectedBorough:R,weekPattern:O,priceTier:B,sortBy:D,selectedNeighborhoods:h},!1)},[R,O,B,D,h]),o.useEffect(()=>Xt(g=>{Y(g.selectedBorough),X(g.weekPattern),K(g.priceTier),H(g.sortBy),q(g.selectedNeighborhoods)}),[]);const Ke=o.useCallback(()=>{const i=es.LOAD_BATCH_SIZE,g=Math.min(C+i,u.length);p(u.slice(0,g)),k(g)},[C,u]),as=o.useCallback(()=>{const i=es.LOAD_BATCH_SIZE,g=Math.min(I+i,M.length);m(M.slice(0,g)),d(g)},[I,M]),Qe=o.useCallback(()=>{const i=Z.find(g=>g.value==="manhattan");i&&Y(i.value),q([]),X("every-week"),K("all"),H("recommended"),Ee("")},[Z]),Ze=o.useCallback(i=>{Q(i),Pe(!0)},[]),Ue=o.useCallback(()=>{Pe(!1),Q(null)},[]),is=o.useCallback((i,g)=>{Q(i),xe(g),ge(!0)},[]),ye=o.useCallback(()=>{ge(!1),Q(null),xe(null)},[]),ls=o.useCallback(()=>{ie(!0)},[]),ke=o.useCallback(()=>{ie(!1)},[]),cs=C<u.length,_e=I<M.length,G=o.useMemo(()=>we.filter(g=>{const E=$s(te);return g.name.toLowerCase().includes(E.toLowerCase())}),[we,te]);return{isLoading:s,error:r,allActiveListings:c,allListings:u,displayedListings:f,hasMore:cs,fallbackListings:M,fallbackDisplayedListings:N,isFallbackLoading:L,hasFallbackMore:_e,handleFallbackLoadMore:as,boroughs:Z,neighborhoods:G,selectedBorough:R,selectedNeighborhoods:h,weekPattern:O,priceTier:B,sortBy:D,neighborhoodSearch:te,filterValidation:qe,filterPanelActive:Ne,menuOpen:Te,mobileMapVisible:rs,isContactModalOpen:ve,isInfoModalOpen:Ce,isAIResearchModalOpen:Fe,selectedListing:le,infoModalTriggerRef:se,informationalTexts:be,mapRef:ce,setSelectedBorough:Y,setSelectedNeighborhoods:q,setWeekPattern:X,setPriceTier:K,setSortBy:H,setNeighborhoodSearch:Ee,handleResetFilters:Qe,setFilterPanelActive:Re,setMenuOpen:He,setMobileMapVisible:ns,handleLoadMore:Ke,fetchListings:Oe,handleOpenContactModal:Ze,handleCloseContactModal:Ue,handleOpenInfoModal:is,handleCloseInfoModal:ye,handleOpenAIResearchModal:ls,handleCloseAIResearchModal:ke,transformListing:pe}}function po(){const{user:s,userId:t,loading:r,isAuthenticated:l}=at(),c=ht(),a=pt(),u=ft(),v=!!(c&&mt()),[f,p]=o.useState(v),[C,k]=o.useState(()=>v?{id:gt(),name:c,email:"",userType:u||"GUEST",avatarUrl:a||null,proposalCount:0,_isOptimistic:!0}:null),[M,x]=o.useState(0),[N,m]=o.useState(new Set),[I,d]=o.useState(new Map),[L,V]=o.useState(null),[U,J]=o.useState(null),[ve,Pe]=o.useState(null),[Ce,ge]=o.useState(13),[Fe,ie]=o.useState(null),[le,Q]=o.useState(!1),[se,xe]=o.useState(null),[be,je]=o.useState(!1),[Z,Ie]=o.useState(!1);o.useEffect(()=>{(async()=>{try{const z=await Ft();V(z)}catch(z){j.warn("[useSearchPageAuth] Failed to load ZAT config:",z)}})()},[]),o.useEffect(()=>{(async()=>{var z;try{if(r)return;if(p(l),!l||!t){k(null),x(0),m(new Set),d(new Map);return}k(s);const[R,Y]=await Promise.all([Se.from("user").select('"About Me / Bio", "need for Space", "special needs", "Favorited Listings"').eq("_id",t).single(),Se.rpc("get_user_junction_counts",{p_user_id:t})]),h=R.data,q=R.error,O=(h==null?void 0:h["Favorited Listings"])||[];if(Array.isArray(O)&&O.length>0){const K=O.filter(D=>typeof D=="string"&&/^\d+x\d+$/.test(D));m(new Set(K)),x(K.length)}else x(0),m(new Set);const X=((z=Y.data)==null?void 0:z[0])||{},B=Number(X.proposals_count)||0;if(!q&&h){k(H=>({...H,proposalCount:B,_isOptimistic:!1})),J({userId:t,aboutMe:h["About Me / Bio"]||"",needForSpace:h["need for Space"]||"",specialNeeds:h["special needs"]||"",proposalCount:B});const K=await ct(t);if(K&&Pe(K),Ds({userType:s.userType})&&B>0)try{const H=await dt(t),te=new Map;H.forEach(Ee=>{const Ne=Ee.Listing;Ne&&!te.has(Ne)&&te.set(Ne,Ee)}),d(te)}catch(H){j.warn("[useSearchPageAuth] Failed to fetch proposals:",H)}}}catch(R){j.error("[useSearchPageAuth] Auth sync error:",R),p(!1),k(null)}})()},[r,l,t,s]);const we=o.useCallback((re,z,R)=>{const Y=new Set(N);return R?Y.add(re):Y.delete(re),m(Y),x(Y.size),{success:!0,isFavorited:R}},[N]);return{isLoggedIn:f,currentUser:C,authLoading:r,authUserId:t,isAuthenticated:l,authenticatedUser:s,favoritesCount:M,favoritedListingIds:N,handleToggleFavorite:we,setFavoritesCount:x,setFavoritedListingIds:m,proposalsByListingId:I,setProposalsByListingId:d,zatConfig:L,loggedInUserData:U,setLoggedInUserData:J,lastProposalDefaults:ve,reservationSpanForProposal:Ce,setReservationSpanForProposal:ge,pendingProposalData:Fe,setPendingProposalData:ie,showSuccessModal:le,setShowSuccessModal:Q,successProposalId:se,setSuccessProposalId:xe,isSubmittingProposal:be,setIsSubmittingProposal:je,showAuthModalForProposal:Z,setShowAuthModalForProposal:Ie}}function fo(s){const t=[...s].sort((f,p)=>f-p),r=t.includes(6),l=t.includes(0),c=r&&l&&s.length<7;let a,u,v;if(c){let f=-1;for(let p=0;p<t.length-1;p++)if(t[p+1]-t[p]>1){f=p+1;break}f!==-1?(a=t[f],u=t[f-1],v=[...t.slice(f),...t.slice(0,f)].slice(0,-1)):(a=t[0],u=t[t.length-1],v=t.slice(0,-1))}else a=t[0],u=t[t.length-1],v=t.slice(0,-1);return{checkInDay:a,checkOutDay:u,nightsSelected:v}}function mo(s){return s===13?"13 weeks (3 months)":s===20?"20 weeks (approx. 5 months)":`${s} weeks`}async function go({guestId:s,listingId:t,moveInDate:r,daysSelectedObjects:l,reservationSpanWeeks:c=13,pricing:a,details:u}){var x,N;if(!s)return j.error("[proposalService] createProposal called without guestId - this is a security issue"),{success:!1,error:"Authentication required"};if(!t)return{success:!1,error:"Listing ID required"};if(!l||l.length===0)return{success:!1,error:"At least one day must be selected"};const v=l.map(m=>m.dayOfWeek),{checkInDay:f,checkOutDay:p,nightsSelected:C}=fo(v),k=mo(c),M={guestId:s,listingId:t,moveInStartRange:r,moveInEndRange:r,daysSelected:v,nightsSelected:C,reservationSpan:k,reservationSpanWeeks:c,checkIn:f,checkOut:p,proposalPrice:a.pricePerNight,fourWeekRent:a.pricePerFourWeeks,hostCompensation:a.pricePerFourWeeks,estimatedBookingTotal:a.totalPrice,needForSpace:u.needForSpace||"",aboutMe:u.aboutMe||"",specialNeeds:u.specialNeeds||"",moveInRangeText:u.moveInRangeText||"",flexibleMoveIn:!!u.moveInRangeText,fourWeekCompensation:a.pricePerFourWeeks};j.debug("[proposalService] Creating proposal:",{listingId:t,guestId:s.substring(0,8)+"..."});try{const{data:m,error:I}=await Se.functions.invoke("proposal",{body:{action:"create",payload:M}});return I?(j.error("[proposalService] Edge Function error:",I),{success:!1,error:I.message||"Failed to create proposal"}):m!=null&&m.success?(j.debug("[proposalService] Proposal created:",(x=m.data)==null?void 0:x.proposalId),{success:!0,proposalId:(N=m.data)==null?void 0:N.proposalId}):(j.error("[proposalService] Proposal creation failed:",m==null?void 0:m.error),{success:!1,error:(m==null?void 0:m.error)||"Failed to create proposal"})}catch(m){return j.error("[proposalService] Unexpected error:",m),{success:!1,error:m.message||"Unexpected error occurred"}}}function xo(s){return s?{_id:s.id||s._id,Name:s.title||s.Name,"Minimum Nights":2,"Maximum Nights":7,"rental type":s.rentalType||s["rental type"]||"Nightly","Weeks offered":s.weeksOffered||s.weeks_offered||s["Weeks offered"]||"Every week","ðŸ’°Unit Markup":Number(s["ðŸ’°Unit Markup"])||0,"ðŸ’°Nightly Host Rate for 2 nights":Number(s["Price 2 nights selected"])||null,"ðŸ’°Nightly Host Rate for 3 nights":Number(s["Price 3 nights selected"])||null,"ðŸ’°Nightly Host Rate for 4 nights":Number(s["Price 4 nights selected"])||null,"ðŸ’°Nightly Host Rate for 5 nights":Number(s["Price 5 nights selected"])||null,"ðŸ’°Nightly Host Rate for 7 nights":Number(s["Price 7 nights selected"])||null,"ðŸ’°Cleaning Cost / Maintenance Fee":Number(s["ðŸ’°Cleaning Cost / Maintenance Fee"])||0,"ðŸ’°Damage Deposit":Number(s["ðŸ’°Damage Deposit"])||0,"ðŸ’°Monthly Host Rate":Number(s["ðŸ’°Monthly Host Rate"])||null,"ðŸ’°Weekly Host Rate":Number(s["ðŸ’°Weekly Host Rate"])||null,host:s.host}:null}function _s({listings:s,onLoadMore:t,hasMore:r,isLoading:l,onOpenContactModal:c,onOpenInfoModal:a,mapRef:u,isLoggedIn:v,userId:f,favoritedListingIds:p,onToggleFavorite:C,onRequireAuth:k,showCreateProposalButton:M,onOpenCreateProposalModal:x,proposalsByListingId:N,selectedNightsCount:m,showMessageButton:I}){const d=o.useRef(null);return o.useEffect(()=>{if(!d.current||!r||l)return;const L=new IntersectionObserver(V=>{V[0].isIntersecting&&t()},{root:null,rootMargin:"100px",threshold:.1});return L.observe(d.current),()=>{d.current&&L.unobserve(d.current)}},[r,l,t]),e.jsxs("div",{className:"listings-container",children:[s.map(L=>{const V=L.id||L._id,U=p==null?void 0:p.has(V),J=(N==null?void 0:N.get(V))||null;return e.jsx(Hs,{listing:L,onLocationClick:ve=>{u.current&&u.current.zoomToListing(ve.id)},onOpenContactModal:c,onOpenInfoModal:a,isLoggedIn:v,isFavorited:U,userId:f,onToggleFavorite:C,onRequireAuth:k,showCreateProposalButton:M,onOpenCreateProposalModal:x,proposalForListing:J,selectedNightsCount:m,variant:"search"},L.id)}),r&&e.jsx("div",{ref:d,className:"lazy-load-sentinel",children:e.jsxs("div",{className:"loading-more",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{children:"Loading more listings..."})]})})]})}function yo(){return e.jsx("div",{className:"loading-skeleton active",children:[1,2].map(s=>e.jsxs("div",{className:"skeleton-card",children:[e.jsx("div",{className:"skeleton-image"}),e.jsxs("div",{className:"skeleton-content",children:[e.jsx("div",{className:"skeleton-line",style:{width:"60%"}}),e.jsx("div",{className:"skeleton-line",style:{width:"80%"}}),e.jsx("div",{className:"skeleton-line",style:{width:"40%"}})]})]},s))})}function vo({message:s,onRetry:t}){return e.jsxs("div",{className:"error-message",children:[e.jsx("img",{src:"/assets/images/filter-error-illustration.png",alt:"Adjust filters illustration",style:{width:"200px",height:"auto",marginBottom:"16px"}}),e.jsx("h3",{children:"Unable to Load Listings"}),e.jsx("p",{children:s||"We had trouble loading listings. Please try refreshing the page or adjusting your filters."}),t&&e.jsx("button",{className:"retry-btn",onClick:t,children:"Retry"})]})}function bo({onResetFilters:s}){return e.jsxs("div",{className:"no-results-notice",children:[e.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.35-4.35"})]}),e.jsx("h3",{children:"No Listings Found"}),e.jsx("p",{children:"No listings match your current filters. Try adjusting your selection."}),e.jsx("button",{className:"reset-filters-btn",onClick:s,children:"Reset Filters"})]})}function jo(){var ws,Ns,ks,Ss;const{isLoading:s,error:t,allActiveListings:r,allListings:l,displayedListings:c,hasMore:a,fallbackListings:u,fallbackDisplayedListings:v,isFallbackLoading:f,hasFallbackMore:p,handleFallbackLoadMore:C,boroughs:k,neighborhoods:M,selectedBorough:x,selectedNeighborhoods:N,weekPattern:m,priceTier:I,sortBy:d,neighborhoodSearch:L,filterPanelActive:V,menuOpen:U,mobileMapVisible:J,isContactModalOpen:ve,isInfoModalOpen:Pe,isAIResearchModalOpen:Ce,selectedListing:ge,infoModalTriggerRef:Fe,informationalTexts:ie,mapRef:le,setSelectedBorough:Q,setSelectedNeighborhoods:se,setWeekPattern:xe,setPriceTier:be,setSortBy:je,setNeighborhoodSearch:Z,handleResetFilters:Ie,setFilterPanelActive:we,setMenuOpen:re,setMobileMapVisible:z,handleLoadMore:R,fetchListings:Y,handleOpenContactModal:h,handleCloseContactModal:q,handleOpenInfoModal:O,handleCloseInfoModal:X,handleOpenAIResearchModal:B,handleCloseAIResearchModal:K}=ho(),{isLoggedIn:D,currentUser:H,authUserId:te,authenticatedUser:Ee,favoritesCount:Ne,favoritedListingIds:Re,handleToggleFavorite:Te,proposalsByListingId:He,setProposalsByListingId:rs,zatConfig:ns,loggedInUserData:ce,lastProposalDefaults:he,reservationSpanForProposal:Ve,setReservationSpanForProposal:ze,pendingProposalData:qe,setPendingProposalData:pe,showSuccessModal:Ge,setShowSuccessModal:Oe,successProposalId:Ye,setSuccessProposalId:Ke,isSubmittingProposal:as,setIsSubmittingProposal:Qe,showAuthModalForProposal:Ze,setShowAuthModalForProposal:Ue}=po(),[is,ye]=o.useState(!1),[ls,ke]=o.useState("login"),[cs,_e]=o.useState(!1),[G,i]=o.useState(null),[g,E]=o.useState([]),[W,F]=o.useState(""),[A,oe]=o.useState(4),[de,ne]=o.useState(!1),[_,ae]=o.useState(!1),[S,P]=o.useState(!1),[fe,me]=o.useState({show:!1,message:"",type:"success"}),b=o.useRef(null),[We,zs]=o.useState(()=>{const w=new URLSearchParams(window.location.search).get("days-selected");return w?w.split(",").map(y=>parseInt(y.trim(),10)).filter(y=>!isNaN(y)&&y>=0&&y<=6):[1,2,3,4,5]}),Je=o.useMemo(()=>{const n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],w=Ws(We);return w?{checkIn:n[w.checkIn],checkOut:n[w.checkOut]}:{checkIn:"",checkOut:""}},[We]);o.useMemo(()=>{let n=0;return N.length>0&&n++,m!=="every-week"&&n++,I!=="all"&&n++,d!=="recommended"&&n++,n},[N,m,I,d]);const Be=o.useMemo(()=>{var w;const n=[];if(x&&x!=="all"&&x!==""){const y=(w=k.find($=>$.value===x))==null?void 0:w.name;y&&y!=="All Boroughs"&&n.push({id:"borough",icon:"map-pin",label:y,onRemove:()=>Q("all")})}if(N.length>0){const y=N.map(T=>{var Me;return(Me=M.find(ee=>ee.id===T))==null?void 0:Me.name}).filter(Boolean).slice(0,2),$=y.length>2?`${y.join(", ")} +${N.length-2}`:y.join(", ");n.push({id:"neighborhoods",icon:"map-pin",label:$||`${N.length} neighborhoods`,onRemove:()=>se([])})}if(I&&I!=="all"){const y={"under-200":"Under $200","200-350":"$200-$350","350-500":"$350-$500","500-plus":"$500+"};n.push({id:"price",icon:"dollar-sign",label:y[I]||I,onRemove:()=>be("all")})}if(m&&m!=="every-week"){const y={"one-on-off":"Every other week","two-on-off":"2 weeks on/off","one-three-off":"1 on, 3 off"};n.push({id:"weekPattern",icon:"repeat",label:y[m]||m,onRemove:()=>xe("every-week")})}return n},[x,N,I,m,k,M]),gs=o.useMemo(()=>{if(!D||!H)return!1;const n=Ds({userType:H.userType}),w=(H.proposalCount??0)>0;return n&&w},[D,H]),Xe=o.useMemo(()=>!D||!H?!0:!ut({userType:H.userType}),[D,H]);o.useEffect(()=>{const n=()=>{const y=new URLSearchParams(window.location.search).get("days-selected");if(y){const $=y.split(",").map(T=>parseInt(T.trim(),10)).filter(T=>!isNaN(T)&&T>=0&&T<=6);zs($)}};return window.addEventListener("popstate",n),window.addEventListener("daysSelected",n),()=>{window.removeEventListener("popstate",n),window.removeEventListener("daysSelected",n)}},[]),o.useEffect(()=>{if(!U)return;const n=w=>{b.current&&!b.current.contains(w.target)&&re(!1)};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[U]),o.useEffect(()=>{let n=0,w=!1;const y=T=>{w||(window.requestAnimationFrame(()=>{const ee=T.target.scrollTop||0,De=window.innerWidth<=768,ds=window.innerWidth>=769;De?(ee>250&&ee>n?ae(!0):ee<n&&ae(!1),P(!1)):ds&&(ee>150&&ee>n?P(!0):ee<n&&P(!1),ae(!1)),n=ee,w=!1}),w=!0)},$=document.querySelector(".listings-content");return $?($.addEventListener("scroll",y,{passive:!0}),()=>$.removeEventListener("scroll",y)):(window.addEventListener("scroll",y,{passive:!0}),()=>window.removeEventListener("scroll",y))},[]),o.useEffect(()=>{const n=document.getElementById("schedule-selector-mount-point"),w=document.getElementById("schedule-selector-mount-point-mobile"),y=[],$={onSelectionChange:T=>{const Me=vt(T);oe(Me)},onError:T=>j.error("AuthAwareSearchScheduleSelector error:",T),weekPattern:m};if(n){const T=fs(n);T.render(e.jsx(Is,{...$})),y.push(T)}if(w){const T=fs(w);T.render(e.jsx(Is,{...$})),y.push(T)}return()=>{y.forEach(T=>T.unmount())}},[m]);const xs=o.useCallback(()=>{ne(n=>!n)},[]),$e=o.useCallback(()=>{ne(!1)},[]),qs=o.useCallback(()=>{Q("all"),se([]),be("all"),xe("every-week"),je("recommended"),$e()},[$e]),Gs=(n,w="success")=>{me({show:!0,message:n,type:w}),setTimeout(()=>{me({show:!1,message:"",type:"success"})},3e3)},ys=n=>{window.location.href=n},vs=async()=>{try{await xt(),window.location.reload()}catch(n){j.error("[SearchPage] Logout error:",n)}},Ys=n=>{const w=n.id||n._id,y=document.querySelector(`[data-listing-id="${w}"]`);y&&(y.scrollIntoView({behavior:"smooth",block:"center"}),y.classList.add("listing-card--highlighted"),setTimeout(()=>{y.classList.remove("listing-card--highlighted")},2e3))},bs=n=>{const y=new URLSearchParams(window.location.search).get("days-selected");let $=[];if(y)try{$=y.split(",").map(Le=>parseInt(Le.trim(),10)).filter(Le=>Le>=0&&Le<=6).map(Le=>Ls(Le,!0))}catch(Ae){j.warn("Failed to parse days from URL:",Ae)}$.length===0&&($=[1,2,3,4,5].map(Ae=>Ls(Ae,!0)));const T=new Date,Me=new Date(T);Me.setDate(T.getDate()+14);const ee=Me.toISOString().split("T")[0];let De=ee;if(he!=null&&he.moveInDate)De=it({previousMoveInDate:he.moveInDate,minDate:ee})||ee;else if($.length>0)try{const Ae=$.map(Le=>Le.dayOfWeek);De=lt({selectedDayIndices:Ae,minDate:ee})}catch{De=ee}const ds=(he==null?void 0:he.reservationSpanWeeks)||13;i(n),E($),F(De),ze(ds),_e(!0)},Ks=()=>{_e(!1),i(null)},js=async n=>{Qe(!0);try{if(!te)throw new Error("Authentication required. Please log in again.");const w=await go({guestId:te,listingId:(G==null?void 0:G.id)||(G==null?void 0:G._id),moveInDate:n.moveInDate,daysSelectedObjects:n.daysSelectedObjects,reservationSpanWeeks:n.reservationSpan||13,pricing:{pricePerNight:n.pricePerNight,pricePerFourWeeks:n.pricePerFourWeeks,totalPrice:n.totalPrice},details:{needForSpace:n.needForSpace,aboutMe:n.aboutYourself,specialNeeds:n.hasUniqueRequirements?n.uniqueRequirements:"",moveInRangeText:n.moveInRange}});if(!w.success)throw new Error(w.error);if(rt(n.listingId),_e(!1),pe(null),Ke(w.proposalId),Oe(!0),w.proposalId&&G){const y=G.id||G._id;rs($=>{const T=new Map($);return T.set(y,{_id:w.proposalId}),T})}}catch(w){j.error("[SearchPage] Error submitting proposal:",w),Gs(w.message||"Failed to submit proposal. Please try again.","error")}finally{Qe(!1)}},Qs=async n=>{if(!await yt()){pe(n),_e(!1),Ue(!0);return}await js(n)},Zs=async n=>{Ue(!1),qe&&setTimeout(async()=>{await js(qe)},500)};return e.jsxs("div",{className:"search-page",children:[fe.show&&e.jsx("div",{className:"toast-container",children:e.jsxs("div",{className:`toast toast-${fe.type} show`,children:[e.jsx("div",{className:"toast-content",children:e.jsx("h4",{className:"toast-title",children:fe.message})}),e.jsx("button",{className:"toast-close",onClick:()=>me({show:!1,message:"",type:"success"}),"aria-label":"Close notification",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18",strokeLinecap:"round"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18",strokeLinecap:"round"})]})})]})}),e.jsxs("main",{className:"two-column-layout",children:[e.jsxs("section",{className:`listings-column ${_?"listings-column--header-hidden":""}`,children:[e.jsx(Rt,{onFilterClick:()=>we(!V),onMapClick:()=>z(!0),isMapVisible:J,isLoggedIn:D,currentUser:H,favoritesCount:Ne,onNavigate:ys,onLogout:vs,onOpenAuthModal:()=>{ke("login"),ye(!0)},isHidden:_}),e.jsx("div",{className:`mobile-schedule-selector ${_?"mobile-schedule-selector--hidden":""}`,children:e.jsx("div",{className:"filter-group schedule-selector-group",id:"schedule-selector-mount-point-mobile"})}),e.jsx(At,{isVisible:_}),e.jsx("div",{className:`filter-section ${Be.length>0?"has-active-filters":""} ${S?"filter-section--collapsed":""}`,children:e.jsxs("div",{className:"filter-bar",children:[e.jsx("div",{className:"schedule-selector",children:e.jsx("div",{className:"filter-group schedule-selector-group",id:"schedule-selector-mount-point"})}),e.jsx("div",{className:"filter-popup-wrapper",id:"topFilterWrapper",children:e.jsxs("button",{className:`filter-toggle-btn-new ${de?"active":""}`,onClick:xs,"aria-label":"Open filters",children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),Be.length>0&&e.jsx("span",{className:"filter-badge",children:Be.length})]})}),e.jsx("div",{className:"filter-divider"}),Je.checkIn&&Je.checkOut&&e.jsx("div",{className:"checkin-block",children:e.jsxs("div",{className:"checkin-details",children:[e.jsxs("div",{className:"checkin-row",children:[e.jsx("span",{className:"label",children:"Check-in:"}),e.jsx("span",{className:"day",children:Je.checkIn})]}),e.jsxs("div",{className:"checkin-row",children:[e.jsx("span",{className:"label",children:"Check-out:"}),e.jsx("span",{className:"day",children:Je.checkOut})]})]})})]})}),e.jsxs("div",{className:`filter-tags-row ${Be.length>0?"has-filters":""} ${S?"filter-tags-row--collapsed":""}`,children:[e.jsxs("button",{className:"results-filter-btn",onClick:xs,children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),e.jsx("span",{className:"results-filter-badge",children:Be.length})]}),e.jsx("div",{className:"filter-tags-single-row",children:Be.map(n=>e.jsxs("div",{className:"filter-tag filter-tag-sm",children:[n.icon==="map-pin"&&e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),n.icon==="dollar-sign"&&e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),e.jsx("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})]}),n.icon==="repeat"&&e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("polyline",{points:"17 1 21 5 17 9"}),e.jsx("path",{d:"M3 11V9a4 4 0 0 1 4-4h14"}),e.jsx("polyline",{points:"7 23 3 19 7 15"}),e.jsx("path",{d:"M21 13v2a4 4 0 0 1-4 4H3"})]}),n.label,e.jsx("button",{className:"filter-tag-remove",onClick:n.onRemove,children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]},n.id))})]}),e.jsxs("div",{className:`filter-popup ${de?"open":""}`,children:[e.jsxs("div",{className:"filter-popup-header",children:[e.jsx("h3",{className:"filter-popup-title",children:"Filters"}),e.jsx("button",{className:"filter-popup-clear",onClick:qs,children:"Clear all"})]}),e.jsxs("div",{className:"filter-popup-body",children:[e.jsxs("div",{className:"filter-popup-group",children:[e.jsx("label",{className:"filter-popup-label",children:"BOROUGH"}),e.jsx("select",{className:"filter-popup-select",value:x,onChange:n=>Q(n.target.value),children:k.length===0?e.jsx("option",{value:"",children:"Loading..."}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"all",children:"All Boroughs"}),k.map(n=>e.jsx("option",{value:n.value,children:n.name},n.id))]})})]}),e.jsxs("div",{className:"filter-popup-group",children:[e.jsx("label",{className:"filter-popup-label",children:"WEEK PATTERN"}),e.jsxs("select",{className:"filter-popup-select",value:m,onChange:n=>xe(n.target.value),children:[e.jsx("option",{value:"every-week",children:"Every week"}),e.jsx("option",{value:"one-on-off",children:"One on, one off"}),e.jsx("option",{value:"two-on-off",children:"Two on, two off"}),e.jsx("option",{value:"one-three-off",children:"One on, three off"})]})]}),e.jsxs("div",{className:"filter-popup-group",children:[e.jsx("label",{className:"filter-popup-label",children:"PRICE RANGE"}),e.jsxs("select",{className:"filter-popup-select",value:I,onChange:n=>be(n.target.value),children:[e.jsx("option",{value:"all",children:"All Prices"}),e.jsx("option",{value:"under-200",children:"< $200/night"}),e.jsx("option",{value:"200-350",children:"$200-$350/night"}),e.jsx("option",{value:"350-500",children:"$350-$500/night"}),e.jsx("option",{value:"500-plus",children:"$500+/night"})]})]}),e.jsxs("div",{className:"filter-popup-group filter-popup-group--full-width",children:[e.jsx("label",{className:"filter-popup-label",children:"NEIGHBORHOODS"}),e.jsx(Ot,{neighborhoods:M,selectedNeighborhoods:N,onNeighborhoodsChange:se,neighborhoodSearch:L,onNeighborhoodSearchChange:Z,searchInputId:"neighborhoodSearchPopup"})]})]}),e.jsxs("div",{className:"filter-popup-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:$e,children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:$e,children:"Apply Filters"})]})]}),de&&e.jsx("div",{className:"filter-backdrop open",onClick:$e}),e.jsxs("div",{className:`results-header ${_?"results-header--hidden":""} ${S?"results-header--desktop-hidden":""}`,children:[e.jsxs("span",{className:"results-count",children:[e.jsxs("strong",{children:[l.length," listings"]})," in ",x==="all"?"NYC":((ws=k.find(n=>n.value===x))==null?void 0:ws.name)||"NYC"]}),e.jsxs("select",{className:"sort-select",value:d,onChange:n=>je(n.target.value),children:[e.jsx("option",{value:"recommended",children:"Recommended"}),e.jsx("option",{value:"price-low",children:"Price: Low to High"}),e.jsx("option",{value:"most-viewed",children:"Most Viewed"}),e.jsx("option",{value:"recent",children:"Recently Added"})]})]}),e.jsxs("div",{className:"listings-content",children:[s&&e.jsx(yo,{}),!s&&t&&e.jsx(vo,{message:t,onRetry:Y}),!s&&!t&&l.length===0&&e.jsxs(e.Fragment,{children:[e.jsx(bo,{onResetFilters:Ie}),f&&e.jsx("div",{className:"fallback-loading",children:e.jsx("p",{children:"Loading all available listings..."})}),!f&&u.length>0&&e.jsxs("div",{className:"fallback-listings-section",children:[e.jsxs("div",{className:"fallback-header",children:[e.jsx("h3",{children:"Browse All Available Listings"}),e.jsxs("p",{children:["Showing ",u.length," listings across all NYC boroughs"]})]}),e.jsx(_s,{listings:v,onLoadMore:C,hasMore:p,isLoading:!1,onOpenContactModal:h,onOpenInfoModal:O,mapRef:le,isLoggedIn:D,userId:te,favoritedListingIds:Re,onToggleFavorite:Te,onRequireAuth:()=>{ke("signup"),ye(!0)},showCreateProposalButton:gs,onOpenCreateProposalModal:bs,proposalsByListingId:He,selectedNightsCount:A,showMessageButton:Xe})]})]}),!s&&!t&&l.length>0&&e.jsx(_s,{listings:c,onLoadMore:R,hasMore:a,isLoading:s,onOpenContactModal:h,onOpenInfoModal:O,mapRef:le,isLoggedIn:D,userId:te,favoritedListingIds:Re,onToggleFavorite:Te,onRequireAuth:()=>{ke("signup"),ye(!0)},showCreateProposalButton:gs,onOpenCreateProposalModal:bs,proposalsByListingId:He,selectedNightsCount:A,showMessageButton:Xe})]})]}),e.jsxs("section",{className:"map-column",children:[e.jsxs("div",{className:"map-header",children:[e.jsxs("a",{href:"/",className:"map-logo",children:[e.jsx("img",{src:"/assets/images/split-lease-purple-circle.png",alt:"Split Lease Logo",className:"logo-icon",width:"36",height:"36"}),e.jsx("span",{className:"logo-text",children:"Split Lease"})]}),e.jsx("div",{className:"map-header-actions",children:D&&H?e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:"/favorite-listings",className:"favorites-link","aria-label":"My Favorite Listings",children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}),Ne>0&&e.jsx("span",{className:"favorites-badge",children:Ne})]}),e.jsx(Bs,{user:H,currentPath:"/search",onNavigate:ys,onLogout:vs})]}):e.jsxs("div",{ref:b,style:{position:"relative"},children:[e.jsxs("button",{className:"hamburger-menu",onClick:()=>re(!U),"aria-label":"Toggle menu",children:[e.jsx("span",{children:"Menu"}),e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),e.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),e.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})]}),U&&e.jsxs("div",{className:"header-dropdown",children:[e.jsx("a",{href:"/guest-success",children:"Success Stories"}),e.jsx("a",{href:"#",onClick:n=>{n.preventDefault(),re(!1),ke("login"),ye(!0)},children:"Sign In / Sign Up"}),e.jsx("a",{href:"/why-split-lease",children:"Understand Split Lease"}),e.jsx("a",{href:"/faq",children:"Explore FAQs"}),e.jsx("a",{href:"/help-center",children:"Support Centre"})]})]})})]}),e.jsx(Ps,{ref:le,listings:r,filteredListings:l,selectedListing:null,selectedBorough:x,selectedNightsCount:A,onMarkerClick:Ys,onMessageClick:h,onAIResearchClick:B,isLoggedIn:D,favoritedListingIds:Re,onToggleFavorite:Te,userId:te,onRequireAuth:()=>{ke("signup"),ye(!0)},showMessageButton:Xe})]})]}),e.jsx(st,{isOpen:ve,onClose:q,listing:ge,onLoginRequired:()=>{q(),ke("signup"),ye(!0)}}),e.jsx(et,{isOpen:Pe,onClose:X,listing:ge,triggerRef:Fe,title:"Pricing Information",content:((Ns=ie["Price Starts"])==null?void 0:Ns.desktop)||"",expandedContent:(ks=ie["Price Starts"])==null?void 0:ks.desktopPlus,showMoreAvailable:(Ss=ie["Price Starts"])==null?void 0:Ss.showMore}),e.jsx(nt,{isOpen:Ce,onClose:K}),e.jsx(Ms,{isOpen:is,onClose:()=>ye(!1),initialView:ls,onAuthSuccess:()=>{}}),cs&&G&&e.jsx(tt,{listing:xo(G),moveInDate:W,daysSelected:g,nightsSelected:g.length>0?g.length-1:0,reservationSpan:Ve,pricingBreakdown:null,zatConfig:ns,isFirstProposal:!ce||ce.proposalCount===0,useFullFlow:!0,existingUserData:ce?{needForSpace:ce.needForSpace||"",aboutYourself:ce.aboutMe||"",hasUniqueRequirements:!!ce.specialNeeds,uniqueRequirements:ce.specialNeeds||""}:null,onClose:Ks,onSubmit:Qs,isSubmitting:as}),Ze&&e.jsx(Ms,{isOpen:Ze,onClose:()=>{Ue(!1),pe(null)},initialView:"signup-step1",onAuthSuccess:Zs,defaultUserType:"guest",skipReload:!0}),Ge&&e.jsx(ot,{proposalId:Ye,listingName:(G==null?void 0:G.title)||(G==null?void 0:G.Name),hasSubmittedRentalApp:(ce==null?void 0:ce.hasSubmittedRentalApp)??!1,onClose:()=>{Oe(!1),Ke(null),i(null)}}),J&&e.jsxs("div",{className:"mobile-map-modal",children:[e.jsxs("div",{className:"mobile-map-header",children:[e.jsx("button",{className:"mobile-map-close-btn",onClick:()=>z(!1),"aria-label":"Close map",children:"X"}),e.jsx("h2",{children:"Map View"})]}),e.jsx("div",{className:"mobile-map-content",children:e.jsx(Ps,{ref:le,listings:r,filteredListings:l,selectedListing:null,selectedBorough:x,selectedNightsCount:A,onMarkerClick:()=>{},onMessageClick:h,onAIResearchClick:B,isLoggedIn:D,favoritedListingIds:Re,onToggleFavorite:Te,userId:te,onRequireAuth:()=>{ke("signup"),ye(!0)},showMessageButton:Xe})})]}),e.jsx(Kt,{userData:Ee})]})}fs(document.getElementById("root")).render(e.jsx(Js.StrictMode,{children:e.jsx(Et,{children:e.jsx(jo,{})})}));

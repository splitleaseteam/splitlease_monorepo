var ds=Object.defineProperty;var us=(t,s,n)=>s in t?ds(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n;var Te=(t,s,n)=>us(t,typeof s!="symbol"?s+"":s,n);import{r,j as e,R as Ut,c as ms}from"./client-BJVKzfAi.js";import{H as lt}from"./Header-BJKWma2V.js";import{F as ct,R as ps}from"./Footer-Bzf1rLKh.js";import{u as hs,a as dt}from"./Toast-BQk6Nzgd.js";import{s as R}from"./supabase-BoCLEw6R.js";import{t as Nt}from"./toastService-BG6XElma.js";import{m as fs,n as gs,c as ys,v as bs,h as Pe}from"./auth-QZ4BJadW.js";import{i as wt}from"./isHost-bTARCkET.js";import{C as bt}from"./camera-DeVyJAXE.js";import{C as ge}from"./check-B34HRHn5.js";import{C as xt}from"./circle-alert-C7SsrRDS.js";import{c as se}from"./createLucideIcon-CgZZH2OU.js";import{S as Bt}from"./shield-check-BpqN-ykL.js";import{P as Vt}from"./phone-JQItnCAU.js";import{C as xs}from"./calendar-CDI4qHEX.js";import{M as vs}from"./mail-CRbL90NL.js";import{C as ft}from"./circle-check-big-42edTrxg.js";import{B as js}from"./bell-xU0WfKlw.js";import{C as gt}from"./chevron-right-DMpFmStq.js";import{P as Ns}from"./pen-line-Duo49k9O.js";import{F as Re}from"./file-text-Bqp_Hw0X.js";import{C as ws}from"./clock-BT0kKcUb.js";import{A as Ss}from"./arrow-left-BuT02xS5.js";import{E as ks}from"./external-link-CaRKhh-A.js";import{L as _s}from"./loader-circle-BXPWbeXx.js";import{P as St}from"./proposalStatuses-1Bj0NYR4.js";import{P as kt}from"./plus-DM0NjXG9.js";import{T as Cs}from"./trash-2-DKO8yvV5.js";import{X as $t}from"./x-CrJVeoCh.js";/* empty css                           */import{E as Is}from"./ErrorBoundary-9_HbXv1y.js";/* empty css             */import"./config-QPKPRtag.js";import"./constants-CPVJY5eo.js";import"./proposalDataFetcher-CipdyWU2.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["path",{d:"M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2",key:"5owen"}],["circle",{cx:"7",cy:"17",r:"2",key:"u2ysq9"}],["path",{d:"M9 17h6",key:"r8uit2"}],["circle",{cx:"17",cy:"17",r:"2",key:"axvx0g"}]],Wt=se("car",As);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],zs=se("compass",Ts);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]],Dt=se("linkedin",Es);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Rs=se("lock",Ps);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],Fs=se("pen",Ls);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]],Os=se("plane",Ms);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Us=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],qt=se("save",Us);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bs=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Vs=se("square-pen",Bs);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["rect",{width:"16",height:"16",x:"4",y:"3",rx:"2",key:"1wxw4b"}],["path",{d:"M4 11h16",key:"mpoxn0"}],["path",{d:"M12 3v8",key:"1h2ygw"}],["path",{d:"m8 19-2 3",key:"13i0xs"}],["path",{d:"m18 22-2-3",key:"1p0ohu"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M16 15h.01",key:"rnfrdf"}]],Ws=se("tram-front",$s);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],qs=se("upload",Ds),Gs={EMAIL:"Email",SMS:"SMS",IN_APP:"In-App Message"},yt=[{id:"message_forwarding",label:"Message Forwarding",description:"Receive forwarded messages via your preferred channel",dbColumn:"Message Forwarding"},{id:"payment_reminders",label:"Payment Reminders",description:"Billing and payment notifications",dbColumn:"Payment Reminders"},{id:"promotional",label:"Promotional",description:"Marketing and promotional content",dbColumn:"Promotional"},{id:"reservation_updates",label:"Reservation Updates",description:"Changes to your bookings",dbColumn:"Reservation Updates"},{id:"lease_requests",label:"Lease Requests",description:"Lease-related inquiries",dbColumn:"Lease Requests"},{id:"proposal_updates",label:"Proposal Updates",description:"Changes to proposals",dbColumn:"Proposal Updates"},{id:"checkin_checkout",label:"Check-in/Check-out Reminders",description:"Guest arrival and departure alerts",dbColumn:"Check In/Out Reminders"},{id:"reviews",label:"Reviews",description:"Rating and feedback notifications",dbColumn:"Reviews"},{id:"tips_insights",label:"Tips / Market Insights",description:"Educational content and market analysis",dbColumn:"Tips/Insights"},{id:"account_assistance",label:"Account Access Assistance",description:"Help with account login and permissions",dbColumn:"Login/Signup Assistance"},{id:"virtual_meetings",label:"Virtual Meetings",description:"Video and online meeting notifications",dbColumn:"Virtual Meetings"}];function _t(){const t={};return yt.forEach(s=>{t[s.dbColumn]=[]}),t}function Ys(t,s){const n=Array.isArray(t)?[...t]:[],i=n.indexOf(s);return i===-1?n.push(s):n.splice(i,1),n}const Ct="notificationsettingsos_lists_";function Hs(t){const[s,n]=r.useState(_t()),[i,o]=r.useState(null),[a,d]=r.useState(!0),[p,c]=r.useState(null),[g,u]=r.useState(new Set),j=r.useCallback(async()=>{if(!t){d(!1);return}d(!0),c(null);try{const{data:b,error:k}=await R.from(Ct).select("*").eq("Created By",t).single();if(k&&k.code!=="PGRST116")throw k;b?(o(b._id),n(b)):(console.log("[useNotificationSettings] No preferences found for user:",t),n(_t()))}catch(b){console.error("[useNotificationSettings] Error fetching preferences:",b),c(b.message||"Failed to load notification settings")}finally{d(!1)}},[t]),l=r.useCallback(async(b,k)=>{if(!t||!i)return console.warn("[useNotificationSettings] Cannot toggle: missing userId or recordId"),{success:!1,error:"User preferences not loaded"};const z=`${b}:${k}`;u(F=>new Set([...F,z]));const P=s[b]||[],E=Ys(P,k),W=P;n(F=>({...F,[b]:E}));try{const{error:F}=await R.from(Ct).update({[b]:E,updated_at:new Date().toISOString()}).eq("_id",i);if(F)throw F;const B=E.includes(k)?"enabled":"disabled";return console.log(`[useNotificationSettings] ✅ ${k} ${B} for ${b}`),window.showToast&&window.showToast("Preference updated","success"),{success:!0}}catch(F){return console.error("[useNotificationSettings] Error toggling channel:",F),n(B=>({...B,[b]:W})),window.showToast&&window.showToast("Failed to update preference","error"),{success:!1,error:F.message}}finally{u(F=>{const B=new Set(F);return B.delete(z),B})}},[t,i,s]),x=r.useCallback((b,k)=>g.has(`${b}:${k}`),[g]),m=r.useCallback((b,k)=>{const z=s[b];return Array.isArray(z)&&z.includes(k)},[s]);return r.useEffect(()=>{j()},[j]),{preferences:s,loading:a,error:p,toggleChannel:l,isTogglePending:x,isChannelEnabled:m,refetch:j,CHANNELS:Gs}}function It({checked:t=!1,onChange:s,disabled:n=!1,ariaLabel:i="Toggle notification"}){const o=c=>{!n&&s&&s(c.target.checked)},a=c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),!n&&s&&s(!t))},d=["notification-toggle-slider",t&&"notification-toggle-slider--checked",n&&"notification-toggle-slider--disabled"].filter(Boolean).join(" "),p=["notification-toggle-knob",t&&"notification-toggle-knob--checked"].filter(Boolean).join(" ");return e.jsxs("label",{className:"notification-toggle",children:[e.jsx("input",{type:"checkbox",checked:t,onChange:o,disabled:n,className:"notification-toggle-input","aria-label":i}),e.jsx("span",{className:d,role:"switch","aria-checked":t,tabIndex:n?-1:0,onKeyDown:a,children:e.jsx("span",{className:p})})]})}function Js({category:t,smsEnabled:s,emailEnabled:n,onToggleSms:i,onToggleEmail:o,smsPending:a=!1,emailPending:d=!1,isLast:p=!1}){return e.jsxs("div",{className:`notification-category-row${p?" notification-category-row--last":""}`,children:[e.jsxs("div",{className:"notification-category-label-section",children:[e.jsx("div",{className:"notification-category-label",children:t.label}),e.jsx("div",{className:"notification-category-description",children:t.description})]}),e.jsxs("div",{className:"notification-toggle-section",children:[e.jsx("div",{className:"notification-toggle-wrapper",children:e.jsx(It,{checked:s,onChange:i,disabled:a,ariaLabel:`${t.label} SMS notifications`})}),e.jsx("div",{className:"notification-toggle-wrapper",children:e.jsx(It,{checked:n,onChange:o,disabled:d,ariaLabel:`${t.label} Email notifications`})})]})]})}function Qs(){return e.jsxs("svg",{className:"notification-error-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]})}function Xs({userId:t}){const{loading:s,error:n,toggleChannel:i,isTogglePending:o,isChannelEnabled:a,refetch:d,CHANNELS:p}=Hs(t);return s?e.jsx("div",{className:"notification-settings-container",children:e.jsxs("div",{className:"notification-loading-container",children:[e.jsx("div",{className:"notification-loading-spinner"}),e.jsx("span",{children:"Loading notification settings..."})]})}):n?e.jsx("div",{className:"notification-settings-container",children:e.jsxs("div",{className:"notification-error-container",children:[e.jsx(Qs,{}),e.jsx("div",{className:"notification-error-text",children:n}),e.jsx("button",{className:"notification-retry-btn",onClick:d,children:"Try Again"})]})}):e.jsxs("div",{className:"notification-settings-container",children:[e.jsx("div",{className:"notification-settings-header",children:e.jsxs("div",{className:"notification-settings-header-labels",children:[e.jsx("span",{className:"notification-settings-header-label",children:"SMS"}),e.jsx("span",{className:"notification-settings-header-label",children:"Email"})]})}),e.jsx("div",{className:"notification-categories-list",children:yt.map((c,g)=>e.jsx(Js,{category:c,smsEnabled:a(c.dbColumn,p.SMS),emailEnabled:a(c.dbColumn,p.EMAIL),onToggleSms:()=>i(c.dbColumn,p.SMS),onToggleEmail:()=>i(c.dbColumn,p.EMAIL),smsPending:o(c.dbColumn,p.SMS),emailPending:o(c.dbColumn,p.EMAIL),isLast:g===yt.length-1},c.id))})]})}function Ks(){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]})}function Zs(){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}function ea({isOpen:t,userId:s,onClose:n}){const i=o=>{o.target===o.currentTarget&&n()};return r.useEffect(()=>{const o=a=>{a.key==="Escape"&&t&&n()};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[t,n]),r.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),t?e.jsx("div",{className:"notification-modal-overlay",onClick:i,role:"dialog","aria-modal":"true","aria-labelledby":"notification-modal-title",children:e.jsxs("div",{className:"notification-modal",onClick:o=>o.stopPropagation(),children:[e.jsx("div",{className:"notification-modal-grab-handle","aria-hidden":"true"}),e.jsxs("header",{className:"notification-modal-header",children:[e.jsxs("div",{className:"notification-modal-header-content",children:[e.jsxs("div",{className:"notification-modal-header-top",children:[e.jsx("span",{className:"notification-modal-icon","aria-hidden":"true",children:e.jsx(Ks,{})}),e.jsx("h2",{id:"notification-modal-title",className:"notification-modal-title",children:"Notification Settings"})]}),e.jsx("p",{className:"notification-modal-subtitle",children:"Manage how you receive updates about your listings and bookings."})]}),e.jsx("button",{className:"notification-modal-close",onClick:n,"aria-label":"Close modal",type:"button",children:e.jsx(Zs,{})})]}),e.jsx("div",{className:"notification-modal-body",children:e.jsx(Xs,{userId:s})})]})}):null}function ta(){return e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"})})}function sa(){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}function aa({isOpen:t,currentPhoneNumber:s,onSave:n,onClose:i}){const[o,a]=r.useState(""),[d,p]=r.useState(!1);r.useEffect(()=>{t?a(""):p(!1)},[t]),r.useEffect(()=>{const u=j=>{j.key==="Escape"&&t&&i()};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[t,i]),r.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]);const c=u=>{u.target===u.currentTarget&&i()},g=async()=>{if(!o.trim()){Nt.warning("Please enter a new phone number");return}p(!0);try{await n(o.trim()),i()}catch(u){Nt.error(`Error saving phone number: ${u.message}`)}finally{p(!1)}};return t?e.jsx("div",{className:"edit-phone-modal-overlay",onClick:c,role:"dialog","aria-modal":"true","aria-labelledby":"edit-phone-modal-title",children:e.jsxs("div",{className:"edit-phone-modal",onClick:u=>u.stopPropagation(),children:[e.jsx("div",{className:"edit-phone-modal-grab-handle","aria-hidden":"true"}),e.jsxs("header",{className:"edit-phone-modal-header",children:[e.jsxs("div",{className:"edit-phone-modal-header-content",children:[e.jsxs("div",{className:"edit-phone-modal-header-top",children:[e.jsx("span",{className:"edit-phone-modal-icon","aria-hidden":"true",children:e.jsx(ta,{})}),e.jsx("h2",{id:"edit-phone-modal-title",className:"edit-phone-modal-title",children:"Edit Phone Number"})]}),e.jsx("p",{className:"edit-phone-modal-subtitle",children:"Update your contact phone number for booking communications."})]}),e.jsx("button",{className:"edit-phone-modal-close",onClick:i,"aria-label":"Close modal",type:"button",children:e.jsx(sa,{})})]}),e.jsxs("div",{className:"edit-phone-modal-body",children:[e.jsxs("div",{className:"edit-phone-form-group",children:[e.jsx("label",{className:"edit-phone-label",htmlFor:"current-phone",children:"Current Phone Number"}),e.jsx("input",{id:"current-phone",type:"tel",className:"edit-phone-input",value:s||"",disabled:!0,inputMode:"tel"})]}),e.jsxs("div",{className:"edit-phone-form-group",children:[e.jsx("label",{className:"edit-phone-label",htmlFor:"new-phone",children:"New Phone Number"}),e.jsx("input",{id:"new-phone",type:"tel",className:"edit-phone-input",value:o,onChange:u=>a(u.target.value),placeholder:"Enter your new phone number",inputMode:"tel",autoFocus:!0})]})]}),e.jsxs("footer",{className:"edit-phone-modal-footer",children:[e.jsx("button",{type:"button",className:"edit-phone-btn edit-phone-btn--secondary",onClick:i,disabled:d,children:"Cancel"}),e.jsx("button",{type:"button",className:"edit-phone-btn edit-phone-btn--primary",onClick:g,disabled:d||!o.trim(),children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"edit-phone-spinner","aria-hidden":"true"}),"Saving..."]}):"Save Changes"})]})]})}):null}async function na({userId:t,documentType:s,selfieFile:n,frontIdFile:i,backIdFile:o,supabase:a,onProgress:d}){const p=d||(()=>{});p("Uploading selfie...");const c=await ut(a,t,"selfie",n);p("Uploading front ID...");const g=await ut(a,t,"front_id",i);p("Uploading back ID...");const u=await ut(a,t,"back_id",o);p("Submitting verification...");const j=await ia(a,{documentType:s,selfieUrl:c,frontIdUrl:g,backIdUrl:u});return p("Verification submitted successfully!"),j}async function ut(t,s,n,i){const o=Date.now(),a=i.name.split(".").pop()||"jpg",d=`${s}/${n}_${o}.${a}`,{data:p,error:c}=await t.storage.from("identity-documents").upload(d,i,{cacheControl:"3600",upsert:!1});if(c)throw new Error(`Failed to upload ${n}: ${c.message}`);const{data:g,error:u}=await t.storage.from("identity-documents").createSignedUrl(d,60*60*24*365);if(u)throw new Error(`Failed to get signed URL for ${n}: ${u.message}`);return g.signedUrl}async function ia(t,s){const{data:n,error:i}=await t.functions.invoke("identity-verification",{body:{action:"submit_verification",payload:s}});if(i)throw new Error(`Verification submission failed: ${i.message}`);if(!n.success)throw new Error(n.error||"Verification submission failed");return n.data}async function ra({userId:t,documentType:s,selfieFile:n,frontIdFile:i,backIdFile:o,onProgress:a}){return na({userId:t,documentType:s,selfieFile:n,frontIdFile:i,backIdFile:o,supabase:R,onProgress:a})}const Gt=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],$={profilePhoto:15,bio:10,firstName:5,lastName:5,jobTitle:5,emailVerified:8,phoneVerified:8,govIdVerified:12,linkedinVerified:7,rentalAppSubmitted:25,firstListingCreated:25};function oa(){const s=window.location.pathname.match(/\/account-profile\/([^/]+)/);return s?s[1]:null}function la(t,s,n={}){let i=0;return t!=null&&t.profilePhoto&&(i+=$.profilePhoto),t!=null&&t.bio&&t.bio.trim().length>0&&(i+=$.bio),t!=null&&t.firstName&&t.firstName.trim().length>0&&(i+=$.firstName),t!=null&&t.lastName&&t.lastName.trim().length>0&&(i+=$.lastName),t!=null&&t.jobTitle&&t.jobTitle.trim().length>0&&(i+=$.jobTitle),s!=null&&s.email&&(i+=$.emailVerified),s!=null&&s.phone&&(i+=$.phoneVerified),s!=null&&s.govId&&(i+=$.govIdVerified),s!=null&&s.linkedin&&(i+=$.linkedinVerified),n!=null&&n.isHost?n!=null&&n.firstListingCreated&&(i+=$.firstListingCreated):n!=null&&n.rentalAppSubmitted&&(i+=$.rentalAppSubmitted),Math.min(100,Math.round(i))}function ca(t,s,n={}){const i=[];return n!=null&&n.isHost?n!=null&&n.firstListingCreated||i.push({id:"firstListing",text:"Create your first listing",points:$.firstListingCreated,icon:"home"}):n!=null&&n.rentalAppSubmitted||i.push({id:"rentalApp",text:"Complete rental application",points:$.rentalAppSubmitted,icon:"clipboard"}),t!=null&&t.profilePhoto||i.push({id:"photo",text:"Add a profile photo",points:$.profilePhoto,icon:"camera"}),s!=null&&s.govId||i.push({id:"govId",text:"Verify your identity",points:$.govIdVerified,icon:"shield"}),(!(t!=null&&t.bio)||t.bio.trim().length===0)&&i.push({id:"bio",text:"Write a short bio",points:$.bio,icon:"edit"}),s!=null&&s.phone||i.push({id:"phone",text:"Verify your phone number",points:$.phoneVerified,icon:"phone"}),s!=null&&s.email||i.push({id:"email",text:"Verify your email",points:$.emailVerified,icon:"mail"}),s!=null&&s.linkedin||i.push({id:"linkedin",text:"Connect your LinkedIn",points:$.linkedinVerified,icon:"linkedin"}),i.slice(0,3)}function At(t){return Array.isArray(t)?t.map(s=>typeof s=="number"&&s>=0&&s<=6?s:Gt.indexOf(s)).filter(s=>s!==-1):[]}function da(t){return Array.isArray(t)?t.filter(s=>s>=0&&s<=6).map(s=>Gt[s]):[]}function ua(){const[t,s]=r.useState(!0),[n,i]=r.useState(!1),[o,a]=r.useState(null),[d,p]=r.useState(null),[c,g]=r.useState(null),[u,j]=r.useState(!1),[l,x]=r.useState(null),[m,b]=r.useState({firstName:"",lastName:"",jobTitle:"",dateOfBirth:"",bio:"",needForSpace:"",specialNeeds:"",selectedDays:[],transportationTypes:[],goodGuestReasons:[],storageItems:[]}),[k,z]=r.useState({}),[P,E]=r.useState(!1),[W,F]=r.useState([]),[B,ee]=r.useState([]),[K]=r.useState([{value:"",label:"Select transportation..."},{value:"car",label:"Car"},{value:"public_transit",label:"Public Transit"},{value:"plane",label:"Plane"}]),[Q,O]=r.useState(!1),[D,X]=r.useState(!1),[ue,re]=r.useState(!1),[oe,le]=r.useState([]),[Le,Fe]=r.useState(!1),[Ce,ye]=r.useState(!1),[Me,be]=r.useState("not_started"),[Oe,me]=r.useState(0),[Ie,ae]=r.useState(!1),[xe,ve]=r.useState(!1),[Ue,vt]=r.useState(!1),je=r.useMemo(()=>u&&d&&c&&d===c,[u,d,c]),q=r.useMemo(()=>Ie?!1:je,[je,Ie]),Be=r.useMemo(()=>!q,[q]),te=r.useMemo(()=>{const h=l==null?void 0:l["Type - User Signup"];return wt({userType:h})},[l]),pe=r.useMemo(()=>l?{email:l["is email confirmed"]===!0,phone:l["Verify - Phone"]===!0,govId:l["user verified?"]===!0,linkedin:!!l["Verify - Linked In ID"]}:{email:!1,phone:!1,govId:!1,linkedin:!1},[l]),Ne=r.useMemo(()=>({isHost:te,firstListingCreated:oe.length>0,rentalAppSubmitted:!!(l!=null&&l["Rental Application"])}),[te,oe,l]),Ze=r.useMemo(()=>{const h={profilePhoto:l==null?void 0:l["Profile Photo"],bio:m.bio||(l==null?void 0:l["About Me / Bio"]),firstName:m.firstName||(l==null?void 0:l["Name - First"]),lastName:m.lastName||(l==null?void 0:l["Name - Last"]),jobTitle:m.jobTitle||(l==null?void 0:l["Job Title"])};return la(h,pe,Ne)},[l,m,pe,Ne]),et=r.useMemo(()=>{const h={profilePhoto:l==null?void 0:l["Profile Photo"],bio:m.bio||(l==null?void 0:l["About Me / Bio"]),firstName:m.firstName||(l==null?void 0:l["Name - First"]),lastName:m.lastName||(l==null?void 0:l["Name - Last"]),jobTitle:m.jobTitle||(l==null?void 0:l["Job Title"])};return ca(h,pe,Ne)},[l,m,pe,Ne]),tt=r.useMemo(()=>{const h=m.firstName||(l==null?void 0:l["Name - First"])||"",y=m.lastName||(l==null?void 0:l["Name - Last"])||"";return`${h} ${y}`.trim()||"Your Name"},[m.firstName,m.lastName,l]),st=r.useMemo(()=>m.jobTitle||(l==null?void 0:l["Job Title"])||"",[m.jobTitle,l]),Ve=r.useMemo(()=>!(l!=null&&l["Date of Birth"]),[l]),$e=r.useCallback(async()=>{try{const{data:h,error:y}=await R.schema("reference_table").from("zat_goodguestreasons").select("_id, name").order("name");y?console.error("Error fetching good guest reasons:",y):F(h||[]);const{data:_,error:S}=await R.schema("reference_table").from("zat_storage").select("_id, Name").order("Name");if(S)console.error("Error fetching storage items:",S);else{const N=["ID / Wallet / Money","Luggage","Portable Massager","Protein","Sound System","TV"],T=(_||[]).filter(M=>!N.includes(M.Name));ee(T)}}catch(h){console.error("Error fetching reference data:",h)}},[]),Z=r.useCallback(async h=>{try{const{data:y,error:_}=await R.from("user").select("*").eq("_id",h).single();if(_)throw new Error("User not found");let S="",N="";const T=y["Rental Application"];if(T){const{data:Y}=await R.from("rentalapplication").select('"job title", "employment status"').eq("_id",T).single();Y&&(S=Y["job title"]||"",N=Y["employment status"]||"",!S&&N&&(S=N.split("-").map(he=>he.charAt(0).toUpperCase()+he.slice(1)).join(" ")))}x({...y,_jobTitle:S,_employmentStatus:N,_rentalAppId:T});const M=y["Date of Birth"],I=M?M.split("T")[0]:"",U=y["transportation medium"];let de=[];const ie=["car","public_transit","bicycle","walking","rideshare","other"];if(U&&typeof U=="string")try{const Y=JSON.parse(U);Array.isArray(Y)&&(de=Y.filter(he=>ie.includes(he)))}catch{ie.includes(U)&&(de=[U])}else Array.isArray(U)&&(de=U.filter(Y=>ie.includes(Y)));return b({firstName:y["Name - First"]||"",lastName:y["Name - Last"]||"",jobTitle:S,dateOfBirth:I,bio:y["About Me / Bio"]||"",needForSpace:y["need for Space"]||"",specialNeeds:y["special needs"]||"",selectedDays:At(y["Recent Days Selected"]||[]),transportationTypes:de,goodGuestReasons:y["Reasons to Host me"]||[],storageItems:y["About - Commonly Stored Items"]||[]}),y}catch(y){throw y}},[]),We=r.useCallback(async h=>{if(h){Fe(!0);try{console.log("[AccountProfile] Fetching listings for host:",h);const{data:y,error:_}=await R.rpc("get_host_listings",{host_user_id:h});if(_)throw _;console.log("[AccountProfile] Listings fetched:",(y==null?void 0:y.length)||0);const S=(y||[]).filter(N=>N.Complete===!0).map(N=>({_id:N.id||N._id,id:N.id,Name:N.Name||"Unnamed Listing","Borough/Region":N["Location - Borough"]||"",hood:N.hood||"","Qty of Bedrooms":N.bedrooms||0,"Qty of Bathrooms":N.bathrooms||0,"Start Nightly Price":N.min_nightly||0,min_nightly:N.min_nightly||0,weekly_rate:N.weekly_rate||0,monthly_rate:N.monthly_rate||0,Complete:N.Complete,listing_photo:N["Features - Photos"]||[],rental_type:N.rental_type||"Nightly",source:N.source||"listing"}));le(S)}catch(y){console.error("[AccountProfile] Error fetching host listings:",y),le([])}finally{Fe(!1)}}},[]);r.useEffect(()=>{async function h(){try{const y=fs();if(y){console.log("[AccountProfile] Auth error detected in URL:",y),gs();let I="Authentication failed. ";throw y.errorCode==="otp_expired"?I="This verification link has expired or already been used. Please request a new verification email from your profile settings.":y.errorCode==="access_denied"?I="Access denied. The verification link may have expired or been used already. Please request a new verification email.":y.errorDescription?I=y.errorDescription:I="The verification link is invalid or has expired. Please request a new verification email from your profile settings.",new Error(I)}const _=await ys();j(_);let S=null;if(_){const I=await bs({clearOnFailure:!1});I!=null&&I.userId?(S=I.userId,console.log("[AccountProfile] Using validated userId (Bubble _id):",S)):(S=Pe(),console.log("[AccountProfile] Falling back to session ID:",S))}p(S);const N=oa(),T=N||S;if(!T)throw new Error("Please log in to view your profile, or provide a user ID in the URL");console.log("[AccountProfile] Target user ID:",T,N?"(from URL)":"(from session - viewing own profile)"),g(T),await $e();const M=await Z(T);if(M){const I=M["Type - User Signup"];wt({userType:I})&&await We(T)}s(!1)}catch(y){console.error("Error initializing profile page:",y),a(y.message),s(!1)}}h()},[$e,Z,We]),r.useEffect(()=>{if(!(!q||te)){if(l!=null&&l["Rental Application"]){be("submitted"),me(100);return}try{const h=localStorage.getItem("rentalApplicationDraft");if(h){const y=JSON.parse(h),_=["fullName","dob","email","phone","currentAddress","lengthResided","employmentStatus","signature"],S=["apartmentUnit","renting","employerName","jobTitle","businessName","hasPets","isSmoker","needsParking","references"];let N=0;const T=_.length;_.forEach(I=>{y[I]&&String(y[I]).trim()&&N++}),S.forEach(I=>{y[I]&&String(y[I]).trim()&&(N+=.5)});const M=Math.min(100,Math.round(N/T*100));if(M>0){be("in_progress"),me(M);return}}}catch(h){console.error("Error reading rental application draft:",h)}be("not_started"),me(0)}},[q,te,l]),r.useEffect(()=>{u&&c&&(async()=>{if(new URLSearchParams(window.location.search).get("verified")!=="email"||!u||!c)return;console.log("[email-verification] Processing verification callback");const S=new URL(window.location.href);S.searchParams.delete("verified"),window.history.replaceState({},"",S.toString());try{const{error:N}=await R.from("user").update({"is email confirmed":!0}).eq("_id",c);if(N){console.error("[email-verification] Error updating verification status:",N),window.showToast&&window.showToast({title:"Error",content:"Failed to update email verification status.",type:"error"});return}console.log("[email-verification] Email verified successfully"),await Z(c),window.showToast&&window.showToast({title:"Email Verified",content:"Your email has been verified successfully!",type:"success"})}catch(N){console.error("[email-verification] Unexpected error:",N),window.showToast&&window.showToast({title:"Error",content:"An error occurred during verification.",type:"error"})}})()},[u,c,Z]),r.useEffect(()=>{if(t||!q||te)return;const h=new URLSearchParams(window.location.search),y=h.get("section"),_=h.get("openRentalApp");if(y!=="rental-application")return;console.log("[rental-app-navigation] Processing rental application deep link");const S=new URL(window.location.href);S.searchParams.delete("section"),S.searchParams.delete("openRentalApp"),window.history.replaceState({},"",S.toString()),setTimeout(()=>{const N=document.getElementById("rental-application-section");N&&N.scrollIntoView({behavior:"smooth",block:"center"}),_==="true"&&ye(!0)},100)},[t,q,te]);const at=r.useCallback((h,y)=>{b(_=>({..._,[h]:y})),E(!0),k[h]&&z(_=>{const S={..._};return delete S[h],S})},[k]),nt=r.useCallback(h=>{b(y=>{const _=y.selectedDays,S=_.includes(h)?_.filter(N=>N!==h):[..._,h].sort((N,T)=>N-T);return{...y,selectedDays:S}}),E(!0)},[]),it=r.useCallback(async(h,y)=>{const _=m[h],S=_.includes(y),N=S?_.filter(I=>I!==y):[..._,y];b(I=>({...I,[h]:N})),E(!0);let T="";if(h==="goodGuestReasons"){const I=W.find(U=>U._id===y);T=(I==null?void 0:I.name)||"Reason"}else if(h==="storageItems"){const I=B.find(U=>U._id===y);T=(I==null?void 0:I.Name)||"Item"}const M=h==="goodGuestReasons"?"Reasons to Host me":"About - Commonly Stored Items";if(!c){console.error("[handleChipToggle] Cannot autosave: no user ID");return}try{const{error:I}=await R.from("user").update({[M]:N,"Modified Date":new Date().toISOString()}).eq("_id",c);if(I){console.error("[handleChipToggle] Autosave error:",I),b(U=>({...U,[h]:_})),window.showToast&&window.showToast({title:"Save Failed",content:`Could not save "${T}". Please try again.`,type:"error",duration:3e3});return}if(window.showToast){const U=S?"Removed":"Added";window.showToast({title:`${U}: ${T}`,type:"success",duration:2e3})}}catch(I){console.error("[handleChipToggle] Unexpected error:",I),b(U=>({...U,[h]:_})),window.showToast&&window.showToast({title:"Save Failed",content:"An unexpected error occurred. Please try again.",type:"error",duration:3e3})}},[m,W,B,c]),rt=r.useCallback(h=>{console.log("[handleTransportToggle] Toggling transport:",h),b(y=>{const _=y.transportationTypes,S=_.includes(h)?_.filter(N=>N!==h):[..._,h];return console.log("[handleTransportToggle] Current:",_,"-> New:",S),{...y,transportationTypes:S}}),E(!0),console.log("[handleTransportToggle] isDirty set to true")},[]),De=r.useCallback(()=>{const h={};return m.firstName.trim()||(h.firstName="First name is required"),z(h),Object.keys(h).length===0},[m]),qe=r.useCallback(async()=>{if(console.log("[handleSave] Called. isEditorView:",q,"profileUserId:",c),!q||!c)return console.error("Cannot save: not in editor view or no user ID"),{success:!1,error:"Cannot save changes"};if(!De())return window.showToast&&window.showToast({title:"Validation error",content:"Please fix the errors before saving.",type:"error"}),{success:!1,error:"Please fix validation errors"};i(!0);try{const h=m.firstName.trim(),y=m.lastName.trim(),_=[h,y].filter(Boolean).join(" ")||null,S=m.dateOfBirth?new Date(m.dateOfBirth+"T00:00:00Z").toISOString():null,N={"Name - First":h,"Name - Last":y,"Name - Full":_,"Date of Birth":S,"About Me / Bio":m.bio.trim(),"need for Space":m.needForSpace.trim(),"special needs":m.specialNeeds.trim(),"Recent Days Selected":da(m.selectedDays),"transportation medium":m.transportationTypes.length>0?JSON.stringify(m.transportationTypes):null,"Reasons to Host me":m.goodGuestReasons,"About - Commonly Stored Items":m.storageItems,"Modified Date":new Date().toISOString()};console.log("[handleSave] Update data:",N);const{error:T}=await R.from("user").update(N).eq("_id",c);if(T)throw console.error("[handleSave] Update error:",T),T;console.log("[handleSave] User data saved successfully");const M=l==null?void 0:l._rentalAppId;if(M&&m.jobTitle!==void 0){const{error:I}=await R.from("rentalapplication").update({"job title":m.jobTitle.trim()}).eq("_id",M);I&&console.error("Error saving job title to rental application:",I)}return await Z(c),E(!1),i(!1),window.showToast&&window.showToast({title:"Profile saved!",content:"Your changes have been saved successfully.",type:"success"}),{success:!0}}catch(h){return console.error("Error saving profile:",h),i(!1),window.showToast&&window.showToast({title:"Save failed",content:h.message||"Please try again.",type:"error"}),{success:!1,error:h.message}}},[q,c,m,De,Z]),f=r.useCallback(()=>{if(l){const h=l["Date of Birth"],y=h?h.split("T")[0]:"",_=l["transportation medium"];let S=[];const N=["car","public_transit","bicycle","walking","rideshare","other"];if(_&&typeof _=="string")try{const T=JSON.parse(_);Array.isArray(T)&&(S=T.filter(M=>N.includes(M)))}catch{N.includes(_)&&(S=[_])}else Array.isArray(_)&&(S=_.filter(T=>N.includes(T)));b({firstName:l["Name - First"]||"",lastName:l["Name - Last"]||"",jobTitle:l._jobTitle||"",dateOfBirth:y,bio:l["About Me / Bio"]||"",needForSpace:l["need for Space"]||"",specialNeeds:l["special needs"]||"",selectedDays:At(l["Recent Days Selected"]||[]),transportationTypes:S,goodGuestReasons:l["Reasons to Host me"]||[],storageItems:l["About - Commonly Stored Items"]||[]}),z({}),E(!1)}},[l]),v=r.useCallback(()=>{ae(h=>!h)},[]),w=r.useCallback(()=>{ae(!1)},[]),A=r.useCallback(async()=>{if(xe)return;const h=l==null?void 0:l.email;if(!h){console.error("[handleVerifyEmail] No email found in profile data"),window.showToast&&window.showToast({title:"Error",content:"Unable to verify email. Please refresh and try again.",type:"error"});return}ve(!0);try{console.log("[handleVerifyEmail] Fetching BCC email addresses");const{data:y,error:_}=await R.schema("reference_table").from("os_slack_channels").select("email_address").in("name",["bots_log","customer_activation"]);let S=[];!_&&y&&(S=y.map(Y=>Y.email_address).filter(Y=>Y&&Y.trim()&&Y.includes("@"))),console.log("[handleVerifyEmail] Generating magic link");const N=`${window.location.origin}/account-profile/${c}?verified=email`,{data:T,error:M}=await R.functions.invoke("auth-user",{body:{action:"generate_magic_link",payload:{email:h.toLowerCase().trim(),redirectTo:N}}});if(M||!(T!=null&&T.success)){console.error("[handleVerifyEmail] Error generating magic link:",M||T),window.showToast&&window.showToast({title:"Error",content:"Failed to generate verification link. Please try again.",type:"error"}),ve(!1);return}const I=T.data.action_link,U=(l==null?void 0:l["Name - First"])||"there";console.log("[handleVerifyEmail] Sending verification email");const de=`Hi ${U}. Please click the link below to verify your email address on Split Lease. This helps us ensure your account is secure and builds trust with other members of our community.`,{error:ie}=await R.functions.invoke("send-email",{body:{action:"send",payload:{template_id:"1757433099447x202755280527849400",to_email:h.toLowerCase().trim(),variables:{toemail:h.toLowerCase().trim(),fromemail:"tech@leasesplit.com",fromname:"Split Lease",subject:"Verify Your Email - Split Lease",preheadertext:"Click to verify your email address",title:"Verify Your Email",bodytext:de,buttonurl:I,buttontext:"Verify Email",bannertext1:"EMAIL VERIFICATION",bannertext2:"This link expires in 1 hour",bannertext3:"If you didn't request this, please ignore this email",footermessage:"For your security, never share this link with anyone.",cc_email:"",bcc_email:""},...S.length>0&&{bcc_emails:S}}}});ie?(console.error("[handleVerifyEmail] Error sending email:",ie),window.showToast&&window.showToast({title:"Error",content:"Failed to send verification email. Please try again.",type:"error"})):(console.log("[handleVerifyEmail] Verification email sent successfully"),vt(!0),window.showToast&&window.showToast({title:"Email Sent",content:"Verification email sent! Check your inbox and click the link to verify.",type:"success"}))}catch(y){console.error("[handleVerifyEmail] Unexpected error:",y),window.showToast&&window.showToast({title:"Error",content:"An unexpected error occurred. Please try again.",type:"error"})}ve(!1)},[xe,l,c]),C=r.useCallback(()=>{X(!0)},[]),V=r.useCallback(()=>{re(!0)},[]),H=r.useCallback(async h=>{try{await ra({userId:c,documentType:h.documentType,selfieFile:h.selfieFile,frontIdFile:h.frontIdFile,backIdFile:h.backIdFile,onProgress:y=>{console.log("[Identity Verification]",y)}}),await Z(c)}catch(y){throw console.error("[Identity Verification] Error:",y),y}},[c,Z]),we=r.useCallback(()=>{re(!1)},[]),Ae=r.useCallback(()=>{console.log("Connect LinkedIn clicked")},[]),ce=r.useCallback(()=>{X(!0)},[]),ne=r.useCallback(()=>{O(!0)},[]),Se=r.useCallback(()=>{O(!1)},[]),ke=r.useCallback(()=>{X(!1)},[]),ts=r.useCallback(()=>{window.location.href="/reset-password"},[]),ss=r.useCallback(()=>{ye(!0)},[]),as=r.useCallback(()=>{ye(!1)},[]),ns=r.useCallback(()=>{be("submitted"),me(100),ye(!1),c&&Z(c)},[c,Z]),is=r.useCallback(async h=>{console.log("Cover photo change:",h)},[]),rs=r.useCallback(async h=>{var S,N;if(!h||!c){console.error("Cannot upload avatar: no file or user ID");return}if(!["image/jpeg","image/png","image/gif","image/webp"].includes(h.type)){console.error("Invalid file type. Please upload a JPEG, PNG, GIF, or WebP image.");return}const _=5*1024*1024;if(h.size>_){console.error("File too large. Maximum size is 5MB.");return}i(!0);try{const{data:{session:T},error:M}=await R.auth.getSession();if(M||!((S=T==null?void 0:T.user)!=null&&S.id))throw new Error("Not authenticated. Please log in again.");const I=T.user.id,U=((N=h.name.split(".").pop())==null?void 0:N.toLowerCase())||"jpg",de=`avatar_${Date.now()}.${U}`,ie=`${I}/${de}`,{data:Y,error:he}=await R.storage.from("profile-photos").upload(ie,h,{cacheControl:"3600",upsert:!0,contentType:h.type});if(he)throw he;const{data:Ge}=R.storage.from("profile-photos").getPublicUrl(ie);if(!(Ge!=null&&Ge.publicUrl))throw new Error("Failed to get public URL for uploaded image");const ot=Ge.publicUrl,{error:jt}=await R.from("user").update({"Profile Photo":ot,"Modified Date":new Date().toISOString()}).eq("_id",c);if(jt)throw jt;x(cs=>({...cs,"Profile Photo":ot})),console.log("✅ Avatar uploaded successfully:",ot)}catch(T){console.error("❌ Error uploading avatar:",T),a(T.message||"Failed to upload profile photo")}finally{i(!1)}},[c]),os=r.useCallback(h=>{h&&(q?window.location.href=`/listing-dashboard?id=${h}`:window.location.href=`/view-split-lease/${h}`)},[q]),ls=r.useCallback(()=>{window.location.href="/self-listing-v2"},[]);return{loading:t,saving:n,error:o,isEditorView:q,isPublicView:Be,isAuthenticated:u,isOwnProfile:je,previewMode:Ie,handleExitPreview:w,profileData:l,profileUserId:c,loggedInUserId:d,displayName:tt,displayJobTitle:st,verifications:pe,profileStrength:Ze,nextActions:et,showDateOfBirthField:Ve,formData:m,formErrors:k,isDirty:P,goodGuestReasonsList:W,storageItemsList:B,transportationOptions:K,handleFieldChange:at,handleDayToggle:nt,handleChipToggle:it,handleTransportToggle:rt,handleSave:qe,handleCancel:f,handlePreviewProfile:v,handleVerifyEmail:A,handleVerifyPhone:C,handleVerifyGovId:V,handleConnectLinkedIn:Ae,handleEditPhone:ce,handleOpenNotificationSettings:ne,handleChangePassword:ts,handleCoverPhotoChange:is,handleAvatarChange:rs,showNotificationModal:Q,handleCloseNotificationModal:Se,showPhoneEditModal:D,handleClosePhoneEditModal:ke,showIdentityVerificationModal:ue,handleIdentityVerificationSubmit:H,handleCloseIdentityVerificationModal:we,isHostUser:te,hostListings:oe,loadingListings:Le,handleListingClick:os,handleCreateListing:ls,rentalApplicationStatus:Me,rentalApplicationProgress:Oe,showRentalWizardModal:Ce,handleOpenRentalWizard:ss,handleCloseRentalWizard:as,handleRentalWizardSuccess:ns,isVerifyingEmail:xe,verificationEmailSent:Ue}}function ma({imageUrl:t,editable:s=!1,onChange:n}){const i=r.useRef(null),o=()=>{s&&i.current&&i.current.click()},a=d=>{var c;const p=(c=d.target.files)==null?void 0:c[0];p&&n&&n(p),i.current&&(i.current.value="")};return e.jsxs("div",{className:"cover-photo-container",onClick:o,style:{cursor:s?"pointer":"default"},children:[t?e.jsx("img",{src:t,alt:"Cover photo",className:"cover-photo"}):e.jsx("div",{className:"cover-photo-default"}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"cover-photo-overlay",children:[e.jsx(bt,{size:24}),e.jsx("span",{className:"cover-photo-overlay-text",children:"Click to change cover"})]}),e.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:a,style:{display:"none"},"aria-label":"Upload cover photo"})]})]})}function pa({imageUrl:t,firstName:s,isEditorView:n=!1,isVerified:i=!1,onChange:o}){const a=r.useRef(null),d=c=>{c.stopPropagation(),n&&a.current&&a.current.click()},p=c=>{var u;const g=(u=c.target.files)==null?void 0:u[0];g&&o&&o(g),a.current&&(a.current.value="")};return e.jsxs("div",{className:"profile-avatar-wrapper",children:[e.jsx("img",{src:t||"/assets/images/default-avatar.jpg",alt:"Profile photo",className:"profile-avatar-image",onError:c=>{c.target.src="/assets/images/default-avatar.jpg"}}),n?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"profile-avatar-edit-badge",onClick:d,"aria-label":"Change profile photo",title:"Upload profile photo",children:e.jsx(bt,{size:18})}),e.jsx("input",{ref:a,type:"file",accept:"image/*",onChange:p,style:{display:"none"},"aria-label":"Upload profile photo"})]}):i?e.jsx("div",{className:"profile-avatar-verified-badge",title:"Identity verified",children:e.jsx(ge,{size:16})}):null]})}function ha({percentage:t=0}){const s=Math.max(0,Math.min(100,t));return e.jsxs("div",{className:"profile-strength-section",children:[e.jsx("div",{className:"profile-strength-label",children:"Profile Strength"}),e.jsxs("div",{className:"profile-strength-bar",children:[e.jsx("div",{className:"profile-strength-track",children:e.jsx("div",{className:"profile-strength-fill",style:{width:`${s}%`}})}),e.jsxs("span",{className:"profile-strength-percentage",children:[s,"%"]})]})]})}const fa={camera:bt,edit:Vs,phone:Vt,shield:Bt,linkedin:Dt,alert:xt};function ga({text:t,points:s,icon:n,onClick:i}){const o=fa[n]||xt;return e.jsxs("div",{className:"next-action-card",onClick:i,role:"button",tabIndex:0,onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),i==null||i())},children:[e.jsx(o,{className:"next-action-icon",size:20}),e.jsx("span",{className:"next-action-text",children:t}),s&&e.jsxs("span",{className:"next-action-badge",children:["+",s," pts"]})]})}const ya={email:"Email verified",phone:"Phone verified",govId:"Identity verified",linkedin:"LinkedIn connected"};function ba({isEditorView:t,coverPhotoUrl:s,avatarUrl:n,firstName:i,lastName:o,jobTitle:a,profileStrength:d,verifications:p,nextActions:c=[],onCoverPhotoChange:g,onAvatarChange:u,responseTime:j,responseRate:l,memberSince:x}){const m=`${i} ${o}`.trim()||"Your Name",k=(z=>{if(!z)return null;try{return new Date(z).toLocaleDateString("en-US",{month:"long",year:"numeric"})}catch{return null}})(x);return e.jsxs("aside",{className:"profile-sidebar",children:[e.jsx(ma,{imageUrl:s,editable:t,onChange:g}),e.jsx("div",{className:"profile-avatar-container",children:e.jsx(pa,{imageUrl:n,firstName:i,isEditorView:t,isVerified:p.govId,onChange:u})}),e.jsxs("div",{className:"sidebar-profile-info",children:[e.jsx("h1",{className:"sidebar-profile-name",children:m}),a&&e.jsx("p",{className:"sidebar-profile-title",children:a})]}),t&&e.jsx(ha,{percentage:d}),t&&c.length>0&&e.jsxs("div",{className:"sidebar-next-actions",children:[e.jsx("h3",{className:"sidebar-next-actions-title",children:"Complete Your Profile"}),e.jsx("div",{className:"next-action-cards",children:c.map(z=>e.jsx(ga,{text:z.text,points:z.points,icon:z.icon},z.id))})]}),!t&&e.jsxs("div",{className:"sidebar-stats",children:[e.jsxs("div",{className:"sidebar-stat-item",children:[e.jsx("div",{className:"sidebar-stat-value",children:j||"N/A"}),e.jsx("div",{className:"sidebar-stat-label",children:"Response time"})]}),e.jsxs("div",{className:"sidebar-stat-item",children:[e.jsx("div",{className:"sidebar-stat-value",children:l?`${l}%`:"N/A"}),e.jsx("div",{className:"sidebar-stat-label",children:"Response rate"})]})]}),!t&&e.jsx("div",{className:"sidebar-verifications",children:Object.entries(p).map(([z,P])=>P?e.jsxs("div",{className:"sidebar-verification-item verified",children:[e.jsx(ge,{size:16}),e.jsx("span",{className:"sidebar-verification-text",children:ya[z]})]},z):null)}),!t&&k&&e.jsxs("div",{className:"sidebar-member-since",children:[e.jsx(xs,{size:14}),e.jsxs("span",{className:"sidebar-member-since-text",children:["Member since ",k]})]})]})}function L({id:t,title:s,subtitle:n,children:i,className:o="",headerAction:a=null}){return e.jsxs("div",{id:t,className:`profile-card ${o}`,children:[e.jsxs("div",{className:"profile-card-header",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"profile-card-title",children:s}),n&&e.jsx("p",{className:"profile-card-subtitle",children:n})]}),a&&e.jsx("div",{className:"profile-card-header-action",children:a})]}),i]})}function xa({firstName:t,lastName:s,jobTitle:n,dateOfBirth:i="",showDateOfBirthField:o=!1,errors:a={},onFieldChange:d}){return e.jsxs(L,{title:"Basic Information",children:[e.jsxs("div",{className:"profile-form-row",children:[e.jsxs("div",{className:"profile-form-group",children:[e.jsx("label",{className:"profile-form-label",htmlFor:"firstName",children:"First Name *"}),e.jsx("input",{id:"firstName",type:"text",className:"profile-form-input",value:t,onChange:p=>d("firstName",p.target.value),placeholder:"Your first name"}),a.firstName&&e.jsx("span",{className:"profile-form-error",children:a.firstName})]}),e.jsxs("div",{className:"profile-form-group",children:[e.jsx("label",{className:"profile-form-label",htmlFor:"lastName",children:"Last Name"}),e.jsx("input",{id:"lastName",type:"text",className:"profile-form-input",value:s,onChange:p=>d("lastName",p.target.value),placeholder:"Your last name"})]})]}),e.jsxs("div",{className:"profile-form-row",children:[o&&e.jsxs("div",{className:"profile-form-group",children:[e.jsx("label",{className:"profile-form-label",htmlFor:"dateOfBirth",children:"Date of Birth"}),e.jsx("input",{id:"dateOfBirth",type:"date",className:"profile-form-input",value:i,onChange:p=>d("dateOfBirth",p.target.value),max:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"profile-form-group",children:[e.jsx("label",{className:"profile-form-label",htmlFor:"jobTitle",children:"Job Title"}),e.jsx("input",{id:"jobTitle",type:"text",className:"profile-form-input",value:n,onChange:p=>d("jobTitle",p.target.value),placeholder:"e.g., Software Engineer, Marketing Manager"})]})]})]})}const Tt=500;function Yt({bio:t,onFieldChange:s,readOnly:n=!1,firstName:i=""}){const o=(t||"").length;if(n){const a=i?`About ${i}`:"About";return e.jsx(L,{title:a,children:t?e.jsx("p",{className:"public-bio-text",children:t}):e.jsx("p",{className:"public-bio-text",style:{color:"var(--sl-text-tertiary)"},children:"No bio provided"})})}return e.jsx(L,{title:"About You",children:e.jsxs("div",{className:"profile-form-group",children:[e.jsx("label",{className:"profile-form-label",htmlFor:"bio",children:"Tell us about yourself"}),e.jsxs("div",{className:"profile-form-input-wrapper",children:[e.jsx("textarea",{id:"bio",className:"profile-form-textarea",value:t,onChange:a=>{a.target.value.length<=Tt&&s("bio",a.target.value)},placeholder:"Share a bit about yourself, your lifestyle, and what kind of roommate you'd be...",rows:5}),e.jsxs("span",{className:"profile-form-char-count",children:[o,"/",Tt]})]})]})})}function va({needForSpace:t,specialNeeds:s,onFieldChange:n,readOnly:i=!1}){return i?e.jsxs(L,{title:"Requirements",children:[e.jsxs("div",{className:"public-profile-info-row",children:[e.jsx("span",{className:"public-profile-label",children:"Need for Space:"}),e.jsx("span",{className:"public-profile-value",children:t||"Not specified"})]}),s&&e.jsxs("div",{className:"public-profile-info-row",children:[e.jsx("span",{className:"public-profile-label",children:"Special Needs:"}),e.jsx("span",{className:"public-profile-value",children:s})]})]}):e.jsxs(L,{title:"Why Split Lease?",children:[e.jsxs("div",{className:"profile-form-group",children:[e.jsx("label",{className:"profile-form-label",htmlFor:"needForSpace",children:"Why do you need the space?"}),e.jsx("textarea",{id:"needForSpace",className:"profile-form-textarea",value:t,onChange:o=>n("needForSpace",o.target.value),placeholder:"e.g., I work in the city 3 days a week and need a place to stay...",rows:3})]}),e.jsxs("div",{className:"profile-form-group",children:[e.jsx("label",{className:"profile-form-label",htmlFor:"specialNeeds",children:"Any special requirements?"}),e.jsx("textarea",{id:"specialNeeds",className:"profile-form-textarea",value:s,onChange:o=>n("specialNeeds",o.target.value),placeholder:"e.g., I need a quiet workspace, have mild allergies to cats...",rows:3})]})]})}const zt=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function ja({selectedDays:t=[],onChange:s,readOnly:n=!1,className:i=""}){const o=a=>{n||!s||s(a)};return e.jsx("div",{className:`day-selector-pills ${i}`,children:zt.map((a,d)=>{const p=t.includes(d);return e.jsx("button",{type:"button",className:`day-pill ${p?"day-pill--selected":""} ${n?"day-pill--readonly":""}`,onClick:()=>o(d),disabled:n,"aria-pressed":p,"aria-label":`${zt[d]} ${p?"selected":"not selected"}`,children:a},d)})})}const Na=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];function Ht({selectedDays:t=[],onDayToggle:s,readOnly:n=!1}){return n?t.length===0?null:e.jsx(L,{title:"Schedule",children:e.jsxs("div",{className:"public-schedule-section",children:[e.jsx("p",{className:"public-schedule-label",children:"Ideal Split Schedule"}),e.jsx("div",{className:"public-day-selector",children:Na.map((i,o)=>e.jsx("div",{className:`public-day-pill ${t.includes(o)?"public-day-pill--active":""}`,children:i},o))})]})}):e.jsx(L,{title:"Schedule",children:e.jsxs("div",{className:"profile-form-group",children:[e.jsx("label",{className:"profile-form-label",children:"Which days do you typically need a place?"}),e.jsx(ja,{selectedDays:t,onChange:s,readOnly:!1})]})})}const Et={car:Wt,public_transit:Ws,plane:Os};function Jt({transportationTypes:t=[],transportationOptions:s=[],onTransportToggle:n,readOnly:i=!1}){if(console.log("[TransportCard] Rendered with transportationTypes:",t,"onTransportToggle:",typeof n),i){const o=s.filter(a=>a.value&&t.includes(a.value));return o.length===0?null:e.jsx(L,{title:"Transport",children:e.jsxs("div",{className:"public-schedule-section",children:[e.jsx("p",{className:"public-schedule-label",children:"How I Get to NYC"}),e.jsx("div",{className:"public-transport-badges",children:o.map(a=>{const d=Et[a.value]||Wt;return e.jsxs("div",{className:"public-transport-badge",children:[e.jsx(d,{size:20}),e.jsx("span",{children:a.label})]},a.value)})})]})})}return e.jsx(L,{title:"Transport",children:e.jsxs("div",{className:"profile-form-group",children:[e.jsx("label",{className:"profile-form-label",children:"How do you get to your Split Lease?"}),e.jsx("p",{className:"profile-form-hint",children:"Select all that apply"}),e.jsx("div",{className:"transport-icon-selector",children:s.filter(o=>o.value).map(o=>{const a=Et[o.value]||zs,d=t.includes(o.value);return e.jsxs("button",{type:"button",className:`transport-icon-btn ${d?"transport-icon-btn--selected":""}`,onClick:()=>{console.log("[TransportCard] Button clicked for:",o.value),n(o.value)},title:o.label,children:[e.jsx(a,{size:24}),e.jsx("span",{className:"transport-icon-label",children:o.label})]},o.value)})})]})})}const Pt=[{key:"email",title:"Email Address",icon:vs,verifyLabel:"Verify",editLabel:null},{key:"phone",title:"Phone Number",icon:Vt,verifyLabel:"Verify",editLabel:"Edit"},{key:"govId",title:"Government ID",icon:Bt,verifyLabel:"Verify",editLabel:null},{key:"linkedin",title:"LinkedIn",icon:Dt,verifyLabel:"Connect",editLabel:null}];function wa({verifications:t={},emailAddress:s="",phoneNumber:n="",onVerifyEmail:i,onVerifyPhone:o,onVerifyGovId:a,onConnectLinkedIn:d,onEditPhone:p,readOnly:c=!1,isVerifyingEmail:g=!1,verificationEmailSent:u=!1}){const j={email:s,phone:n},l={email:i,phone:o,govId:a,linkedin:d};if(c){const x=Pt.filter(m=>t[m.key]);return e.jsx(L,{title:"Trust & Verification",children:x.length>0?e.jsx("div",{className:"verification-list",children:x.map(m=>e.jsx("div",{className:"verification-item",children:e.jsxs("div",{className:"verification-item-left",children:[e.jsx("div",{className:"verification-icon-container",children:e.jsx(m.icon,{size:24})}),e.jsxs("div",{className:"verification-info",children:[e.jsx("span",{className:"verification-title",children:m.title}),e.jsxs("span",{className:"verification-status verification-status--verified",children:[e.jsx(ft,{size:14}),"Verified"]})]})]})},m.key))}):e.jsx("p",{style:{color:"var(--sl-text-tertiary)",fontSize:"14px"},children:"No verifications completed yet"})})}return e.jsx(L,{title:"Trust & Verification",children:e.jsx("div",{className:"verification-list",children:Pt.map(x=>{const m=t[x.key],b=x.icon,k=l[x.key];return e.jsxs("div",{className:"verification-item",children:[e.jsxs("div",{className:"verification-item-left",children:[e.jsx("div",{className:"verification-icon-container",children:e.jsx(b,{size:24})}),e.jsxs("div",{className:"verification-info",children:[e.jsx("span",{className:"verification-title",children:x.title}),j[x.key]&&e.jsx("span",{className:"verification-value",children:j[x.key]}),m?e.jsxs("span",{className:"verification-status verification-status--verified",children:[e.jsx(ft,{size:14}),"Verified"]}):e.jsx("span",{className:"verification-status verification-status--unverified",children:"Not verified"})]})]}),e.jsxs("div",{className:"verification-item-right",children:[x.key==="phone"&&m&&p&&e.jsx("button",{type:"button",className:"verification-btn verification-btn--secondary",onClick:p,children:"Edit"}),!m&&k&&e.jsx("button",{type:"button",className:`verification-btn${x.key==="email"&&u?" verification-btn--success":""}`,onClick:k,disabled:x.key==="email"&&(g||u),children:x.key==="email"&&g?"Sending...":x.key==="email"&&u?"Email Sent ✓":x.verifyLabel})]})]},x.key)})})})}function Qt({label:t,selected:s=!1,onChange:n,readOnly:i=!1,variant:o="default"}){const a=()=>{i||!n||n(!s)},d=["selectable-chip",s&&"selectable-chip--selected",s&&o==="success"&&"selectable-chip--success",i&&"selectable-chip--readonly"].filter(Boolean).join(" ");return e.jsx("button",{type:"button",className:d,onClick:a,disabled:i,"aria-pressed":s,children:t})}function Xt({selectedReasons:t=[],reasonsList:s=[],onChipToggle:n,readOnly:i=!1}){const o=s.filter(a=>t.includes(a._id)).map(a=>a.name);return i?e.jsx(L,{title:"Reasons to Host Me",children:o.length>0?e.jsx("div",{className:"public-reasons-grid",children:o.map((a,d)=>e.jsxs("div",{className:"public-reason-tag",children:[e.jsx(ge,{size:14}),e.jsx("span",{children:a})]},d))}):e.jsx("p",{style:{color:"var(--sl-text-tertiary)",fontSize:"14px"},children:"No reasons selected"})}):e.jsxs(L,{title:"Reasons to Host Me",children:[e.jsx("p",{style:{fontSize:"14px",color:"var(--sl-text-secondary)",marginBottom:"16px"},children:"Select the qualities that make you a great guest:"}),e.jsx("div",{className:"chip-container",children:s.map(a=>e.jsx(Qt,{label:a.name,selected:t.includes(a._id),variant:"success",onChange:()=>n("goodGuestReasons",a._id)},a._id))})]})}function Kt({selectedItems:t=[],itemsList:s=[],onChipToggle:n,readOnly:i=!1}){const o=s.filter(a=>t.includes(a._id)).map(a=>a.Name);return i?e.jsx(L,{title:"Items I Typically Store",subtitle:"Things I may keep at the space",children:o.length>0?e.jsx("div",{className:"public-items-grid",children:o.map((a,d)=>e.jsx("span",{className:"public-item-tag",children:a},d))}):e.jsx("p",{style:{color:"var(--sl-text-tertiary)",fontSize:"14px"},children:"No storage needs specified"})}):e.jsxs(L,{title:"What You'll Want to Store",children:[e.jsx("p",{style:{fontSize:"14px",color:"var(--sl-text-secondary)",marginBottom:"16px"},children:"Select the items you typically bring with you:"}),e.jsx("div",{className:"chip-container",children:s.map(a=>e.jsx(Qt,{label:a.Name,selected:t.includes(a._id),onChange:()=>n("storageItems",a._id)},a._id))})]})}function Sa({onOpenNotificationSettings:t,onChangePassword:s}){const n=[{id:"notifications",icon:js,label:"Notification Settings",onClick:t},{id:"password",icon:Rs,label:"Change Password",onClick:s}];return e.jsx(L,{title:"Account Settings",children:e.jsx("div",{className:"settings-list",children:n.map(i=>{const o=i.icon;return e.jsxs("div",{className:"settings-item",onClick:i.onClick,role:"button",tabIndex:0,onKeyDown:a=>{var d;(a.key==="Enter"||a.key===" ")&&(a.preventDefault(),(d=i.onClick)==null||d.call(i))},children:[e.jsxs("div",{className:"settings-item-left",children:[e.jsx(o,{size:20}),e.jsx("span",{className:"settings-item-text",children:i.label})]}),e.jsx("div",{className:"settings-item-right",children:e.jsx(gt,{size:16})})]},i.id)})})})}function ka(t){if(!Array.isArray(t)||t.length===0)return null;const s=[...t].sort((n,i)=>{const o=(n==null?void 0:n.SortOrder)??(n==null?void 0:n.displayOrder)??(n==null?void 0:n.Order)??0,a=(i==null?void 0:i.SortOrder)??(i==null?void 0:i.displayOrder)??(i==null?void 0:i.Order)??0;return o-a});for(const n of s){if(typeof n=="string"){if(!n.startsWith("blob:"))return n;continue}const i=(n==null?void 0:n.url)||(n==null?void 0:n.Photo)||(n==null?void 0:n["Photo (thumbnail)"]);if(i&&typeof i=="string"&&!i.startsWith("blob:"))return i}return null}function _a(t){const s=(t.rental_type||"").toLowerCase();if(s==="monthly"){const n=t.monthly_rate||t["Monthly Host Rate"]||0;if(n>0)return{amount:n,label:"/month"}}else if(s==="weekly"){const n=t.weekly_rate||t["Weekly Host Rate"]||0;if(n>0)return{amount:n,label:"/week"}}else{const n=t["Start Nightly Price"]||t.min_nightly||0;if(n>0)return{amount:n,label:"/night"}}return null}function Ca({listing:t,onClick:s}){const n=t.listing_photo||[],i=ka(n),o=()=>{s==null||s(t._id)},a=m=>{(m.key==="Enter"||m.key===" ")&&(m.preventDefault(),s==null||s(t._id))},d=t["Borough/Region"]||"",p=t.hood||"",c=[d,p].filter(Boolean).join(", ")||"Location not specified",g=t["Qty of Bedrooms"]||0,u=t["Qty of Bathrooms"]||0,j=g===1?"1 bed":`${g} beds`,l=u===1?"1 bath":`${u} baths`,x=_a(t);return e.jsxs("div",{className:"listing-item",onClick:o,onKeyDown:a,role:"button",tabIndex:0,"aria-label":`View listing: ${t.Name||"Unnamed listing"}`,children:[e.jsx("div",{className:"listing-item-photo",children:i?e.jsx("img",{src:i,alt:t.Name||"Listing photo",loading:"lazy"}):e.jsx("div",{className:"listing-item-photo-placeholder",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),e.jsx("polyline",{points:"21 15 16 10 5 21"})]})})}),e.jsxs("div",{className:"listing-item-details",children:[e.jsx("h4",{className:"listing-item-name",children:t.Name||"Unnamed Listing"}),e.jsx("p",{className:"listing-item-location",children:c}),e.jsxs("div",{className:"listing-item-meta",children:[e.jsxs("span",{children:[j,", ",l]}),x&&e.jsxs("span",{className:"listing-item-price",children:["$",x.amount,x.label]})]})]})]})}function Rt(){return e.jsxs("div",{className:"listing-item-skeleton","aria-hidden":"true",children:[e.jsx("div",{className:"listing-item-skeleton-photo"}),e.jsxs("div",{className:"listing-item-skeleton-details",children:[e.jsx("div",{className:"listing-item-skeleton-title"}),e.jsx("div",{className:"listing-item-skeleton-location"}),e.jsx("div",{className:"listing-item-skeleton-meta"})]})]})}function Ia({onCreateListing:t}){return e.jsxs("div",{className:"listings-empty-state",children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:[e.jsx("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),e.jsx("p",{children:"You haven't created any listings yet"}),t&&e.jsx("button",{onClick:t,type:"button",children:"Create Your First Listing"})]})}function Zt({listings:t=[],loading:s=!1,onListingClick:n,onCreateListing:i,readOnly:o=!1}){return s?e.jsx(L,{title:"My Listings",children:e.jsxs("div",{className:"listings-grid",children:[e.jsx(Rt,{}),e.jsx(Rt,{})]})}):t.length===0?e.jsx(L,{title:"My Listings",children:e.jsx(Ia,{onCreateListing:o?null:i})}):e.jsx(L,{title:"My Listings",children:e.jsx("div",{className:"listings-grid",children:t.map(a=>e.jsx(Ca,{listing:a,onClick:n},a._id))})})}function Aa({applicationStatus:t="not_started",progress:s=0,onOpenWizard:n}){return t==="submitted"?e.jsx(L,{id:"rental-application-section",title:"Rental Application",className:"rental-app-card rental-app-card--success",children:e.jsxs("div",{className:"rental-app-card__success",children:[e.jsx("div",{className:"rental-app-card__success-icon",children:e.jsx(ft,{size:32})}),e.jsxs("div",{className:"rental-app-card__success-content",children:[e.jsx("h3",{className:"rental-app-card__success-title",children:"Application Submitted"}),e.jsx("p",{className:"rental-app-card__success-text",children:"Your rental application is on file. Hosts can now review your information when considering your proposals."})]}),e.jsxs("button",{className:"rental-app-card__cta rental-app-card__cta--secondary",onClick:n,type:"button",children:[e.jsx(Ns,{size:16}),"Review & Edit"]})]})}):t==="in_progress"?e.jsx(L,{id:"rental-application-section",title:"Rental Application",className:"rental-app-card",children:e.jsxs("div",{className:"rental-app-card__content",children:[e.jsx("div",{className:"rental-app-card__icon",children:e.jsx(Re,{size:24})}),e.jsxs("div",{className:"rental-app-card__info",children:[e.jsx("h3",{className:"rental-app-card__heading",children:"Continue Your Application"}),e.jsxs("p",{className:"rental-app-card__description",children:["You're ",s,"% done. Pick up where you left off."]}),e.jsxs("div",{className:"rental-app-card__progress",children:[e.jsx("div",{className:"rental-app-card__progress-bar",children:e.jsx("div",{className:"rental-app-card__progress-fill",style:{width:`${s}%`}})}),e.jsxs("span",{className:"rental-app-card__progress-text",children:[s,"%"]})]})]}),e.jsxs("button",{className:"rental-app-card__cta",onClick:n,type:"button",children:["Continue",e.jsx(gt,{size:18})]})]})}):e.jsx(L,{id:"rental-application-section",title:"Rental Application",className:"rental-app-card",children:e.jsxs("div",{className:"rental-app-card__content",children:[e.jsx("div",{className:"rental-app-card__icon",children:e.jsx(Re,{size:24})}),e.jsxs("div",{className:"rental-app-card__info",children:[e.jsx("h3",{className:"rental-app-card__heading",children:"Complete Your Rental Application"}),e.jsx("p",{className:"rental-app-card__description",children:"Hosts review this before accepting your booking proposals. It helps build trust and speeds up approvals."}),e.jsxs("div",{className:"rental-app-card__time",children:[e.jsx(ws,{size:14}),e.jsx("span",{children:"Takes about 5 minutes"})]})]}),e.jsxs("button",{className:"rental-app-card__cta",onClick:n,type:"button",children:["Start",e.jsx(gt,{size:18})]})]})})}function Ta({formData:t,formErrors:s,profileData:n,verifications:i,goodGuestReasonsList:o,storageItemsList:a,transportationOptions:d,showDateOfBirthField:p=!1,onFieldChange:c,onDayToggle:g,onChipToggle:u,onTransportToggle:j,onVerifyEmail:l,onVerifyPhone:x,onVerifyGovId:m,onConnectLinkedIn:b,onEditPhone:k,onOpenNotificationSettings:z,onChangePassword:P,isHostUser:E=!1,hostListings:W=[],loadingListings:F=!1,onListingClick:B,onCreateListing:ee,rentalApplicationStatus:K="not_started",rentalApplicationProgress:Q=0,onOpenRentalWizard:O,isVerifyingEmail:D=!1,verificationEmailSent:X=!1}){return e.jsxs(e.Fragment,{children:[e.jsx(xa,{firstName:t.firstName,lastName:t.lastName,jobTitle:t.jobTitle,dateOfBirth:t.dateOfBirth,showDateOfBirthField:p,errors:s,onFieldChange:c}),e.jsx(Yt,{bio:t.bio,onFieldChange:c}),!E&&e.jsx(va,{needForSpace:t.needForSpace,specialNeeds:t.specialNeeds,onFieldChange:c}),!E&&e.jsx(Ht,{selectedDays:t.selectedDays,onDayToggle:g}),!E&&e.jsx(Jt,{transportationTypes:t.transportationTypes,transportationOptions:d,onTransportToggle:j}),e.jsx(wa,{verifications:i,emailAddress:(n==null?void 0:n.email)||(n==null?void 0:n.Email)||"",phoneNumber:(n==null?void 0:n["Phone Number (as text)"])||"",onVerifyEmail:l,onVerifyPhone:x,onVerifyGovId:m,onConnectLinkedIn:b,onEditPhone:k,isVerifyingEmail:D,verificationEmailSent:X}),!E&&e.jsx(Xt,{selectedReasons:t.goodGuestReasons,reasonsList:o,onChipToggle:u}),!E&&e.jsx(Kt,{selectedItems:t.storageItems,itemsList:a,onChipToggle:u}),E&&e.jsx(Zt,{listings:W,loading:F,onListingClick:B,onCreateListing:ee}),!E&&e.jsx(Aa,{applicationStatus:K,progress:Q,onOpenWizard:O}),e.jsx(Sa,{onOpenNotificationSettings:z,onChangePassword:P})]})}function za({content:t}){return t?e.jsx(L,{title:"Why I Want a Split Lease",children:e.jsx("p",{className:"public-bio-text",children:t})}):null}function Ea({content:t}){return t?e.jsx(L,{title:"My Requirements",children:e.jsx("p",{className:"public-bio-text",children:t})}):null}const Pa=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function Ra(t){return Array.isArray(t)?t.map(s=>Pa.indexOf(s)).filter(s=>s!==-1):[]}function La({profileData:t,verifications:s,goodGuestReasonsList:n,storageItemsList:i,isHostUser:o=!1,hostListings:a=[],onListingClick:d}){const p=(t==null?void 0:t["About Me / Bio"])||"",c=(t==null?void 0:t["need for Space"])||"",g=(t==null?void 0:t["special needs"])||"",u=Ra((t==null?void 0:t["Recent Days Selected"])||[]),j=t==null?void 0:t["transportation medium"];let l=[];const x=["car","public_transit","bicycle","walking","rideshare","other"];if(j&&typeof j=="string")try{const P=JSON.parse(j);Array.isArray(P)&&(l=P.filter(E=>x.includes(E)))}catch{x.includes(j)&&(l=[j])}else Array.isArray(j)&&(l=j.filter(P=>x.includes(P)));const m=(t==null?void 0:t["Good Guest Reasons"])||[],b=(t==null?void 0:t.storage)||[],k=(t==null?void 0:t["Name - First"])||"this guest",z=[{value:"",label:"Not specified"},{value:"car",label:"Car",icon:"car"},{value:"public_transit",label:"Public Transit",icon:"train"},{value:"plane",label:"Plane",icon:"plane"}];return e.jsxs(e.Fragment,{children:[e.jsx(Yt,{bio:p,readOnly:!0,firstName:k}),!o&&c&&e.jsx(za,{content:c}),!o&&g&&e.jsx(Ea,{content:g}),!o&&u.length>0&&e.jsx(Ht,{selectedDays:u,readOnly:!0}),!o&&l.length>0&&e.jsx(Jt,{transportationTypes:l,transportationOptions:z,readOnly:!0}),!o&&m.length>0&&e.jsx(Xt,{selectedReasons:m,reasonsList:n,readOnly:!0}),!o&&b.length>0&&e.jsx(Kt,{selectedItems:b,itemsList:i,readOnly:!0}),o&&a.length>0&&e.jsx(Zt,{listings:a,loading:!1,onListingClick:d,readOnly:!0})]})}function Fa({onPreview:t,onSave:s,saving:n=!1,disabled:i=!1,previewMode:o=!1}){const{showToast:a}=hs(),d=async()=>{if(n||i)return;const p=await s();p!=null&&p.success?a({title:"Profile saved",content:"Your changes have been saved successfully.",type:"success"}):a({title:"Save failed",content:(p==null?void 0:p.error)||"Unable to save changes. Please try again.",type:"error"})};return o?e.jsxs("div",{className:"fixed-save-bar fixed-save-bar--preview-mode",children:[e.jsx("div",{className:"preview-mode-indicator",children:e.jsx("span",{children:"👁️ Viewing as public"})}),e.jsxs("button",{type:"button",className:"save-bar-btn save-bar-btn--preview",onClick:t,children:[e.jsx(Ss,{size:16,style:{marginRight:8}}),"Exit Preview"]})]}):e.jsxs("div",{className:"fixed-save-bar",children:[e.jsxs("button",{type:"button",className:"save-bar-btn save-bar-btn--preview",onClick:t,children:[e.jsx(ks,{size:16,style:{marginRight:8}}),"Preview Public Profile"]}),e.jsx("button",{type:"button",className:"save-bar-btn save-bar-btn--save",onClick:d,disabled:n||i,children:n?e.jsxs(e.Fragment,{children:[e.jsx(_s,{size:16,style:{marginRight:8},className:"animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(qt,{size:16,style:{marginRight:8}}),"Save Changes"]})})]})}function Ma(){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polyline",{points:"20 12 20 22 4 22 4 12"}),e.jsx("rect",{x:"2",y:"7",width:"20",height:"5"}),e.jsx("line",{x1:"12",y1:"22",x2:"12",y2:"7"}),e.jsx("path",{d:"M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"}),e.jsx("path",{d:"M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"})]})}function Oa({onInviteClick:t,userType:s="guest"}){const n=()=>{t?t():console.log("Invite friends clicked")},o=s==="host"?"When the referred host closes their first lease, the reward is unlocked":"When they complete their first booking, the reward is unlocked";return e.jsxs("div",{className:"referral-banner",children:[e.jsxs("div",{className:"referral-banner-left",children:[e.jsx("div",{className:"referral-banner-icon",children:e.jsx(Ma,{})}),e.jsxs("div",{className:"referral-banner-text",children:[e.jsx("strong",{children:"Give $50, Get $50"}),e.jsx("span",{children:o})]})]}),e.jsx("button",{className:"referral-banner-btn",onClick:n,children:"Invite Friends"})]})}const _e={DRAFT:"rentalApplicationDraft",LAST_SAVED:"rentalApplicationLastSaved"},Ye={fullName:"",dob:"",email:"",phone:"",currentAddress:"",apartmentUnit:"",lengthResided:"",renting:"",employmentStatus:"",employerName:"",employerPhone:"",jobTitle:"",monthlyIncome:"",businessName:"",businessYear:"",businessState:"",monthlyIncomeSelf:"",companyStake:"",slForBusiness:"",taxForms:"",alternateIncome:"",hasPets:"",isSmoker:"",needsParking:"",references:"",showVisualReferences:!1,showCreditScore:!1,signature:"",proofOfEmploymentUrl:"",alternateGuaranteeUrl:"",creditScoreUrl:"",stateIdFrontUrl:"",stateIdBackUrl:"",governmentIdUrl:""},He={linkedin:!1,facebook:!1,id:!1,income:!1};class Ua{constructor(){Te(this,"state");Te(this,"listeners");Te(this,"autoSaveTimer");Te(this,"AUTO_SAVE_DELAY",1e3);this.state={formData:{...Ye},occupants:[],verificationStatus:{...He},lastSaved:null,isDirty:!1},this.listeners=new Set,this.autoSaveTimer=null}initialize(){try{const s=localStorage.getItem(_e.DRAFT),n=localStorage.getItem(_e.LAST_SAVED);if(s){const i=JSON.parse(s);i.formData&&(this.state.formData={...Ye,...i.formData}),i.occupants&&(this.state.occupants=i.occupants),i.verificationStatus&&(this.state.verificationStatus={...He,...i.verificationStatus}),this.state.lastSaved=n?new Date(n):null,console.log("[RentalAppStore] Loaded draft from localStorage")}return this.notifyListeners(),this.state}catch(s){return console.error("[RentalAppStore] Error initializing store:",s),this.state}}getState(){return{...this.state}}getFormData(){return{...this.state.formData}}getOccupants(){return[...this.state.occupants]}getVerificationStatus(){return{...this.state.verificationStatus}}updateFormData(s){this.state.formData={...this.state.formData,...s},this.state.isDirty=!0,this.scheduleAutoSave(),this.notifyListeners()}updateField(s,n){this.state.formData[s]=n,this.state.isDirty=!0,this.scheduleAutoSave(),this.notifyListeners()}setOccupants(s){this.state.occupants=[...s],this.state.isDirty=!0,this.scheduleAutoSave(),this.notifyListeners()}addOccupant(s){this.state.occupants=[...this.state.occupants,s],this.state.isDirty=!0,this.scheduleAutoSave(),this.notifyListeners()}removeOccupant(s){this.state.occupants=this.state.occupants.filter(n=>n.id!==s),this.state.isDirty=!0,this.scheduleAutoSave(),this.notifyListeners()}updateOccupant(s,n,i){this.state.occupants=this.state.occupants.map(o=>o.id===s?{...o,[n]:i}:o),this.state.isDirty=!0,this.scheduleAutoSave(),this.notifyListeners()}updateVerificationStatus(s,n){this.state.verificationStatus={...this.state.verificationStatus,[s]:n},this.state.isDirty=!0,this.scheduleAutoSave(),this.notifyListeners()}scheduleAutoSave(){this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=setTimeout(()=>{this.saveDraft()},this.AUTO_SAVE_DELAY)}saveDraft(){try{const s={formData:this.state.formData,occupants:this.state.occupants,verificationStatus:this.state.verificationStatus};return localStorage.setItem(_e.DRAFT,JSON.stringify(s)),localStorage.setItem(_e.LAST_SAVED,new Date().toISOString()),this.state.lastSaved=new Date,this.state.isDirty=!1,console.log("[RentalAppStore] Draft saved to localStorage"),this.notifyListeners(),!0}catch(s){return console.error("[RentalAppStore] Error saving draft:",s),!1}}reset(){this.state={formData:{...Ye},occupants:[],verificationStatus:{...He},lastSaved:null,isDirty:!1},localStorage.removeItem(_e.DRAFT),localStorage.removeItem(_e.LAST_SAVED),console.log("[RentalAppStore] Store reset to default state"),this.notifyListeners()}loadFromDatabase(s,n,i){this.state.formData={...Ye,...s},n&&(this.state.occupants=n),i&&(this.state.verificationStatus={...He,...i}),this.state.isDirty=!1,this.state.lastSaved=null,console.log("[RentalAppStore] Loaded data from database"),this.notifyListeners()}subscribe(s){return this.listeners.add(s),()=>{this.listeners.delete(s)}}notifyListeners(){this.listeners.forEach(s=>{s(this.getState())})}getDebugSummary(){var s;return{hasData:!!this.state.formData.fullName,fullName:this.state.formData.fullName||"(empty)",email:this.state.formData.email||"(empty)",employmentStatus:this.state.formData.employmentStatus||"(empty)",occupantsCount:this.state.occupants.length,hasSignature:!!this.state.formData.signature,verificationStatus:this.state.verificationStatus,lastSaved:((s=this.state.lastSaved)==null?void 0:s.toISOString())||"never",isDirty:this.state.isDirty}}}const J=new Ua;function Ba(){const[t,s]=r.useState(()=>J.getState());r.useEffect(()=>{const x=J.initialize();return s(x),J.subscribe(b=>{s(b)})},[]);const n=r.useCallback(x=>{J.updateFormData(x)},[]),i=r.useCallback((x,m)=>{J.updateField(x,m)},[]),o=r.useCallback(x=>{J.setOccupants(x)},[]),a=r.useCallback(x=>{J.addOccupant(x)},[]),d=r.useCallback(x=>{J.removeOccupant(x)},[]),p=r.useCallback((x,m,b)=>{J.updateOccupant(x,m,b)},[]),c=r.useCallback((x,m)=>{J.updateVerificationStatus(x,m)},[]),g=r.useCallback(()=>J.saveDraft(),[]),u=r.useCallback(()=>{J.reset()},[]),j=r.useCallback((x,m,b)=>{J.loadFromDatabase(x,m,b)},[]),l=r.useCallback(()=>J.getDebugSummary(),[]);return{formData:t.formData,occupants:t.occupants,verificationStatus:t.verificationStatus,lastSaved:t.lastSaved,isDirty:t.isDirty,updateFormData:n,updateField:i,setOccupants:o,addOccupant:a,removeOccupant:d,updateOccupant:p,updateVerificationStatus:c,saveDraft:g,reset:u,loadFromDatabase:j,getDebugSummary:l}}function Je(t){return t===!0?"yes":t===!1?"no":""}function mt(t){return t==null?"":String(t)}function Va(t){return!t||typeof t!="object"?"":t.address||""}function $a(t){return!Array.isArray(t)||t.length===0?"":t[0]||""}function Wa(t){const s=t;let n="",i="";s["employment status"]==="full-time"||s["employment status"]==="part-time"?n=mt(s["Monthly Income"]):(s["employment status"]==="business-owner"||s["employment status"]==="self-employed")&&(i=mt(s["Monthly Income"]));const o={fullName:s.name||"",dob:s.DOB||"",email:s.email||"",phone:s["phone number"]||"",currentAddress:Va(s["permanent address"]),apartmentUnit:s["apartment number"]||"",lengthResided:s["length resided"]||"",renting:Je(s.renting),employmentStatus:s["employment status"]||"",employerName:s["employer name"]||"",employerPhone:s["employer phone number"]||"",jobTitle:s["job title"]||"",monthlyIncome:n,businessName:s["business legal name"]||"",businessYear:mt(s["year business was created?"]),businessState:s["state business registered"]||"",monthlyIncomeSelf:i,hasPets:Je(s.pets),isSmoker:Je(s.smoking),needsParking:Je(s.parking),references:$a(s.references),signature:s["signature (text)"]||s.signature||"",proofOfEmploymentUrl:s["proof of employment"]||"",alternateGuaranteeUrl:s["alternate guarantee"]||"",creditScoreUrl:s["credit score"]||"",stateIdFrontUrl:s["State ID - Front"]||"",stateIdBackUrl:s["State ID - Back"]||"",governmentIdUrl:s["government ID"]||""},a=Array.isArray(s["occupants list"])?s["occupants list"]:[];return{formData:o,occupants:a}}const Lt=["fullName","dob","email","phone","currentAddress","lengthResided","employmentStatus","signature"],ze={"full-time":["employerName","jobTitle","monthlyIncome"],"part-time":["employerName","jobTitle","monthlyIncome"],intern:["employerName","jobTitle","monthlyIncome"],"business-owner":["businessName"]},pt={1:["fullName","dob","email","phone"],2:["currentAddress","lengthResided"],3:[],4:["employmentStatus"],5:[],6:[],7:["signature"]},Da=[{value:"",label:"Select relationship"},{value:"spouse",label:"Spouse"},{value:"partner",label:"Partner"},{value:"child",label:"Child"},{value:"parent",label:"Parent"},{value:"sibling",label:"Sibling"},{value:"brother-sister",label:"Brother/Sister"},{value:"family-member",label:"Family Member"},{value:"roommate",label:"Roommate"},{value:"other",label:"Other"}],qa=[{value:"",label:"Select employment status"},{value:"full-time",label:"Full-time Employee"},{value:"part-time",label:"Part-time Employee"},{value:"business-owner",label:"Business Owner"},{value:"intern",label:"Intern"},{value:"student",label:"Student"},{value:"unemployed",label:"Unemployed"},{value:"other",label:"Other"}],Ft=6,Qe=7,Xe=Object.freeze([1,2,3,4,5,6,7]),Mt={employmentProof:{urlField:"proofOfEmploymentUrl",backendType:"employmentProof"},alternateGuarantee:{urlField:"alternateGuaranteeUrl",backendType:"alternateGuarantee"},creditScore:{urlField:"creditScoreUrl",backendType:"creditScore"},stateIdFront:{urlField:"stateIdFrontUrl",backendType:"stateIdFront"},stateIdBack:{urlField:"stateIdBackUrl",backendType:"stateIdBack"},governmentId:{urlField:"governmentIdUrl",backendType:"governmentId"}},Ga=10*1024*1024,Ya=["image/jpeg","image/png","image/webp","application/pdf"];async function Ha(t){if(t)try{const{data:s,error:n}=await R.from("proposal").select("_id, Status").eq("Guest",t).eq("Status",St.SUGGESTED_PROPOSAL_AWAITING_RENTAL_APP.key);if(n){console.error("[RentalAppWizard] Error fetching proposals for transition:",n);return}if(!s||s.length===0){console.log("[RentalAppWizard] No SL proposals to transition");return}const i=s.map(a=>a._id);console.log(`[RentalAppWizard] Transitioning ${i.length} SL proposal(s) to Host Review`);const{error:o}=await R.from("proposal").update({Status:St.HOST_REVIEW.key,"Modified Date":new Date().toISOString()}).in("_id",i);o?console.error("[RentalAppWizard] Error transitioning proposals:",o):console.log("[RentalAppWizard] Successfully transitioned proposals to Host Review")}catch(s){console.error("[RentalAppWizard] Error in proposal transition:",s)}}function Ja({onClose:t,onSuccess:s,applicationStatus:n="not_started",userProfileData:i=null}){var qe;const o=Ba(),{formData:a,occupants:d,verificationStatus:p,updateFormData:c,updateField:g,addOccupant:u,removeOccupant:j,updateOccupant:l,reset:x,loadFromDatabase:m}=o,[b,k]=r.useState(1),[z,P]=r.useState(()=>n==="submitted"?Xe:[]),[E,W]=r.useState(()=>n==="submitted"?Xe:[1]),F=r.useRef(n==="submitted"),[B,ee]=r.useState({}),[K,Q]=r.useState({}),[O,D]=r.useState({}),[X,ue]=r.useState({}),[re,oe]=r.useState({}),[le,Le]=r.useState(!1),[Fe,Ce]=r.useState(null),[ye,Me]=r.useState(!1),[be,Oe]=r.useState(null),me=r.useRef(!1),Ie=r.useRef(null),ae=r.useRef(null),xe=r.useRef(!1);r.useEffect(()=>{if(xe.current||n==="submitted"||!(a.fullName||a.email||a.phone||a.dob))return;const v=a.fullName&&a.dob&&a.email&&a.phone,w=a.currentAddress&&a.lengthResided&&a.renting,A=a.employmentStatus&&(a.employmentStatus==="student"||a.employmentStatus==="unemployed"||a.employmentStatus==="other"||["full-time","part-time","intern"].includes(a.employmentStatus)&&a.employerName&&a.employerPhone&&a.jobTitle&&a.monthlyIncome||a.employmentStatus==="business-owner"&&a.businessName&&a.businessYear&&a.businessState);let C=1;v&&(C=2,w&&(C=3,A?C=5:C=4));const V=[];for(let H=1;H<C;H++)V.push(H);C>1&&(k(C),V.length>0&&W(V)),xe.current=!0},[n,a.fullName,a.dob,a.email,a.phone,a.currentAddress,a.lengthResided,a.renting,a.employmentStatus,a.employerName,a.employerPhone,a.jobTitle,a.monthlyIncome,a.businessName,a.businessYear,a.businessState]),r.useEffect(()=>{if(n!=="submitted"||me.current)return;(async()=>{Me(!0),Oe(null);try{const v=Pe();if(!v)throw new Error("User not logged in");const{data:{session:w}}=await R.auth.getSession(),A=w==null?void 0:w.access_token,C=await fetch("https://qcfifybkaddcoimjroca.supabase.co/functions/v1/rental-application",{method:"POST",headers:{"Content-Type":"application/json",...A?{Authorization:`Bearer ${A}`}:{}},body:JSON.stringify({action:"get",payload:{user_id:v}})}),V=await C.json();if(!C.ok||!V.success)throw new Error(V.error||"Failed to load application");if(V.data){const{formData:H,occupants:we,completedSteps:Ae,lastStep:ce}=Wa(V.data,(i==null?void 0:i.email)||"");m(H,we),W(Xe),P(Xe),ce&&k(ce),me.current=!0}}catch(v){console.error("Error loading rental application from database:",v),Oe(v.message||"Failed to load your application")}finally{Me(!1)}})()},[n,m]);const ve=r.useRef(!1);r.useEffect(()=>{if(n==="submitted"||ve.current||!i)return;const f=[i.firstName,i.lastName].filter(Boolean).join(" ").trim(),v={};if(f&&!a.fullName&&(v.fullName=f),i.email&&!a.email&&(v.email=i.email),i.phone&&!a.phone&&(v.phone=i.phone),i.dob&&!a.dob){const w=String(i.dob);v.dob=w.split(/[T\s]/)[0]}Object.keys(v).length>0&&c(v),ve.current=!0},[n,i,a.fullName,a.email,a.phone,a.dob,c]),r.useEffect(()=>{ae.current!==null||!i||(ae.current={phone:!i.phone,dob:!i.dob},console.log("[RentalAppWizard] Empty user profile fields tracked:",ae.current))},[i]);const Ue=r.useCallback(async(f,v)=>{if(!ae.current||!ae.current[f]||!v||typeof v=="string"&&!v.trim())return;const w=Pe();if(!w){console.warn("[RentalAppWizard] Cannot sync to user table: no user ID");return}const C={phone:"Phone Number (as text)",dob:"Date of Birth"}[f];if(C)try{const V={[C]:v,"Modified Date":new Date().toISOString()},{error:H}=await R.from("user").update(V).eq("_id",w);H?console.error("[RentalAppWizard] Failed to sync field to user table:",H):(console.log(`[RentalAppWizard] Synced ${f} to user table`),ae.current[f]=!1)}catch(V){console.error("[RentalAppWizard] Error syncing to user table:",V)}},[]),je=r.useCallback(()=>{const f=a.employmentStatus;let v=[...Lt];f&&ze[f]&&(v=[...v,...ze[f]]);let w=0;return v.forEach(A=>{const C=a[A];C!=null&&C!==""&&w++}),Math.round(w/v.length*100)},[a])(),q=je>=80&&((qe=a.signature)==null?void 0:qe.trim()),Be=r.useRef(b);r.useEffect(()=>{if(n==="submitted"||F.current)return;const f=Be.current;f!==b&&!E.includes(f)&&W(v=>[...v,f]),Be.current=b},[b,E,n]);const te=r.useCallback((f,v)=>{let w=[...pt[f]];if(f===4&&a.employmentStatus){const A=ze[a.employmentStatus]||[];w=[...w,...A]}return w.length===0?v.includes(f):w.every(A=>{const C=a[A];return C!=null&&C!==""})},[a]);r.useEffect(()=>{if(n==="submitted"||F.current)return;const f=[];for(let v=1;v<=Qe;v++)te(v,E)&&f.push(v);P(v=>v.length===f.length&&v.every((A,C)=>A===f[C])?v:f)},[a,E,te,n]);const pe=r.useCallback(f=>z.includes(f),[z]),Ne=r.useCallback(()=>{let f=[...pt[b]];if(b===4&&a.employmentStatus){const v=ze[a.employmentStatus]||[];f=[...f,...v]}return f.length===0?!0:f.every(v=>{const w=a[v];return w!=null&&w!==""})},[b,a]),Ze=r.useCallback(()=>pt[b].length===0,[b]),et=r.useCallback(f=>{f>=1&&f<=Qe&&k(f)},[]),tt=r.useCallback(()=>{b<Qe&&k(f=>f+1)},[b]),st=r.useCallback(()=>{b>1&&k(f=>f-1)},[b]),Ve=r.useCallback((f,v)=>{const w=typeof v=="string"?v.trim():v,A=Lt.includes(f)||(ze[a.employmentStatus]||[]).includes(f);if(!w&&!A)return{isValid:!0,error:null};let C=!1;switch(f){case"email":C=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(w);break;case"phone":case"employerPhone":C=w.length>=10;break;case"dob":C=w!==""&&!isNaN(Date.parse(w));break;case"monthlyIncome":case"monthlyIncomeSelf":case"businessYear":C=w!==""&&!isNaN(parseFloat(w));break;default:C=w.length>0}return{isValid:C,error:C?null:`Invalid ${f}`}},[a.employmentStatus]),$e=r.useCallback((f,v)=>{g(f,v),ue(w=>{const A={...w};return delete A[f],A})},[g]),Z=r.useCallback(f=>{const v=a[f],w=Ve(f,v);w.isValid?(oe(A=>({...A,[f]:!0})),(f==="phone"||f==="dob")&&v&&Ue(f,v)):w.error&&ue(A=>({...A,[f]:w.error}))},[a,Ve,Ue]),We=r.useCallback(()=>{d.length>=Ft||u({id:`occupant-${Date.now()}`,name:"",relationship:""})},[d.length,u]),at=r.useCallback(f=>{j(f)},[j]),nt=r.useCallback((f,v,w)=>{l(f,v,w)},[l]),it=r.useCallback(async(f,v)=>{const w=v[0];if(w){if(w.size>Ga){D(A=>({...A,[f]:"File too large. Maximum size is 10MB."}));return}if(!Ya.includes(w.type)){D(A=>({...A,[f]:"Invalid file type. Please upload JPEG, PNG, WebP, or PDF."}));return}D(A=>{const C={...A};return delete C[f],C}),Q(A=>({...A,[f]:"uploading"}));try{const A=await new Promise((ne,Se)=>{const ke=new FileReader;ke.onload=()=>ne(ke.result.split(",")[1]),ke.onerror=Se,ke.readAsDataURL(w)}),C=Pe(),V=Mt[f],{data:{session:H}}=await R.auth.getSession(),we=H==null?void 0:H.access_token,Ae=await fetch("https://qcfifybkaddcoimjroca.supabase.co/functions/v1/rental-application",{method:"POST",headers:{"Content-Type":"application/json",...we?{Authorization:`Bearer ${we}`}:{}},body:JSON.stringify({action:"upload",payload:{user_id:C,fileType:V.backendType,fileName:w.name,fileData:A,mimeType:w.type}})}),ce=await Ae.json();if(!Ae.ok||!ce.success)throw new Error(ce.error||"Upload failed");ee(ne=>({...ne,[f]:w})),c({[V.urlField]:ce.data.url}),Q(ne=>({...ne,[f]:"complete"})),setTimeout(()=>{Q(ne=>{const Se={...ne};return delete Se[f],Se})},2e3)}catch(A){console.error("Upload error:",A),D(C=>({...C,[f]:A.message||"Upload failed. Please try again."})),Q(C=>{const V={...C};return delete V[f],V})}}},[c]),rt=r.useCallback(f=>{const v=Mt[f];v&&c({[v.urlField]:""}),ee(w=>{const A={...w};return delete A[f],A})},[c]),De=r.useCallback(async()=>{if(!q){Ce("Please complete at least 80% of the application and sign.");return}Le(!0),Ce(null);try{const f=Pe();if(!f)throw new Error("You must be logged in to submit.");const{data:{session:v}}=await R.auth.getSession(),w=v==null?void 0:v.access_token,A=await fetch("https://qcfifybkaddcoimjroca.supabase.co/functions/v1/rental-application",{method:"POST",headers:{"Content-Type":"application/json",...w?{Authorization:`Bearer ${w}`}:{}},body:JSON.stringify({action:"submit",payload:{...a,occupants:d,verificationStatus:p,user_id:f}})}),C=await A.json();if(!A.ok||!C.success)throw new Error(C.error||"Submission failed");await Ha(f),x(),s==null||s(),t==null||t()}catch(f){console.error("Submit error:",f),Ce(f.message||"Submission failed. Please try again.")}finally{Le(!1)}},[q,a,d,p,x,s,t]);return{formData:a,occupants:d,verificationStatus:p,currentStep:b,completedSteps:z,totalSteps:Qe,progress:je,canSubmit:q,goToStep:et,goToNextStep:tt,goToPreviousStep:st,isStepComplete:pe,canProceedFromCurrentStep:Ne,isCurrentStepOptional:Ze,handleInputChange:$e,handleInputBlur:Z,fieldErrors:X,fieldValid:re,addOccupant:We,removeOccupant:at,updateOccupant:nt,maxOccupants:Ft,handleFileUpload:it,handleFileRemove:rt,uploadedFiles:B,uploadProgress:K,uploadErrors:O,handleSubmit:De,isSubmitting:le,submitError:Fe,isLoadingFromDb:ye,loadError:be,relationshipOptions:Da,employmentStatusOptions:qa,addressInputRef:Ie}}const Qa=[{short:"Personal",full:"Personal Info"},{short:"Address",full:"Current Address"},{short:"Occupants",full:"Occupants"},{short:"Work",full:"Employment"},{short:"Details",full:"Requirements"},{short:"Docs",full:"Documents"},{short:"Review",full:"Review & Sign"}];function Xa({currentStep:t=1,completedSteps:s=[],onStepClick:n,disabled:i=!1}){const o=d=>{i||n==null||n(d)},a=(d,p)=>{i||(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),n==null||n(p))};return e.jsx("div",{className:"step-indicator",children:e.jsx("div",{className:"step-indicator__track",children:Qa.map((d,p)=>{const c=p+1,g=s.includes(c),u=t===c,j=!g&&!u;return e.jsxs(Ut.Fragment,{children:[p>0&&e.jsx("div",{className:`step-indicator__connector ${s.includes(c)||t>=c?"step-indicator__connector--filled":""}`}),e.jsxs("div",{className:`step-indicator__step ${u?"step-indicator__step--active":""} ${g?"step-indicator__step--completed":""} ${j?"step-indicator__step--pending":""}`,onClick:()=>o(c),onKeyDown:l=>a(l,c),role:"button",tabIndex:i?-1:0,"aria-label":`${d.full}${g?" (completed)":""}${u?" (current)":""}`,"aria-current":u?"step":void 0,children:[e.jsx("div",{className:"step-indicator__dot",children:g?e.jsx(ge,{size:14,strokeWidth:3}):e.jsx("span",{children:c})}),e.jsx("span",{className:"step-indicator__label",title:d.full,children:d.short})]})]},c)})})})}function Ka({formData:t,fieldErrors:s,fieldValid:n,onFieldChange:i,onFieldBlur:o}){return e.jsxs("div",{className:"wizard-step personal-info-step",children:[e.jsx("p",{className:"wizard-step__intro",children:"Let's start with some basic information about you."}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsxs("label",{htmlFor:"fullName",className:"wizard-label",children:["Full Legal Name ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"fullName",className:`wizard-input ${s.fullName?"wizard-input--error":""} ${n.fullName?"wizard-input--valid":""}`,value:t.fullName||"",onChange:a=>i("fullName",a.target.value),onBlur:()=>o("fullName"),placeholder:"Enter your full legal name"}),s.fullName&&e.jsx("span",{className:"wizard-error",children:s.fullName})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsxs("label",{htmlFor:"dob",className:"wizard-label",children:["Date of Birth ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"date",id:"dob",className:`wizard-input ${s.dob?"wizard-input--error":""} ${n.dob?"wizard-input--valid":""}`,value:t.dob||"",onChange:a=>i("dob",a.target.value),onBlur:()=>o("dob")}),s.dob&&e.jsx("span",{className:"wizard-error",children:s.dob})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsxs("label",{htmlFor:"email",className:"wizard-label",children:["Email Address ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"email",id:"email",className:`wizard-input ${s.email?"wizard-input--error":""} ${n.email?"wizard-input--valid":""}`,value:t.email||"",onChange:a=>i("email",a.target.value),onBlur:()=>o("email"),placeholder:"you@example.com"}),s.email&&e.jsx("span",{className:"wizard-error",children:s.email})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsxs("label",{htmlFor:"phone",className:"wizard-label",children:["Phone Number ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"tel",id:"phone",className:`wizard-input ${s.phone?"wizard-input--error":""} ${n.phone?"wizard-input--valid":""}`,value:t.phone||"",onChange:a=>i("phone",a.target.value),onBlur:()=>o("phone"),placeholder:"(555) 123-4567"}),s.phone&&e.jsx("span",{className:"wizard-error",children:s.phone})]})]})}function Za({formData:t,fieldErrors:s,fieldValid:n,onFieldChange:i,onFieldBlur:o,addressInputRef:a}){const d=r.useRef(null),p=r.useRef(i);return r.useEffect(()=>{p.current=i},[i]),r.useEffect(()=>{if(d.current){console.log("[RentalAppWizard] Autocomplete already initialized, skipping");return}let c=0;const g=50;let u=null;const j=()=>{if(!window.google||!window.google.maps||!window.google.maps.places){c++,c<g?u=setTimeout(j,100):console.error("[RentalAppWizard] Google Maps API failed to load after 5 seconds");return}if(!(a!=null&&a.current)){c++,c<g&&(u=setTimeout(j,100));return}try{console.log("[RentalAppWizard] Initializing Google Maps Autocomplete..."),console.log("[RentalAppWizard] Input element:",a.current);const l=new window.google.maps.places.Autocomplete(a.current,{types:["address"],componentRestrictions:{country:"us"},fields:["address_components","formatted_address","geometry","place_id"]});console.log("[RentalAppWizard] Google Maps Autocomplete initialized (US addresses)"),console.log("[RentalAppWizard] Autocomplete instance:",l),window.google.maps.event.addDomListener(a.current,"keydown",m=>{m.key==="Enter"&&m.preventDefault()}),d.current=l;const x=l.addListener("place_changed",()=>{var b;console.log("[RentalAppWizard] place_changed event fired!");const m=l.getPlace();if(console.log("[RentalAppWizard] Place object:",m),console.log("[RentalAppWizard] Place place_id:",m==null?void 0:m.place_id),console.log("[RentalAppWizard] Place formatted_address:",m==null?void 0:m.formatted_address),!m||!m.place_id){console.log("[RentalAppWizard] No place_id - user may not have selected from dropdown");const k=(b=a.current)==null?void 0:b.value;console.log("[RentalAppWizard] Current input value:",k);return}if(!m.formatted_address){console.error("[RentalAppWizard] Invalid place selected - no formatted_address");return}console.log("[RentalAppWizard] Calling onFieldChange with:",m.formatted_address),p.current("currentAddress",m.formatted_address),console.log("[RentalAppWizard] Address updated successfully:",m.formatted_address)});console.log("[RentalAppWizard] place_changed listener attached")}catch(l){console.error("[RentalAppWizard] Error initializing Google Maps Autocomplete:",l)}};return j(),()=>{u&&clearTimeout(u),d.current&&window.google&&window.google.maps&&(console.log("[RentalAppWizard] Cleaning up autocomplete listeners"),window.google.maps.event.clearInstanceListeners(d.current),d.current=null)}},[a]),e.jsxs("div",{className:"wizard-step address-step",children:[e.jsx("p",{className:"wizard-step__intro",children:"Where do you currently live?"}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsxs("label",{htmlFor:"currentAddress",className:"wizard-label",children:["Current Address ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"currentAddress",ref:a,className:`wizard-input ${s.currentAddress?"wizard-input--error":""} ${n.currentAddress?"wizard-input--valid":""}`,value:t.currentAddress||"",onChange:c=>i("currentAddress",c.target.value),onBlur:()=>o("currentAddress"),placeholder:"Start typing your address..."}),s.currentAddress&&e.jsx("span",{className:"wizard-error",children:s.currentAddress})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsx("label",{htmlFor:"apartmentUnit",className:"wizard-label",children:"Apartment/Unit Number"}),e.jsx("input",{type:"text",id:"apartmentUnit",className:"wizard-input",value:t.apartmentUnit||"",onChange:c=>i("apartmentUnit",c.target.value),placeholder:"Apt 4B (optional)"})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsxs("label",{htmlFor:"lengthResided",className:"wizard-label",children:["How long have you lived here? ",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("select",{id:"lengthResided",className:`wizard-select ${s.lengthResided?"wizard-input--error":""} ${n.lengthResided?"wizard-input--valid":""}`,value:t.lengthResided||"",onChange:c=>i("lengthResided",c.target.value),onBlur:()=>o("lengthResided"),children:[e.jsx("option",{value:"",children:"Select duration"}),e.jsx("option",{value:"less-than-1-year",children:"Less than 1 year"}),e.jsx("option",{value:"1-2-years",children:"1-2 years"}),e.jsx("option",{value:"2-5-years",children:"2-5 years"}),e.jsx("option",{value:"5-plus-years",children:"5+ years"})]}),s.lengthResided&&e.jsx("span",{className:"wizard-error",children:s.lengthResided})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsx("label",{htmlFor:"renting",className:"wizard-label",children:"Are you currently renting?"}),e.jsxs("select",{id:"renting",className:"wizard-select",value:t.renting||"",onChange:c=>i("renting",c.target.value),children:[e.jsx("option",{value:"",children:"Select an option (optional)"}),e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"no",children:"No"})]})]})]})}function en({occupants:t,onAddOccupant:s,onRemoveOccupant:n,onUpdateOccupant:i,maxOccupants:o,relationshipOptions:a}){const d=t.length<o;return e.jsxs("div",{className:"wizard-step occupants-step",children:[e.jsx("p",{className:"wizard-step__intro",children:"Will anyone else be staying with you? Add their information below. This step is optional."}),t.length===0?e.jsxs("div",{className:"wizard-empty-state",children:[e.jsx("p",{children:"No additional occupants added yet."}),e.jsxs("button",{type:"button",className:"wizard-btn wizard-btn--secondary",onClick:s,children:[e.jsx(kt,{size:16}),"Add Occupant"]})]}):e.jsxs("div",{className:"occupants-list",children:[t.map((p,c)=>e.jsxs("div",{className:"occupant-card",children:[e.jsxs("div",{className:"occupant-card__header",children:[e.jsxs("span",{className:"occupant-card__number",children:["Occupant ",c+1]}),e.jsx("button",{type:"button",className:"occupant-card__remove",onClick:()=>n(p.id),"aria-label":"Remove occupant",children:e.jsx(Cs,{size:16})})]}),e.jsxs("div",{className:"occupant-card__fields",children:[e.jsxs("div",{className:"wizard-form-group",children:[e.jsx("label",{className:"wizard-label",children:"Full Name"}),e.jsx("input",{type:"text",className:"wizard-input",value:p.name||"",onChange:g=>i(p.id,"name",g.target.value),placeholder:"Enter name"})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsx("label",{className:"wizard-label",children:"Relationship"}),e.jsx("select",{className:"wizard-select",value:p.relationship||"",onChange:g=>i(p.id,"relationship",g.target.value),children:a.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))})]})]})]},p.id)),d&&e.jsxs("button",{type:"button",className:"wizard-btn wizard-btn--secondary wizard-btn--full",onClick:s,children:[e.jsx(kt,{size:16}),"Add Another Occupant"]}),!d&&e.jsxs("p",{className:"wizard-hint",children:["Maximum of ",o," occupants reached."]})]})]})}function tn({formData:t,fieldErrors:s,fieldValid:n,onFieldChange:i,onFieldBlur:o,employmentStatusOptions:a}){const d=t.employmentStatus,p=["full-time","part-time","intern"].includes(d),c=d==="business-owner",g=["student","unemployed","other"].includes(d);return e.jsxs("div",{className:"wizard-step employment-step",children:[e.jsx("p",{className:"wizard-step__intro",children:"Tell us about your employment situation."}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsxs("label",{htmlFor:"employmentStatus",className:"wizard-label",children:["Employment Status ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("select",{id:"employmentStatus",className:`wizard-select ${s.employmentStatus?"wizard-input--error":""}`,value:d||"",onChange:u=>i("employmentStatus",u.target.value),onBlur:()=>o("employmentStatus"),children:a.map(u=>e.jsx("option",{value:u.value,children:u.label},u.value))}),s.employmentStatus&&e.jsx("span",{className:"wizard-error",children:s.employmentStatus})]}),p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"wizard-form-group",children:[e.jsxs("label",{htmlFor:"employerName",className:"wizard-label",children:["Employer Name ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"employerName",className:`wizard-input ${s.employerName?"wizard-input--error":""}`,value:t.employerName||"",onChange:u=>i("employerName",u.target.value),onBlur:()=>o("employerName"),placeholder:"Company name"}),s.employerName&&e.jsx("span",{className:"wizard-error",children:s.employerName})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsx("label",{htmlFor:"employerPhone",className:"wizard-label",children:"Employer Phone"}),e.jsx("input",{type:"tel",id:"employerPhone",className:"wizard-input",value:t.employerPhone||"",onChange:u=>i("employerPhone",u.target.value),placeholder:"(555) 123-4567 (optional)"})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsxs("label",{htmlFor:"jobTitle",className:"wizard-label",children:["Job Title ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"jobTitle",className:`wizard-input ${s.jobTitle?"wizard-input--error":""}`,value:t.jobTitle||"",onChange:u=>i("jobTitle",u.target.value),onBlur:()=>o("jobTitle"),placeholder:"Your position"}),s.jobTitle&&e.jsx("span",{className:"wizard-error",children:s.jobTitle})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsxs("label",{htmlFor:"monthlyIncome",className:"wizard-label",children:["Monthly Income ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"number",id:"monthlyIncome",className:`wizard-input ${s.monthlyIncome?"wizard-input--error":""}`,value:t.monthlyIncome||"",onChange:u=>i("monthlyIncome",u.target.value),onBlur:()=>o("monthlyIncome"),placeholder:"5000",min:"0"}),s.monthlyIncome&&e.jsx("span",{className:"wizard-error",children:s.monthlyIncome})]})]}),c&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"wizard-form-group",children:[e.jsxs("label",{htmlFor:"businessName",className:"wizard-label",children:["Business Name ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"businessName",className:`wizard-input ${s.businessName?"wizard-input--error":""}`,value:t.businessName||"",onChange:u=>i("businessName",u.target.value),onBlur:()=>o("businessName"),placeholder:"Your business name"}),s.businessName&&e.jsx("span",{className:"wizard-error",children:s.businessName})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsx("label",{htmlFor:"businessYear",className:"wizard-label",children:"Year Established"}),e.jsx("input",{type:"number",id:"businessYear",className:"wizard-input",value:t.businessYear||"",onChange:u=>i("businessYear",u.target.value),placeholder:"2020 (optional)",min:"1900",max:new Date().getFullYear()})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsx("label",{htmlFor:"businessState",className:"wizard-label",children:"State Registered"}),e.jsx("input",{type:"text",id:"businessState",className:"wizard-input",value:t.businessState||"",onChange:u=>i("businessState",u.target.value),placeholder:"e.g., New York (optional)"})]})]}),g&&e.jsxs("div",{className:"wizard-form-group",children:[e.jsx("label",{htmlFor:"alternateIncome",className:"wizard-label",children:"Alternate Source of Income"}),e.jsx("textarea",{id:"alternateIncome",className:"wizard-textarea",value:t.alternateIncome||"",onChange:u=>i("alternateIncome",u.target.value),placeholder:"Describe any other sources of income (savings, family support, etc.)",rows:3}),e.jsx("p",{className:"wizard-hint",children:"You can upload supporting documents in the Documents step."})]})]})}function sn({formData:t,onFieldChange:s}){return e.jsxs("div",{className:"wizard-step requirements-step",children:[e.jsx("p",{className:"wizard-step__intro",children:"Help hosts understand your needs. All fields are optional."}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsx("label",{htmlFor:"hasPets",className:"wizard-label",children:"Do you have any pets?"}),e.jsxs("select",{id:"hasPets",className:"wizard-select",value:t.hasPets||"",onChange:n=>s("hasPets",n.target.value),children:[e.jsx("option",{value:"",children:"Select an option"}),e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"no",children:"No"})]})]}),t.hasPets==="yes"&&e.jsxs("div",{className:"wizard-form-group",children:[e.jsx("label",{htmlFor:"petDetails",className:"wizard-label",children:"Pet Details"}),e.jsx("textarea",{id:"petDetails",className:"wizard-textarea",value:t.petDetails||"",onChange:n=>s("petDetails",n.target.value),placeholder:"Type, breed, weight, etc.",rows:2})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsx("label",{htmlFor:"isSmoker",className:"wizard-label",children:"Do you smoke?"}),e.jsxs("select",{id:"isSmoker",className:"wizard-select",value:t.isSmoker||"",onChange:n=>s("isSmoker",n.target.value),children:[e.jsx("option",{value:"",children:"Select an option"}),e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"no",children:"No"})]})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsx("label",{htmlFor:"needsParking",className:"wizard-label",children:"Do you need parking?"}),e.jsxs("select",{id:"needsParking",className:"wizard-select",value:t.needsParking||"",onChange:n=>s("needsParking",n.target.value),children:[e.jsx("option",{value:"",children:"Select an option"}),e.jsx("option",{value:"yes",children:"Yes"}),e.jsx("option",{value:"no",children:"No"})]})]}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsx("label",{htmlFor:"references",className:"wizard-label",children:"References"}),e.jsx("textarea",{id:"references",className:"wizard-textarea",value:t.references||"",onChange:n=>s("references",n.target.value),placeholder:"Previous landlord, employer, or personal references with contact information",rows:4}),e.jsx("p",{className:"wizard-hint",children:"Providing references can help hosts trust you faster."})]})]})}function Ke({label:t,hint:s,uploadKey:n,formData:i,urlField:o,uploadedFiles:a,uploadProgress:d,uploadErrors:p,onFileUpload:c,onFileRemove:g}){const u=i[o],j=a[n],l=d[n]==="uploading",x=d[n]==="complete",m=p[n],b=k=>{var z;(z=k.target.files)!=null&&z.length&&c(n,k.target.files)};return e.jsxs("div",{className:"file-upload-box",children:[e.jsx("label",{className:"wizard-label",children:t}),s&&e.jsx("p",{className:"wizard-hint",children:s}),u||j?e.jsxs("div",{className:"file-upload-box__preview",children:[u?e.jsxs("a",{href:u,target:"_blank",rel:"noopener noreferrer",className:"file-upload-box__file file-upload-box__file--link",children:[e.jsx(Re,{size:20}),e.jsx("span",{children:(j==null?void 0:j.name)||"View uploaded file"}),(x||u)&&e.jsx(ge,{size:16,className:"file-upload-box__check"})]}):e.jsxs("div",{className:"file-upload-box__file",children:[e.jsx(Re,{size:20}),e.jsx("span",{children:(j==null?void 0:j.name)||"Uploaded file"}),x&&e.jsx(ge,{size:16,className:"file-upload-box__check"})]}),e.jsx("button",{type:"button",className:"file-upload-box__remove",onClick:()=>g(n),"aria-label":"Remove file",children:e.jsx($t,{size:16})})]}):e.jsxs("div",{className:`file-upload-box__dropzone ${l?"file-upload-box__dropzone--uploading":""}`,children:[e.jsx("input",{type:"file",accept:"image/jpeg,image/png,image/webp,application/pdf",onChange:b,disabled:l}),l?e.jsxs("div",{className:"file-upload-box__uploading",children:[e.jsx("div",{className:"spinner"}),e.jsx("span",{children:"Uploading..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(qs,{size:24}),e.jsx("span",{children:"Click to upload"}),e.jsx("span",{className:"file-upload-box__formats",children:"JPEG, PNG, WebP, or PDF (max 10MB)"})]})]}),m&&e.jsx("span",{className:"wizard-error",children:m})]})}function an({formData:t,uploadedFiles:s,uploadProgress:n,uploadErrors:i,onFileUpload:o,onFileRemove:a}){const d=t.employmentStatus,p=["full-time","part-time","intern"].includes(d),c=["student","unemployed","other","business-owner"].includes(d);return e.jsxs("div",{className:"wizard-step documents-step",children:[e.jsx("p",{className:"wizard-step__intro",children:"Upload supporting documents. All uploads are optional but help verify your application."}),p&&e.jsx(Ke,{label:"Proof of Employment",hint:"Pay stub, employment letter, or offer letter",uploadKey:"employmentProof",urlField:"proofOfEmploymentUrl",formData:t,uploadedFiles:s,uploadProgress:n,uploadErrors:i,onFileUpload:o,onFileRemove:a}),c&&e.jsx(Ke,{label:"Alternate Financial Guarantee",hint:"Bank statement, sponsor letter, or other financial proof",uploadKey:"alternateGuarantee",urlField:"alternateGuaranteeUrl",formData:t,uploadedFiles:s,uploadProgress:n,uploadErrors:i,onFileUpload:o,onFileRemove:a}),e.jsx(Ke,{label:"Credit Score Screenshot",hint:"Screenshot from Credit Karma, Experian, or similar",uploadKey:"creditScore",urlField:"creditScoreUrl",formData:t,uploadedFiles:s,uploadProgress:n,uploadErrors:i,onFileUpload:o,onFileRemove:a}),e.jsx(Ke,{label:"Government ID (Front)",hint:"Driver's license, state ID, or passport",uploadKey:"stateIdFront",urlField:"stateIdFrontUrl",formData:t,uploadedFiles:s,uploadProgress:n,uploadErrors:i,onFileUpload:o,onFileRemove:a})]})}function Ee({title:t,children:s,onEdit:n,stepNumber:i}){return e.jsxs("div",{className:"review-section",children:[e.jsxs("div",{className:"review-section__header",children:[e.jsx("h4",{className:"review-section__title",children:t}),e.jsxs("button",{type:"button",className:"review-section__edit",onClick:()=>n(i),children:[e.jsx(Fs,{size:14}),"Edit"]})]}),e.jsx("div",{className:"review-section__content",children:s})]})}function G({label:t,value:s,fallback:n="Not provided"}){return e.jsxs("div",{className:"review-field",children:[e.jsx("span",{className:"review-field__label",children:t}),e.jsx("span",{className:"review-field__value",children:s||n})]})}function nn({formData:t,occupants:s,fieldErrors:n,onFieldChange:i,onFieldBlur:o,onGoToStep:a,progress:d,canSubmit:p}){const c=u=>u?new Date(u).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"Not provided",g=u=>u?u==="yes"?"Yes":"No":"Not specified";return e.jsxs("div",{className:"wizard-step review-step",children:[e.jsxs("div",{className:"review-step__progress",children:[e.jsx("div",{className:"review-step__progress-bar",children:e.jsx("div",{className:"review-step__progress-fill",style:{width:`${d}%`}})}),e.jsxs("div",{className:"review-step__progress-info",children:[e.jsxs("span",{className:"review-step__progress-text",children:[d,"% Complete"]}),p?e.jsxs("span",{className:"review-step__ready",children:[e.jsx(ge,{size:14})," Ready to submit"]}):e.jsxs("span",{className:"review-step__incomplete",children:[e.jsx(xt,{size:14})," Complete 80% to submit"]})]})]}),e.jsxs(Ee,{title:"Personal Information",onEdit:a,stepNumber:1,children:[e.jsx(G,{label:"Full Name",value:t.fullName}),e.jsx(G,{label:"Date of Birth",value:c(t.dob)}),e.jsx(G,{label:"Email",value:t.email}),e.jsx(G,{label:"Phone",value:t.phone})]}),e.jsxs(Ee,{title:"Current Address",onEdit:a,stepNumber:2,children:[e.jsx(G,{label:"Address",value:t.currentAddress}),t.apartmentUnit&&e.jsx(G,{label:"Unit",value:t.apartmentUnit}),e.jsx(G,{label:"Length at Address",value:t.lengthResided}),e.jsx(G,{label:"Currently Renting",value:g(t.renting)})]}),s.length>0&&e.jsx(Ee,{title:"Occupants",onEdit:a,stepNumber:3,children:s.map((u,j)=>e.jsx(G,{label:`Occupant ${j+1}`,value:`${u.name||"Name not provided"} (${u.relationship||"Relationship not specified"})`},u.id))}),e.jsxs(Ee,{title:"Employment",onEdit:a,stepNumber:4,children:[e.jsx(G,{label:"Status",value:t.employmentStatus}),t.employerName&&e.jsx(G,{label:"Employer",value:t.employerName}),t.jobTitle&&e.jsx(G,{label:"Position",value:t.jobTitle}),t.businessName&&e.jsx(G,{label:"Business",value:t.businessName})]}),e.jsxs(Ee,{title:"Requirements",onEdit:a,stepNumber:5,children:[e.jsx(G,{label:"Pets",value:g(t.hasPets)}),e.jsx(G,{label:"Smoker",value:g(t.isSmoker)}),e.jsx(G,{label:"Parking",value:g(t.needsParking)})]}),e.jsxs("div",{className:"signature-section",children:[e.jsx("h4",{className:"signature-section__title",children:"Signature"}),e.jsx("p",{className:"signature-section__legal",children:"By signing below, you certify that all information provided in this application is accurate and truthful."}),e.jsxs("div",{className:"wizard-form-group",children:[e.jsxs("label",{htmlFor:"signature",className:"wizard-label",children:["Type your full legal name ",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"signature",className:`wizard-input wizard-input--signature ${n.signature?"wizard-input--error":""}`,value:t.signature||"",onChange:u=>i("signature",u.target.value),onBlur:()=>o("signature"),placeholder:"Your full legal name"}),n.signature&&e.jsx("span",{className:"wizard-error",children:n.signature})]})]})]})}function rn({isOpen:t,onClose:s,onSuccess:n,applicationStatus:i="not_started",userProfileData:o=null}){const a=Ja({onClose:s,onSuccess:n,applicationStatus:i,userProfileData:o});if(r.useEffect(()=>{if(!t)return;const g=document.body.style.overflow,u=document.body.style.paddingRight,j=window.innerWidth-document.documentElement.clientWidth;return document.body.style.overflow="hidden",j>0&&(document.body.style.paddingRight=`${j}px`),()=>{document.body.style.overflow=g,document.body.style.paddingRight=u}},[t]),r.useEffect(()=>{if(!t)return;const g=u=>{u.key==="Escape"&&(s==null||s())};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[t,s]),!t)return null;const d=g=>{g.target===g.currentTarget&&(s==null||s())},p=()=>{const g={formData:a.formData,fieldErrors:a.fieldErrors,fieldValid:a.fieldValid,onFieldChange:a.handleInputChange,onFieldBlur:a.handleInputBlur};switch(a.currentStep){case 1:return e.jsx(Ka,{...g});case 2:return e.jsx(Za,{...g,addressInputRef:a.addressInputRef});case 3:return e.jsx(en,{occupants:a.occupants,onAddOccupant:a.addOccupant,onRemoveOccupant:a.removeOccupant,onUpdateOccupant:a.updateOccupant,maxOccupants:a.maxOccupants,relationshipOptions:a.relationshipOptions});case 4:return e.jsx(tn,{...g,employmentStatusOptions:a.employmentStatusOptions});case 5:return e.jsx(sn,{...g});case 6:return e.jsx(an,{formData:a.formData,uploadedFiles:a.uploadedFiles,uploadProgress:a.uploadProgress,uploadErrors:a.uploadErrors,onFileUpload:a.handleFileUpload,onFileRemove:a.handleFileRemove});case 7:return e.jsx(nn,{formData:a.formData,occupants:a.occupants,fieldErrors:a.fieldErrors,onFieldChange:a.handleInputChange,onFieldBlur:a.handleInputBlur,onGoToStep:a.goToStep,progress:a.progress,canSubmit:a.canSubmit});default:return null}},c=()=>a.currentStep===7?a.isSubmitting?"Submitting...":"Submit Application":a.currentStep===6?"Review Application":"Continue";return e.jsx("div",{className:"rental-wizard-overlay",onClick:d,children:e.jsxs("div",{className:"rental-wizard-modal",children:[e.jsxs("div",{className:"rental-wizard-header",children:[e.jsxs("div",{className:"rental-wizard-title",children:[e.jsx(Re,{size:20}),e.jsx("span",{children:"Rental Application"})]}),e.jsx("button",{type:"button",className:"rental-wizard-close",onClick:s,"aria-label":"Close",children:e.jsx($t,{size:20})})]}),e.jsx(Xa,{currentStep:a.currentStep,completedSteps:a.completedSteps,onStepClick:a.goToStep,disabled:a.isSubmitting}),e.jsx("div",{className:"rental-wizard-content",children:a.isLoadingFromDb?e.jsxs("div",{className:"rental-wizard-loading",children:[e.jsx("div",{className:"rental-wizard-loading__spinner"}),e.jsx("p",{children:"Loading your application..."})]}):a.loadError?e.jsxs("div",{className:"rental-wizard-error-state",children:[e.jsx("p",{children:a.loadError}),e.jsx("button",{type:"button",className:"wizard-btn wizard-btn--secondary",onClick:s,children:"Close"})]}):p()}),e.jsxs("div",{className:"rental-wizard-footer",children:[e.jsxs("div",{className:"rental-wizard-footer__auto-save",children:[e.jsx(qt,{size:14}),e.jsx("span",{children:"Progress saved automatically"})]}),e.jsxs("div",{className:"rental-wizard-nav",children:[a.currentStep>1&&e.jsx("button",{type:"button",className:"wizard-btn wizard-btn--secondary",onClick:a.goToPreviousStep,disabled:a.isSubmitting,children:"Back"}),a.currentStep<7&&a.isCurrentStepOptional()&&e.jsx("button",{type:"button",className:"wizard-btn wizard-btn--ghost",onClick:a.goToNextStep,children:"Skip"}),e.jsx("button",{type:"button",className:"wizard-btn wizard-btn--primary",onClick:a.currentStep===7?a.handleSubmit:a.goToNextStep,disabled:a.isSubmitting||a.currentStep===7&&!a.canSubmit||a.currentStep<7&&!a.canProceedFromCurrentStep(),children:c()})]})]}),a.submitError&&e.jsx("div",{className:"rental-wizard-error",children:a.submitError})]})})}function on(t){if(t===0)return"0 Bytes";const s=1024,n=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(t)/Math.log(s));return Math.round(t/Math.pow(s,i)*100)/100+" "+n[i]}function ln(t){if(!t)return{valid:!1,error:"No file provided"};const s=["image/jpeg","image/png","image/webp","image/heic"];if(!t.type.startsWith("image/")||!s.some(i=>t.type===i||t.type.startsWith("image/")))return{valid:!1,error:"Please upload an image file (JPG, PNG, WEBP, or HEIC)"};const n=10*1024*1024;return t.size>n?{valid:!1,error:"File size must be less than 10MB"}:{valid:!0}}function cn({controlledIsOpen:t,initialDocumentType:s,userId:n,onSubmit:i,onClose:o,onAlertTriggered:a}){const[d,p]=r.useState(t??!1),[c,g]=r.useState(!1),[u,j]=r.useState(s),[l,x]=r.useState(fe()),[m,b]=r.useState(fe()),[k,z]=r.useState(fe());r.useEffect(()=>{t!==void 0&&p(t)},[t]),r.useEffect(()=>{const O=D=>{D.key==="Escape"&&d&&!c&&K()};return document.addEventListener("keydown",O),()=>document.removeEventListener("keydown",O)},[d,c]),r.useEffect(()=>(d?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[d]);const P=r.useCallback(O=>{a&&a(O)},[a]),E=r.useCallback((O,D)=>{var oe;const X=(oe=O.target.files)==null?void 0:oe[0];if(!X)return;const ue=ln(X);if(!ue.valid){P({title:"Invalid File",content:ue.error,type:"error"}),O.target.value="";return}const re=new FileReader;re.onloadend=()=>{const le={file:X,preview:re.result,size:on(X.size)};switch(D){case"selfie":x(le);break;case"frontId":b(le);break;case"backId":z(le);break}},re.readAsDataURL(X)},[P]),W=r.useCallback(O=>{const D=fe();switch(O){case"selfie":x(D);break;case"frontId":b(D);break;case"backId":z(D);break}},[]),F=r.useCallback(O=>{j(O)},[]),B=r.useCallback(()=>u?l.file?m.file?k.file?!0:(P({title:"Back ID Required",content:"Please upload the back of your ID document",type:"error"}),!1):(P({title:"Front ID Required",content:"Please upload the front of your ID document",type:"error"}),!1):(P({title:"Selfie Required",content:"Please upload a selfie showing your face clearly",type:"error"}),!1):(P({title:"Document Type Required",content:"Please select a document type",type:"error"}),!1),[u,l,m,k,P]),ee=r.useCallback(async()=>{if(B()){g(!0);try{i&&await i({documentType:u,selfieFile:l.file,frontIdFile:m.file,backIdFile:k.file,userId:n}),P({title:"Verification Submitted",content:"Your identity documents have been submitted successfully. You will receive a confirmation email shortly.",type:"success",duration:5e3}),K()}catch(O){console.error("Identity verification submission error:",O),P({title:"Submission Failed",content:O.message||"An error occurred while submitting your documents",type:"error"})}finally{g(!1)}}},[u,l,m,k,n,B,i,P]),K=r.useCallback(()=>{c||(p(!1),o&&o())},[c,o]),Q=r.useCallback(()=>{j(s),x(fe()),b(fe()),z(fe())},[s]);return{isOpen:d,isSubmitting:c,documentType:u,selfieInfo:l,frontIdInfo:m,backIdInfo:k,handleDocumentTypeChange:F,handleFileChange:E,handleRemoveFile:W,handleSubmit:ee,handleClose:K,resetForm:Q}}function fe(){return{file:null,preview:null,size:""}}const dn=()=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",y1:"3",x2:"12",y2:"15"})]}),un=()=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"16",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"8",x2:"12.01",y2:"8"})]}),mn=()=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]});function ht({label:t,required:s=!1,fileInfo:n,onChange:i,onRemove:o,helpText:a,accept:d="image/*",capture:p}){var j;const c=r.useRef(null),g=()=>{var l;(l=c.current)==null||l.click()},u=l=>{l.stopPropagation(),o&&o(),c.current&&(c.current.value="")};return e.jsxs("div",{className:"file-upload-field",children:[e.jsxs("label",{className:"file-upload-field__label",children:[t,s&&e.jsx("span",{className:"file-upload-field__required",children:"*"})]}),e.jsx("div",{className:"file-upload-field__dropzone",onClick:g,role:"button",tabIndex:0,onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),g())},children:n.preview?e.jsxs("div",{className:"file-upload-field__preview",children:[e.jsx("img",{src:n.preview,alt:`${t} preview`,className:"file-upload-field__preview-image"}),e.jsx("div",{className:"file-upload-field__preview-overlay",children:e.jsxs("button",{type:"button",className:"file-upload-field__remove-btn",onClick:u,"aria-label":`Remove ${t}`,children:[e.jsx(mn,{}),e.jsx("span",{children:"Remove"})]})}),e.jsxs("div",{className:"file-upload-field__preview-info",children:[e.jsx("span",{className:"file-upload-field__filename",children:(j=n.file)==null?void 0:j.name}),e.jsxs("span",{className:"file-upload-field__filesize",children:["(",n.size,")"]})]})]}):e.jsxs("div",{className:"file-upload-field__placeholder",children:[e.jsx("div",{className:"file-upload-field__placeholder-icon",children:e.jsx(dn,{})}),e.jsx("p",{className:"file-upload-field__placeholder-text",children:"Click to upload an image"}),e.jsx("p",{className:"file-upload-field__placeholder-hint",children:"JPG, PNG, WEBP (max 10MB)"})]})}),e.jsx("input",{ref:c,type:"file",accept:d,capture:p,onChange:i,className:"file-upload-field__input","aria-label":t}),a&&e.jsxs("div",{className:"file-upload-field__help",children:[e.jsx("span",{className:"file-upload-field__help-icon",children:e.jsx(un,{})}),e.jsx("p",{className:"file-upload-field__help-text",children:a})]})]})}const pn=["Driver's License / State ID","Passport","National ID Card","Residence Permit"];function hn({value:t,onChange:s}){return e.jsxs("div",{className:"document-type-select",children:[e.jsxs("label",{htmlFor:"document-type",className:"document-type-select__label",children:["Document Type",e.jsx("span",{className:"document-type-select__required",children:"*"})]}),e.jsx("select",{id:"document-type",value:t,onChange:n=>s(n.target.value),className:"document-type-select__input",required:!0,children:pn.map(n=>e.jsx("option",{value:n,children:n},n))})]})}const fn=()=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),gn=()=>e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}),e.jsx("polyline",{points:"9 12 12 15 16 10"})]}),es=r.forwardRef(({isOpen:t,onClose:s,onSubmit:n,userId:i,onAlertTriggered:o,initialDocumentType:a="Driver's License / State ID"},d)=>{const{isOpen:p,isSubmitting:c,documentType:g,selfieInfo:u,frontIdInfo:j,backIdInfo:l,handleDocumentTypeChange:x,handleFileChange:m,handleRemoveFile:b,handleSubmit:k,handleClose:z,resetForm:P}=cn({controlledIsOpen:t,initialDocumentType:a,userId:i,onSubmit:n,onClose:s,onAlertTriggered:o});return r.useImperativeHandle(d,()=>({resetForm:P})),p?e.jsx("div",{className:"identity-verification-overlay",onClick:z,role:"dialog","aria-modal":"true","aria-labelledby":"identity-verification-title",children:e.jsxs("div",{className:"identity-verification-container",onClick:E=>E.stopPropagation(),children:[e.jsx("div",{className:"identity-verification-grab-handle","aria-hidden":"true"}),e.jsxs("header",{className:"identity-verification-header",children:[e.jsxs("div",{className:"identity-verification-header-content",children:[e.jsx("span",{className:"identity-verification-icon","aria-hidden":"true",children:e.jsx(gn,{})}),e.jsxs("div",{className:"identity-verification-header-text",children:[e.jsx("h2",{id:"identity-verification-title",className:"identity-verification-title",children:"Identity Verification"}),e.jsx("p",{className:"identity-verification-description",children:"Please submit front and back photos of your State ID, along with a selfie clearly showing your face"})]})]}),e.jsx("button",{onClick:z,className:"identity-verification-close-btn","aria-label":"Close modal",type:"button",children:e.jsx(fn,{})})]}),e.jsxs("div",{className:"identity-verification-body",children:[e.jsx(hn,{value:g,onChange:x}),e.jsx(ht,{label:"Selfie",required:!0,fileInfo:u,onChange:E=>m(E,"selfie"),onRemove:()=>b("selfie"),helpText:"Press 'allow' on your browser to capture your selfie. Taking a selfie helps ensure user authenticity.",accept:"image/*",capture:"user"}),e.jsx(ht,{label:"Front ID",required:!0,fileInfo:j,onChange:E=>m(E,"frontId"),onRemove:()=>b("frontId"),accept:"image/*"}),e.jsx(ht,{label:"Back ID",required:!0,fileInfo:l,onChange:E=>m(E,"backId"),onRemove:()=>b("backId"),accept:"image/*"})]}),e.jsxs("footer",{className:"identity-verification-footer",children:[e.jsx("button",{type:"button",className:"identity-verification-btn identity-verification-btn--secondary",onClick:z,disabled:c,children:"Close"}),e.jsx("button",{type:"button",className:"identity-verification-btn identity-verification-btn--primary",onClick:k,disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"identity-verification-spinner","aria-hidden":"true"}),"Submitting..."]}):"Submit"})]})]})}):null});es.displayName="IdentityVerification";function yn(){return e.jsx("div",{className:"profile-loading",children:e.jsx("span",{children:"Loading profile..."})})}function bn({error:t}){return e.jsxs("div",{className:"profile-error",children:[e.jsxs("svg",{className:"profile-error-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),e.jsx("h2",{className:"profile-error-title",children:"Unable to load profile"}),e.jsx("p",{className:"profile-error-message",children:t}),e.jsx("button",{className:"save-bar-btn save-bar-btn--preview",onClick:()=>window.location.href="/",children:"Go to Home"})]})}function xn(){var o,a,d,p,c,g,u,j,l,x,m,b,k,z,P,E,W,F,B,ee,K;const t=ua(),[s,n]=r.useState(!1);if(t.loading)return e.jsx(dt,{children:e.jsxs("div",{className:"account-profile-page",children:[e.jsx(lt,{}),e.jsx(yn,{}),e.jsx(ct,{})]})});if(t.error)return e.jsx(dt,{children:e.jsxs("div",{className:"account-profile-page",children:[e.jsx(lt,{}),e.jsx(bn,{error:t.error}),e.jsx(ct,{})]})});const i={isEditorView:t.isEditorView,coverPhotoUrl:((o=t.profileData)==null?void 0:o["Cover Photo"])||null,avatarUrl:((a=t.profileData)==null?void 0:a["Profile Photo"])||null,firstName:t.formData.firstName||((d=t.profileData)==null?void 0:d["Name - First"])||"",lastName:t.formData.lastName||((p=t.profileData)==null?void 0:p["Name - Last"])||"",jobTitle:t.displayJobTitle,profileStrength:t.profileStrength,verifications:t.verifications,nextActions:t.nextActions,onCoverPhotoChange:t.handleCoverPhotoChange,onAvatarChange:t.handleAvatarChange,responseTime:((c=t.profileData)==null?void 0:c["Response Time"])||"Within 24 hours",responseRate:((g=t.profileData)==null?void 0:g["Response Rate"])||95,memberSince:((u=t.profileData)==null?void 0:u["Created Date"])||((j=t.profileData)==null?void 0:j._created_date)};return e.jsx(dt,{children:e.jsxs("div",{className:"account-profile-page",children:[e.jsx(lt,{}),e.jsxs("main",{className:"account-profile-container",children:[e.jsx(ba,{...i}),e.jsxs("div",{className:"account-profile-feed",children:[t.isEditorView&&e.jsx(Oa,{onInviteClick:()=>n(!0),userType:t.isHostUser?"host":"guest"}),t.isEditorView?e.jsx(Ta,{formData:t.formData,formErrors:t.formErrors,profileData:t.profileData,verifications:t.verifications,goodGuestReasonsList:t.goodGuestReasonsList,storageItemsList:t.storageItemsList,transportationOptions:t.transportationOptions,showDateOfBirthField:t.showDateOfBirthField,onFieldChange:t.handleFieldChange,onDayToggle:t.handleDayToggle,onChipToggle:t.handleChipToggle,onTransportToggle:t.handleTransportToggle,onVerifyEmail:t.handleVerifyEmail,onVerifyPhone:t.handleVerifyPhone,onVerifyGovId:t.handleVerifyGovId,onConnectLinkedIn:t.handleConnectLinkedIn,onEditPhone:t.handleEditPhone,onOpenNotificationSettings:t.handleOpenNotificationSettings,onChangePassword:t.handleChangePassword,isHostUser:t.isHostUser,hostListings:t.hostListings,loadingListings:t.loadingListings,onListingClick:t.handleListingClick,onCreateListing:t.handleCreateListing,rentalApplicationStatus:t.rentalApplicationStatus,rentalApplicationProgress:t.rentalApplicationProgress,onOpenRentalWizard:t.handleOpenRentalWizard,isVerifyingEmail:t.isVerifyingEmail,verificationEmailSent:t.verificationEmailSent}):e.jsx(La,{profileData:t.profileData,verifications:t.verifications,goodGuestReasonsList:t.goodGuestReasonsList,storageItemsList:t.storageItemsList,isHostUser:t.isHostUser,hostListings:t.hostListings,onListingClick:t.handleListingClick})]})]}),(t.isEditorView||t.previewMode)&&e.jsx(Fa,{onPreview:t.handlePreviewProfile,onSave:t.handleSave,saving:t.saving,disabled:!t.isDirty,previewMode:t.previewMode}),e.jsx(ea,{isOpen:t.showNotificationModal,userId:t.profileUserId,onClose:t.handleCloseNotificationModal}),e.jsx(aa,{isOpen:t.showPhoneEditModal,currentPhoneNumber:((l=t.profileData)==null?void 0:l["Phone Number (as text)"])||"",onSave:async Q=>{t.handleClosePhoneEditModal()},onClose:t.handleClosePhoneEditModal}),e.jsx(ps,{isOpen:s,onClose:()=>n(!1),referralCode:((x=t.profileData)==null?void 0:x["Referral Code"])||t.profileUserId||"user",stats:{friendsReferred:((m=t.profileData)==null?void 0:m["Friends Referred"])||0,rewardsClaimed:((b=t.profileData)==null?void 0:b["Rewards Claimed"])||0,totalRewards:((k=t.profileData)==null?void 0:k["Total Rewards"])||0},userType:t.isHostUser?"host":"guest",referrerName:((z=t.profileData)==null?void 0:z["Name - First"])||((P=t.profileData)==null?void 0:P.firstName)||""}),!t.isHostUser&&e.jsx(rn,{isOpen:t.showRentalWizardModal,onClose:t.handleCloseRentalWizard,onSuccess:t.handleRentalWizardSuccess,applicationStatus:t.rentalApplicationStatus,userProfileData:{email:((E=t.profileData)==null?void 0:E.email)||((W=t.profileData)==null?void 0:W.Email)||"",firstName:((F=t.profileData)==null?void 0:F["Name - First"])||"",lastName:((B=t.profileData)==null?void 0:B["Name - Last"])||"",phone:((ee=t.profileData)==null?void 0:ee["Phone Number (as text)"])||"",dob:((K=t.profileData)==null?void 0:K["Date of Birth"])||""}}),e.jsx(es,{isOpen:t.showIdentityVerificationModal,onClose:t.handleCloseIdentityVerificationModal,onSubmit:t.handleIdentityVerificationSubmit,userId:t.profileUserId,onAlertTriggered:Q=>{window.showToast&&window.showToast(Q)}}),e.jsx(ct,{})]})})}const Ot=document.getElementById("root");Ot&&ms(Ot).render(e.jsx(Ut.StrictMode,{children:e.jsx(Is,{children:e.jsx(xn,{})})}));

import{r as u,j as s,c as I,R}from"./client-BJVKzfAi.js";import{s as b}from"./supabase-BoCLEw6R.js";import{t as E,u as L,r as S,w as q}from"./auth-QZ4BJadW.js";import{H as C}from"./Header-BJKWma2V.js";import{F as U}from"./Footer-Bzf1rLKh.js";import{E as M}from"./ErrorBoundary-9_HbXv1y.js";/* empty css             */import"./config-QPKPRtag.js";import"./constants-CPVJY5eo.js";import"./Toast-BQk6Nzgd.js";import"./proposalDataFetcher-CipdyWU2.js";import"./proposalStatuses-1Bj0NYR4.js";const B=()=>{const i=new URLSearchParams(window.location.search).get("redirect_to");return i&&i.startsWith("/")?i:"/"},k=()=>{window.location.search&&window.history.replaceState({},"",window.location.pathname)},_=(e,i)=>{var d,n,g,t,a,f,h,y,l,o;return i==="otp_expired"||(d=e==null?void 0:e.message)!=null&&d.includes("expired")?"This login link has expired. Please request a new one.":i==="otp_disabled"||(n=e==null?void 0:e.message)!=null&&n.includes("disabled")?"This login link has been disabled. Please request a new one.":(g=e==null?void 0:e.message)!=null&&g.includes("already been used")||(t=e==null?void 0:e.message)!=null&&t.includes("already used")?"This login link has already been used. Please request a new one.":(a=e==null?void 0:e.message)!=null&&a.includes("Invalid")||(f=e==null?void 0:e.message)!=null&&f.includes("invalid")?"Invalid verification link. Please request a new login link.":(h=e==null?void 0:e.message)!=null&&h.includes("Token")||(y=e==null?void 0:e.message)!=null&&y.includes("token")?"Invalid or expired token. Please request a new login link.":(l=e==null?void 0:e.message)!=null&&l.includes("network")||(o=e==null?void 0:e.message)!=null&&o.includes("Network")?"Network error. Please check your connection and try again.":(e==null?void 0:e.message)||"Verification failed. Please request a new login link."};function F(){const[e,i]=u.useState("loading"),[d,n]=u.useState(null),[g,t]=u.useState(null),[a]=u.useState(B),f=15e3,h=u.useCallback(async(l,o)=>{var x,w,j,V,T,A,N;console.log("[AuthVerify] Starting verification..."),console.log("[AuthVerify] Token hash present:",!!l),console.log("[AuthVerify] Type:",o),i("verifying"),n(null),t(null);const r=setTimeout(()=>{console.log("[AuthVerify] Verification timed out"),i("error"),n("Verification timed out. Please try again or request a new link."),t("timeout")},f);try{const{data:c,error:m}=await b.auth.verifyOtp({token_hash:l,type:o});if(clearTimeout(r),m){console.error("[AuthVerify] Verification error:",m),i("error"),n(_(m,m.code)),t(m.code||"unknown"),k();return}if(c!=null&&c.session){console.log("[AuthVerify] Verification successful"),console.log("[AuthVerify] User ID:",(x=c.session.user)==null?void 0:x.id),console.log("[AuthVerify] Email:",(w=c.session.user)==null?void 0:w.email);const p=c.session,v=((V=(j=p.user)==null?void 0:j.user_metadata)==null?void 0:V.user_id)||((T=p.user)==null?void 0:T.id),P=(N=(A=p.user)==null?void 0:A.user_metadata)==null?void 0:N.user_type;E(p.access_token),v&&(L(v),S(!0,v)),P&&q(P),k(),i("success"),setTimeout(()=>{console.log("[AuthVerify] Redirecting to:",a),window.location.href=a},1500)}else console.error("[AuthVerify] No session in response"),i("error"),n("Verification completed but no session was created. Please try logging in again."),t("no_session"),k()}catch(c){clearTimeout(r),console.error("[AuthVerify] Unexpected error:",c),i("error"),n(_(c,null)),t("exception"),k()}},[a]);u.useEffect(()=>{console.log("[AuthVerify] Page mounted, checking URL params...");const l=new URLSearchParams(window.location.search),o=l.get("token_hash"),r=l.get("type")||"magiclink";if(console.log("[AuthVerify] Has token_hash:",!!o),console.log("[AuthVerify] Type:",r),console.log("[AuthVerify] Redirect to:",a),!o){console.error("[AuthVerify] Missing token_hash parameter"),i("error"),n("Invalid verification link. Please request a new login link."),t("missing_token");return}if(!["magiclink","email","sms","phone_change","email_change","signup","recovery","invite"].includes(r)){console.error("[AuthVerify] Invalid type parameter:",r),i("error"),n("Invalid verification link. Please request a new login link."),t("invalid_type");return}h(o,r)},[h,a]);const y=u.useCallback(()=>{window.location.href="/"},[]);return{status:e,errorMessage:d,errorCode:g,handleRequestNewLink:y,redirectTo:a}}const H=()=>s.jsx("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})}),O=()=>s.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("line",{x1:"15",y1:"9",x2:"9",y2:"15"}),s.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"15"})]});function W(){const{status:e,errorMessage:i,handleRequestNewLink:d}=F();return s.jsxs(s.Fragment,{children:[s.jsx(C,{}),s.jsx("main",{className:"auth-verify-page",children:s.jsxs("div",{className:"auth-verify-container",children:[s.jsx("h1",{children:"Verify Your Login"}),e==="loading"&&s.jsxs("div",{className:"auth-verify-loading",children:[s.jsx("div",{className:"spinner"}),s.jsx("p",{children:"Preparing verification..."})]}),e==="verifying"&&s.jsxs("div",{className:"auth-verify-loading",children:[s.jsx("div",{className:"spinner"}),s.jsx("p",{children:"Verifying your login..."})]}),e==="success"&&s.jsxs("div",{className:"auth-verify-success",children:[s.jsx("div",{className:"success-icon",children:s.jsx(H,{})}),s.jsx("p",{className:"success-message",children:"Login verified successfully!"}),s.jsx("p",{className:"redirect-notice",children:"Redirecting you now..."})]}),e==="error"&&s.jsxs("div",{className:"auth-verify-error",children:[s.jsx("div",{className:"error-icon",children:s.jsx(O,{})}),s.jsx("p",{className:"error-message",children:i}),s.jsx("button",{type:"button",className:"btn-primary",onClick:d,children:"Back to Home"})]})]})}),s.jsx(U,{})]})}I(document.getElementById("root")).render(s.jsx(R.StrictMode,{children:s.jsx(M,{children:s.jsx(W,{})})}));

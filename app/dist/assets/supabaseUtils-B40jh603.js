import{s as p}from"./supabase-BoCLEw6R.js";import{l as c}from"./auth-QZ4BJadW.js";function u({field:r,fieldName:e}){if(!e||typeof e!="string")throw new Error("parseJsonArrayField: fieldName parameter is required and must be a string");if(r==null)throw new Error(`parseJsonArrayField: ${e} is null or undefined`);if(Array.isArray(r))return r;if(typeof r=="string"){let n;try{n=JSON.parse(r)}catch(o){throw new Error(`parseJsonArrayField: Failed to parse ${e} as JSON - ${o.message}`)}if(!Array.isArray(n))throw new Error(`parseJsonArrayField: ${e} parsed to ${typeof n}, expected array. Value: ${JSON.stringify(n)}`);return n}throw new Error(`parseJsonArrayField: ${e} has unexpected type ${typeof r}. Expected array or JSON string. Value: ${JSON.stringify(r)}`)}function y({field:r,fieldName:e}){return r==null||r===""?[]:u({field:r,fieldName:e})}const l=y;async function d(r){if(c.debug("fetchPhotoUrls called",{count:(r==null?void 0:r.length)||0}),!r||r.length===0)return{};try{const{data:e,error:n}=await p.from("listing_photo").select("_id, Photo").in("_id",r);if(n)return c.error("Error fetching photos:",n),{};if(!e||e.length===0)return{};const o={};return e.forEach(i=>{if(i.Photo){let t=i.Photo;t.startsWith("//")&&(t="https:"+t),o[i._id]=t}}),c.debug("Fetched photo URLs",{count:Object.keys(o).length}),o}catch(e){return c.error("Error in fetchPhotoUrls:",e),{}}}async function g(r){if(!r||r.length===0)return{};const e={};try{const{data:n,error:o}=await p.from("user").select('_id, "Name - Full", "Profile Photo"').in("_id",r);return o&&c.error("Error fetching user data by _id:",o),n&&n.length>0&&n.forEach(i=>{let t=i["Profile Photo"];t&&t.startsWith("//")&&(t="https:"+t),e[i._id]={name:i["Name - Full"]||null,image:t||null,verified:!1,userId:i._id}}),c.debug("Fetched host data",{count:Object.keys(e).length}),e}catch(n){return c.error("Error in fetchHostData:",n),{}}}function w(r,e={},n=null){const o=l({field:r,fieldName:"photos"});if(o.length===0)return[];const i=[];for(const t of o){if(typeof t=="object"&&t!==null){let a=t.url||t.Photo||null;a&&(a.startsWith("//")&&(a="https:"+a),i.push(a));continue}if(typeof t=="string"){if(t.startsWith("http://")||t.startsWith("https://")||t.startsWith("//")){let s=t;s.startsWith("//")&&(s="https:"+s),i.push(s);continue}const a=e[t];a&&i.push(a);continue}}return i.length===0&&c.warn(`Listing ${n}: NO VALID PHOTO URLS RESOLVED`),i}function F(r){const e={wifi:{icon:"ðŸ“¶",name:"WiFi",priority:1},furnished:{icon:"ðŸ›‹ï¸",name:"Furnished",priority:2},pet:{icon:"ðŸ•",name:"Pet-Friendly",priority:3},dog:{icon:"ðŸ•",name:"Pet-Friendly",priority:3},cat:{icon:"ðŸ•",name:"Pet-Friendly",priority:3},washer:{icon:"ðŸ§º",name:"Washer/Dryer",priority:4},dryer:{icon:"ðŸ§º",name:"Washer/Dryer",priority:4},parking:{icon:"ðŸ…¿ï¸",name:"Parking",priority:5},elevator:{icon:"ðŸ¢",name:"Elevator",priority:6},gym:{icon:"ðŸ’ª",name:"Gym",priority:7},doorman:{icon:"ðŸšª",name:"Doorman",priority:8},ac:{icon:"â„ï¸",name:"A/C",priority:9},"air conditioning":{icon:"â„ï¸",name:"A/C",priority:9},kitchen:{icon:"ðŸ³",name:"Kitchen",priority:10},balcony:{icon:"ðŸŒ¿",name:"Balcony",priority:11},workspace:{icon:"ðŸ’»",name:"Workspace",priority:12},desk:{icon:"ðŸ’»",name:"Workspace",priority:12}},n=[],o=new Set,i=r.Features;if(i){const a=typeof i=="string"?i.toLowerCase():"";for(const[s,h]of Object.entries(e))a.includes(s)&&!o.has(h.name)&&(n.push(h),o.add(h.name))}const t=r["Kitchen Type"];return t&&t.toLowerCase().includes("kitchen")&&!o.has("Kitchen")&&(n.push(e.kitchen),o.add("Kitchen")),n.sort((a,s)=>a.priority-s.priority),n}export{F as a,g as b,w as e,d as f,y as p};

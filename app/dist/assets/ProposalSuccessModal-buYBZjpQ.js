import{r as m,j as e}from"./client-BJVKzfAi.js";import{s as Z}from"./supabase-BoCLEw6R.js";import{c as ie}from"./createLucideIcon-CgZZH2OU.js";import{X as be}from"./x-CrJVeoCh.js";import{C as ve}from"./calendar-CDI4qHEX.js";import{C as ke}from"./clock-BT0kKcUb.js";import{S as we}from"./send-C4mziT0-.js";import{L as je,c as Ne}from"./ListingScheduleSelector-B9O1H-bT.js";import{b as Se}from"./nightCalculations-BvAtd4RD.js";import{u as Ce,T as Fe}from"./Toast-BQk6Nzgd.js";import{D as U}from"./dayUtils-C3_GW2W5.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],Ie=ie("coffee",Re);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],De=ie("zap",Pe);function Me({fullName:o}){if(typeof o!="string")throw new Error(`formatHostName: fullName must be a string, got ${typeof o}`);const t=o.trim();if(!t||t.length===0)throw new Error("formatHostName: fullName cannot be empty or whitespace");const s=t.split(/\s+/);if(s.length===1)return s[0];const f=s[0],d=s[s.length-1].charAt(0).toUpperCase();return`${f} ${d}.`}const c={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4,padding:"20px"},modal:{background:"white",borderRadius:"16px",overflow:"hidden",boxShadow:"0 24px 48px rgba(0, 0, 0, 0.2)",width:"100%",maxWidth:"420px",display:"flex",flexDirection:"column",maxHeight:"92vh",position:"relative",animation:"slideUp 0.3s ease"},header:{padding:"18px 56px 12px 24px",borderBottom:"1px solid #E7E0EC",display:"flex",alignItems:"center",gap:"14px",flexShrink:0},avatarContainer:{width:"48px",height:"48px",borderRadius:"50%",flexShrink:0,position:"relative",overflow:"hidden"},avatarImage:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"50%"},avatar:{width:"48px",height:"48px",borderRadius:"50%",background:"linear-gradient(135deg, #6D31C2 0%, #31135D 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"16px",fontWeight:"600",flexShrink:0},headerText:{flex:1},headerTitle:{fontSize:"18px",fontWeight:"400",color:"#1C1B1F",margin:0},responseHint:{fontSize:"13px",color:"#5B5FCF",display:"flex",alignItems:"center",gap:"5px",marginTop:"2px"},closeBtn:{position:"absolute",top:"16px",right:"16px",width:"48px",height:"48px",display:"flex",alignItems:"center",justifyContent:"center",background:"transparent",border:"none",borderRadius:"50%",cursor:"pointer",transition:"all 0.2s",zIndex:10},listingBar:{padding:"12px 24px",background:"#F7F2FA",fontSize:"13px",color:"#49454F",borderBottom:"1px solid #E7E0EC",flexShrink:0},body:{padding:"24px",overflowY:"auto",flexGrow:1,WebkitOverflowScrolling:"touch"},formLabel:{display:"block",fontSize:"14px",fontWeight:"500",color:"#1C1B1F",marginBottom:"8px"},input:{width:"100%",padding:"12px 16px",border:"2px solid #CAC4D0",borderRadius:"8px",fontSize:"14px",fontFamily:"inherit",transition:"all 0.2s",boxSizing:"border-box"},inputError:{borderColor:"#DC3545"},textarea:{width:"100%",padding:"14px 16px",border:"2px solid #CAC4D0",borderRadius:"8px",fontSize:"14px",lineHeight:"1.5",minHeight:"120px",resize:"vertical",fontFamily:"inherit",transition:"all 0.2s",boxSizing:"border-box"},charCount:{marginTop:"6px",fontSize:"12px",color:"#79747E",textAlign:"right"},quickQuestions:{marginTop:"16px"},quickLabel:{fontSize:"12px",color:"#49454F",marginBottom:"8px",fontWeight:"500"},quickChips:{display:"flex",flexWrap:"wrap",gap:"8px"},quickChip:{minHeight:"40px",padding:"8px 16px",background:"white",border:"1px solid #E7E0EC",borderRadius:"100px",fontSize:"13px",color:"#49454F",cursor:"pointer",display:"flex",alignItems:"center",gap:"6px",transition:"all 0.15s"},quickChipHover:{borderColor:"#31135D",color:"#31135D",background:"#F7F2FA"},footer:{padding:"16px 24px",background:"#F7F2FA",display:"flex",flexDirection:"column",gap:"16px",flexShrink:0},btnPrimary:{width:"100%",padding:"14px 28px",background:"#31135D",border:"none",borderRadius:"100px",color:"white",fontSize:"14px",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s"},btnPrimaryHover:{background:"#4A2F7C",boxShadow:"0 2px 8px rgba(49, 19, 93, 0.3)"},btnPrimaryDisabled:{background:"#9ca3af",cursor:"not-allowed"},footerNote:{textAlign:"center",fontSize:"13px",color:"#49454F"},footerLink:{color:"#6D31C2",textDecoration:"none",fontWeight:"500",cursor:"pointer",background:"none",border:"none",fontSize:"inherit",padding:0},errorMessage:{display:"block",marginTop:"4px",fontSize:"13px",color:"#DC3545"},errorBanner:{padding:"12px",background:"#F7F2FA",border:"1px solid #E7E0EC",borderRadius:"12px",marginBottom:"16px",display:"flex",alignItems:"center",gap:"12px"},errorBannerIcon:{width:"24px",height:"24px",background:"#31135D",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},errorBannerText:{fontSize:"13px",color:"#1C1B1F",lineHeight:"1.4"},spinner:{width:"48px",height:"48px",border:"3px solid #E7E0EC",borderTopColor:"#31135D",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 1rem"},successIcon:{width:"64px",height:"64px",borderRadius:"50%",background:"#5B5FCF",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2rem",margin:"0 auto 1rem"},formGroup:{marginBottom:"16px"}},We=[{id:"availability",icon:ve,label:"Availability",text:"Is the space available for my dates?"},{id:"amenities",icon:Ie,label:"Amenities",text:"What amenities are included?"},{id:"flexibility",icon:ke,label:"Flexibility",text:"Is there flexibility with the schedule?"}];function rt({isOpen:o,onClose:t,listing:s,onLoginRequired:f}){var te,X;const[d,l]=m.useState({userName:"",email:"",message:""}),[a,n]=m.useState({}),[g,u]=m.useState(!1),[_,O]=m.useState(!1),[P,E]=m.useState(!1),[h,k]=m.useState(!0),[S,y]=m.useState(null),[V,j]=m.useState(!1),W=m.useRef(null),F=m.useRef(null),R=()=>{var w;const r=((w=s==null?void 0:s.host)==null?void 0:w.name)||"Host",b=r.split(" ");return b.length>=2?`${b[0][0]}${b[b.length-1][0]}`.toUpperCase():r.substring(0,2).toUpperCase()};m.useEffect(()=>{o&&(z(),l({userName:"",email:"",message:""}),n({}),O(!1))},[o]),m.useEffect(()=>{o&&!h&&!_&&W.current&&W.current.focus()},[o,h,_]);const z=async()=>{k(!0);try{const{data:{session:r}}=await Z.auth.getSession();E(!!r)}catch(r){console.error("[ContactHostMessaging] Auth check error:",r),E(!1)}finally{k(!1)}};m.useEffect(()=>{if(!o)return;const r=b=>{if(b.key==="Escape"&&D(),b.key==="Tab"&&F.current){const w=F.current.querySelectorAll('button, textarea, input, a[href], [tabindex]:not([tabindex="-1"])'),C=w[0],q=w[w.length-1];b.shiftKey&&document.activeElement===C?(b.preventDefault(),q.focus()):!b.shiftKey&&document.activeElement===q&&(b.preventDefault(),C.focus())}};return document.addEventListener("keydown",r),()=>document.removeEventListener("keydown",r)},[o]);const G=()=>{const r={};return P||(d.userName.trim()||(r.userName="Name is required"),d.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.email)||(r.email="Please enter a valid email"):r.email="Email is required"),d.message.trim()?d.message.trim().length<10&&(r.message="Message must be at least 10 characters"):r.message="Message is required",n(r),Object.keys(r).length===0},L=async()=>{var r,b,w,C,q,J,$,p;if(G()){if(u(!0),n({}),!((r=s.host)!=null&&r.userId)){n({submit:"Host information unavailable. Please try again later."}),u(!1);return}try{const{data:{session:T}}=await Z.auth.getSession();if(T){console.log("[ContactHostMessaging] Sending authenticated message",{recipient_user_id:(b=s.host)==null?void 0:b.userId,listing_id:s.id,message_body_length:d.message.length});const{data:N,error:M}=await Z.functions.invoke("messages",{body:{action:"send_message",payload:{recipient_user_id:s.host.userId,listing_id:s.id,message_body:d.message.trim(),send_welcome_messages:!0}}});if(M){console.error("[ContactHostMessaging] Edge Function error:",M),n({submit:M.message||"Failed to send message. Please try again."});return}if(!N.success){console.error("[ContactHostMessaging] Message send failed:",N.error),n({submit:N.error||"Failed to send message. Please try again."});return}console.log("[ContactHostMessaging] Message sent successfully",{thread_id:(w=N.data)==null?void 0:w.thread_id,message_id:(C=N.data)==null?void 0:C.message_id,is_new_thread:(q=N.data)==null?void 0:q.is_new_thread,welcome_messages_sent:(J=N.data)==null?void 0:J.welcome_messages_sent})}else{console.log("[ContactHostMessaging] Sending guest inquiry",{sender_name:d.userName,sender_email:d.email,recipient_user_id:($=s.host)==null?void 0:$.userId,listing_id:s.id,message_body_length:d.message.length});const{data:N,error:M}=await Z.functions.invoke("messages",{body:{action:"send_guest_inquiry",payload:{sender_name:d.userName.trim(),sender_email:d.email.trim(),recipient_user_id:s.host.userId,listing_id:s.id,message_body:d.message.trim()}}});if(M){console.error("[ContactHostMessaging] Edge Function error:",M),n({submit:M.message||"Failed to send message. Please try again."});return}if(!N.success){console.error("[ContactHostMessaging] Guest inquiry failed:",N.error),n({submit:N.error||"Failed to send message. Please try again."});return}console.log("[ContactHostMessaging] Guest inquiry sent successfully",{inquiry_id:(p=N.data)==null?void 0:p.inquiry_id})}O(!0),setTimeout(()=>{D()},2e3)}catch(T){console.error("[ContactHostMessaging] Exception sending message:",T),n({submit:T.message||"Network error. Please check your connection and try again."})}finally{u(!1)}}},D=()=>{l({userName:"",email:"",message:""}),n({}),O(!1),t()},I=(r,b)=>{l(w=>({...w,[r]:b})),a[r]&&n(w=>{const C={...w};return delete C[r],C})},Q=r=>{const b=d.message.trim(),w=b?`${b}
${r.text}`:r.text;l(C=>({...C,message:w})),a.message&&n(C=>{const q={...C};return delete q.message,q})},Y=()=>{D(),f&&f()};if(!o)return null;const K=Me({fullName:((te=s==null?void 0:s.host)==null?void 0:te.name)||"Host"});return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        @keyframes slideUp {
          from { transform: translateY(20px); opacity: 0; }
          to { transform: translateY(0); opacity: 1; }
        }
        @keyframes spin {
          to { transform: rotate(360deg); }
        }
        @media (max-width: 480px) {
          .contact-modal-overlay { align-items: flex-end !important; padding: 0 !important; }
          .contact-modal {
            max-width: 100% !important;
            border-radius: 24px 24px 0 0 !important;
            animation: slideFromBottom 0.4s cubic-bezier(0.16, 1, 0.3, 1) !important;
          }
          .contact-modal::before {
            content: '';
            width: 36px;
            height: 4px;
            background: #E7E0EC;
            border-radius: 2px;
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 30;
          }
          .contact-modal-footer {
            background: white !important;
            border-top: 1px solid #E7E0EC;
            padding: 16px 24px 24px 24px !important;
          }
        }
        @keyframes slideFromBottom {
          from { transform: translateY(100%); }
          to { transform: translateY(0); }
        }
        @media (prefers-reduced-motion: reduce) {
          *, *::before, *::after {
            animation-duration: 0.01ms !important;
            transition-duration: 0.01ms !important;
          }
        }
      `}),e.jsx("div",{className:"contact-modal-overlay",style:c.overlay,role:"dialog","aria-modal":"true","aria-labelledby":"contact-modal-title",onClick:D,children:e.jsxs("div",{ref:F,className:"contact-modal",style:c.modal,onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{style:c.header,children:[(X=s==null?void 0:s.host)!=null&&X.image?e.jsxs("div",{style:c.avatarContainer,"aria-hidden":"true",children:[e.jsx("img",{src:s.host.image,alt:"",style:c.avatarImage,onError:r=>{r.target.style.display="none",r.target.nextSibling.style.display="flex"}}),e.jsx("div",{style:{...c.avatar,display:"none",position:"absolute",top:0,left:0},children:R()})]}):e.jsx("div",{style:c.avatar,"aria-hidden":"true",children:R()}),e.jsxs("div",{style:c.headerText,children:[e.jsxs("h2",{id:"contact-modal-title",style:c.headerTitle,children:["Message ",K]}),e.jsxs("div",{style:c.responseHint,children:[e.jsx(De,{size:14,"aria-hidden":"true"}),e.jsx("span",{children:"Responds within hours"})]})]}),e.jsx("button",{onClick:D,style:c.closeBtn,"aria-label":"Close modal",onMouseEnter:r=>r.target.style.background="#F7F2FA",onMouseLeave:r=>r.target.style.background="transparent",children:e.jsx(be,{size:20,color:"#49454F"})})]}),e.jsxs("div",{style:c.listingBar,children:[e.jsx("span",{className:"sr-only",children:"Regarding listing: "}),"About: ",e.jsx("strong",{style:{color:"#1C1B1F"},children:(s==null?void 0:s.title)||"Listing"})]}),h?e.jsxs("div",{style:{padding:"3rem",textAlign:"center"},children:[e.jsx("div",{style:c.spinner}),e.jsx("p",{style:{color:"#49454F",margin:0},children:"Loading..."})]}):_?e.jsxs("div",{style:{padding:"3rem",textAlign:"center"},children:[e.jsx("div",{style:c.successIcon,children:"âœ“"}),e.jsx("h3",{style:{fontSize:"1.5rem",fontWeight:"600",color:"#1C1B1F",marginBottom:"0.5rem"},children:"Message Sent!"}),e.jsx("p",{style:{color:"#49454F",fontSize:"1rem"},children:P?"Your message has been sent. Check your inbox for the conversation.":"Your message has been sent. The host will respond to your email."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:c.body,children:[!P&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:c.formGroup,children:[e.jsx("label",{htmlFor:"contact-name",style:c.formLabel,children:"Your Name"}),e.jsx("input",{id:"contact-name",type:"text",value:d.userName,onChange:r=>I("userName",r.target.value),placeholder:"John Smith",style:{...c.input,...a.userName?c.inputError:{}},onFocus:r=>{r.target.style.borderColor="#31135D",r.target.style.background="#F7F2FA",r.target.style.boxShadow="0 0 0 4px rgba(109, 49, 194, 0.2)"},onBlur:r=>{a.userName||(r.target.style.borderColor="#CAC4D0",r.target.style.background="white",r.target.style.boxShadow="none")},"aria-invalid":a.userName?"true":"false","aria-describedby":a.userName?"name-error":void 0}),a.userName&&e.jsx("span",{id:"name-error",style:c.errorMessage,role:"alert",children:a.userName})]}),e.jsxs("div",{style:c.formGroup,children:[e.jsx("label",{htmlFor:"contact-email",style:c.formLabel,children:"Your Email"}),e.jsx("input",{id:"contact-email",type:"email",value:d.email,onChange:r=>I("email",r.target.value),placeholder:"john@example.com",style:{...c.input,...a.email?c.inputError:{}},onFocus:r=>{r.target.style.borderColor="#31135D",r.target.style.background="#F7F2FA",r.target.style.boxShadow="0 0 0 4px rgba(109, 49, 194, 0.2)"},onBlur:r=>{a.email||(r.target.style.borderColor="#CAC4D0",r.target.style.background="white",r.target.style.boxShadow="none")},"aria-invalid":a.email?"true":"false","aria-describedby":a.email?"email-error":void 0}),a.email&&e.jsx("span",{id:"email-error",style:c.errorMessage,role:"alert",children:a.email})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"contact-message",style:c.formLabel,children:P?"Your Message":"Message"}),e.jsx("textarea",{ref:W,id:"contact-message",value:d.message,onChange:r=>I("message",r.target.value),placeholder:`Hi ${K}! I saw your listing and...`,maxLength:500,style:{...c.textarea,...a.message?c.inputError:{}},onFocus:r=>{r.target.style.borderColor="#31135D",r.target.style.background="#F7F2FA",r.target.style.boxShadow="0 0 0 4px rgba(109, 49, 194, 0.2)"},onBlur:r=>{a.message||(r.target.style.borderColor="#CAC4D0",r.target.style.background="white",r.target.style.boxShadow="none")},"aria-invalid":a.message?"true":"false","aria-describedby":"message-help message-error"}),a.message&&e.jsx("span",{id:"message-error",style:c.errorMessage,role:"alert",children:a.message}),e.jsxs("div",{id:"message-help",style:c.charCount,"aria-live":"polite",children:[d.message.length," / 500"]})]}),e.jsxs("fieldset",{style:{...c.quickQuestions,border:"none",padding:0,margin:0},children:[e.jsx("legend",{style:c.quickLabel,children:"Quick questions:"}),e.jsx("div",{style:c.quickChips,role:"group","aria-label":"Quick question options",children:We.map(r=>e.jsxs("button",{type:"button",onClick:()=>Q(r),onMouseEnter:()=>y(r.id),onMouseLeave:()=>y(null),style:{...c.quickChip,...S===r.id?c.quickChipHover:{}},"aria-label":`Add question: ${r.text}`,children:[e.jsx(r.icon,{size:14,"aria-hidden":"true"}),r.label]},r.id))})]})]}),e.jsxs("div",{className:"contact-modal-footer",style:c.footer,children:[a.submit&&e.jsxs("div",{style:c.errorBanner,role:"alert",children:[e.jsx("div",{style:c.errorBannerIcon,children:e.jsx("span",{style:{color:"white",fontSize:"14px",fontWeight:"bold"},children:"!"})}),e.jsx("span",{style:c.errorBannerText,children:a.submit})]}),e.jsxs("button",{onClick:L,disabled:g,onMouseEnter:()=>!g&&j(!0),onMouseLeave:()=>j(!1),style:{...c.btnPrimary,...g?c.btnPrimaryDisabled:{},...V&&!g?c.btnPrimaryHover:{}},children:[e.jsx(we,{size:18,"aria-hidden":"true"}),g?"Sending...":"Send Message"]}),e.jsx("div",{style:c.footerNote,children:P?e.jsx(e.Fragment,{children:"Signed in Â· Messages go to your inbox"}):e.jsxs(e.Fragment,{children:["Have an account?"," ",e.jsx("button",{onClick:Y,style:c.footerLink,children:"Log in"})," ","to track messages"]})})]})]})]})})]})}function ne(o){if(!o)return null;const t=o.toLowerCase();return t.includes("1 on 1 off")||t.includes("1on1off")||t.includes("one week on")&&t.includes("one week off")||t.includes("1 week on")&&t.includes("1 week off")?{label:"1 week on / 1 week off",shortLabel:"1on/1off",actualWeeksPer4:2}:t.includes("2 on 2 off")||t.includes("2on2off")||t.includes("two weeks on")||t.includes("two week")&&t.includes("two week")||t.includes("2 week on")&&t.includes("2 week off")?{label:"2 weeks on / 2 weeks off",shortLabel:"2on/2off",actualWeeksPer4:2}:t.includes("1 on 3 off")||t.includes("1on3off")||t.includes("one week on")&&t.includes("three week")||t.includes("1 week on")&&t.includes("3 week off")?{label:"1 week on / 3 weeks off",shortLabel:"1on/3off",actualWeeksPer4:1}:null}function qe({data:o,listing:t,onEditUserDetails:s,onEditMoveIn:f,onEditDays:d}){const l=n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(n||0),a=n=>n?new Date(n).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"Not set";return e.jsxs("div",{className:"section review-section",children:[e.jsxs("div",{className:"review-field",children:[e.jsx("span",{className:"review-label",children:"Approx Move-in"}),e.jsx("span",{className:"review-value",children:a(o.moveInDate)}),e.jsx("button",{className:"edit-link",onClick:f,children:"edit"})]}),e.jsxs("div",{className:"review-field",children:[e.jsx("span",{className:"review-label",children:"Check-in"}),e.jsx("span",{className:"review-value",children:o.checkInDay}),e.jsx("button",{className:"edit-link",onClick:d,children:"edit"})]}),e.jsxs("div",{className:"review-field",children:[e.jsx("span",{className:"review-label",children:"Check-out"}),e.jsx("span",{className:"review-value",children:o.checkOutDay}),e.jsx("button",{className:"edit-link",onClick:d,children:"edit"})]}),e.jsxs("div",{className:"review-field",children:[e.jsx("span",{className:"review-label",children:"Reservation span (weeks)"}),e.jsx("span",{className:"review-value",children:o.reservationSpan}),e.jsx("button",{className:"edit-link",onClick:f,children:"edit"})]}),(()=>{const n=(t==null?void 0:t["Weeks offered"])||(t==null?void 0:t.weeks_offered),g=ne(n);if(g){const u=Math.ceil(g.actualWeeksPer4*(o.reservationSpan/4));return e.jsx("div",{className:"schedule-notice",style:{backgroundColor:"#FFF3CD",border:"1px solid #FFECB5",borderRadius:"8px",padding:"12px 16px",marginTop:"12px",marginBottom:"12px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"10px"},children:[e.jsx("span",{style:{fontSize:"18px"},children:"ğŸ“…"}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"600",color:"#856404",fontSize:"14px"},children:["Alternating Schedule: ",g.label]}),e.jsxs("div",{style:{fontSize:"13px",color:"#664D03",marginTop:"4px"},children:["Out of ",o.reservationSpan," weeks, you will occupy ",e.jsxs("strong",{children:[u," weeks"]})," total.",e.jsx("br",{}),e.jsx("span",{style:{fontStyle:"italic"},children:"Pricing reflects actual occupancy weeks only."})]})]})]})})}return null})(),e.jsxs("div",{className:"pricing-section",children:[e.jsxs("div",{className:"price-row",children:[e.jsx("span",{className:"price-label",children:"Price per night"}),e.jsx("span",{className:"price-value",children:l(o.pricePerNight)})]}),e.jsxs("div",{className:"price-row",children:[e.jsx("span",{className:"price-label",children:"Number of nights per week"}),e.jsxs("span",{className:"price-value",children:["x ",o.numberOfNights]})]}),(()=>{const n=(t==null?void 0:t["Weeks offered"])||(t==null?void 0:t.weeks_offered),g=ne(n);if(g){const u=Math.ceil(g.actualWeeksPer4*(o.reservationSpan/4));return e.jsxs("div",{className:"price-row",children:[e.jsxs("span",{className:"price-label",children:["Actual weeks of occupancy",e.jsxs("div",{style:{fontSize:"11px",color:"#666",fontStyle:"italic",marginTop:"2px"},children:["(",g.shortLabel," schedule)"]})]}),e.jsxs("span",{className:"price-value",children:["x ",u," weeks"]})]})}return null})(),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:"price-row",children:[e.jsxs("span",{className:"price-label",children:["Total price for reservation",e.jsx("div",{style:{fontSize:"11px",color:"#666",fontStyle:"italic",marginTop:"3px"},children:"*excluding Maintenance Fee and Damage Deposit"})]}),e.jsx("span",{className:"price-value",children:l(o.totalPrice)})]}),e.jsxs("div",{className:"price-row",children:[e.jsx("span",{className:"price-label",children:"Price per 4 weeks"}),e.jsx("span",{className:"price-value",children:l(o.pricePerFourWeeks)})]}),e.jsxs("div",{className:"price-row",children:[e.jsxs("span",{className:"price-label",children:["Refundable* Damage Deposit",e.jsx("a",{href:"/policies#damage-deposit",style:{fontSize:"11px",marginLeft:"5px",color:"#0066cc"},children:"*see terms of use"})]}),e.jsxs("span",{className:"price-value",children:["+ ",l(o.damageDeposit)]})]}),e.jsxs("div",{className:"price-row",children:[e.jsx("span",{className:"price-label",children:"Maintenance Fee / 4 wks"}),e.jsx("span",{className:"price-value",children:o.maintenanceFee===0?"No cleaning fee":`+ ${l(o.maintenanceFee)}`})]}),e.jsx("div",{className:"divider"}),e.jsxs("div",{className:"price-row price-highlight",children:[e.jsxs("div",{children:[e.jsx("div",{className:"price-label",style:{fontWeight:"700",fontSize:"15px"},children:"Price for the 1st 4 weeks"}),e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"3px"},children:"incl. Damage Deposit + Maintenance Fees"})]}),e.jsx("span",{className:"price-value",style:{fontSize:"20px",color:"#5B2C6F",fontWeight:"700"},children:l(o.firstFourWeeksTotal)})]})]})]})}function Ee({data:o,updateData:t}){return e.jsxs("div",{className:"section user-details-section",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"needForSpace",className:"form-label",children:"Why do you want this space?"}),e.jsx("textarea",{id:"needForSpace",className:"form-textarea",placeholder:"How will you use the space? (minimum of 10 words)",value:o.needForSpace,onChange:s=>t("needForSpace",s.target.value),rows:4})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"aboutYourself",className:"form-label",children:"Tell us about yourself"}),e.jsx("textarea",{id:"aboutYourself",className:"form-textarea",placeholder:"Please take a moment to share some details about yourself, such as your interests, travel preferences, etc. (minimum of 10 words)",value:o.aboutYourself,onChange:s=>t("aboutYourself",s.target.value),rows:4})]}),e.jsx("div",{className:"form-group",style:{marginBottom:o.hasUniqueRequirements?"25px":"0"},children:e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o.hasUniqueRequirements,onChange:s=>t("hasUniqueRequirements",s.target.checked)}),e.jsx("span",{style:{marginLeft:"8px"},children:"Do you have any unique requirements?"})]})}),o.hasUniqueRequirements&&e.jsxs("div",{className:"form-group",style:{marginBottom:"0"},children:[e.jsx("label",{htmlFor:"uniqueRequirements",className:"form-label",children:"Write your unique requirements"}),e.jsx("textarea",{id:"uniqueRequirements",className:"form-textarea",placeholder:"Any special needs, personal preference or specific requirements you may have (minimum of 10 words)",value:o.uniqueRequirements,onChange:s=>t("uniqueRequirements",s.target.value),rows:4})]})]})}function Ae(o){if(!o)return null;const t=o.toLowerCase();return t.includes("1 on 1 off")||t.includes("1on1off")||t.includes("one week on")&&t.includes("one week off")||t.includes("1 week on")&&t.includes("1 week off")?{label:"1 week on / 1 week off",explanation:"You will occupy the space every other week. Prices are calculated for actual weeks of occupancy only.",actualWeeksPer4:2}:t.includes("2 on 2 off")||t.includes("2on2off")||t.includes("two weeks on")||t.includes("two week")&&t.includes("two week")||t.includes("2 week on")&&t.includes("2 week off")?{label:"2 weeks on / 2 weeks off",explanation:"You will occupy the space for 2 weeks, then off for 2 weeks. Prices are calculated for actual weeks of occupancy only.",actualWeeksPer4:2}:t.includes("1 on 3 off")||t.includes("1on3off")||t.includes("one week on")&&t.includes("three week")||t.includes("1 week on")&&t.includes("3 week off")?{label:"1 week on / 3 weeks off",explanation:"You will occupy the space 1 week per month. Prices are calculated for actual weeks of occupancy only.",actualWeeksPer4:1}:null}function Te({data:o,updateData:t,listing:s,errors:f={}}){const d=[{value:6,label:"6 weeks"},{value:7,label:"7 weeks"},{value:8,label:"8 weeks"},{value:9,label:"9 weeks (~2 months)"},{value:10,label:"10 weeks"},{value:12,label:"12 weeks"},{value:13,label:"13 weeks (3 months)"},{value:16,label:"16 weeks"},{value:17,label:"17 weeks (~4 months)"},{value:20,label:"20 weeks"},{value:22,label:"22 weeks (~5 months)"},{value:26,label:"26 weeks (6 months)"}],l=()=>{const a=new Date,n=new Date(a);return n.setDate(a.getDate()+14),n.toISOString().split("T")[0]};return e.jsxs("div",{className:"section move-in-section",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{className:"form-label",children:["Approx Move-in",e.jsx("span",{className:"helper-icon",title:"Your move in date depends on this listing's availability. Let us know if you have any move-in flexibility",children:"â„¹ï¸"})]}),e.jsx("div",{className:"helper-text",children:"Your move in date depends on this listing's availability. Let us know if you have any move-in flexibility"}),e.jsx("input",{type:"date",id:"moveInDate",value:o.moveInDate?o.moveInDate.split("T")[0]:"",onChange:a=>t("moveInDate",a.target.value),min:l(),className:`form-input date-picker ${f.moveInDate?"is-invalid":""}`}),f.moveInDate&&e.jsx("div",{className:"form-error-message",children:f.moveInDate})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"moveInRange",className:"form-label",children:"Move-in Range (Optional)"}),e.jsx("input",{type:"text",id:"moveInRange",className:"form-input",placeholder:"e.g., 2-3 weeks flexibility",value:o.moveInRange,onChange:a=>t("moveInRange",a.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reservationSpan",className:"form-label",children:"Reservation Length"}),e.jsxs("div",{className:"select-wrapper",children:[e.jsx("span",{className:"select-icon",children:"ğŸ•"}),e.jsx("select",{id:"reservationSpan",className:"form-select",value:o.reservationSpan,onChange:a=>t("reservationSpan",parseInt(a.target.value)),children:d.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})]}),(()=>{const a=(s==null?void 0:s["Weeks offered"])||(s==null?void 0:s.weeks_offered),n=Ae(a);return n?e.jsx("div",{className:"schedule-notice",style:{backgroundColor:"#FFF3CD",border:"1px solid #FFECB5",borderRadius:"8px",padding:"12px 16px",marginTop:"16px",marginBottom:"16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:"10px"},children:[e.jsx("span",{style:{fontSize:"20px"},children:"ğŸ“…"}),e.jsxs("div",{children:[e.jsxs("div",{style:{fontWeight:"600",color:"#856404",marginBottom:"4px"},children:["Alternating Schedule: ",n.label]}),e.jsx("div",{style:{fontSize:"13px",color:"#664D03"},children:n.explanation}),e.jsxs("div",{style:{fontSize:"12px",color:"#664D03",marginTop:"8px",fontStyle:"italic"},children:["For a ",o.reservationSpan,"-week reservation span, you will occupy approximately"," ",e.jsxs("strong",{children:[Math.ceil(n.actualWeeksPer4*(o.reservationSpan/4))," weeks"]})," total."]})]})]})}):null})(),(s==null?void 0:s["Dates - Blocked"])&&Array.isArray(s["Dates - Blocked"])&&s["Dates - Blocked"].length>0&&e.jsxs("div",{className:"blocked-dates-notice",children:[e.jsx("h4",{children:"Desired Nights Restricted by Host"}),e.jsx("ul",{children:s["Dates - Blocked"].slice(0,5).map((a,n)=>e.jsxs("li",{children:["- ",new Date(a).toLocaleDateString()]},n))}),e.jsx("p",{className:"warning-text",children:"You will have the option to either accept these restrictions or request these restrictions being removed during negotiations."})]})]})}const ee=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function He(o){if(!o)return null;const t=o.toLowerCase();return t.includes("1 on 1 off")||t.includes("1on1off")||t.includes("one week on")&&t.includes("one week off")||t.includes("1 week on")&&t.includes("1 week off")?{label:"1 week on / 1 week off",explanation:"Prices shown reflect actual weeks of occupancy only.",actualWeeksPer4:2}:t.includes("2 on 2 off")||t.includes("2on2off")||t.includes("two weeks on")||t.includes("two week")&&t.includes("two week")||t.includes("2 week on")&&t.includes("2 week off")?{label:"2 weeks on / 2 weeks off",explanation:"Prices shown reflect actual weeks of occupancy only.",actualWeeksPer4:2}:t.includes("1 on 3 off")||t.includes("1on3off")||t.includes("one week on")&&t.includes("three week")||t.includes("1 week on")&&t.includes("3 week off")?{label:"1 week on / 3 weeks off",explanation:"Prices shown reflect actual weeks of occupancy only.",actualWeeksPer4:1}:null}const _e=o=>{if(!o||o.length===0)return{checkInName:null,checkOutName:null};const t=[...o].sort((a,n)=>a-n),s=t.includes(6),f=t.includes(0);if(s&&f&&o.length<7){let a=-1;for(let n=0;n<t.length-1;n++)if(t[n+1]-t[n]>1){a=n+1;break}if(a!==-1){const n=t[a],g=t[a-1];return{checkInName:ee[n],checkOutName:ee[g]}}}const d=t[0],l=t[t.length-1];return{checkInName:ee[d],checkOutName:ee[l]}};function Oe({data:o,updateData:t,listing:s,zatConfig:f,errors:d={}}){var E;const l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a=h=>!h||!Array.isArray(h)?[]:h.map(k=>{const S=l.indexOf(k);return{id:`day-${S}`,dayOfWeek:S,name:k,abbreviation:k.substring(0,3),isSelected:!0}}),n=h=>!h||!Array.isArray(h)?[]:h.map(k=>l[k.dayOfWeek]),g=h=>{if(!h||!Array.isArray(h))return[0,1,2,3,4,5,6];const k={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},S=h.map(y=>k[y]).filter(y=>y!==void 0);return S.length>0?S:[0,1,2,3,4,5,6]},u=m.useMemo(()=>s?{id:s._id,firstAvailable:new Date(s[" First Available"]||Date.now()),lastAvailable:new Date(s["Last Available"]||Date.now()),numberOfNightsAvailable:s["# of nights available"]||7,active:s.Active,approved:s.Approved,datesBlocked:Array.isArray(s["Dates - Blocked"])?s["Dates - Blocked"]:[],complete:s.Complete,confirmedAvailability:s.confirmedAvailability,checkInTime:s["NEW Date Check-in Time"]||"3:00 pm",checkOutTime:s["NEW Date Check-out Time"]||"11:00 am",nightsAvailableList:[],nightsAvailableNumbers:s["Nights Available (numbers)"]||[0,1,2,3,4,5,6],nightsNotAvailable:[],minimumNights:s["Minimum Nights"]||2,maximumNights:s["Maximum Nights"]||7,daysAvailable:g(s["Days Available (List of Days)"]),daysNotAvailable:[],"rental type":s["rental type"]||"Nightly","Weeks offered":s["Weeks offered"]||"Every week","ğŸ’°Unit Markup":s["ğŸ’°Unit Markup"]||0,"ğŸ’°Nightly Host Rate for 2 nights":s["ğŸ’°Nightly Host Rate for 2 nights"],"ğŸ’°Nightly Host Rate for 3 nights":s["ğŸ’°Nightly Host Rate for 3 nights"],"ğŸ’°Nightly Host Rate for 4 nights":s["ğŸ’°Nightly Host Rate for 4 nights"],"ğŸ’°Nightly Host Rate for 5 nights":s["ğŸ’°Nightly Host Rate for 5 nights"],"ğŸ’°Nightly Host Rate for 7 nights":s["ğŸ’°Nightly Host Rate for 7 nights"],"ğŸ’°Weekly Host Rate":s["ğŸ’°Weekly Host Rate"],"ğŸ’°Monthly Host Rate":s["ğŸ’°Monthly Host Rate"],"ğŸ’°Price Override":s["ğŸ’°Price Override"],"ğŸ’°Cleaning Cost / Maintenance Fee":s["ğŸ’°Cleaning Cost / Maintenance Fee"],"ğŸ’°Damage Deposit":s["ğŸ’°Damage Deposit"]}:null,[s]),_=m.useMemo(()=>a(o.daysSelected||[]),[]),O=h=>{const k=n(h);if(t("daysSelected",k),k.length>0){const S=h.map(j=>j.dayOfWeek),{checkInName:y,checkOutName:V}=_e(S);t("checkInDay",y),t("checkOutDay",V)}},P=h=>{h&&h.valid&&(t("pricingBreakdown",h),t("pricePerNight",h.pricePerNight),t("pricePerFourWeeks",h.fourWeekRent),t("totalPrice",h.reservationTotal))};return u?e.jsxs("div",{className:"section days-selection-section",children:[e.jsx("h3",{className:"section-title",children:"Please confirm your typical weekly schedule"}),e.jsxs("div",{id:"daysSelected",children:[e.jsx(je,{listing:u,initialSelectedDays:_,limitToFiveNights:!1,reservationSpan:o.reservationSpan||13,zatConfig:f,onSelectionChange:O,onPriceChange:P,showPricing:!0}),d.daysSelected&&e.jsx("div",{className:"form-error-message",style:{marginTop:"8px"},children:d.daysSelected})]}),(()=>{const h=(s==null?void 0:s["Weeks offered"])||(s==null?void 0:s.weeks_offered),k=He(h);return k?e.jsx("div",{className:"schedule-notice",style:{backgroundColor:"#E8F4FD",border:"1px solid #B8DAFF",borderRadius:"8px",padding:"10px 14px",marginTop:"16px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{style:{fontSize:"16px"},children:"ğŸ“…"}),e.jsxs("div",{style:{fontSize:"13px",color:"#004085"},children:[e.jsx("strong",{children:"Schedule:"})," ",k.label," â€” ",k.explanation]})]})}):null})(),e.jsx("div",{className:"pricing-display",style:{marginTop:"16px"},children:e.jsxs("p",{children:[e.jsx("strong",{children:"Price per Night:"})," $",((E=o.pricePerNight)==null?void 0:E.toFixed(2))||"0.00"]})})]}):e.jsx("div",{className:"section days-selection-section",children:e.jsx("p",{children:"Loading schedule selector..."})})}const ze=[2,3,4,1],Le=[2,1],Ye=1,$e=()=>{m.useEffect(()=>{const o=document.body.style.overflow,t=document.body.style.paddingRight,s=window.innerWidth-document.documentElement.clientWidth;return document.body.style.overflow="hidden",s>0&&(document.body.style.paddingRight=`${s}px`),()=>{document.body.style.overflow=o,document.body.style.paddingRight=t}},[])},ae="splitlease_proposal_draft_",Be=o=>{if(!o)return null;try{const t=localStorage.getItem(`${ae}${o}`);return t?JSON.parse(t):null}catch(t){return console.warn("Failed to load proposal draft:",t),null}},Ge=(o,t)=>{if(o)try{localStorage.setItem(`${ae}${o}`,JSON.stringify(t))}catch(s){console.warn("Failed to save proposal draft:",s)}},at=o=>{if(o)try{localStorage.removeItem(`${ae}${o}`),console.log("ğŸ—‘ï¸ Cleared proposal draft from localStorage for listing:",o)}catch(t){console.warn("Failed to clear proposal draft:",t)}};function nt({listing:o,moveInDate:t,daysSelected:s=[],nightsSelected:f=0,reservationSpan:d=13,pricingBreakdown:l=null,zatConfig:a=null,isFirstProposal:n=!0,useFullFlow:g=!1,existingUserData:u=null,onClose:_,onSubmit:O,isSubmitting:P=!1}){$e();const{toasts:E,showToast:h,removeToast:k}=Ce(),S=o==null?void 0:o._id,y=Be(S),V=y&&(y.needForSpace||y.aboutYourself),j=g?ze:Le,W=g||n,[F,R]=m.useState(W?j[0]:Ye),[z,G]=m.useState(0),[L,D]=m.useState(!1),[I,Q]=m.useState(l),[Y,K]=m.useState(s),[te,X]=m.useState(f);m.useEffect(()=>{console.log("ğŸ“‹ CreateProposalFlowV2 initialized with data from View page:",{moveInDate:t,daysSelected:s,nightsSelected:f,reservationSpan:d,isFirstProposal:n,hasExistingUserData:!!(u!=null&&u.needForSpace||u!=null&&u.aboutYourself),pricingBreakdown:{pricePerNight:l==null?void 0:l.pricePerNight,fourWeekRent:l==null?void 0:l.fourWeekRent,reservationTotal:l==null?void 0:l.reservationTotal,valid:l==null?void 0:l.valid}}),console.log("ğŸ” isFirstProposal debug:",{value:n,type:typeof n,strictEquals0:n===0,strictEqualsTrue:n===!0,strictEqualsFalse:n===!1}),V&&console.log("ğŸ“‚ Loaded saved proposal draft from localStorage:",y),u&&console.log("ğŸ‘¤ User profile data available for prefilling:",{needForSpace:u.needForSpace?"present":"empty",aboutYourself:u.aboutYourself?"present":"empty",hasUniqueRequirements:u.hasUniqueRequirements}),console.log(`ğŸ“ Starting flow: ${W?`Sequential flow (${g?"full":"short"}) [${j.join(" -> ")}], starting at step 1 (section ${j[0]})`:"1 (Review - returning user, hub-and-spoke model)"}`)},[]);const r=i=>i.map(x=>U[x.dayOfWeek]),b=i=>i.map(x=>{const v=U.indexOf(x);return{id:`day-${v}`,dayOfWeek:v,name:x,abbreviation:x.substring(0,3),isSelected:!0}}),w=i=>{if(!i||i.length===0)return{checkIn:"Monday",checkOut:"Friday"};const v=[...i].sort((H,A)=>H.dayOfWeek-A.dayOfWeek).map(H=>H.dayOfWeek),B=v.includes(6),se=v.includes(0);if(B&&se&&i.length<7){let H=-1;for(let A=0;A<v.length-1;A++)if(v[A+1]-v[A]>1){H=A+1;break}if(H!==-1){const A=v[H],ge=v[H-1];return{checkIn:U[A],checkOut:U[ge]}}}const re=v[0],ye=v[v.length-1];return{checkIn:U[re],checkOut:U[ye]}},{checkIn:C,checkOut:q}=w(s),J=i=>{const x=(i==null?void 0:i.fourWeekRent)||0,v=(o==null?void 0:o["ğŸ’°Damage Deposit"])||0,B=(o==null?void 0:o["ğŸ’°Cleaning Cost / Maintenance Fee"])||0;return x+v+B},$={needForSpace:(u==null?void 0:u.needForSpace)||(y==null?void 0:y.needForSpace)||"",aboutYourself:(u==null?void 0:u.aboutYourself)||(y==null?void 0:y.aboutYourself)||"",hasUniqueRequirements:(u==null?void 0:u.hasUniqueRequirements)??(y==null?void 0:y.hasUniqueRequirements)??!1,uniqueRequirements:(u==null?void 0:u.uniqueRequirements)||(y==null?void 0:y.uniqueRequirements)||""},[p,T]=m.useState({moveInDate:t||"",daysSelected:r(s),reservationSpan:d||13,checkInDay:C,checkOutDay:q,needForSpace:$.needForSpace,aboutYourself:$.aboutYourself,hasUniqueRequirements:$.hasUniqueRequirements,uniqueRequirements:$.uniqueRequirements,moveInRange:"",pricePerNight:(l==null?void 0:l.pricePerNight)||0,numberOfNights:f*d,totalPrice:(l==null?void 0:l.reservationTotal)||0,pricePerFourWeeks:(l==null?void 0:l.fourWeekRent)||0,damageDeposit:(o==null?void 0:o["ğŸ’°Damage Deposit"])||0,maintenanceFee:(o==null?void 0:o["ğŸ’°Cleaning Cost / Maintenance Fee"])||0,firstFourWeeksTotal:J(l),listingId:o==null?void 0:o._id,listingAddress:(o==null?void 0:o.Name)||(o==null?void 0:o.address)});m.useEffect(()=>{if(I&&I.valid){console.log("ğŸ’° Updating proposal data with pricing from ListingScheduleSelector:",I);const x=(Y.length-1)*p.reservationSpan,v=J(I);T(B=>({...B,pricePerNight:I.pricePerNight,pricePerFourWeeks:I.fourWeekRent,totalPrice:I.reservationTotal,numberOfNights:x,firstFourWeeksTotal:v}))}},[I,Y,p.reservationSpan]),m.useEffect(()=>{if(!S)return;const i={needForSpace:p.needForSpace,aboutYourself:p.aboutYourself,hasUniqueRequirements:p.hasUniqueRequirements,uniqueRequirements:p.uniqueRequirements};(i.needForSpace||i.aboutYourself)&&(Ge(S,i),console.log("ğŸ’¾ Saved proposal draft to localStorage"))},[S,p.needForSpace,p.aboutYourself,p.hasUniqueRequirements,p.uniqueRequirements]);const N=m.useMemo(()=>o?{id:o._id,minimumNights:o["Minimum Nights"]||2,maximumNights:o["Maximum Nights"]||7,"rental type":o["rental type"]||"Nightly","Weeks offered":o["Weeks offered"]||"Every week","ğŸ’°Unit Markup":o["ğŸ’°Unit Markup"]||0,"ğŸ’°Nightly Host Rate for 2 nights":o["ğŸ’°Nightly Host Rate for 2 nights"],"ğŸ’°Nightly Host Rate for 3 nights":o["ğŸ’°Nightly Host Rate for 3 nights"],"ğŸ’°Nightly Host Rate for 4 nights":o["ğŸ’°Nightly Host Rate for 4 nights"],"ğŸ’°Nightly Host Rate for 5 nights":o["ğŸ’°Nightly Host Rate for 5 nights"],"ğŸ’°Nightly Host Rate for 7 nights":o["ğŸ’°Nightly Host Rate for 7 nights"],"ğŸ’°Weekly Host Rate":o["ğŸ’°Weekly Host Rate"],"ğŸ’°Monthly Host Rate":o["ğŸ’°Monthly Host Rate"],"ğŸ’°Price Override":o["ğŸ’°Price Override"],"ğŸ’°Cleaning Cost / Maintenance Fee":o["ğŸ’°Cleaning Cost / Maintenance Fee"],"ğŸ’°Damage Deposit":o["ğŸ’°Damage Deposit"]}:null,[o]);m.useEffect(()=>{if(!Y||Y.length<2||!N)return;console.log("ğŸ“Š Recalculating prices due to reservationSpan change:",p.reservationSpan);const i=Se(Y);if(i.length===0)return;const x=Ne(i,N,p.reservationSpan,a);console.log("ğŸ’° New price breakdown after reservationSpan change:",x),Q(x)},[p.reservationSpan,N,a]);const M=(i,x)=>{if(i==="pricingBreakdown"&&x&&typeof x=="object"){console.log("ğŸ’° Received full pricing breakdown from DaysSelectionSection:",x),Q(x);return}if((i==="pricePerNight"||i==="pricePerFourWeeks"||i==="totalPrice")&&(console.log(`ğŸ’° Pricing field '${i}' updated to:`,x),i==="pricePerNight"&&typeof x=="object")){Q(x);return}if(i==="daysSelected"&&Array.isArray(x)){const v=b(x);K(v),X(x.length-1);const{checkIn:B,checkOut:se}=w(v);T(re=>({...re,daysSelected:x,checkInDay:B,checkOutDay:se}));return}T(v=>({...v,[i]:x}))},le=()=>{R(2),D(!0),console.log("ğŸ“ Edit: Jumping to User Details (section 2) from Review")},ce=()=>{R(3),D(!0),console.log("ğŸ“ Edit: Jumping to Move-in (section 3) from Review")},de=()=>{R(4),D(!0),console.log("ğŸ“ Edit: Jumping to Days Selection (section 4) from Review")},ue=()=>{if(pe()){if(L){R(1),D(!1);const i=j.indexOf(1);i!==-1&&G(i),console.log("ğŸ“ Edit complete: Returning to Review section");return}if(W){const i=z+1;i<j.length&&(G(i),R(j[i]),console.log(`ğŸ“ Sequential flow (${g?"full":"short"}): Moving to step ${i+1} (section ${j[i]})`))}else R(1),console.log("ğŸ“ Returning user (hub-and-spoke): Back to Review section")}},he=()=>{if(L){R(1),D(!1);const i=j.indexOf(1);i!==-1&&G(i),console.log("ğŸ“ Edit cancelled: Returning to Review section");return}if(W){if(z>0){const i=z-1;G(i),R(j[i]),console.log(`ğŸ“ Sequential flow (${g?"full":"short"}): Going back to step ${i+1} (section ${j[i]})`)}}else F!==1&&(R(1),console.log("ğŸ“ Returning user (hub-and-spoke): Back to Review section"))},pe=()=>{switch(F){case 2:return!p.needForSpace||!p.aboutYourself?(h({title:"Required Fields Missing",content:"Please fill in all required fields (minimum 10 words each)",type:"warning"}),!1):p.hasUniqueRequirements&&!p.uniqueRequirements?(h({title:"Required Field Missing",content:"Please describe your unique requirements",type:"warning"}),!1):!0;case 3:return p.moveInDate?!0:(h({title:"Move-in Date Required",content:"Please select a move-in date",type:"warning"}),!1);case 4:return!p.daysSelected||p.daysSelected.length===0?(h({title:"Days Selection Required",content:"Please select at least one day",type:"warning"}),!1):!0;default:return!0}},me=()=>{const i={...p,daysSelectedObjects:b(p.daysSelected),listingId:S};O(i)},fe=()=>{switch(F){case 1:return e.jsx(qe,{data:p,listing:o,onEditUserDetails:le,onEditMoveIn:ce,onEditDays:de});case 2:return e.jsx(Ee,{data:p,updateData:M});case 3:return e.jsx(Te,{data:p,updateData:M,listing:o});case 4:return e.jsx(Oe,{data:p,updateData:M,listing:o,zatConfig:a});default:return null}},xe=()=>{switch(F){case 1:return"Confirm Proposal";case 2:return"Create Proposal";case 3:return"Adjust Proposal";case 4:return"Adjust Proposal";default:return"Create Proposal"}},oe=()=>F===2?"Start the conversation! After submitting a proposal, you'll begin a negotiation process with the host to finalize the details of your booking.":null;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"create-proposal-popup",children:e.jsxs("div",{className:"proposal-container",children:[e.jsxs("div",{className:"proposal-header",children:[e.jsxs("div",{className:"proposal-header-top",style:{marginBottom:oe()?"15px":"0"},children:[e.jsxs("div",{className:"proposal-title",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#31135D",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",style:{marginRight:"8px",verticalAlign:"middle"},children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),xe()]}),e.jsx("button",{className:"close-button",onClick:_,children:"âœ•"})]}),oe()&&e.jsx("p",{className:"proposal-subtitle",children:oe()})]}),e.jsx("div",{className:"proposal-content",children:fe()}),e.jsxs("div",{className:"navigation-buttons",children:[(L||(W?z>0:F!==1))&&e.jsx("button",{className:"nav-button back",onClick:he,children:L?"Cancel":"Go back"}),F===1?e.jsx("button",{className:`nav-button next ${P?"submitting":""}`,onClick:me,disabled:P,children:P?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"button-spinner"}),"Submitting..."]}):"Submit Proposal"}):e.jsx("button",{className:"nav-button next",onClick:ue,children:L?"Save & Review":W?z===j.length-2?"Review Proposal":"Next":F===2?"Next":"Yes, Continue"})]})]})}),E&&E.length>0&&e.jsx(Fe,{toasts:E,onRemove:k})]})}function it({proposalId:o,listingName:t,onClose:s,hasSubmittedRentalApp:f=!1}){const d=()=>{window.location.href=`/rental-application?proposal=${o}`},l=()=>{window.location.href=`/guest-proposals?proposal=${o}`},a={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e4,animation:"fadeIn 0.2s ease-in-out"},modal:{position:"relative",background:"#FFFFFF",borderRadius:"16px",padding:"24px",maxWidth:"420px",width:"90%",maxHeight:"90vh",overflowY:"auto",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.12)",animation:"slideUp 0.3s ease-out"},closeButton:{position:"absolute",top:"12px",right:"12px",background:"transparent",border:"none",fontSize:"24px",cursor:"pointer",color:"#666",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",transition:"all 0.2s ease"},successIcon:{width:"64px",height:"64px",backgroundColor:"#dcfce7",color:"#16a34a",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 20px auto"},title:{fontSize:"20px",fontWeight:"600",color:"#1f2937",textAlign:"center",marginBottom:"8px"},subtitle:{fontSize:"14px",color:"#6b7280",textAlign:"center",marginBottom:"20px",lineHeight:"1.5"},listingName:{fontWeight:"500",color:"#7c3aed"},infoBox:{backgroundColor:"#f5f3ff",borderRadius:"8px",padding:"16px",marginBottom:"24px",borderLeft:"4px solid #7c3aed"},infoTitle:{fontSize:"14px",fontWeight:"600",color:"#5b21b6",marginBottom:"8px"},infoText:{fontSize:"14px",color:"#6d28d9",lineHeight:"1.5",margin:0},buttonContainer:{display:"flex",flexDirection:"column",gap:"12px"},primaryButton:{width:"100%",padding:"14px 20px",backgroundColor:"#7c3aed",color:"#FFFFFF",border:"none",borderRadius:"10px",fontSize:"16px",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s ease"},secondaryButton:{width:"100%",padding:"14px 20px",backgroundColor:"#FFFFFF",color:"#7c3aed",border:"2px solid #7c3aed",borderRadius:"10px",fontSize:"16px",fontWeight:"500",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",transition:"all 0.2s ease"},recommendedBadge:{fontSize:"12px",opacity:"0.8"}};return e.jsx("div",{style:a.overlay,onClick:s,children:e.jsxs("div",{style:a.modal,onClick:n=>n.stopPropagation(),children:[e.jsx("button",{onClick:s,style:a.closeButton,"aria-label":"Close modal",onMouseOver:n=>n.target.style.backgroundColor="#f3f4f6",onMouseOut:n=>n.target.style.backgroundColor="transparent",children:"Ã—"}),e.jsx("div",{style:a.successIcon,children:e.jsx("svg",{width:"32",height:"32",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M5 13l4 4L19 7"})})}),e.jsx("h3",{style:a.title,children:"Proposal Submitted!"}),t&&e.jsxs("p",{style:a.subtitle,children:["Your proposal for ",e.jsx("span",{style:a.listingName,children:t})," has been sent to the host."]}),!f&&e.jsxs("div",{style:a.infoBox,children:[e.jsx("h4",{style:a.infoTitle,children:"What's Next?"}),e.jsx("p",{style:a.infoText,children:"Complete your rental application to increase your chances of approval. The host will review your proposal and application together."})]}),f&&e.jsxs("div",{style:a.infoBox,children:[e.jsx("h4",{style:a.infoTitle,children:"What's Next?"}),e.jsx("p",{style:a.infoText,children:"Your rental application is already on file. The host will review your proposal and get back to you soon."})]}),e.jsxs("div",{style:a.buttonContainer,children:[!f&&e.jsxs("button",{onClick:d,style:a.primaryButton,onMouseOver:n=>n.target.style.backgroundColor="#6d28d9",onMouseOut:n=>n.target.style.backgroundColor="#7c3aed",children:[e.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Submit Rental Application",e.jsx("span",{style:a.recommendedBadge,children:"(Recommended)"})]}),e.jsxs("button",{onClick:l,style:f?a.primaryButton:a.secondaryButton,onMouseOver:n=>{f?n.target.style.backgroundColor="#6d28d9":(n.target.style.backgroundColor="#f5f3ff",n.target.style.borderColor="#6d28d9")},onMouseOut:n=>{f?n.target.style.backgroundColor="#7c3aed":(n.target.style.backgroundColor="#FFFFFF",n.target.style.borderColor="#7c3aed")},children:[e.jsx("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})}),"Go to Guest Dashboard"]})]})]})})}export{rt as C,it as P,nt as a,at as c,Me as f};

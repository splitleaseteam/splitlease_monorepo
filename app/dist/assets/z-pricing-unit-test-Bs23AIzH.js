import{r as n,j as e,c as ae}from"./client-BJVKzfAi.js";import{s as H}from"./supabase-BoCLEw6R.js";import{P as U}from"./pricingConstants-B1FVgRNI.js";import{f as se}from"./listingDataFetcher-DGGxiGnp.js";import"./dataLookups-zG18yzis.js";import"./constants-CPVJY5eo.js";const le=["S","M","T","W","T","F","S"],ie=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ne=[1,2,3,4,5,6,8,12,13,26,52],V={weeksCount:4,selectedDays:[1,2,3,4,5]},W={checkInDay:1,nights:5},L={hostCompStyle:"",weeksOffered:"Every week",rate2Night:0,rate3Night:0,rate4Night:0,rate5Night:0,weeklyRate:0,monthlyRate:0,damageDeposit:0,cleaningDeposit:0,nightsAvailable:[],unitMarkup:0,minNights:null,maxNights:null},$={monthly:{proratedNightlyRate:0,markupAndDiscounts:{siteMarkup:0,unitMarkup:0,discount:0,total:0}},weekly:{proratedNightlyRate:0,markupAndDiscounts:{siteMarkup:0,unusedNightsDiscount:0,total:0}},nightly:{baseRate:0,nightPriceMultiplier:1,markupAndDiscounts:{siteMarkup:0,fullTimeDiscount:0,total:0}}},Z={priceExists:!1,rentalTypeSelected:!1,appearsInSearch:!1,discountsPositive:!0,minNightsValid:!1,maxNightsValid:!1,nightlyPricingValid:!1};function re(){const[s,g]=n.useState(null),[j,y]=n.useState([]),[E,b]=n.useState(!1),[S,R]=n.useState(null),[o,_]=n.useState(""),[r,v]=n.useState(null),[p,C]=n.useState(!1),[c,m]=n.useState(V),[D,M]=n.useState(W),[l,f]=n.useState(L),[T,h]=n.useState($),[F,t]=n.useState(Z);n.useEffect(()=>{(async()=>{try{const a=await se();g(a)}catch(a){console.error("[ZPricingUnitTest] Failed to load ZAT config:",a),g({overallSiteMarkup:U.SITE_MARKUP_RATE,fullTimeDiscount:U.FULL_TIME_DISCOUNT_RATE,unusedNightsDiscountMultiplier:.03,avgDaysPerMonth:31})}})()},[]),n.useEffect(()=>{(async()=>{b(!0),R(null);try{let a=H.from("listing").select('_id, Name, Active, Complete, "rental type"').eq("Deleted",!1).order("Name",{ascending:!0}).limit(500);o.trim()&&(a=a.ilike("Name",`%${o.trim()}%`));const{data:u,error:d}=await a;if(d)throw d;y(u||[])}catch(a){console.error("[ZPricingUnitTest] Failed to fetch listings:",a),R("Failed to load listings")}finally{b(!1)}})()},[o]);const N=n.useCallback(async i=>{if(!i){v(null),f(L);return}C(!0);try{const{data:a,error:u}=await H.from("listing").select(`
          _id,
          Name,
          "rental type",
          "Weeks offered",
          "Host Comp Style",
          "ðŸ’°Nightly Host Rate for 2 nights",
          "ðŸ’°Nightly Host Rate for 3 nights",
          "ðŸ’°Nightly Host Rate for 4 nights",
          "ðŸ’°Nightly Host Rate for 5 nights",
          "ðŸ’°Weekly Host Rate",
          "ðŸ’°Monthly Host Rate",
          "ðŸ’°Damage Deposit",
          "ðŸ’°Cleaning Cost / Maintenance Fee",
          "ðŸ’°Unit Markup",
          "Nights_Available",
          "Minimum Nights",
          "Maximum Nights",
          Active,
          Complete,
          Approved
        `).eq("_id",i).single();if(u)throw u;v(a),f({hostCompStyle:a["Host Comp Style"]||"",weeksOffered:a["Weeks offered"]||"Every week",rate2Night:parseFloat(a["ðŸ’°Nightly Host Rate for 2 nights"])||0,rate3Night:parseFloat(a["ðŸ’°Nightly Host Rate for 3 nights"])||0,rate4Night:parseFloat(a["ðŸ’°Nightly Host Rate for 4 nights"])||0,rate5Night:parseFloat(a["ðŸ’°Nightly Host Rate for 5 nights"])||0,weeklyRate:parseFloat(a["ðŸ’°Weekly Host Rate"])||0,monthlyRate:parseFloat(a["ðŸ’°Monthly Host Rate"])||0,damageDeposit:parseFloat(a["ðŸ’°Damage Deposit"])||0,cleaningDeposit:parseFloat(a["ðŸ’°Cleaning Cost / Maintenance Fee"])||0,nightsAvailable:ue(a.Nights_Available),unitMarkup:parseFloat(a["ðŸ’°Unit Markup"])||0,minNights:a["Minimum Nights"],maxNights:a["Maximum Nights"]})}catch(a){console.error("[ZPricingUnitTest] Failed to fetch listing details:",a)}finally{C(!1)}},[]);n.useEffect(()=>{if(!s)return;const i=c.selectedDays.length,a=l.monthlyRate>0?l.monthlyRate/s.avgDaysPerMonth*(1+s.overallSiteMarkup+l.unitMarkup):0,d=(7-i)*s.unusedNightsDiscountMultiplier,k=l.weeklyRate>0?l.weeklyRate/7*(1+s.overallSiteMarkup)*(1-d):0,P={2:l.rate2Night,3:l.rate3Night,4:l.rate4Night,5:l.rate5Night,7:l.weeklyRate/7}[i]||l.rate4Night,w=i===7?s.fullTimeDiscount:0,te=P*(1+s.overallSiteMarkup)*(1-w);h({monthly:{proratedNightlyRate:a,markupAndDiscounts:{siteMarkup:s.overallSiteMarkup,unitMarkup:l.unitMarkup,discount:0,total:a}},weekly:{proratedNightlyRate:k,markupAndDiscounts:{siteMarkup:s.overallSiteMarkup,unusedNightsDiscount:d,total:k}},nightly:{baseRate:P,nightPriceMultiplier:1,markupAndDiscounts:{siteMarkup:s.overallSiteMarkup,fullTimeDiscount:w,total:te}}})},[s,c,D,l]);const O=n.useCallback(i=>({2:l.rate2Night,3:l.rate3Night,4:l.rate4Night,5:l.rate5Night,7:l.weeklyRate/7})[i]||0,[l]);n.useEffect(()=>{const i=c.selectedDays.length,a=l.rate2Night>0||l.rate3Night>0||l.rate4Night>0||l.rate5Night>0||l.weeklyRate>0||l.monthlyRate>0,u=(r==null?void 0:r["rental type"])!==null&&(r==null?void 0:r["rental type"])!==void 0,d=(r==null?void 0:r.Active)===!0&&(r==null?void 0:r.Complete)===!0&&(r==null?void 0:r.Approved)===!0,k=!0,A=!l.minNights||i>=l.minNights,P=!l.maxNights||i<=l.maxNights,w=O(i)>0;t({priceExists:a,rentalTypeSelected:u,appearsInSearch:d,discountsPositive:k,minNightsValid:A,maxNightsValid:P,nightlyPricingValid:w})},[r,l,c,O]);const Y=n.useCallback(i=>{_(i)},[]),B=n.useCallback(i=>{m(a=>({...a,weeksCount:parseInt(i)}))},[]),q=n.useCallback(i=>{m(a=>{const u=[...a.selectedDays],d=u.indexOf(i);return d>-1?u.splice(d,1):(u.push(i),u.sort((k,A)=>k-A)),{...a,selectedDays:u}})},[]),K=n.useCallback((i,a)=>{M(u=>({...u,[i]:a}))},[]),J=n.useCallback((i,a)=>{f(u=>({...u,[i]:parseFloat(a)||0}))},[]),Q=n.useCallback(()=>{v(null),m(V),M(W),f(L),h($),t(Z)},[]),X=n.useMemo(()=>c.selectedDays.length,[c.selectedDays]),ee=n.useMemo(()=>{if(!o.trim())return j;const i=o.toLowerCase();return j.filter(a=>{var u,d;return((u=a.Name)==null?void 0:u.toLowerCase().includes(i))||((d=a._id)==null?void 0:d.toLowerCase().includes(i))})},[j,o]);return{DAY_NAMES:le,DAY_FULL_NAMES:ie,WEEKS_COUNT_OPTIONS:ne,zatConfig:s,listings:ee,listingsLoading:E,listingsError:S,searchTerm:o,selectedListing:r,selectedListingLoading:p,reservationConfig:c,guestPattern:D,hostRates:l,nightsCount:X,pricingOutput:T,scorecard:F,handleSearchChange:Y,handleListingSelect:N,handleWeeksCountChange:B,handleDayToggle:q,handleGuestPatternChange:K,handleHostRateChange:J,handleReset:Q}}function ue(s){if(Array.isArray(s))return s;if(typeof s=="string")try{return JSON.parse(s)}catch{return[]}return[]}function G(){return e.jsxs("div",{className:"zput-loading",children:[e.jsx("div",{className:"zput-spinner"}),e.jsx("span",{children:"Loading..."})]})}function ce({message:s}){return e.jsx("div",{className:"zput-error",children:s})}function oe({day:s,index:g,isActive:j,onClick:y}){return e.jsx("button",{type:"button",className:`zput-day-btn ${j?"active":""}`,onClick:()=>y(g),title:s,children:s.charAt(0)})}function z({label:s,isValid:g}){return e.jsxs("div",{className:"zput-check-item",children:[e.jsx("span",{className:`zput-check-badge ${g?"yes":"no"}`,children:g?"YES":"NO"}),e.jsx("span",{className:"zput-check-label",children:s})]})}function I(s){return typeof s!="number"||isNaN(s)?"$0.00":`$${s.toFixed(2)}`}function x(s){return typeof s!="number"||isNaN(s)?"0%":`${(s*100).toFixed(1)}%`}function pe(){const{DAY_NAMES:s,DAY_FULL_NAMES:g,WEEKS_COUNT_OPTIONS:j,zatConfig:y,listings:E,listingsLoading:b,listingsError:S,searchTerm:R,selectedListing:o,selectedListingLoading:_,reservationConfig:r,guestPattern:v,hostRates:p,nightsCount:C,pricingOutput:c,scorecard:m,handleSearchChange:D,handleListingSelect:M,handleWeeksCountChange:l,handleDayToggle:f,handleGuestPatternChange:T,handleHostRateChange:h,handleReset:F}=re();return e.jsxs("div",{className:"zput-page",children:[e.jsxs("header",{className:"zput-header",children:[e.jsx("h1",{children:"Z-Pricing Unit Test"}),e.jsx("p",{children:"Internal pricing engine testing and validation tool"})]}),e.jsxs("div",{className:"zput-container",children:[e.jsx("div",{className:"zput-column zput-column-listing",children:e.jsxs("div",{className:"zput-panel",children:[e.jsx("h2",{className:"zput-panel-header",children:"Listing Selector"}),e.jsxs("div",{className:"zput-form-group",children:[e.jsx("label",{className:"zput-label",children:"Search Listings"}),e.jsx("input",{type:"text",className:"zput-input",placeholder:"Search by name or ID...",value:R,onChange:t=>D(t.target.value)})]}),e.jsxs("div",{className:"zput-form-group",children:[e.jsx("label",{className:"zput-label",children:"Select Listing"}),b?e.jsx(G,{}):S?e.jsx(ce,{message:S}):e.jsxs("select",{className:"zput-select",value:(o==null?void 0:o._id)||"",onChange:t=>M(t.target.value),children:[e.jsx("option",{value:"",children:"-- Select a listing --"}),E.map(t=>e.jsx("option",{value:t._id,children:t.Name||t._id},t._id))]})]}),o&&e.jsx("div",{className:"zput-form-group",children:e.jsxs("p",{className:"zput-info-text",children:["ID: ",o._id,e.jsx("br",{}),"Status: ",o.Active?"Active":"Inactive",o.Complete?", Complete":"",o.Approved?", Approved":""]})}),e.jsx("button",{type:"button",className:"zput-btn zput-btn-secondary",onClick:F,style:{width:"100%",marginTop:"16px"},children:"Reset All"})]})}),e.jsxs("div",{className:"zput-column zput-column-config",children:[e.jsxs("div",{className:"zput-panel",children:[e.jsx("h2",{className:"zput-panel-header",children:"Reservation Span Configuration"}),e.jsxs("div",{className:"zput-form-group",children:[e.jsx("label",{className:"zput-label",children:"Weeks Count"}),e.jsx("select",{className:"zput-select",value:r.weeksCount,onChange:t=>l(t.target.value),children:j.map(t=>e.jsxs("option",{value:t,children:[t," week",t>1?"s":""]},t))})]}),e.jsxs("div",{className:"zput-form-group",children:[e.jsx("label",{className:"zput-label",children:"Day Pattern"}),e.jsx("div",{className:"zput-day-toggles",children:s.map((t,N)=>e.jsx(oe,{day:g[N],index:N,isActive:r.selectedDays.includes(N),onClick:f},N))}),e.jsxs("p",{className:"zput-info-text",children:["Selected: ",C," night",C!==1?"s":""," per week"]})]})]}),e.jsxs("div",{className:"zput-panel",children:[e.jsx("h2",{className:"zput-panel-header",children:"Guest Desired Pattern"}),e.jsxs("div",{className:"zput-inline-row",children:[e.jsxs("div",{className:"zput-inline-field",children:[e.jsx("label",{className:"zput-label",children:"Check-in Day"}),e.jsx("select",{className:"zput-select",value:v.checkInDay,onChange:t=>T("checkInDay",parseInt(t.target.value)),children:g.map((t,N)=>e.jsx("option",{value:N,children:t},N))})]}),e.jsxs("div",{className:"zput-inline-field",children:[e.jsx("label",{className:"zput-label",children:"Nights"}),e.jsx("input",{type:"number",className:"zput-input",min:"1",max:"7",value:v.nights,onChange:t=>T("nights",parseInt(t.target.value)||1)})]})]})]}),e.jsxs("div",{className:"zput-panel",children:[e.jsx("h2",{className:"zput-panel-header",children:"Host Prices Input"}),e.jsxs("div",{className:"zput-form-group",children:[e.jsx("label",{className:"zput-label",children:"Host Comp Style"}),e.jsx("input",{type:"text",className:"zput-input",value:p.hostCompStyle,onChange:t=>h("hostCompStyle",t.target.value)})]}),e.jsxs("div",{className:"zput-form-group",children:[e.jsx("label",{className:"zput-label",children:"Weeks Offered"}),e.jsx("input",{type:"text",className:"zput-input",value:p.weeksOffered,readOnly:!0})]}),e.jsx("h3",{className:"zput-panel-subheader",children:"Nightly Host Rates"}),e.jsxs("div",{className:"zput-rates-grid",children:[e.jsxs("div",{className:"zput-rate-item",children:[e.jsx("span",{className:"zput-rate-label",children:"2-Night Rate"}),e.jsx("input",{type:"number",className:"zput-rate-input",value:p.rate2Night||"",onChange:t=>h("rate2Night",t.target.value),placeholder:"$0.00"})]}),e.jsxs("div",{className:"zput-rate-item",children:[e.jsx("span",{className:"zput-rate-label",children:"3-Night Rate"}),e.jsx("input",{type:"number",className:"zput-rate-input",value:p.rate3Night||"",onChange:t=>h("rate3Night",t.target.value),placeholder:"$0.00"})]}),e.jsxs("div",{className:"zput-rate-item",children:[e.jsx("span",{className:"zput-rate-label",children:"4-Night Rate"}),e.jsx("input",{type:"number",className:"zput-rate-input",value:p.rate4Night||"",onChange:t=>h("rate4Night",t.target.value),placeholder:"$0.00"})]}),e.jsxs("div",{className:"zput-rate-item",children:[e.jsx("span",{className:"zput-rate-label",children:"5-Night Rate"}),e.jsx("input",{type:"number",className:"zput-rate-input",value:p.rate5Night||"",onChange:t=>h("rate5Night",t.target.value),placeholder:"$0.00"})]})]}),e.jsx("h3",{className:"zput-panel-subheader",children:"Weekly and Monthly Rates"}),e.jsxs("div",{className:"zput-rates-grid",children:[e.jsxs("div",{className:"zput-rate-item",children:[e.jsx("span",{className:"zput-rate-label",children:"Weekly Host Rate"}),e.jsx("input",{type:"number",className:"zput-rate-input",value:p.weeklyRate||"",onChange:t=>h("weeklyRate",t.target.value),placeholder:"$0.00"})]}),e.jsxs("div",{className:"zput-rate-item",children:[e.jsx("span",{className:"zput-rate-label",children:"Monthly Host Rate"}),e.jsx("input",{type:"number",className:"zput-rate-input",value:p.monthlyRate||"",onChange:t=>h("monthlyRate",t.target.value),placeholder:"$0.00"})]})]}),e.jsx("h3",{className:"zput-panel-subheader",children:"Deposits"}),e.jsxs("div",{className:"zput-rates-grid",children:[e.jsxs("div",{className:"zput-rate-item",children:[e.jsx("span",{className:"zput-rate-label",children:"Damage Deposit"}),e.jsx("input",{type:"number",className:"zput-rate-input",value:p.damageDeposit||"",onChange:t=>h("damageDeposit",t.target.value),placeholder:"$0.00"})]}),e.jsxs("div",{className:"zput-rate-item",children:[e.jsx("span",{className:"zput-rate-label",children:"Cleaning Deposit"}),e.jsx("input",{type:"number",className:"zput-rate-input",value:p.cleaningDeposit||"",onChange:t=>h("cleaningDeposit",t.target.value),placeholder:"$0.00"})]})]}),e.jsxs("div",{className:"zput-form-group",style:{marginTop:"16px"},children:[e.jsx("label",{className:"zput-label",children:"Unit Markup"}),e.jsx("input",{type:"number",className:"zput-input zput-input-small",step:"0.01",value:p.unitMarkup||"",onChange:t=>h("unitMarkup",t.target.value),placeholder:"0.00"}),e.jsx("span",{className:"zput-info-text",children:"(e.g., 0.05 = 5%)"})]})]})]}),e.jsxs("div",{className:"zput-column zput-column-output",children:[e.jsxs("div",{className:"zput-panel",children:[e.jsx("h2",{className:"zput-panel-header",children:"Pricing Calculations Output"}),_?e.jsx(G,{}):e.jsxs("div",{className:"zput-output-grid",children:[e.jsxs("div",{className:"zput-output-panel",children:[e.jsx("div",{className:"zput-output-title",children:"Monthly"}),e.jsxs("div",{className:"zput-output-row",children:[e.jsx("span",{className:"zput-output-label",children:"Prorated Nightly Rate"}),e.jsx("span",{className:"zput-output-value highlight",children:I(c.monthly.proratedNightlyRate)})]}),e.jsxs("div",{className:"zput-output-row",children:[e.jsx("span",{className:"zput-output-label",children:"Site Markup"}),e.jsx("span",{className:"zput-output-value",children:x(c.monthly.markupAndDiscounts.siteMarkup)})]}),e.jsxs("div",{className:"zput-output-row",children:[e.jsx("span",{className:"zput-output-label",children:"Unit Markup"}),e.jsx("span",{className:"zput-output-value",children:x(c.monthly.markupAndDiscounts.unitMarkup)})]})]}),e.jsxs("div",{className:"zput-output-panel",children:[e.jsx("div",{className:"zput-output-title",children:"Weekly"}),e.jsxs("div",{className:"zput-output-row",children:[e.jsx("span",{className:"zput-output-label",children:"Prorated Nightly Rate"}),e.jsx("span",{className:"zput-output-value highlight",children:I(c.weekly.proratedNightlyRate)})]}),e.jsxs("div",{className:"zput-output-row",children:[e.jsx("span",{className:"zput-output-label",children:"Site Markup"}),e.jsx("span",{className:"zput-output-value",children:x(c.weekly.markupAndDiscounts.siteMarkup)})]}),e.jsxs("div",{className:"zput-output-row",children:[e.jsx("span",{className:"zput-output-label",children:"Unused Nights Discount"}),e.jsx("span",{className:"zput-output-value",children:x(c.weekly.markupAndDiscounts.unusedNightsDiscount)})]})]}),e.jsxs("div",{className:"zput-output-panel",children:[e.jsx("div",{className:"zput-output-title",children:"Nightly"}),e.jsxs("div",{className:"zput-output-row",children:[e.jsx("span",{className:"zput-output-label",children:"Base Rate"}),e.jsx("span",{className:"zput-output-value",children:I(c.nightly.baseRate)})]}),e.jsxs("div",{className:"zput-output-row",children:[e.jsx("span",{className:"zput-output-label",children:"With Markup"}),e.jsx("span",{className:"zput-output-value highlight",children:I(c.nightly.markupAndDiscounts.total)})]}),e.jsxs("div",{className:"zput-output-row",children:[e.jsx("span",{className:"zput-output-label",children:"Site Markup"}),e.jsx("span",{className:"zput-output-value",children:x(c.nightly.markupAndDiscounts.siteMarkup)})]}),e.jsxs("div",{className:"zput-output-row",children:[e.jsx("span",{className:"zput-output-label",children:"Full-Time Discount"}),e.jsx("span",{className:"zput-output-value",children:x(c.nightly.markupAndDiscounts.fullTimeDiscount)})]})]})]})]}),e.jsxs("div",{className:"zput-panel zput-scorecard",children:[e.jsx("h2",{className:"zput-panel-header",children:"Data Check Scorecard"}),e.jsxs("div",{className:"zput-scorecard-grid",children:[e.jsx(z,{label:"Price Exists",isValid:m.priceExists}),e.jsx(z,{label:"Rental Type Selected",isValid:m.rentalTypeSelected}),e.jsx(z,{label:"Appears in Search",isValid:m.appearsInSearch}),e.jsx(z,{label:"Discounts Positive",isValid:m.discountsPositive}),e.jsx(z,{label:"Min Nights Valid",isValid:m.minNightsValid}),e.jsx(z,{label:"Max Nights Valid",isValid:m.maxNightsValid}),e.jsx(z,{label:"Nightly Pricing Valid",isValid:m.nightlyPricingValid})]}),y&&e.jsx("div",{style:{marginTop:"16px",padding:"12px",background:"#F9FAFB",borderRadius:"6px"},children:e.jsxs("p",{className:"zput-info-text",style:{margin:0},children:[e.jsx("strong",{children:"Global Config:"})," Site Markup: ",x(y.overallSiteMarkup),", Full-Time Discount: ",x(y.fullTimeDiscount),", Unused Nights Multiplier: ",x(y.unusedNightsDiscountMultiplier)]})})]})]})]})]})}const he=ae(document.getElementById("root"));he.render(e.jsx(pe,{}));

import{r as i,j as e,c as R}from"./client-BJVKzfAi.js";import{s as B}from"./supabase-BoCLEw6R.js";import{g as I,a as O,c as W,i as U}from"./dataLookups-zG18yzis.js";import{W as q}from"./constants-CPVJY5eo.js";import{S as Z}from"./SearchScheduleSelector-KBnRs4ik.js";const S={selectedBorough:"",selectedNeighborhood:"",selectedDays:[1,2,3,4,5],weekPattern:"every-week",showActive:!0,showApproved:!0,showComplete:!0,showDefault:!1,sortBy:"recommended",priceMin:null,priceMax:null};function H(){const[o]=i.useState({isChecking:!1,isAuthenticated:!0,isAdmin:!0,shouldRedirect:!1}),[r,h]=i.useState([]),[f,p]=i.useState([]),[a,u]=i.useState(S),[y,j]=i.useState([]),[z,k]=i.useState(!1),[g,b]=i.useState(null),[C,A]=i.useState(0);i.useEffect(()=>{(async()=>{W()||await U()})()},[]),i.useEffect(()=>{(async()=>{try{const{data:s,error:n}=await B.schema("reference_table").from("zat_geo_borough_toplevel").select('_id, "Display Borough"').order('"Display Borough"',{ascending:!0});if(n)throw n;const m=s.filter(c=>{var v;return(v=c["Display Borough"])==null?void 0:v.trim()}).map(c=>({id:c._id,name:c["Display Borough"].trim(),value:c["Display Borough"].trim().toLowerCase().replace(/\s+/g,"-")}));h(m);const x=m.find(c=>c.value==="manhattan");x?u(c=>({...c,selectedBorough:x.value})):m.length>0&&u(c=>({...c,selectedBorough:m[0].value}))}catch(s){console.error("[ZSearchUnitTest] Failed to load boroughs:",s),b("Failed to load boroughs")}})()},[]),i.useEffect(()=>{(async()=>{if(!a.selectedBorough||r.length===0)return;const s=r.find(n=>n.value===a.selectedBorough);if(s)try{const{data:n,error:m}=await B.schema("reference_table").from("zat_geo_hood_mediumlevel").select('_id, Display, "Geo-Borough"').eq('"Geo-Borough"',s.id).order("Display",{ascending:!0});if(m)throw m;const x=n.filter(c=>{var v;return(v=c.Display)==null?void 0:v.trim()}).map(c=>({id:c._id,name:c.Display.trim(),boroughId:c["Geo-Borough"]}));p(x),u(c=>({...c,selectedNeighborhood:""}))}catch(n){console.error("[ZSearchUnitTest] Failed to load neighborhoods:",n)}})()},[a.selectedBorough,r]);const N=i.useCallback(async()=>{if(!(!a.selectedBorough||r.length===0)){k(!0),b(null);try{const l=r.find(d=>d.value===a.selectedBorough);if(!l)throw new Error("Borough not found");let s=B.from("listing").select("*",{count:"exact"}).eq('"Location - Borough"',l.id);if(a.showActive&&(s=s.eq("Active",!0)),a.showApproved&&(s=s.eq("Approved",!0)),a.showComplete&&(s=s.eq('"Complete"',!0)),a.showDefault||(s=s.eq("isForUsability",!1)),a.selectedNeighborhood&&(s=s.eq('"Location - Hood"',a.selectedNeighborhood)),a.weekPattern!=="every-week"){const d=q[a.weekPattern];d&&(s=s.eq('"Weeks offered"',d))}a.priceMin!==null&&(s=s.gte('"Standarized Minimum Nightly Price (Filter)"',a.priceMin)),a.priceMax!==null&&(s=s.lte('"Standarized Minimum Nightly Price (Filter)"',a.priceMax));const n={recommended:{field:'"Modified Date"',ascending:!1},"price-low":{field:'"Standarized Minimum Nightly Price (Filter)"',ascending:!0},"price-high":{field:'"Standarized Minimum Nightly Price (Filter)"',ascending:!1},newest:{field:'"Created Date"',ascending:!1}}[a.sortBy]||{field:'"Modified Date"',ascending:!1};s=s.order(n.field,{ascending:n.ascending});const{data:m,error:x}=await s;if(x)throw x;const v=G(m||[],a.selectedDays).map(d=>({id:d._id,name:d.Name||"Untitled Listing",borough:O(d["Location - Borough"]),neighborhood:I(d["Location - Hood"]),nightlyPrice:d["Standarized Minimum Nightly Price (Filter)"]||0,daysAvailable:d["Days Available (List of Days)"]||[],nightsAvailable:d.Nights_Available||[],weeksOffered:d["Weeks offered"]||"Every week",isActive:d.Active||!1,isComplete:d.Complete||!1,isApproved:d.Approved||!1,modifiedDate:d["Modified Date"],createdDate:d["Created Date"]}));j(v),A(v.length)}catch(l){console.error("[ZSearchUnitTest] Fetch failed:",l),b("Failed to fetch listings"),j([]),A(0)}finally{k(!1)}}},[a,r]);i.useEffect(()=>{r.length>0&&a.selectedBorough&&N()},[N,r.length,a.selectedBorough]);const t=i.useCallback(l=>{u(s=>({...s,selectedBorough:l}))},[]),D=i.useCallback(l=>{u(s=>({...s,selectedNeighborhood:l}))},[]),P=i.useCallback(l=>{const s=l.map(n=>n.index);u(n=>({...n,selectedDays:s}))},[]),F=i.useCallback(l=>{u(s=>({...s,weekPattern:l}))},[]),L=i.useCallback((l,s)=>{u(n=>({...n,[l]:s}))},[]),_=i.useCallback(l=>{u(s=>({...s,sortBy:l}))},[]),E=i.useCallback((l,s)=>{u(n=>({...n,priceMin:l,priceMax:s}))},[]),M=i.useCallback(()=>{var s;const l=r.find(n=>n.value==="manhattan");u({...S,selectedBorough:(l==null?void 0:l.value)||((s=r[0])==null?void 0:s.value)||""})},[r]),T=i.useCallback(()=>{b(null),N()},[N]);return{authState:o,boroughs:r,neighborhoods:f,filters:a,listings:y,isLoading:z,error:g,totalCount:C,handleBoroughChange:t,handleNeighborhoodChange:D,handleDaysChange:P,handleWeekPatternChange:F,handleAttributeFilterChange:L,handleSortChange:_,handlePriceFilterChange:E,handleResetFilters:M,handleRetry:T}}function w(o){if(Array.isArray(o))return o;if(typeof o=="string")try{return JSON.parse(o)}catch{return[]}return[]}function G(o,r){if(!r||r.length===0)return o;const h=r;return o.filter(f=>{const p=w(f["Days Available (List of Days)"]),a=w(f.Days_Not_Available),u=w(f.Nights_Available),y=w(f.Nights_Not_Available);return!(!r.every(g=>p.includes(g))||!!r.some(g=>a.includes(g))||u.length>0&&!h.every(b=>u.includes(b))||!!r.some(g=>y.includes(g)))})}const K=[{value:"every-week",label:"Every Week"},{value:"one-on-off",label:"1 Week On, 1 Off"},{value:"two-on-off",label:"2 Weeks On, 2 Off"},{value:"one-three-off",label:"1 Week On, 3 Off"}],$=[{value:"recommended",label:"Recommended"},{value:"price-low",label:"Price: Low to High"},{value:"price-high",label:"Price: High to Low"},{value:"newest",label:"Newest First"}];function J(){return e.jsxs("div",{className:"zsut-loading",children:[e.jsx("div",{className:"zsut-spinner"}),e.jsx("p",{children:"Loading listings..."})]})}function Q({error:o,onRetry:r}){return e.jsxs("div",{className:"zsut-error",children:[e.jsx("p",{children:o}),e.jsx("button",{onClick:r,className:"zsut-btn zsut-btn-primary",children:"Try Again"})]})}function V(){return e.jsx("div",{className:"zsut-empty",children:e.jsx("p",{children:"No listings found matching your filters."})})}function X({listing:o}){return e.jsxs("div",{className:"zsut-listing-card",children:[e.jsxs("div",{className:"zsut-listing-header",children:[e.jsx("h3",{className:"zsut-listing-name",children:o.name}),e.jsxs("span",{className:"zsut-listing-price",children:["$",o.nightlyPrice,"/night"]})]}),e.jsxs("div",{className:"zsut-listing-location",children:[o.neighborhood&&e.jsxs("span",{children:[o.neighborhood,", "]}),e.jsx("span",{children:o.borough})]}),e.jsxs("div",{className:"zsut-listing-meta",children:[e.jsx("span",{className:"zsut-badge",children:o.weeksOffered}),o.isActive&&e.jsx("span",{className:"zsut-badge zsut-badge-active",children:"Active"}),o.isComplete&&e.jsx("span",{className:"zsut-badge zsut-badge-complete",children:"Complete"})]}),e.jsxs("div",{className:"zsut-listing-id",children:["ID: ",o.id]})]})}function Y(){const{boroughs:o,neighborhoods:r,filters:h,listings:f,isLoading:p,error:a,totalCount:u,handleBoroughChange:y,handleNeighborhoodChange:j,handleDaysChange:z,handleWeekPatternChange:k,handleAttributeFilterChange:g,handleSortChange:b,handlePriceFilterChange:C,handleResetFilters:A,handleRetry:N}=H();return e.jsxs("div",{className:"zsut-page",children:[e.jsxs("header",{className:"zsut-header",children:[e.jsx("h1",{children:"Z-Search Unit Test"}),e.jsx("p",{children:"Internal testing page for search algorithm validation"})]}),e.jsxs("div",{className:"zsut-container",children:[e.jsxs("aside",{className:"zsut-filters",children:[e.jsx("h2",{children:"Filters"}),e.jsxs("div",{className:"zsut-filter-group",children:[e.jsx("label",{htmlFor:"borough",children:"Borough"}),e.jsxs("select",{id:"borough",value:h.selectedBorough,onChange:t=>y(t.target.value),className:"zsut-select",children:[e.jsx("option",{value:"",children:"Select Borough"}),o.map(t=>e.jsx("option",{value:t.value,children:t.name},t.id))]})]}),e.jsxs("div",{className:"zsut-filter-group",children:[e.jsx("label",{htmlFor:"neighborhood",children:"Neighborhood"}),e.jsxs("select",{id:"neighborhood",value:h.selectedNeighborhood,onChange:t=>j(t.target.value),className:"zsut-select",disabled:r.length===0,children:[e.jsx("option",{value:"",children:"All Neighborhoods"}),r.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{className:"zsut-filter-group",children:[e.jsx("label",{children:"Days Available"}),e.jsx(Z,{onSelectionChange:z,initialSelection:h.selectedDays,updateUrl:!1,weekPattern:h.weekPattern})]}),e.jsxs("div",{className:"zsut-filter-group",children:[e.jsx("label",{htmlFor:"weekPattern",children:"Week Pattern"}),e.jsx("select",{id:"weekPattern",value:h.weekPattern,onChange:t=>k(t.target.value),className:"zsut-select",children:K.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"zsut-filter-group",children:[e.jsx("label",{children:"Listing Attributes"}),e.jsxs("div",{className:"zsut-checkbox-group",children:[e.jsxs("label",{className:"zsut-checkbox",children:[e.jsx("input",{type:"checkbox",checked:h.showActive,onChange:t=>g("showActive",t.target.checked)}),e.jsx("span",{children:"Active"})]}),e.jsxs("label",{className:"zsut-checkbox",children:[e.jsx("input",{type:"checkbox",checked:h.showApproved,onChange:t=>g("showApproved",t.target.checked)}),e.jsx("span",{children:"Approved"})]}),e.jsxs("label",{className:"zsut-checkbox",children:[e.jsx("input",{type:"checkbox",checked:h.showComplete,onChange:t=>g("showComplete",t.target.checked)}),e.jsx("span",{children:"Complete"})]}),e.jsxs("label",{className:"zsut-checkbox",children:[e.jsx("input",{type:"checkbox",checked:h.showDefault,onChange:t=>g("showDefault",t.target.checked)}),e.jsx("span",{children:"Include Usability (Default)"})]})]})]}),e.jsxs("div",{className:"zsut-filter-group",children:[e.jsx("label",{htmlFor:"sortBy",children:"Sort By"}),e.jsx("select",{id:"sortBy",value:h.sortBy,onChange:t=>b(t.target.value),className:"zsut-select",children:$.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"zsut-filter-group",children:[e.jsx("label",{children:"Price Range ($/night)"}),e.jsxs("div",{className:"zsut-price-inputs",children:[e.jsx("input",{type:"number",placeholder:"Min",value:h.priceMin||"",onChange:t=>C(t.target.value?Number(t.target.value):null,h.priceMax),className:"zsut-input"}),e.jsx("span",{children:"to"}),e.jsx("input",{type:"number",placeholder:"Max",value:h.priceMax||"",onChange:t=>C(h.priceMin,t.target.value?Number(t.target.value):null),className:"zsut-input"})]})]}),e.jsx("button",{onClick:A,className:"zsut-btn zsut-btn-secondary",children:"Reset Filters"})]}),e.jsxs("main",{className:"zsut-results",children:[e.jsxs("div",{className:"zsut-results-header",children:[e.jsx("h2",{children:"Results"}),e.jsxs("span",{className:"zsut-count",children:[u," listing(s) found"]})]}),p&&e.jsx(J,{}),!p&&a&&e.jsx(Q,{error:a,onRetry:N}),!p&&!a&&f.length===0&&e.jsx(V,{}),!p&&!a&&f.length>0&&e.jsx("div",{className:"zsut-listings-grid",children:f.map(t=>e.jsx(X,{listing:t},t.id))})]})]})]})}const ee=R(document.getElementById("root"));ee.render(e.jsx(Y,{}));

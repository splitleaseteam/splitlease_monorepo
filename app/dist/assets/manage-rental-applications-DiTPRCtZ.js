import{r as i,j as e,c as ie,R as re}from"./client-BJVKzfAi.js";import{s as ce}from"./supabase-BoCLEw6R.js";import{u as de,a as oe}from"./Toast-BQk6Nzgd.js";import{A as V}from"./AdminHeader-tCInZd3n.js";import{E as me}from"./ErrorBoundary-9_HbXv1y.js";/* empty css             */import"./config-QPKPRtag.js";import"./auth-QZ4BJadW.js";import"./star-OtPMgcH9.js";import"./createLucideIcon-CgZZH2OU.js";import"./file-text-Bqp_Hw0X.js";import"./triangle-alert-Bp6DQQmR.js";import"./users-d0RSvnp4.js";import"./pen-line-Duo49k9O.js";import"./calendar-CDI4qHEX.js";import"./mail-CRbL90NL.js";import"./user-check-CoCGzn5Y.js";import"./dollar-sign-Dn2-KjNW.js";import"./send-C4mziT0-.js";import"./x-CrJVeoCh.js";const ue="https://qcfifybkaddcoimjroca.supabase.co",K={searchQuery:"",status:"",completionStatus:"all",minIncome:""},he={field:"created_at",direction:"desc"},xe={page:1,pageSize:20,total:0,totalPages:0},pe=[{value:"",label:"All Statuses"},{value:"draft",label:"Draft"},{value:"in-progress",label:"In Progress"},{value:"submitted",label:"Submitted"},{value:"under-review",label:"Under Review"},{value:"approved",label:"Approved"},{value:"conditionally-approved",label:"Conditionally Approved"},{value:"denied",label:"Denied"},{value:"withdrawn",label:"Withdrawn"},{value:"expired",label:"Expired"}];function je({showToast:s}){const[a,n]=i.useState(""),[h,v]=i.useState([]),[c,p]=i.useState(null),[x,b]=i.useState(!1),[r,S]=i.useState(!1),[o,u]=i.useState(!1),[t,j]=i.useState(null),[w,k]=i.useState("list"),[f,g]=i.useState(K),[y,A]=i.useState(he),[C,F]=i.useState(xe),[M,I]=i.useState(!1),[B,E]=i.useState(null),O=pe,D=i.useCallback(()=>new URLSearchParams(window.location.search).get("id"),[]);i.useEffect(()=>{(async()=>{try{const{data:{session:m}}=await ce.auth.getSession(),N=localStorage.getItem("sl_auth_token")||sessionStorage.getItem("sl_auth_token");n((m==null?void 0:m.access_token)||N||"")}catch(m){console.error("[ManageRentalApps] Token lookup failed:",m),n("")}})()},[]);const L=i.useCallback(()=>{const l={"Content-Type":"application/json"};return a&&(l.Authorization=`Bearer ${a}`),l},[a]),_=i.useCallback(async(l,m={})=>{const N=await fetch(`${ue}/functions/v1/rental-applications`,{method:"POST",headers:L(),body:JSON.stringify({action:l,payload:m})}),z=await N.json();if(!N.ok||!z.success)throw new Error(z.error||`Action ${l} failed`);return z},[L]),R=i.useCallback(async()=>{b(!0),j(null);try{const l=await _("list",{filters:{status:f.status||void 0,searchQuery:f.searchQuery||void 0,isCompleted:f.completionStatus==="all"?void 0:f.completionStatus==="completed",minIncome:f.minIncome?parseFloat(f.minIncome):void 0},sort:y,pagination:{page:C.page,pageSize:C.pageSize}});v(l.data||[]),F(m=>{var N,z;return{...m,total:((N=l.pagination)==null?void 0:N.total)||0,totalPages:((z=l.pagination)==null?void 0:z.totalPages)||0}})}catch(l){console.error("[ManageRentalApps] Fetch error:",l),j(l.message),s({title:"Failed to load applications",content:l.message,type:"error"})}finally{b(!1)}},[f,y,C.page,C.pageSize,_,s]),q=i.useCallback(async l=>{S(!0),j(null);try{const m=await _("get",{id:l});p(m.data),k("detail");const N=new URL(window.location);N.searchParams.set("id",l),window.history.pushState({},"",N)}catch(m){console.error("[ManageRentalApps] Failed to fetch application:",m),s({title:"Failed to load application details",content:m.message,type:"error"})}finally{S(!1)}},[_,s]);i.useEffect(()=>{R()},[R]),i.useEffect(()=>{if(!x){const l=D();l&&q(l)}},[x,D,q]);const G=i.useMemo(()=>({submitted:h.filter(l=>l.status==="submitted").length,underReview:h.filter(l=>l.status==="under-review").length,approved:h.filter(l=>l.status==="approved"||l.status==="conditionally-approved").length,denied:h.filter(l=>l.status==="denied").length,total:C.total}),[h,C.total]),Y=i.useCallback(l=>{g(m=>({...m,...l})),F(m=>({...m,page:1}))},[]),Z=i.useCallback(()=>{g(K),F(l=>({...l,page:1}))},[]),J=i.useCallback(l=>{A(m=>({field:l,direction:m.field===l&&m.direction==="asc"?"desc":"asc"}))},[]),X=i.useCallback(l=>{F(m=>({...m,page:l}))},[]),ee=i.useCallback(l=>{F(m=>({...m,pageSize:l,page:1}))},[]),se=i.useCallback(()=>{k("list"),p(null);const l=new URL(window.location);l.searchParams.delete("id"),window.history.pushState({},"",l)},[]),ae=i.useCallback(l=>{E(l),I(!0)},[]),Q=i.useCallback(()=>{I(!1),E(null)},[]),te=i.useCallback(async l=>{if(c){u(!0);try{const m=await _("update",{id:c.id,updates:l});p(N=>({...N,...m.data})),s({title:"Application updated successfully",type:"success"}),Q(),R()}catch(m){console.error("[ManageRentalApps] Failed to update application:",m),s({title:"Failed to update application",content:m.message,type:"error"})}finally{u(!1)}}},[c,_,s,Q,R]),le=i.useCallback(async l=>{if(c){u(!0);try{const m=await _("update_status",{id:c.id,status:l});p(N=>({...N,status:m.data.status})),s({title:`Status updated to "${l}"`,type:"success"}),R()}catch(m){console.error("[ManageRentalApps] Failed to update status:",m),s({title:"Failed to update status",content:m.message,type:"error"})}finally{u(!1)}}},[c,_,s,R]),ne=i.useCallback(()=>{R()},[R]);return{applications:h,selectedApplication:c,isLoading:x,isLoadingDetail:r,isSaving:o,error:t,stats:G,viewMode:w,filters:f,sort:y,pagination:C,isEditModalOpen:M,editSection:B,statusOptions:O,handleUpdateFilters:Y,handleClearFilters:Z,handleUpdateSort:J,handleChangePage:X,handleChangePageSize:ee,handleSelectApplication:q,handleBackToList:se,handleOpenEditModal:ae,handleCloseEditModal:Q,handleSaveEdit:te,handleUpdateStatus:le,handleRetry:ne}}function fe({filters:s,statusOptions:a,onUpdateFilters:n,onClearFilters:h}){const v=i.useCallback(r=>{n({searchQuery:r.target.value})},[n]),c=i.useCallback(r=>{n({status:r.target.value})},[n]),p=i.useCallback(r=>{n({completionStatus:r.target.value})},[n]),x=i.useCallback(r=>{n({minIncome:r.target.value})},[n]),b=s.searchQuery||s.status||s.completionStatus!=="all"||s.minIncome;return e.jsx("div",{className:"search-filters",children:e.jsxs("div",{className:"search-filters__row",children:[e.jsxs("div",{className:"search-filters__field search-filters__field--search",children:[e.jsx("label",{htmlFor:"search-query",className:"sr-only",children:"Search"}),e.jsxs("div",{className:"search-filters__input-wrapper",children:[e.jsxs("svg",{className:"search-filters__search-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),e.jsx("input",{type:"text",id:"search-query",className:"search-filters__input",placeholder:"Search by name, email, or ID...",value:s.searchQuery,onChange:v})]})]}),e.jsxs("div",{className:"search-filters__field",children:[e.jsx("label",{htmlFor:"status-filter",className:"sr-only",children:"Status"}),e.jsx("select",{id:"status-filter",className:"search-filters__select",value:s.status,onChange:c,children:a.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})]}),e.jsxs("div",{className:"search-filters__field",children:[e.jsx("label",{htmlFor:"completion-filter",className:"sr-only",children:"Completion"}),e.jsxs("select",{id:"completion-filter",className:"search-filters__select",value:s.completionStatus,onChange:p,children:[e.jsx("option",{value:"all",children:"All Completions"}),e.jsx("option",{value:"completed",children:"Completed Only"}),e.jsx("option",{value:"incomplete",children:"Incomplete Only"})]})]}),e.jsxs("div",{className:"search-filters__field",children:[e.jsx("label",{htmlFor:"min-income",className:"sr-only",children:"Min Income"}),e.jsx("input",{type:"number",id:"min-income",className:"search-filters__input search-filters__input--number",placeholder:"Min income...",value:s.minIncome,onChange:x,min:"0",step:"100"})]}),b&&e.jsxs("button",{className:"search-filters__clear-btn",onClick:h,type:"button",children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),"Clear Filters"]})]})})}function be(s){return s==null?"-":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}function ve(s){return s?new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"-"}function ge(s){return{draft:"status-badge--draft","in-progress":"status-badge--in-progress",submitted:"status-badge--submitted","under-review":"status-badge--under-review",approved:"status-badge--approved","conditionally-approved":"status-badge--conditionally-approved",denied:"status-badge--denied",withdrawn:"status-badge--withdrawn",expired:"status-badge--expired"}[s]||"status-badge--default"}function ye(s){return s?s.split("-").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" "):"-"}function _e(s){var a,n,h;return(a=s.personal_info)!=null&&a.firstName&&((n=s.personal_info)!=null&&n.lastName)?`${s.personal_info.firstName} ${s.personal_info.lastName}`:(h=s.guest)!=null&&h.full_name?s.guest.full_name:"Unknown"}function Ne(s){var a,n;return((a=s.personal_info)==null?void 0:a.email)||((n=s.guest)==null?void 0:n.email)||"-"}function ke({field:s,currentSort:a}){const n=a.field===s,h=n&&a.direction==="asc";return e.jsx("span",{className:`sort-icon ${n?"sort-icon--active":""}`,children:n?h?"↑":"↓":"↕"})}function Ce({applications:s,isLoading:a,pagination:n,sort:h,onSelectApplication:v,onUpdateSort:c,onChangePage:p,onChangePageSize:x}){const b=i.useCallback(o=>{v(o)},[v]),r=i.useCallback((o,u)=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),v(u))},[v]),S=[{key:"unique_id",label:"ID",sortable:!0},{key:"applicant",label:"Applicant",sortable:!1},{key:"status",label:"Status",sortable:!0},{key:"completion_percentage",label:"Progress",sortable:!0},{key:"total_monthly_income",label:"Income",sortable:!0},{key:"created_at",label:"Submitted",sortable:!0}];return!a&&s.length===0?e.jsxs("div",{className:"applications-table__empty",children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",children:e.jsx("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("h3",{children:"No applications found"}),e.jsx("p",{children:"Try adjusting your filters or check back later."})]}):e.jsxs("div",{className:"applications-table-wrapper",children:[e.jsxs("table",{className:"applications-table",children:[e.jsx("thead",{children:e.jsx("tr",{children:S.map(o=>e.jsxs("th",{className:o.sortable?"sortable":"",onClick:o.sortable?()=>c(o.key):void 0,children:[o.label,o.sortable&&e.jsx(ke,{field:o.key,currentSort:h})]},o.key))})}),e.jsx("tbody",{children:a?Array.from({length:5}).map((o,u)=>e.jsx("tr",{className:"skeleton-row",children:S.map(t=>e.jsx("td",{children:e.jsx("div",{className:"skeleton-cell"})},t.key))},`skeleton-${u}`)):s.map(o=>{var u;return e.jsxs("tr",{onClick:()=>b(o.id),onKeyDown:t=>r(t,o.id),tabIndex:0,role:"button",className:"clickable-row",children:[e.jsx("td",{className:"id-cell",children:e.jsx("span",{className:"application-id",children:o.unique_id||((u=o.id)==null?void 0:u.slice(0,8))})}),e.jsx("td",{children:e.jsxs("div",{className:"applicant-cell",children:[e.jsx("span",{className:"applicant-name",children:_e(o)}),e.jsx("span",{className:"applicant-email",children:Ne(o)})]})}),e.jsx("td",{children:e.jsx("span",{className:`status-badge ${ge(o.status)}`,children:ye(o.status)})}),e.jsx("td",{children:e.jsxs("div",{className:"progress-cell",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-bar__fill",style:{width:`${o.completion_percentage||0}%`}})}),e.jsxs("span",{className:"progress-text",children:[o.completion_percentage||0,"%"]})]})}),e.jsx("td",{className:"income-cell",children:be(o.total_monthly_income||o.monthly_income)}),e.jsx("td",{className:"date-cell",children:ve(o.submitted_at||o.created_at)})]},o.id)})})]}),n.totalPages>1&&e.jsxs("div",{className:"applications-table__pagination",children:[e.jsxs("div",{className:"pagination-info",children:["Showing ",(n.page-1)*n.pageSize+1," to"," ",Math.min(n.page*n.pageSize,n.total)," of"," ",n.total," applications"]}),e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{className:"pagination-btn",onClick:()=>p(n.page-1),disabled:n.page<=1,children:"Previous"}),e.jsxs("span",{className:"pagination-current",children:["Page ",n.page," of ",n.totalPages]}),e.jsx("button",{className:"pagination-btn",onClick:()=>p(n.page+1),disabled:n.page>=n.totalPages,children:"Next"})]}),e.jsxs("div",{className:"pagination-size",children:[e.jsx("label",{htmlFor:"page-size",children:"Show:"}),e.jsxs("select",{id:"page-size",value:n.pageSize,onChange:o=>x(Number(o.target.value)),children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})]})]})}function T(s){return s==null?"-":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}function $(s){return s?new Date(s).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}):"-"}function H(s){return s?new Date(s).toLocaleString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"}):"-"}function W(s){if(!s)return"-";const a=s.replace(/\D/g,"");return a.length===10?`(${a.slice(0,3)}) ${a.slice(3,6)}-${a.slice(6)}`:s}function Se(s){return{draft:"status-badge--draft","in-progress":"status-badge--in-progress",submitted:"status-badge--submitted","under-review":"status-badge--under-review",approved:"status-badge--approved","conditionally-approved":"status-badge--conditionally-approved",denied:"status-badge--denied",withdrawn:"status-badge--withdrawn",expired:"status-badge--expired"}[s]||"status-badge--default"}function P({title:s,onEdit:a,section:n}){return e.jsxs("div",{className:"detail-section__header",children:[e.jsx("h3",{children:s}),a&&e.jsxs("button",{className:"detail-section__edit-btn",onClick:()=>a(n),type:"button",children:[e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),e.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"})]}),"Edit"]})]})}function d({label:s,value:a,fullWidth:n=!1}){return e.jsxs("div",{className:`detail-field ${n?"detail-field--full":""}`,children:[e.jsx("span",{className:"detail-field__label",children:s}),e.jsx("span",{className:"detail-field__value",children:a||"-"})]})}function U({label:s,value:a}){return e.jsxs("div",{className:"detail-field detail-field--boolean",children:[e.jsx("span",{className:"detail-field__label",children:s}),e.jsxs("span",{className:`detail-field__value ${a?"value--yes":"value--no"}`,children:[a?e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})}):e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),a?"Yes":"No"]})]})}function we({application:s,isLoading:a,onBack:n,onEdit:h,onUpdateStatus:v,statusOptions:c}){var o,u;const p=i.useCallback(t=>{v(t.target.value)},[v]);if(a)return e.jsxs("div",{className:"application-detail application-detail--loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading application details..."})]});if(!s)return e.jsxs("div",{className:"application-detail application-detail--empty",children:[e.jsx("p",{children:"No application selected."}),e.jsx("button",{className:"btn btn--primary",onClick:n,children:"Back to List"})]});const x=s.personal_info||{},b=s.current_address||{},r=s.emergency_contact||{},S=s.accessibility||{};return e.jsxs("div",{className:"application-detail",children:[e.jsxs("div",{className:"application-detail__header",children:[e.jsxs("button",{className:"back-btn",onClick:n,type:"button",children:[e.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("polyline",{points:"15 18 9 12 15 6"})}),"Back to List"]}),e.jsxs("div",{className:"application-detail__title",children:[e.jsxs("h2",{children:[x.firstName," ",x.lastName||((o=s.guest)==null?void 0:o.full_name)||"Application"]}),e.jsx("span",{className:"application-id",children:s.unique_id||s.id})]}),e.jsxs("div",{className:"application-detail__status-control",children:[e.jsx("label",{htmlFor:"status-select",children:"Status:"}),e.jsx("select",{id:"status-select",value:s.status,onChange:p,className:`status-select ${Se(s.status)}`,children:c.filter(t=>t.value).map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"application-detail__progress",children:[e.jsxs("div",{className:"progress-info",children:[e.jsx("span",{children:"Completion Progress"}),e.jsxs("span",{children:[s.completion_percentage||0,"%"]})]}),e.jsx("div",{className:"progress-bar progress-bar--large",children:e.jsx("div",{className:"progress-bar__fill",style:{width:`${s.completion_percentage||0}%`}})})]}),e.jsxs("div",{className:"application-detail__content",children:[e.jsxs("section",{className:"detail-section",children:[e.jsx(P,{title:"Personal Information",onEdit:h,section:"personal"}),e.jsxs("div",{className:"detail-grid",children:[e.jsx(d,{label:"First Name",value:x.firstName}),e.jsx(d,{label:"Last Name",value:x.lastName}),e.jsx(d,{label:"Email",value:x.email||((u=s.guest)==null?void 0:u.email)}),e.jsx(d,{label:"Phone",value:W(x.phone)}),e.jsx(d,{label:"Date of Birth",value:$(x.dateOfBirth)}),e.jsx(d,{label:"SSN (Last 4)",value:x.ssnLast4?`***-**-${x.ssnLast4}`:"-"})]})]}),e.jsxs("section",{className:"detail-section",children:[e.jsx(P,{title:"Current Address",onEdit:h,section:"address"}),e.jsxs("div",{className:"detail-grid",children:[e.jsx(d,{label:"Street Address",value:b.street,fullWidth:!0}),e.jsx(d,{label:"Unit/Apt",value:b.unit}),e.jsx(d,{label:"City",value:b.city}),e.jsx(d,{label:"State",value:b.state}),e.jsx(d,{label:"ZIP Code",value:b.zip}),e.jsx(d,{label:"Move-in Date",value:$(b.moveInDate)}),e.jsx(d,{label:"Monthly Rent",value:T(b.monthlyRent)}),e.jsx(d,{label:"Landlord Name",value:b.landlordName}),e.jsx(d,{label:"Landlord Phone",value:W(b.landlordPhone)})]})]}),e.jsxs("section",{className:"detail-section",children:[e.jsx(P,{title:"Employment & Income",onEdit:h,section:"employment"}),e.jsxs("div",{className:"detail-grid",children:[e.jsx(d,{label:"Monthly Income",value:T(s.monthly_income)}),e.jsx(d,{label:"Additional Income",value:T(s.additional_income)}),e.jsx(d,{label:"Total Monthly Income",value:T(s.total_monthly_income)})]}),s.employment&&s.employment.length>0&&e.jsxs("div",{className:"detail-subsection",children:[e.jsx("h4",{children:"Employment History"}),s.employment.map((t,j)=>e.jsx("div",{className:"employment-item",children:e.jsxs("div",{className:"detail-grid",children:[e.jsx(d,{label:"Employer",value:t.employer_name}),e.jsx(d,{label:"Position",value:t.position}),e.jsx(d,{label:"Start Date",value:$(t.start_date)}),e.jsx(d,{label:"End Date",value:t.is_current?"Current":$(t.end_date)}),e.jsx(d,{label:"Monthly Income",value:T(t.monthly_income)}),e.jsx(d,{label:"Supervisor",value:t.supervisor_name})]})},t.id||j))]})]}),e.jsxs("section",{className:"detail-section",children:[e.jsx(P,{title:"Background Information",onEdit:h,section:"background"}),e.jsxs("div",{className:"detail-grid detail-grid--booleans",children:[e.jsx(U,{label:"Prior Eviction",value:s.has_eviction}),e.jsx(U,{label:"Prior Felony",value:s.has_felony}),e.jsx(U,{label:"Prior Bankruptcy",value:s.has_bankruptcy})]})]}),e.jsxs("section",{className:"detail-section",children:[e.jsx(P,{title:"Occupants",onEdit:h,section:"occupants"}),s.occupants&&s.occupants.length>0?e.jsx("div",{className:"occupants-list",children:s.occupants.map((t,j)=>e.jsxs("div",{className:"occupant-item",children:[e.jsxs("span",{className:"occupant-name",children:[t.first_name," ",t.last_name,t.is_applicant&&e.jsx("span",{className:"badge badge--primary",children:"Applicant"})]}),e.jsxs("span",{className:"occupant-details",children:[t.relationship&&e.jsx("span",{children:t.relationship}),t.date_of_birth&&e.jsx("span",{children:$(t.date_of_birth)})]})]},t.id||j))}):e.jsx("p",{className:"no-data",children:"No occupants listed"})]}),e.jsxs("section",{className:"detail-section",children:[e.jsx(P,{title:"References",onEdit:h,section:"references"}),s.references&&s.references.length>0?e.jsx("div",{className:"references-list",children:s.references.map((t,j)=>e.jsx("div",{className:"reference-item",children:e.jsxs("div",{className:"detail-grid",children:[e.jsx(d,{label:"Name",value:t.name}),e.jsx(d,{label:"Relationship",value:t.relationship}),e.jsx(d,{label:"Phone",value:W(t.phone)}),e.jsx(d,{label:"Email",value:t.email}),e.jsx(d,{label:"Years Known",value:t.years_known})]})},t.id||j))}):e.jsx("p",{className:"no-data",children:"No references listed"})]}),e.jsxs("section",{className:"detail-section",children:[e.jsx(P,{title:"Emergency Contact",onEdit:h,section:"emergency"}),e.jsxs("div",{className:"detail-grid",children:[e.jsx(d,{label:"Name",value:r.name}),e.jsx(d,{label:"Relationship",value:r.relationship}),e.jsx(d,{label:"Phone",value:W(r.phone)}),e.jsx(d,{label:"Email",value:r.email})]})]}),e.jsxs("section",{className:"detail-section",children:[e.jsx(P,{title:"Consents & Signatures"}),e.jsxs("div",{className:"detail-grid detail-grid--booleans",children:[e.jsx(U,{label:"Background Check Consent",value:s.background_check_consent}),e.jsx(U,{label:"Credit Check Consent",value:s.credit_check_consent}),e.jsx(U,{label:"Terms Accepted",value:s.terms_accepted})]}),e.jsx("div",{className:"detail-grid",children:e.jsx(d,{label:"Signature Date",value:H(s.signature_date)})})]}),S&&Object.keys(S).length>0&&e.jsxs("section",{className:"detail-section",children:[e.jsx(P,{title:"Accessibility Needs",onEdit:h,section:"accessibility"}),e.jsxs("div",{className:"detail-grid",children:[e.jsx(U,{label:"Has Accessibility Needs",value:S.hasNeeds}),e.jsx(d,{label:"Description",value:S.description,fullWidth:!0})]})]}),e.jsxs("section",{className:"detail-section detail-section--metadata",children:[e.jsx("h4",{children:"Application Metadata"}),e.jsxs("div",{className:"detail-grid",children:[e.jsx(d,{label:"Created",value:H(s.created_at)}),e.jsx(d,{label:"Last Updated",value:H(s.updated_at)}),e.jsx(d,{label:"Submitted",value:H(s.submitted_at)}),e.jsx(d,{label:"Application ID",value:s.id}),e.jsx(d,{label:"Guest ID",value:s.guest_id}),e.jsx(d,{label:"Listing ID",value:s.listing_id||"Not linked"})]})]})]})]})}const Fe={personal:"Personal Information",address:"Current Address",employment:"Employment & Income",background:"Background Information",occupants:"Occupants",references:"References",emergency:"Emergency Contact",accessibility:"Accessibility Needs"};function Ae({application:s,editSection:a,onClose:n,onSave:h,isSaving:v}){const[c,p]=i.useState({}),[x,b]=i.useState({});i.useEffect(()=>{var u,t,j,w,k,f,g,y,A,C,F,M,I,B,E,O,D,L,_;if(s)switch(a){case"personal":p({personal_info:{...s.personal_info,firstName:((u=s.personal_info)==null?void 0:u.firstName)||"",lastName:((t=s.personal_info)==null?void 0:t.lastName)||"",email:((j=s.personal_info)==null?void 0:j.email)||"",phone:((w=s.personal_info)==null?void 0:w.phone)||"",dateOfBirth:((k=s.personal_info)==null?void 0:k.dateOfBirth)||""}});break;case"address":p({current_address:{...s.current_address,street:((f=s.current_address)==null?void 0:f.street)||"",unit:((g=s.current_address)==null?void 0:g.unit)||"",city:((y=s.current_address)==null?void 0:y.city)||"",state:((A=s.current_address)==null?void 0:A.state)||"",zip:((C=s.current_address)==null?void 0:C.zip)||"",landlordName:((F=s.current_address)==null?void 0:F.landlordName)||"",landlordPhone:((M=s.current_address)==null?void 0:M.landlordPhone)||"",monthlyRent:((I=s.current_address)==null?void 0:I.monthlyRent)||""}});break;case"employment":p({monthly_income:s.monthly_income||"",additional_income:s.additional_income||""});break;case"background":p({has_eviction:s.has_eviction||!1,has_felony:s.has_felony||!1,has_bankruptcy:s.has_bankruptcy||!1});break;case"emergency":p({emergency_contact:{...s.emergency_contact,name:((B=s.emergency_contact)==null?void 0:B.name)||"",relationship:((E=s.emergency_contact)==null?void 0:E.relationship)||"",phone:((O=s.emergency_contact)==null?void 0:O.phone)||"",email:((D=s.emergency_contact)==null?void 0:D.email)||""}});break;case"accessibility":p({accessibility:{...s.accessibility,hasNeeds:((L=s.accessibility)==null?void 0:L.hasNeeds)||!1,description:((_=s.accessibility)==null?void 0:_.description)||""}});break;default:p({})}},[s,a]);const r=i.useCallback(u=>{const{name:t,value:j,type:w,checked:k}=u.target,f=w==="checkbox"?k:j;if(t.includes(".")){const[g,y]=t.split(".");p(A=>({...A,[g]:{...A[g],[y]:f}}))}else p(g=>({...g,[t]:f}));b(g=>{const y={...g};return delete y[t],y})},[]),S=i.useCallback(u=>{var j,w,k,f;u.preventDefault();const t={};if(a==="personal"&&((w=(j=c.personal_info)==null?void 0:j.firstName)!=null&&w.trim()||(t["personal_info.firstName"]="First name is required"),(f=(k=c.personal_info)==null?void 0:k.lastName)!=null&&f.trim()||(t["personal_info.lastName"]="Last name is required")),Object.keys(t).length>0){b(t);return}h(c)},[a,c,h]);i.useEffect(()=>{const u=t=>{t.key==="Escape"&&!v&&n()};return document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)},[n,v]);const o=()=>{var u,t,j,w,k,f,g,y,A,C,F,M,I,B,E,O,D,L,_;switch(a){case"personal":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"firstName",children:"First Name *"}),e.jsx("input",{type:"text",id:"firstName",name:"personal_info.firstName",value:((u=c.personal_info)==null?void 0:u.firstName)||"",onChange:r,className:x["personal_info.firstName"]?"error":""}),x["personal_info.firstName"]&&e.jsx("span",{className:"field-error",children:x["personal_info.firstName"]})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"lastName",children:"Last Name *"}),e.jsx("input",{type:"text",id:"lastName",name:"personal_info.lastName",value:((t=c.personal_info)==null?void 0:t.lastName)||"",onChange:r,className:x["personal_info.lastName"]?"error":""}),x["personal_info.lastName"]&&e.jsx("span",{className:"field-error",children:x["personal_info.lastName"]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"email",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"personal_info.email",value:((j=c.personal_info)==null?void 0:j.email)||"",onChange:r})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"phone",children:"Phone"}),e.jsx("input",{type:"tel",id:"phone",name:"personal_info.phone",value:((w=c.personal_info)==null?void 0:w.phone)||"",onChange:r})]})]}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"dateOfBirth",children:"Date of Birth"}),e.jsx("input",{type:"date",id:"dateOfBirth",name:"personal_info.dateOfBirth",value:((k=c.personal_info)==null?void 0:k.dateOfBirth)||"",onChange:r})]})})]});case"address":return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-field form-field--full",children:[e.jsx("label",{htmlFor:"street",children:"Street Address"}),e.jsx("input",{type:"text",id:"street",name:"current_address.street",value:((f=c.current_address)==null?void 0:f.street)||"",onChange:r})]})}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"unit",children:"Unit/Apt"}),e.jsx("input",{type:"text",id:"unit",name:"current_address.unit",value:((g=c.current_address)==null?void 0:g.unit)||"",onChange:r})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"city",children:"City"}),e.jsx("input",{type:"text",id:"city",name:"current_address.city",value:((y=c.current_address)==null?void 0:y.city)||"",onChange:r})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"state",children:"State"}),e.jsx("input",{type:"text",id:"state",name:"current_address.state",value:((A=c.current_address)==null?void 0:A.state)||"",onChange:r,maxLength:"2"})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"zip",children:"ZIP Code"}),e.jsx("input",{type:"text",id:"zip",name:"current_address.zip",value:((C=c.current_address)==null?void 0:C.zip)||"",onChange:r,maxLength:"10"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"landlordName",children:"Landlord Name"}),e.jsx("input",{type:"text",id:"landlordName",name:"current_address.landlordName",value:((F=c.current_address)==null?void 0:F.landlordName)||"",onChange:r})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"landlordPhone",children:"Landlord Phone"}),e.jsx("input",{type:"tel",id:"landlordPhone",name:"current_address.landlordPhone",value:((M=c.current_address)==null?void 0:M.landlordPhone)||"",onChange:r})]})]}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"monthlyRent",children:"Monthly Rent"}),e.jsx("input",{type:"number",id:"monthlyRent",name:"current_address.monthlyRent",value:((I=c.current_address)==null?void 0:I.monthlyRent)||"",onChange:r,min:"0",step:"1"})]})})]});case"employment":return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"monthly_income",children:"Monthly Income"}),e.jsx("input",{type:"number",id:"monthly_income",name:"monthly_income",value:c.monthly_income||"",onChange:r,min:"0",step:"100"})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"additional_income",children:"Additional Income"}),e.jsx("input",{type:"number",id:"additional_income",name:"additional_income",value:c.additional_income||"",onChange:r,min:"0",step:"100"})]})]})});case"background":return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"form-row form-row--checkboxes",children:[e.jsx("div",{className:"form-field form-field--checkbox",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"has_eviction",checked:c.has_eviction||!1,onChange:r}),"Has prior eviction"]})}),e.jsx("div",{className:"form-field form-field--checkbox",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"has_felony",checked:c.has_felony||!1,onChange:r}),"Has prior felony"]})}),e.jsx("div",{className:"form-field form-field--checkbox",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"has_bankruptcy",checked:c.has_bankruptcy||!1,onChange:r}),"Has prior bankruptcy"]})})]})});case"emergency":return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"emergencyName",children:"Name"}),e.jsx("input",{type:"text",id:"emergencyName",name:"emergency_contact.name",value:((B=c.emergency_contact)==null?void 0:B.name)||"",onChange:r})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"emergencyRelationship",children:"Relationship"}),e.jsx("input",{type:"text",id:"emergencyRelationship",name:"emergency_contact.relationship",value:((E=c.emergency_contact)==null?void 0:E.relationship)||"",onChange:r})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"emergencyPhone",children:"Phone"}),e.jsx("input",{type:"tel",id:"emergencyPhone",name:"emergency_contact.phone",value:((O=c.emergency_contact)==null?void 0:O.phone)||"",onChange:r})]}),e.jsxs("div",{className:"form-field",children:[e.jsx("label",{htmlFor:"emergencyEmail",children:"Email"}),e.jsx("input",{type:"email",id:"emergencyEmail",name:"emergency_contact.email",value:((D=c.emergency_contact)==null?void 0:D.email)||"",onChange:r})]})]})]});case"accessibility":return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"form-row",children:e.jsx("div",{className:"form-field form-field--checkbox",children:e.jsxs("label",{children:[e.jsx("input",{type:"checkbox",name:"accessibility.hasNeeds",checked:((L=c.accessibility)==null?void 0:L.hasNeeds)||!1,onChange:r}),"Has accessibility needs"]})})}),e.jsx("div",{className:"form-row",children:e.jsxs("div",{className:"form-field form-field--full",children:[e.jsx("label",{htmlFor:"accessibilityDescription",children:"Description"}),e.jsx("textarea",{id:"accessibilityDescription",name:"accessibility.description",value:((_=c.accessibility)==null?void 0:_.description)||"",onChange:r,rows:4})]})})]});default:return e.jsxs("p",{children:["Unknown section: ",a]})}};return e.jsx("div",{className:"modal-overlay",onClick:n,children:e.jsxs("div",{className:"modal",onClick:u=>u.stopPropagation(),children:[e.jsxs("div",{className:"modal__header",children:[e.jsxs("h2",{children:["Edit ",Fe[a]||"Application"]}),e.jsx("button",{className:"modal__close-btn",onClick:n,disabled:v,type:"button","aria-label":"Close modal",children:e.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),e.jsxs("form",{onSubmit:S,children:[e.jsx("div",{className:"modal__body",children:o()}),e.jsxs("div",{className:"modal__footer",children:[e.jsx("button",{type:"button",className:"btn btn--secondary",onClick:n,disabled:v,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn--primary",disabled:v,children:v?"Saving...":"Save Changes"})]})]})]})})}function Pe(){const{showToast:s}=de(),a=je({showToast:s});return a.isLoading&&!a.applications.length&&a.viewMode==="list"?e.jsxs("div",{className:"manage-rental-apps",children:[e.jsx(V,{}),e.jsxs("div",{className:"manage-rental-apps__loading",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading..."})]})]}):e.jsxs("div",{className:"manage-rental-apps",children:[e.jsx(V,{}),e.jsxs("header",{className:"manage-rental-apps__header",children:[e.jsxs("div",{className:"manage-rental-apps__header-content",children:[e.jsx("h1",{children:"Manage Rental Applications"}),e.jsxs("p",{className:"manage-rental-apps__subtitle",children:[a.pagination.total," total application",a.pagination.total!==1?"s":""]})]}),e.jsxs("div",{className:"manage-rental-apps__stats",children:[e.jsxs("div",{className:"stat-card stat-card--submitted",children:[e.jsx("span",{className:"stat-card__value",children:a.stats.submitted}),e.jsx("span",{className:"stat-card__label",children:"Submitted"})]}),e.jsxs("div",{className:"stat-card stat-card--under-review",children:[e.jsx("span",{className:"stat-card__value",children:a.stats.underReview}),e.jsx("span",{className:"stat-card__label",children:"Under Review"})]}),e.jsxs("div",{className:"stat-card stat-card--approved",children:[e.jsx("span",{className:"stat-card__value",children:a.stats.approved}),e.jsx("span",{className:"stat-card__label",children:"Approved"})]}),e.jsxs("div",{className:"stat-card stat-card--denied",children:[e.jsx("span",{className:"stat-card__value",children:a.stats.denied}),e.jsx("span",{className:"stat-card__label",children:"Denied"})]})]})]}),e.jsxs("main",{className:"manage-rental-apps__main",children:[a.error&&e.jsxs("div",{className:"manage-rental-apps__error-banner",children:[e.jsx("span",{children:a.error}),e.jsx("button",{onClick:a.handleRetry,className:"btn btn--small",children:"Retry"})]}),a.viewMode==="list"?e.jsxs(e.Fragment,{children:[e.jsx(fe,{filters:a.filters,statusOptions:a.statusOptions,onUpdateFilters:a.handleUpdateFilters,onClearFilters:a.handleClearFilters}),e.jsx(Ce,{applications:a.applications,isLoading:a.isLoading,pagination:a.pagination,sort:a.sort,onSelectApplication:a.handleSelectApplication,onUpdateSort:a.handleUpdateSort,onChangePage:a.handleChangePage,onChangePageSize:a.handleChangePageSize})]}):e.jsx(we,{application:a.selectedApplication,isLoading:a.isLoadingDetail,onBack:a.handleBackToList,onEdit:a.handleOpenEditModal,onUpdateStatus:a.handleUpdateStatus,statusOptions:a.statusOptions})]}),a.isEditModalOpen&&e.jsx(Ae,{application:a.selectedApplication,editSection:a.editSection,onClose:a.handleCloseEditModal,onSave:a.handleSaveEdit,isSaving:a.isSaving})]})}ie(document.getElementById("root")).render(e.jsx(re.StrictMode,{children:e.jsx(me,{children:e.jsx(oe,{children:e.jsx(Pe,{})})})}));

import{r as y,j as t,c as Zt,R as Jt}from"./client-BJVKzfAi.js";import{H as ht}from"./Header-BJKWma2V.js";import{F as ot}from"./Footer-Bzf1rLKh.js";import{c as Qt,v as Xt,k as pt,g as en,i as ut}from"./auth-QZ4BJadW.js";import{s as p}from"./supabase-BoCLEw6R.js";import{i as mt}from"./isHost-bTARCkET.js";import{g as tn}from"./houseRulesService-B9S6foqA.js";import{s as ee,a as nn}from"./Toast-BQk6Nzgd.js";import{g as Ct,i as Dt}from"./proposalStatuses-1Bj0NYR4.js";import{C as Pt}from"./circle-check-big-42edTrxg.js";import{C as sn,S as ft}from"./star-OtPMgcH9.js";import{c as ge}from"./createLucideIcon-CgZZH2OU.js";import{C as Ee}from"./clock-BT0kKcUb.js";import{X as $e}from"./x-CrJVeoCh.js";import{C as Ae}from"./check-B34HRHn5.js";import{B as an}from"./briefcase-U9yY2xYz.js";import{C as cn}from"./calendar-CDI4qHEX.js";import{U as rn}from"./user-C2rhnql4.js";import{M as Oe}from"./message-circle-CVrAGIgu.js";import{B as gt}from"./bell-xU0WfKlw.js";import{T as dn}from"./trash-2-DKO8yvV5.js";import{C as yt}from"./circle-alert-C7SsrRDS.js";import{a as ln,b as we,C as xt,V as hn}from"./virtualMeetingRules-B_v6fFKi.js";import{E as on}from"./ErrorBoundary-9_HbXv1y.js";/* empty css             */import"./constants-CPVJY5eo.js";import"./proposalDataFetcher-CipdyWU2.js";import"./dataLookups-zG18yzis.js";import"./format-AibE8BX3.js";/* empty css                           *//**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],mn=ge("archive",un);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fn=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],gn=ge("circle-x",fn);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yn=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],xn=ge("cpu",yn);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]],kn=ge("git-compare",vn);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nn=[["polyline",{points:"22 12 16 12 14 15 10 15 8 12 2 12",key:"o97t9d"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}]],et=ge("inbox",Nn);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]],jn=ge("loader",bn);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wn=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],_n=ge("pencil",wn);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sn=[["path",{d:"m17 2 4 4-4 4",key:"nntrym"}],["path",{d:"M3 11v-1a4 4 0 0 1 4-4h14",key:"84bu3i"}],["path",{d:"m7 22-4-4 4-4",key:"1wqhfi"}],["path",{d:"M21 13v1a4 4 0 0 1-4 4H3",key:"1rx37r"}]],Rt=ge("repeat",Sn);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cn=[["path",{d:"M10 5H3",key:"1qgfaw"}],["path",{d:"M12 19H3",key:"yhmn1j"}],["path",{d:"M14 3v4",key:"1sua03"}],["path",{d:"M16 17v4",key:"1q0r14"}],["path",{d:"M21 12h-9",key:"1o4lsq"}],["path",{d:"M21 19h-5",key:"1rlt1p"}],["path",{d:"M21 5h-7",key:"1oszz2"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M8 12H3",key:"a7s4jb"}]],Dn=ge("sliders-horizontal",Cn);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pn=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],It=ge("video",Pn),st=[{id:0,name:"Sunday",shortName:"Sun",singleLetter:"S",dayIndex:0},{id:1,name:"Monday",shortName:"Mon",singleLetter:"M",dayIndex:1},{id:2,name:"Tuesday",shortName:"Tue",singleLetter:"T",dayIndex:2},{id:3,name:"Wednesday",shortName:"Wed",singleLetter:"W",dayIndex:3},{id:4,name:"Thursday",shortName:"Thu",singleLetter:"T",dayIndex:4},{id:5,name:"Friday",shortName:"Fri",singleLetter:"F",dayIndex:5},{id:6,name:"Saturday",shortName:"Sat",singleLetter:"S",dayIndex:6}],Re=[{id:0,name:"Sunday Night",checkInDay:0,checkOutDay:1},{id:1,name:"Monday Night",checkInDay:1,checkOutDay:2},{id:2,name:"Tuesday Night",checkInDay:2,checkOutDay:3},{id:3,name:"Wednesday Night",checkInDay:3,checkOutDay:4},{id:4,name:"Thursday Night",checkInDay:4,checkOutDay:5},{id:5,name:"Friday Night",checkInDay:5,checkOutDay:6},{id:6,name:"Saturday Night",checkInDay:6,checkOutDay:0}],He=[{value:"6-weeks",label:"6 weeks",weeks:6,months:1.5,days:42},{value:"7-weeks",label:"7 weeks",weeks:7,months:1.75,days:49},{value:"8-weeks",label:"8 weeks",weeks:8,months:2,days:56},{value:"9-weeks",label:"9 weeks (~2 months)",weeks:9,months:2.25,days:63},{value:"10-weeks",label:"10 weeks",weeks:10,months:2.5,days:70},{value:"12-weeks",label:"12 weeks",weeks:12,months:3,days:84},{value:"13-weeks",label:"13 weeks (3 months)",weeks:13,months:3.25,days:91},{value:"16-weeks",label:"16 weeks",weeks:16,months:4,days:112},{value:"17-weeks",label:"17 weeks (~4 months)",weeks:17,months:4.25,days:119},{value:"20-weeks",label:"20 weeks (5 months)",weeks:20,months:5,days:140},{value:"22-weeks",label:"22 weeks (~5.5 months)",weeks:22,months:5.5,days:154},{value:"26-weeks",label:"26 weeks (6 months)",weeks:26,months:6.5,days:182},{value:"other",label:"Other",weeks:0,months:0,days:0}],Rn={proposal_submitted_for_review:{status:"proposal_submitted_for_review",displayText:"Proposal Submitted for Review",usualOrder:0},proposal_submitted_by_guest:{status:"proposal_submitted_by_guest",displayText:"Proposal Submitted by Guest",usualOrder:1},host_review:{status:"host_review",displayText:"Host Review",usualOrder:2},host_counteroffer_submitted:{status:"host_counteroffer_submitted",displayText:"Host Counteroffer Submitted",usualOrder:3},proposal_accepted:{status:"proposal_accepted",displayText:"Proposal or Counteroffer Accepted",usualOrder:4},lease_documents_sent_to_guest:{status:"lease_documents_sent_to_guest",displayText:"Lease Documents Sent to Guest",usualOrder:5},lease_documents_sent_to_host:{status:"lease_documents_sent_to_host",displayText:"Lease Documents Sent to Host",usualOrder:6},lease_documents_signed:{status:"lease_documents_signed",displayText:"Lease Documents Signed",usualOrder:7},initial_payment_submitted:{status:"initial_payment_submitted",displayText:"Initial Payment Submitted",usualOrder:8},proposal_cancelled_by_guest:{status:"proposal_cancelled_by_guest",displayText:"Proposal Cancelled by Guest",usualOrder:9},proposal_rejected_by_host:{status:"proposal_rejected_by_host",displayText:"Proposal Rejected by Host",usualOrder:10},proposal_cancelled_by_system:{status:"proposal_cancelled_by_system",displayText:"Proposal Cancelled by System",usualOrder:11},guest_ignored_suggestion:{status:"guest_ignored_suggestion",displayText:"Guest Ignored Suggestion",usualOrder:12}};function _e(e){const n=st.find(s=>s.id===e);return(n==null?void 0:n.name)||""}function In(e){const n=Re.find(s=>s.id===e);return(n==null?void 0:n.name)||""}function Ln(e){return e.map(n=>In(n)).filter(Boolean)}function Mn(e){return e.map(n=>{const s=Re.find(i=>i.name===n);return s==null?void 0:s.id}).filter(n=>n!==void 0)}function An(e){if(!e||e.length===0)return null;if(e.length===1)return e[0];const n=[...e].sort((a,c)=>a-c),s=n.includes(0),i=n.includes(6);if(s&&i){for(let a=0;a<n.length-1;a++)if(n[a+1]-n[a]>1)return n[a+1];return n[0]}return n[0]}function Tn(e){if(!e||e.length===0)return null;if(e.length===1)return e[0];const n=[...e].sort((a,c)=>a-c),s=n.includes(0),i=n.includes(6);if(s&&i){for(let a=0;a<n.length-1;a++)if(n[a+1]-n[a]>1)return n[a];return n[n.length-1]}return n[n.length-1]}function vt(e){const n=An(e);if(n===null)return null;const s=Re.find(i=>i.id===n);return(s==null?void 0:s.checkInDay)??null}function tt(e){const n=Tn(e);if(n===null)return null;const s=Re.find(i=>i.id===n);return(s==null?void 0:s.checkOutDay)??null}function En(e){if(!e||e.length===0)return[];const n=e.map(i=>{const a=Re.find(c=>c.id===i);return a==null?void 0:a.checkInDay}).filter(i=>i!==void 0),s=tt(e);return s!==null&&!n.includes(s)&&n.push(s),n}function Ge(e){return e==null||isNaN(e)?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e)}function Te(e,n="full"){return!e||!(e instanceof Date)||isNaN(e.getTime())?"":n==="short"?new Intl.DateTimeFormat("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}).format(e):new Intl.DateTimeFormat("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}).format(e)}function Je(e){return!e||!(e instanceof Date)||isNaN(e.getTime())?"":e.toISOString().split("T")[0]}function Lt(e){return He.find(n=>n.weeks===e)||null}function On(e){return e?{...e,title:e.Name||e.title||e.name||"Unnamed Listing",name:e.Name||e.title||e.name||"Unnamed Listing",thumbnail:e["Cover Photo"]||e.thumbnail||e.cover_photo||null,neighborhood:e.Neighborhood||e.neighborhood||null,address:e["Full Address"]||e.address||e.full_address||null,bedrooms:e["Bedrooms (number)"]||e.bedrooms||0,bathrooms:e["Bathrooms (number)"]||e.bathrooms||0,monthly_rate:e["Monthly Rate"]||e.monthly_rate||0}:null}function Mt(e){if(!e)return null;const n=e["user verified?"]||e.id_verified||!1,s=!!(e["Selfie with ID"]||e.id_verified),i=!!(e["Verify - Linked In ID"]||e.work_verified);return{...e,name:e["Name - Full"]||e.name||e.full_name||"Guest",full_name:e["Name - Full"]||e.full_name||e.name||"Guest",first_name:e["Name - First"]||e.first_name||e.firstName||"Guest",profilePhoto:e["Profile Photo"]||e.profilePhoto||e.profile_photo||null,avatar:e["Profile Photo"]||e.profilePhoto||e.avatar||null,bio:e["About Me / Bio"]||e.Bio||e.bio||e.about||null,id_verified:s||n,work_verified:i,is_verified:n,review_count:e["Review Count"]||e.review_count||0,created_at:e["Created Date"]||e.created_at||null}}function Fn(e,n=null){if(!e)return null;const s=e.Status||e.status||"",i=typeof s=="string"?s.toLowerCase().replace(/\s+/g,"_"):s;return{...e,status:i,guest:n||Mt(e.guest),start_date:e["Move in range start"]||e.start_date||null,end_date:e["Move-out"]||e.end_date||null,move_in_range_start:e["Move in range start"]||e.move_in_range_start||null,move_in_range_end:e["Move in range end"]||e.move_in_range_end||null,created_at:e["Created Date"]||e.created_at||null,days_selected:e["Days Selected"]||e.days_selected||[],days_per_week:e["Days Selected"]||e.days_per_week||[],nights_selected:e["Nights Selected (Nights list)"]||e.nights_selected||[],nights_per_week:e["nights per week (num)"]||e.nights_per_week||0,check_in_day:e["check in day"]||e.check_in_day||null,check_out_day:e["check out day"]||e.check_out_day||null,duration_weeks:e["Reservation Span (Weeks)"]||e.duration_weeks||e.total_weeks||0,duration_months:e["Reservation Span"]||e.duration_months||0,nightly_rate:e["proposal nightly price"]||e.nightly_rate||0,total_price:e["Total Compensation (proposal - host)"]||e["host compensation"]||e.total_price||0,host_compensation:e["host compensation"]||e["Total Compensation (proposal - host)"]||e.host_compensation||0,four_week_rent:e["4 week rent"]||e.four_week_rent||0,four_week_compensation:e["4 week compensation"]||e.four_week_compensation||0,cleaning_fee:e["cleaning fee"]||e.cleaning_fee||0,damage_deposit:e["damage deposit"]||e.damage_deposit||0,comment:e.Comment||e.comment||null,need_for_space:e["need for space"]||e.need_for_space||null,about_yourself:e.about_yourself||null,last_modified_by:e.last_modified_by||e.last_modified_by||null,has_guest_counteroffer:e.has_guest_counteroffer||!1}}function $n({skipAuth:e=!1}={}){const[n,s]=y.useState({isChecking:!e,isAuthenticated:e,shouldRedirect:!1,userType:e?"host":null}),[i,a]=y.useState(null),[c,u]=y.useState([]),[l,r]=y.useState(null),[d,o]=y.useState([]),[N,S]=y.useState(null),[f,I]=y.useState(!1),[j,k]=y.useState(!1),[W,F]=y.useState(!1),[R,T]=y.useState(!1),[C,$]=y.useState(""),[O,V]=y.useState(null),[Z,z]=y.useState(!0),[se,P]=y.useState(null),[q,Se]=y.useState({}),[Ce,Ie]=y.useState([]);y.useEffect(()=>{if(e){z(!1);return}async function g(){var x,h,D,U,L;try{if(!await Qt()){s({isChecking:!1,isAuthenticated:!1,shouldRedirect:!0,userType:null}),window.location.href="/";return}const H=await Xt({clearOnFailure:!1});let E=null,m=null;if(H)E=H["User Type"]||H.userType,m=H,console.log("[HostProposals] User data loaded, userType:",E);else{const{data:{session:v}}=await p.auth.getSession();if(v!=null&&v.user){if(E=((x=v.user.user_metadata)==null?void 0:x.user_type)||pt()||null,console.log("[HostProposals] Using fallback session data, userType:",E),E&&mt({userType:E})&&(m={userId:((h=v.user.user_metadata)==null?void 0:h.user_id)||ut()||v.user.id,_id:((D=v.user.user_metadata)==null?void 0:D.user_id)||ut()||v.user.id,firstName:((U=v.user.user_metadata)==null?void 0:U.first_name)||en()||((L=v.user.email)==null?void 0:L.split("@")[0])||"Host",email:v.user.email,userType:E}),!E){console.log("[HostProposals] Cannot determine user type from session, redirecting"),s({isChecking:!1,isAuthenticated:!0,shouldRedirect:!0,userType:null}),window.location.href="/";return}}else{console.log("[HostProposals] No valid session, redirecting"),s({isChecking:!1,isAuthenticated:!1,shouldRedirect:!0,userType:null}),window.location.href="/";return}}if(!mt({userType:E})){console.warn("[HostProposals] User is not a Host, redirecting..."),s({isChecking:!1,isAuthenticated:!1,shouldRedirect:!0,userType:E}),window.location.href="/";return}a(m),s({isChecking:!1,isAuthenticated:!0,shouldRedirect:!1,userType:E}),await J(m.userId||m._id)}catch(G){console.error("Auth check failed:",G),P("Authentication failed. Please log in again."),s({isChecking:!1,isAuthenticated:!1,shouldRedirect:!0,userType:null})}}g()},[]),y.useEffect(()=>{async function g(){try{const x=await tn();Ie(x),console.log("[HostProposals] Loaded all house rules:",x.length)}catch(x){console.error("[HostProposals] Failed to load house rules:",x)}}g()},[]);const J=async g=>{z(!0),P(null);try{const x=await ie(g);if(x.length>0){const h=x.map(b=>b._id||b.id),{data:D,error:U}=await p.from("proposal").select('Listing, "Created Date"').in("Listing",h).or('"Deleted".is.null,"Deleted".eq.false');U&&console.warn("[useHostProposalsPageLogic] Could not fetch proposal stats:",U);const L={},G={};(D||[]).forEach(b=>{const A=b.Listing;L[A]||(L[A]={count:0,mostRecent:null}),L[A].count++,G[A]=(G[A]||0)+1;const Q=new Date(b["Created Date"]);(!L[A].mostRecent||Q>L[A].mostRecent)&&(L[A].mostRecent=Q)}),Se(G);const H=[...x].sort((b,A)=>{const Q=b._id||b.id,X=A._id||A.id,oe=L[Q]||{count:0,mostRecent:null},ue=L[X]||{count:0,mostRecent:null};return oe.count>0&&ue.count===0?-1:ue.count>0&&oe.count===0?1:oe.mostRecent&&ue.mostRecent?ue.mostRecent-oe.mostRecent:oe.mostRecent?-1:ue.mostRecent?1:ue.count-oe.count});console.log("[useHostProposalsPageLogic] Sorted listings by proposals:",H.map(b=>{var A;return{id:b._id||b.id,name:b.Name,proposals:((A=L[b._id||b.id])==null?void 0:A.count)||0}}));const E=H.map(On);u(E);const v=new URLSearchParams(window.location.search).get("listingId");let M=E[0];if(v){const b=E.find(A=>(A._id||A.id)===v);b&&(M=b,console.log("[useHostProposalsPageLogic] Pre-selected listing from URL:",v))}r(M);const w=await Y(M._id||M.id,g);o(w)}else u([]),o([])}catch(x){console.error("Failed to load host data:",x),P("Failed to load your listings and proposals. Please try again.")}finally{z(!1)}},ie=async g=>{try{console.log("[useHostProposalsPageLogic] Fetching listings for user:",g);const{data:x,error:h}=await p.rpc("get_host_listings",{host_user_id:g});if(h)throw console.error("[useHostProposalsPageLogic] Error fetching listings:",h),h;return console.log("[useHostProposalsPageLogic] Found listings:",(x==null?void 0:x.length)||0),x||[]}catch(x){return console.error("Failed to fetch listings:",x),[]}},Y=async(g,x=null)=>{try{console.log("[useHostProposalsPageLogic] Fetching proposals for listing:",g);const{data:h,error:D}=await p.from("proposal").select(`
          _id,
          "Status",
          "Guest",
          "Host User",
          "Listing",
          "Move in range start",
          "Move in range end",
          "Move-out",
          "Reservation Span",
          "Reservation Span (Weeks)",
          "nights per week (num)",
          "Nights Selected (Nights list)",
          "Days Selected",
          "check in day",
          "check out day",
          "hc nights selected",
          "hc days selected",
          "proposal nightly price",
          "4 week rent",
          "Total Price for Reservation (guest)",
          "Total Compensation (proposal - host)",
          "host compensation",
          "4 week compensation",
          "cleaning fee",
          "damage deposit",
          "Guest email",
          "need for space",
          "about_yourself",
          "Comment",
          "Created Date",
          "Modified Date",
          "virtual meeting",
          "counter offer happened",
          "hc reservation span (weeks)",
          "hc nightly price",
          "hc total price",
          "hc move in date",
          "hc check in day",
          "hc check out day",
          "hc nights per week",
          "hc house rules"
        `).eq("Listing",g).neq("Deleted",!0).order("Created Date",{ascending:!1});if(D)throw console.error("[useHostProposalsPageLogic] Error fetching proposals:",D),D;if(console.log("[useHostProposalsPageLogic] Found proposals:",(h==null?void 0:h.length)||0),h&&h.length>0){const L=[...new Set(h.map(m=>m.Guest).filter(Boolean))];if(L.length>0){console.log("[useHostProposalsPageLogic] Fetching guest data for IDs:",L);const{data:m,error:v}=await p.from("user").select('_id, "Name - Full", "Name - First", "Name - Last", email, "Profile Photo", "About Me / Bio", "user verified?", "Verify - Linked In ID", "Verify - Phone", "Selfie with ID", "Created Date"').in("_id",L);v&&console.error("[useHostProposalsPageLogic] Error fetching guests:",v),console.log("[useHostProposalsPageLogic] Raw guest data:",m);const M={};m==null||m.forEach(w=>{M[w._id]=w}),h.forEach(w=>{if(w.Guest&&M[w.Guest]){const b=Mt(M[w.Guest]);console.log("[useHostProposalsPageLogic] Normalized guest:",{name:b.name,bio:b.bio?b.bio.substring(0,30)+"...":"NO BIO",id_verified:b.id_verified,work_verified:b.work_verified}),w.guest=b}})}const G=[...new Set(h.map(m=>m["virtual meeting"]).filter(Boolean))];if(G.length>0){const{data:m}=await p.from("virtualmeetingschedulesandlinks").select(`
              _id,
              "requested by",
              "booked date",
              "meeting declined",
              "confirmedBySplitLease",
              "suggested dates and times",
              "meeting link"
            `).in("_id",G),v={};m==null||m.forEach(M=>{v[M._id]=M}),h.forEach(M=>{if(M["virtual meeting"]&&v[M["virtual meeting"]]){const w=v[M["virtual meeting"]];M.virtualMeeting={_id:w._id,requestedBy:w["requested by"],bookedDate:w["booked date"],meetingDeclined:w["meeting declined"],confirmedBySplitlease:w.confirmedBySplitLease,suggestedTimes:w["suggested dates and times"],meetingLink:w["meeting link"]}}})}console.log("[useHostProposalsPageLogic] DEBUG: About to fetch negotiation summaries");const H=h.map(m=>m._id),E=x||(i==null?void 0:i._id)||(i==null?void 0:i.userId);if(console.log("[useHostProposalsPageLogic] DEBUG: proposalIds:",H,"hostUserId:",E,"override:",x),H.length>0&&E){const{data:m,error:v}=await p.from("negotiationsummary").select("*").in('"Proposal associated"',H).eq('"To Account"',E).order('"Created Date"',{ascending:!1});if(v)console.error("[useHostProposalsPageLogic] Error fetching negotiation summaries:",v);else{const M={};m==null||m.forEach(w=>{const b=w["Proposal associated"];M[b]||(M[b]=[]),M[b].push(w)}),h.forEach(w=>{w.negotiationSummaries=M[w._id]||[]}),console.log("[useHostProposalsPageLogic] Fetched negotiation summaries for",(m==null?void 0:m.length)||0,"proposals")}}}return(h||[]).map(L=>Fn(L,L.guest))}catch(h){return console.error("Failed to fetch proposals:",h),[]}},ye=y.useCallback(async g=>{let x=g;if(typeof g=="string"&&(x=c.find(h=>(h._id||h.id)===g),!x)){console.warn("[useHostProposalsPageLogic] Listing not found:",g);return}r(x),z(!0);try{const h=await Y(x._id||x.id);o(h)}catch(h){console.error("Failed to load proposals for listing:",h),P("Failed to load proposals. Please try again.")}finally{z(!1)}},[c]),xe=y.useCallback(g=>{S(g),I(!0)},[]),ae=y.useCallback(()=>{I(!1),S(null)},[]),ce=y.useCallback(async g=>{if(confirm("Are you sure you want to delete this proposal?"))try{const{data:x,error:h}=await p.functions.invoke("proposal",{body:{action:"update",payload:{proposalId:g._id||g.id,status:"Deleted"}}});if(h)throw h;o(D=>D.filter(U=>(U._id||U.id)!==(g._id||g.id))),console.log("[useHostProposalsPageLogic] Proposal deleted:",g._id)}catch(x){console.error("Failed to delete proposal:",x),ee({title:"Error",content:"Failed to delete proposal. Please try again.",type:"error"})}},[]),B=y.useCallback(async g=>{try{const{data:x,error:h}=await p.functions.invoke("proposal",{body:{action:"update",payload:{proposal_id:g._id||g.id,status:"Proposal or Counteroffer Accepted / Drafting Lease Documents"}}});if(h)throw h;if(l){const D=await Y(l._id||l.id);o(D)}ae(),ee({title:"Success!",content:"Proposal accepted successfully!",type:"success"}),console.log("[useHostProposalsPageLogic] Proposal accepted:",g._id)}catch(x){console.error("Failed to accept proposal:",x),ee({title:"Error",content:"Failed to accept proposal. Please try again.",type:"error"})}},[l,ae]),te=y.useCallback(g=>{S(g),I(!1),F(!0),k(!0)},[]),ve=y.useCallback(g=>{S(g),I(!1),F(!1),k(!0)},[]),me=y.useCallback(()=>{k(!1),S(null),F(!1)},[]),Le=y.useCallback(async g=>{await B(g),k(!1)},[B]),ne=g=>{if(typeof g=="number")return g;if(typeof g!="string")return null;const x=st.find(h=>h.name.toLowerCase()===g.toLowerCase());return(x==null?void 0:x.dayIndex)??null},re=y.useCallback(async g=>{var x;try{const{proposal:h,numberOfWeeks:D,checkIn:U,checkOut:L,nightsSelected:G,daysSelected:H,newHouseRules:E,moveInDate:m}=g,v=h||N;console.log("[useHostProposalsPageLogic] Counteroffer input:",{checkIn:U,checkOut:L,nightsSelected:G,daysSelected:H});const M=v["Reservation Span (Weeks)"]||v.duration_weeks||0,w=v["check in day"]??v.check_in_day,b=v["check out day"]??v.check_out_day,A=v["Nights Selected (Nights list)"]||v.nights_selected||[],Q=v["Days Selected"]||v.days_selected||[],X=v["Move in range start"]||v.move_in_range_start,oe=v["proposal nightly price"]||v.nightly_rate||0,ue=v["cleaning fee"]||v.cleaning_fee||0,We=v["damage deposit"]||v.damage_deposit||0,Ys=v["Total Price for Reservation (guest)"]||v.total_price||0,Ks=v["4 week rent"]||v.four_week_rent||0,Bt=U!==void 0?ne(U):null,Gt=L!==void 0?ne(L):null,zt=G!==void 0&&Array.isArray(G)?Mn(G):null,Ut=H!==void 0&&Array.isArray(H)?H.map(ne).filter(je=>je!==null):null,qt=m!==void 0?m instanceof Date?m.toISOString().split("T")[0]:m:null,ct=D??M,Ve=zt??A,Ye=Array.isArray(Ve)?Ve.length:(A==null?void 0:A.length)||0,Ke=parseFloat(oe)||0,Vt=Ke*Ye*ct,Yt=Ke*Ye*4,rt={proposal_id:v._id||v.id,status:"Host Counteroffer Submitted / Awaiting Guest Review",hc_reservation_span_weeks:ct,hc_check_in:Bt??(typeof w=="number"?w:parseInt(w,10)||0),hc_check_out:Gt??(typeof b=="number"?b:parseInt(b,10)||0),hc_nights_selected:Ve,hc_days_selected:Ut??Q,hc_move_in_date:qt??X,hc_nights_per_week:Ye,hc_nightly_price:Ke,hc_cleaning_fee:parseFloat(ue)||0,hc_damage_deposit:parseFloat(We)||0,hc_total_price:Vt,hc_four_week_rent:Yt,hc_house_rules:Array.isArray(E)?E.map(je=>je.id||je._id||je).filter(Boolean):[]};console.log("[useHostProposalsPageLogic] Converted payload with ALL hc_ fields:",rt);const{data:{session:Me},error:dt}=await p.auth.getSession();if(dt&&console.error("[useHostProposalsPageLogic] Session error:",dt),console.log("[useHostProposalsPageLogic] Session exists:",!!Me),console.log("[useHostProposalsPageLogic] Access token exists:",!!(Me!=null&&Me.access_token)),!(Me!=null&&Me.access_token)){console.log("[useHostProposalsPageLogic] No active session, attempting refresh...");const{data:{session:je},error:Kt}=await p.auth.refreshSession();if(Kt||!je)throw new Error("Session expired. Please refresh the page and try again.");console.log("[useHostProposalsPageLogic] Session refreshed successfully")}const{data:{session:Ze}}=await p.auth.getSession(),Be=Ze==null?void 0:Ze.access_token;console.log("[useHostProposalsPageLogic] Auth token length:",Be==null?void 0:Be.length),console.log("[useHostProposalsPageLogic] Invoking Edge Function with explicit auth...");const{data:Zs,error:lt}=await p.functions.invoke("proposal",{headers:{Authorization:`Bearer ${Be}`},body:{action:"update",payload:rt}});if(lt)throw lt;if(l){const je=await Y(l._id||l.id);o(je)}k(!1),S(null),ee({title:"Counteroffer Sent!",content:"Your counteroffer has been submitted for guest review.",type:"success"}),console.log("[useHostProposalsPageLogic] Counteroffer sent:",N._id)}catch(h){console.error("Failed to send counteroffer:",h);const D=(h==null?void 0:h.message)||((x=h==null?void 0:h.error)==null?void 0:x.message)||(h==null?void 0:h.error)||(typeof h=="string"?h:"Failed to send counteroffer. Please try again.");ee({title:"Error",content:typeof D=="string"?D:"Failed to send counteroffer. Please try again.",type:"error"})}},[N,l]),de=y.useCallback(async(g,x)=>{try{const{data:h,error:D}=await p.functions.invoke("proposal",{body:{action:"update",payload:{proposal_id:g._id||g.id,status:"Proposal Rejected by Host",reason_for_cancellation:x}}});if(D)throw D;if(l){const U=await Y(l._id||l.id);o(U)}k(!1),S(null),ee({title:"Proposal Rejected",content:"The proposal has been rejected.",type:"info"}),console.log("[useHostProposalsPageLogic] Proposal rejected from editing:",g._id)}catch(h){console.error("Failed to reject proposal:",h),ee({title:"Error",content:"Failed to reject proposal. Please try again.",type:"error"})}},[l]),ke=y.useCallback(g=>{if(g&&typeof g=="object"){const x=g.type==="information"?"info":g.type||"info";ee({title:g.title||"Notification",content:g.content||"",type:x})}else typeof g=="string"&&ee({title:g,type:"info"})},[]),Ne=y.useCallback(g=>{const x=g.guest||g.Guest||g["Created By"]||{},h=x.firstName||x["First Name"]||"Guest";ee({title:"Opening Messages",content:`Opening message thread with ${h}`,type:"info"})},[]),De=y.useCallback(async g=>{try{console.log("[useHostProposalsPageLogic] Reminder requested for proposal:",g._id),ee({title:"Coming Soon",content:"Reminder feature coming soon! For urgent matters, please contact support@splitlease.com",type:"info"})}catch(x){console.error("Failed to send reminder:",x),ee({title:"Error",content:"Failed to send reminder. Please try again.",type:"error"})}},[]),le=y.useCallback(g=>{if(!g)return;const x=g.virtualMeeting,h=(i==null?void 0:i._id)||(i==null?void 0:i.userId);let D="request";x?x.meetingDeclined?D="request":x.confirmedBySplitlease?D="details":x.bookedDate&&!x.meetingDeclined?x.requestedBy===h?D="details":D="respond":x.requestedBy&&x.requestedBy!==h?D="respond":x.requestedBy===h&&(D="details"):D="request",V(g),$(D),T(!0),I(!1)},[i]),he=y.useCallback(()=>{T(!1),$(""),V(null)},[]),K=y.useCallback(async()=>{if(l){const g=await Y(l._id||l.id);o(g)}he()},[l,he]),_=y.useCallback(g=>{const x=g.guest||g.Guest||g["Created By"]||{},h=x.firstName||x["First Name"]||"Guest";ee({title:"Request Sent!",content:`Rental application request sent to ${h}! They will be notified to complete their application.`,type:"success"})},[]),be=y.useCallback(()=>{l&&(window.location.href=`/listing-dashboard?id=${l._id||l.id}`)},[l]),Pe=y.useCallback(()=>{i&&J(i.userId)},[i]);return{authState:n,user:i,listings:c,selectedListing:l,proposals:d,selectedProposal:N,isModalOpen:f,isEditingProposal:j,showRejectOnOpen:W,isVirtualMeetingModalOpen:R,virtualMeetingView:C,virtualMeetingProposal:O,allHouseRules:Ce,isLoading:Z,error:se,proposalCountsByListing:q,handleListingChange:ye,handleProposalClick:xe,handleCloseModal:ae,handleDeleteProposal:ce,handleAcceptProposal:B,handleRejectProposal:te,handleModifyProposal:ve,handleSendMessage:Ne,handleRemindSplitLease:De,handleChooseVirtualMeeting:le,handleRequestRentalApp:_,handleEditListing:be,handleRetry:Pe,handleCloseVirtualMeetingModal:he,handleVirtualMeetingSuccess:K,handleCloseEditing:me,handleAcceptAsIs:Le,handleCounteroffer:re,handleRejectFromEditing:de,handleEditingAlert:ke}}function Hn(e){const n=typeof e=="string"?e:(e==null?void 0:e.id)||(e==null?void 0:e._id)||"",s=Ct(n),i=s.usualOrder??0;return Dt(n)?{text:"Cancelled!",backgroundColor:"#FEE2E2",textColor:"#991B1B",icon:"x"}:s.key==="Host Counteroffer Submitted / Awaiting Guest Review"?{text:"Guest Reviewing Counteroffer",backgroundColor:"#FEF3C7",textColor:"#924026",icon:"clock"}:i>=3?{text:"Accepted!",backgroundColor:"#D1FAE5",textColor:"#065F46",icon:"check"}:{text:"Pending Review",backgroundColor:"#FEF3C7",textColor:"#924026",icon:"clock"}}const Wn=[{short:"S",full:"Sunday"},{short:"M",full:"Monday"},{short:"T",full:"Tuesday"},{short:"W",full:"Wednesday"},{short:"T",full:"Thursday"},{short:"F",full:"Friday"},{short:"S",full:"Saturday"}];function Bn(e){const n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if(!e)return[];let s=e;if(typeof e=="string")try{s=JSON.parse(e)}catch{return[]}return Array.isArray(s)?s.map(i=>{const a=typeof i=="string"?parseInt(i,10):i;return n[a]||""}).filter(Boolean):[]}function it(e){const n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if(!e)return{checkInDay:"",checkOutDay:""};let s=e;if(typeof e=="string")try{s=JSON.parse(e)}catch{return{checkInDay:"",checkOutDay:""}}if(!Array.isArray(s)||s.length===0)return{checkInDay:"",checkOutDay:""};const i=s.map(d=>{if(typeof d=="number")return d;if(typeof d=="string"){const o=d.trim(),N=parseInt(o,10);if(!isNaN(N)&&String(N)===o)return N;const S=n.indexOf(o);return S>=0?S:-1}return-1}).filter(d=>d>=0&&d<=6);if(i.length===0)return{checkInDay:"",checkOutDay:""};const a=[...i].sort((d,o)=>d-o),c=a.includes(0),u=a.includes(6);if(c&&u){let d=-1;for(let o=1;o<a.length;o++)if(a[o]!==a[o-1]+1){d=o;break}if(d!==-1){const o=a[d],N=a[d-1];return{checkInDay:n[o]||"",checkOutDay:n[N]||""}}}const l=a[0],r=a[a.length-1];return{checkInDay:n[l]||"",checkOutDay:n[r]||""}}function Gn(e){const n=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];if(!e)return{checkInDay:"",checkOutDay:""};let s=e;if(typeof e=="string")try{s=JSON.parse(e)}catch{return{checkInDay:"",checkOutDay:""}}if(!Array.isArray(s)||s.length===0)return{checkInDay:"",checkOutDay:""};const i=s.map(d=>typeof d=="string"?parseInt(d,10):d).filter(d=>!isNaN(d)&&d>=0&&d<=6).sort((d,o)=>d-o);if(i.length===0)return{checkInDay:"",checkOutDay:""};const a=i.includes(0),c=i.includes(6);if(a&&c){let d=-1;for(let o=1;o<i.length;o++)if(i[o]!==i[o-1]+1){d=o;break}if(d!==-1){const o=i[d],S=(i[d-1]+1)%7;return{checkInDay:n[o]||"",checkOutDay:n[S]||""}}}const u=i[0],r=(i[i.length-1]+1)%7;return{checkInDay:n[u]||"",checkOutDay:n[r]||""}}const At=["proposal_submitted","host_review"],zn=["accepted","host_counteroffer","lease_documents_sent","lease_documents_signatures","lease_signed"],Tt=["cancelled_by_guest","rejected_by_host","cancelled_by_splitlease","payment_submitted"];function qe(e){const n=e==null?void 0:e.status;return n?typeof n=="string"?n:n.id||n._id||n.key||"":""}function at(e){if(e!=null&&e.has_guest_counteroffer||e!=null&&e.guest_counteroffer)return!0;const n=qe(e);return(e==null?void 0:e.last_modified_by)==="guest"&&(n==="host_review"||n==="proposal_submitted")}function Un(e){const n={actionNeeded:[],inProgress:[],closed:[]};if(!Array.isArray(e))return n;for(const s of e){const i=qe(s);if(at(s)){n.actionNeeded.push(s);continue}At.includes(i)?n.actionNeeded.push(s):zn.includes(i)?n.inProgress.push(s):Tt.includes(i)?n.closed.push(s):n.inProgress.push(s)}return n}function qn(e){const n=qe(e);return at(e)?"counteroffer":At.includes(n)?"action-needed":n==="accepted"||n.startsWith("lease_")?"accepted":n==="host_counteroffer"?"default":Tt.includes(n)&&n!=="payment_submitted"?"declined":"default"}function Vn(e){const n=qe(e);return at(e)?{text:"Guest Counter",variant:"counteroffer"}:n==="proposal_submitted_by_guest_-_awaiting_rental_application"||n==="proposal_submitted_for_guest_by_split_lease_-_awaiting_rental_application"?{text:"Awaiting Rental App",variant:"default"}:n==="proposal_submitted_for_guest_by_split_lease_-_pending_confirmation"||n==="pending_confirmation"?{text:"Pending Confirmation",variant:"default"}:n==="host_counteroffer_submitted_/_awaiting_guest_review"?{text:"Awaiting Guest Review",variant:"default"}:n==="pending"?{text:"Awaiting Rental App",variant:"default"}:{proposal_submitted:{text:"Review",variant:"attention"},host_review:{text:"Review",variant:"attention"},host_counteroffer:{text:"Your Counter",variant:"default"},accepted:{text:"Accepted",variant:"success"},lease_documents_sent:{text:"Lease Sent",variant:"success"},lease_documents_signatures:{text:"Awaiting Signatures",variant:"success"},lease_signed:{text:"Lease Signed",variant:"success"},payment_submitted:{text:"Active",variant:"success"},cancelled_by_guest:{text:"Cancelled",variant:"declined"},rejected_by_host:{text:"Declined",variant:"declined"},cancelled_by_splitlease:{text:"Cancelled",variant:"declined"}}[n]||{text:"Pending",variant:"default"}}function Yn(e,n=48){const s=(e==null?void 0:e.created_at)||(e==null?void 0:e.Created_Date)||(e==null?void 0:e.createdAt);if(!s)return!1;const i=new Date(s);return(new Date-i)/(1e3*60*60)<=n}function Kn(e){if(e!=null&&e.picture_url)return e.picture_url;if(e!=null&&e.Image)return e.Image;if(e!=null&&e.photo)return e.photo;const n=(e==null?void 0:e.title)||(e==null?void 0:e.name)||"Listing";return`https://ui-avatars.com/api/?name=${encodeURIComponent(n)}&background=E9E0F7&color=6D31C2&size=100`}function Zn({listings:e=[],selectedListingId:n,onListingChange:s,proposalCounts:i={}}){return e!=null&&e.length?t.jsx("div",{className:"hp7-listing-selector",children:e.map(a=>{const c=a._id||a.id,u=c===n,l=i[c]??0,r=a.title||a.name||"Unnamed Listing",d=Kn(a);return t.jsxs("button",{type:"button",className:`hp7-listing-pill${u?" active":""}`,onClick:()=>s==null?void 0:s(c),"aria-pressed":u,"aria-label":`${r} - ${l} proposals`,children:[t.jsx("img",{src:d,className:"hp7-listing-pill-thumb",alt:"",loading:"lazy"}),t.jsx("span",{className:"hp7-listing-pill-name",children:r}),t.jsx("span",{className:"hp7-listing-pill-count",children:l})]},c)})}):null}function Jn(e){if(e!=null&&e.profilePhoto)return e.profilePhoto;if(e!=null&&e.avatar)return e.avatar;if(e!=null&&e.photo)return e.photo;if(e!=null&&e.picture_url)return e.picture_url;const n=(e==null?void 0:e.name)||(e==null?void 0:e.full_name)||"Guest";return`https://ui-avatars.com/api/?name=${encodeURIComponent(n)}&background=E9E0F7&color=6D31C2&rounded=true&size=100`}function Qn(e){return(e==null?void 0:e.name)||(e==null?void 0:e.full_name)||(e==null?void 0:e.first_name)||"Guest"}function Xn(e){return(e==null?void 0:e.id_verified)||(e==null?void 0:e.is_verified)||(e==null?void 0:e.verified)||!1}function pn(e){if(!Array.isArray(e)||e.length===0)return"";const{checkInDay:n,checkOutDay:s}=it(e);return n?!s||n===s?n.slice(0,3):`${n.slice(0,3)}-${s.slice(0,3)}`:""}function es(e){const n=(e==null?void 0:e.duration_weeks)||(e==null?void 0:e.weeks)||(e==null?void 0:e.total_weeks);if(n)return`${n} weeks`;const s=(e==null?void 0:e.start_date)||(e==null?void 0:e.move_in_date),i=(e==null?void 0:e.end_date)||(e==null?void 0:e.move_out_date);if(s&&i){const a=new Date(s),c=new Date(i),u=Math.ceil((c-a)/(1e3*60*60*24));return`${Math.round(u/7)} weeks`}return""}function ts(e){const n=(e==null?void 0:e.total_price)||(e==null?void 0:e.host_earnings)||(e==null?void 0:e.total_amount)||0;return`$${Number(n).toLocaleString()}`}function ns({proposal:e,isExpanded:n,onToggle:s,contentId:i}){const a=(e==null?void 0:e.guest)||(e==null?void 0:e.user)||{},c=Jn(a),u=Qn(a),l=Xn(a),r=Yn(e),d=Vn(e),o=(e==null?void 0:e.days_selected)||(e==null?void 0:e.Days_Selected)||[],N=pn(o),S=es(e),f=ts(e),j=[N,S,`${f} total`].filter(Boolean).join(" · ");return t.jsxs("div",{className:"hp7-card-header",onClick:s,role:"button",tabIndex:0,onKeyDown:k=>{(k.key==="Enter"||k.key===" ")&&(k.preventDefault(),s==null||s())},"aria-expanded":n,"aria-controls":i,"aria-label":`${u}, ${d.text}. ${n?"Collapse":"Expand"} to ${n?"hide":"view"} details`,children:[t.jsx("img",{src:c,className:"hp7-guest-avatar",alt:"","aria-hidden":"true",loading:"lazy"}),t.jsxs("div",{className:"hp7-proposal-info",children:[t.jsxs("div",{className:"hp7-proposal-name",children:[u,r&&t.jsx("span",{className:"hp7-new-badge",children:"New"}),l&&t.jsxs("span",{className:"hp7-verified-badge",children:[t.jsx(Pt,{size:10,"aria-hidden":"true"}),"Verified"]})]}),t.jsx("div",{className:"hp7-proposal-meta",children:j})]}),t.jsx("div",{className:`hp7-proposal-status ${d.variant}`,"aria-label":`Status: ${d.text}`,children:d.text}),t.jsx("div",{className:"hp7-expand-icon","aria-hidden":"true",children:t.jsx(sn,{size:16})})]})}function ss(e){if(!e)return"";const s=new Date-e,i=Math.floor(s/1e3),a=Math.floor(i/60),c=Math.floor(a/60),u=Math.floor(c/24);return u>0?u===1?"1 day ago":`${u} days ago`:c>0?c===1?"1 hour ago":`${c} hours ago`:a>0?a===1?"1 minute ago":`${a} minutes ago`:"just now"}function is(e){var l,r;const n=typeof(e==null?void 0:e.status)=="string"?e.status:((l=e==null?void 0:e.status)==null?void 0:l.id)||((r=e==null?void 0:e.status)==null?void 0:r._id)||"",s=(e==null?void 0:e.created_at)||(e==null?void 0:e.Created_Date),i=s?ss(new Date(s)):"",a=(e==null?void 0:e.guest)||(e==null?void 0:e.Guest)||(e==null?void 0:e["Created By"])||{},c=(a==null?void 0:a.firstName)||(a==null?void 0:a["First Name"])||(a==null?void 0:a.name)||"Guest";return e!=null&&e.has_guest_counteroffer||e!=null&&e.guest_counteroffer||(e==null?void 0:e.last_modified_by)==="guest"?{variant:"warning",icon:Rt,title:"Guest Counteroffer",message:`${c} proposed different terms`}:n==="proposal_submitted_by_guest_-_awaiting_rental_application"||n==="proposal_submitted_for_guest_by_split_lease_-_awaiting_rental_application"?{variant:"action-needed",icon:Ee,title:"Awaiting Rental Application",message:`Waiting for ${c} to submit rental application`}:n==="proposal_submitted_for_guest_by_split_lease_-_pending_confirmation"||n==="pending_confirmation"?{variant:"default",icon:Ee,title:"Pending Confirmation",message:`Waiting for ${c} to confirm proposal`}:n==="host_counteroffer_submitted_/_awaiting_guest_review"?{variant:"default",icon:Ee,title:"Awaiting Guest Review",message:`${c} is reviewing your counteroffer`}:n==="pending"?{variant:"default",icon:Ee,title:"Awaiting Rental Application",message:`Waiting for ${c} to submit rental application`}:{proposal_submitted:{variant:"action-needed",icon:et,title:"New Proposal",message:i?`Submitted ${i}`:"Awaiting your review"},host_review:{variant:"action-needed",icon:et,title:"New Proposal",message:i?`Submitted ${i}`:"Awaiting your review"},host_counteroffer:{variant:"default",icon:Ee,title:"Counteroffer Sent",message:"Waiting for guest response"},accepted:{variant:"success",icon:Ae,title:"Accepted",message:"Waiting for guest to complete rental application"},lease_documents_sent:{variant:"success",icon:Ae,title:"Lease Documents Sent",message:"Waiting for signatures"},lease_documents_signatures:{variant:"success",icon:Ae,title:"Awaiting Signatures",message:"Documents sent for signing"},lease_signed:{variant:"success",icon:Ae,title:"Lease Signed",message:"Waiting for initial payment"},payment_submitted:{variant:"success",icon:Ae,title:"Active Lease",message:"Payment received, lease is active"},cancelled_by_guest:{variant:"declined",icon:$e,title:"Cancelled",message:"Guest cancelled this proposal"},rejected_by_host:{variant:"declined",icon:$e,title:"Declined",message:(e==null?void 0:e.decline_reason)||"You declined this proposal"},cancelled_by_splitlease:{variant:"declined",icon:$e,title:"Cancelled",message:"Cancelled by Split Lease"}}[n]||{variant:"default",icon:Ee,title:"Pending",message:"Awaiting action"}}function as({proposal:e}){const n=is(e),s=n.icon;return t.jsxs("div",{className:`hp7-status-banner ${n.variant}`,children:[t.jsx("span",{className:"hp7-status-icon",children:t.jsx(s,{size:10})}),t.jsxs("div",{className:"hp7-status-text",children:[t.jsx("strong",{children:n.title})," — ",n.message]})]})}function Et(e){const n=(e==null?void 0:e.negotiationSummaries)||[];if(n.length>0){const s=n[0];return(s==null?void 0:s.Summary)||(s==null?void 0:s.summary)||null}return(e==null?void 0:e.ai_summary)||(e==null?void 0:e.guest_summary)||(e==null?void 0:e.summary)||null}function cs(e){return e?e.replace(/\[\/b>/g,"[/b]").replace(/\[b>/g,"[b]").replace(/\[\/b\]/g,"[/b]").replace(/\[b\]/g,"[b]").split(/\[b\]|\[\/b\]/).map((i,a)=>a%2===1?t.jsx("strong",{children:i},a):i):null}function rs(e){var a,c;if(!Et(e))return!1;const s=typeof(e==null?void 0:e.status)=="string"?e.status:((a=e==null?void 0:e.status)==null?void 0:a.id)||((c=e==null?void 0:e.status)==null?void 0:c._id)||"";return["proposal_submitted","host_review","pending","awaiting","new"].some(u=>s.startsWith(u))}function ds({proposal:e}){const n=Et(e);return rs(e)?t.jsxs("div",{className:"hp7-ai-summary-card",children:[t.jsx("div",{className:"hp7-ai-summary-icon",children:t.jsx(xn,{size:12})}),t.jsxs("div",{className:"hp7-ai-summary-content",children:[t.jsx("div",{className:"hp7-ai-summary-title",children:"AI Summary"}),t.jsx("div",{className:"hp7-ai-summary-text",children:cs(n)})]})]}):null}function ls(e){return(e==null?void 0:e.name)||(e==null?void 0:e.full_name)||(e==null?void 0:e.first_name)||"Guest"}function hs(e){return(e==null?void 0:e.bio)||(e==null?void 0:e.about)||(e==null?void 0:e.description)||"No bio available"}function os(e){const n=(e==null?void 0:e.created_at)||(e==null?void 0:e.Created_Date)||(e==null?void 0:e.member_since);if(!n)return null;const s=new Date(n).getFullYear();return isNaN(s)?null:String(s)}function us({guest:e}){if(!e)return null;const n=ls(e),s=hs(e),i=(e==null?void 0:e.id_verified)||(e==null?void 0:e.is_verified)||(e==null?void 0:e.verified),a=(e==null?void 0:e.work_verified)||(e==null?void 0:e.employment_verified),c=(e==null?void 0:e.review_count)||(e==null?void 0:e.reviews_count)||0,u=os(e);return t.jsx("div",{className:"hp7-guest-info-card",children:t.jsxs("div",{className:"hp7-guest-details",children:[t.jsx("div",{className:"hp7-guest-name-large",children:n}),t.jsx("div",{className:"hp7-guest-bio",children:s}),t.jsxs("div",{className:"hp7-guest-badges",children:[i&&t.jsxs("span",{className:"hp7-guest-badge verified",children:[t.jsx(Pt,{size:10}),"ID Verified"]}),a&&t.jsxs("span",{className:"hp7-guest-badge verified",children:[t.jsx(an,{size:10}),"Work Verified"]}),c>0&&t.jsxs("span",{className:"hp7-guest-badge",children:[t.jsx(ft,{size:10}),c," ",c===1?"Review":"Reviews"]}),c===0&&t.jsxs("span",{className:"hp7-guest-badge",children:[t.jsx(ft,{size:10}),"New to SL"]}),u&&t.jsxs("span",{className:"hp7-guest-badge",children:[t.jsx(cn,{size:10}),"Member since ",u]})]})]})})}function ms({onViewProfile:e,onMessage:n,onScheduleMeeting:s,onCompareTerms:i,showCompareTerms:a=!1}){return t.jsxs("div",{className:"hp7-links-row",children:[t.jsxs("button",{type:"button",className:"hp7-link-item",onClick:e,children:[t.jsx(rn,{size:12}),"Full Profile"]}),t.jsxs("button",{type:"button",className:"hp7-link-item",onClick:n,children:[t.jsx(Oe,{size:12}),"Message Guest"]}),a?t.jsxs("button",{type:"button",className:"hp7-link-item",onClick:i,children:[t.jsx(kn,{size:12}),"Compare Terms"]}):t.jsxs("button",{type:"button",className:"hp7-link-item",onClick:s,children:[t.jsx(It,{size:12}),"Schedule Meeting"]})]})}function Qe(e){if(!e)return"TBD";const n=new Date(e);return isNaN(n.getTime())?"TBD":n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}function kt(e){if(!Array.isArray(e)||e.length===0)return"TBD";const{checkInDay:n,checkOutDay:s}=it(e);return n?!s||n===s?n.slice(0,3):`${n.slice(0,3)} - ${s.slice(0,3)} (check-out)`:"TBD"}function fs(e){const n=(e==null?void 0:e.nights_selected)||(e==null?void 0:e["Nights Selected (Nights list)"])||[];if(Array.isArray(n)&&n.length>0)return`${n.length}/week`;const s=(e==null?void 0:e.days_selected)||(e==null?void 0:e.Days_Selected)||[];return!Array.isArray(s)||s.length===0?"TBD":`${Math.max(0,s.length-1)}/week`}function gs({proposal:e}){const n=(e==null?void 0:e["counter offer happened"])||(e==null?void 0:e.counterOfferHappened)||(e==null?void 0:e.counter_offer_happened),s=(e==null?void 0:e["Move in range start"])||(e==null?void 0:e.move_in_range_start),i=(e==null?void 0:e["Reservation Span (Weeks)"])||(e==null?void 0:e.reservation_span_weeks);let a=(e==null?void 0:e["Days Selected"])||[];if(typeof a=="string")try{a=JSON.parse(a)}catch{a=[]}let c=(e==null?void 0:e["Nights Selected (Nights list)"])||[];if(typeof c=="string")try{c=JSON.parse(c)}catch{c=[]}const u=e==null?void 0:e["hc move in date"],l=e==null?void 0:e["hc reservation span (weeks)"];let r=(e==null?void 0:e["hc days selected"])||[];if(typeof r=="string")try{r=JSON.parse(r)}catch{r=[]}let d=(e==null?void 0:e["hc nights selected"])||[];if(typeof d=="string")try{d=JSON.parse(d)}catch{d=[]}const o=n&&u?u:(e==null?void 0:e.start_date)||(e==null?void 0:e.move_in_date)||s,N=(e==null?void 0:e.end_date)||(e==null?void 0:e.move_out_date),S=n&&l!=null?l:(e==null?void 0:e.duration_weeks)||(e==null?void 0:e.weeks)||(e==null?void 0:e.total_weeks)||i,f=n&&r.length>0?r:(e==null?void 0:e.days_selected)||(e==null?void 0:e.Days_Selected)||a,I=n&&d.length>0?d:(e==null?void 0:e.nights_selected)||(e==null?void 0:e["Nights Selected (Nights list)"])||c,j=n&&u&&u!==s,k=n&&l!=null&&l!==i,W=n&&r.length>0&&a.length>0&&(r.length!==a.length||!r.every((T,C)=>T===a[C])),F=n&&d.length>0&&c.length>0&&(d.length!==c.length||!d.every((T,C)=>T===c[C]));let R=S;if(!R&&o&&N){const T=new Date(o),C=new Date(N),$=Math.ceil((C-T)/(1e3*60*60*24));R=Math.round($/7)}return t.jsxs("div",{className:"hp7-info-grid",children:[t.jsxs("div",{className:"hp7-info-item",children:[t.jsx("div",{className:"hp7-info-label",children:"Move-in"}),t.jsxs("div",{className:"hp7-info-value",children:[j&&t.jsx("span",{className:"hp7-strikethrough",children:Qe(s)}),t.jsx("span",{className:j?"hp7-changed-value":"",children:Qe(o)})]})]}),t.jsxs("div",{className:"hp7-info-item",children:[t.jsx("div",{className:"hp7-info-label",children:"Move-out"}),t.jsx("div",{className:"hp7-info-value",children:Qe(N)})]}),t.jsxs("div",{className:"hp7-info-item",children:[t.jsx("div",{className:"hp7-info-label",children:"Duration"}),t.jsxs("div",{className:"hp7-info-value",children:[k&&t.jsxs("span",{className:"hp7-strikethrough",children:[i," weeks"]}),t.jsx("span",{className:k?"hp7-changed-value":"",children:R?`${R} weeks`:"TBD"})]})]}),t.jsxs("div",{className:"hp7-info-item",children:[t.jsx("div",{className:"hp7-info-label",children:"Schedule"}),t.jsxs("div",{className:"hp7-info-value",children:[W&&t.jsx("span",{className:"hp7-strikethrough",children:kt(a)}),t.jsx("span",{className:W?"hp7-changed-value":"",children:kt(f)})]})]}),t.jsxs("div",{className:"hp7-info-item",children:[t.jsx("div",{className:"hp7-info-label",children:"Nights"}),t.jsxs("div",{className:"hp7-info-value",children:[F&&t.jsxs("span",{className:"hp7-strikethrough",children:[c.length,"/week"]}),t.jsx("span",{className:F?"hp7-changed-value":"",children:I.length>0?`${I.length}/week`:fs(e)})]})]})]})}const ys=["S","M","T","W","T","F","S"];function xs({nightsSelected:e=[]}){const n=(e||[]).map(r=>Number(r)),s=n.length,{checkInDay:i,checkOutDay:a}=Gn(n),c=i?i.slice(0,3):"",u=a?a.slice(0,3):"",l=c&&u?`${c} check-in, ${u} check-out`:"";return t.jsxs("div",{className:"hp7-days-row",children:[t.jsx("span",{className:"hp7-days-label",children:"Nights"}),t.jsx("div",{className:"hp7-days-pills",children:ys.map((r,d)=>t.jsx("div",{className:`hp7-day-pill${n.includes(d)?" selected":""}`,children:r},d))}),t.jsxs("div",{className:"hp7-days-info",children:[t.jsxs("div",{className:"hp7-days-count",children:[s," ",s===1?"night":"nights"]}),l&&t.jsx("div",{className:"hp7-days-range",children:l})]})]})}function vs({proposal:e,isDeclined:n=!1}){const s=(e==null?void 0:e["counter offer happened"])||(e==null?void 0:e.counterOfferHappened)||(e==null?void 0:e.counter_offer_happened),i=(e==null?void 0:e["proposal nightly price"])||(e==null?void 0:e.proposal_nightly_price)||0,a=(e==null?void 0:e["Reservation Span (Weeks)"])||(e==null?void 0:e.reservation_span_weeks)||0,c=(e==null?void 0:e["Total Price for Reservation (guest)"])||(e==null?void 0:e.total_price_guest)||0;let u=(e==null?void 0:e["Nights Selected (Nights list)"])||[];if(typeof u=="string")try{u=JSON.parse(u)}catch{u=[]}const l=u.length,r=e==null?void 0:e["hc nightly price"],d=e==null?void 0:e["hc reservation span (weeks)"],o=e==null?void 0:e["hc total price"];let N=(e==null?void 0:e["hc nights selected"])||[];if(typeof N=="string")try{N=JSON.parse(N)}catch{N=[]}const S=N.length>0?N.length:null,f=s&&r!=null?r:(e==null?void 0:e.nightly_rate)||(e==null?void 0:e.price_per_night)||i,j=(s&&N.length>0?N:(e==null?void 0:e.nights_selected)||(e==null?void 0:e["Nights Selected (Nights list)"])||u).length,k=s&&d!=null?d:(e==null?void 0:e.duration_weeks)||(e==null?void 0:e.weeks)||(e==null?void 0:e.total_weeks)||a,W=s&&o!=null?o:(e==null?void 0:e.total_price)||(e==null?void 0:e.host_earnings)||(e==null?void 0:e.total_amount)||c,F=s&&r!=null&&r!==i,R=s&&d!=null&&d!==a,T=s&&S!=null&&S!==l,C=s&&o!=null&&o!==c,$=f>0||j>0||k>0,O=`$${Number(W).toLocaleString()}`,V=`$${Number(c).toLocaleString()}`;return t.jsxs("div",{className:"hp7-pricing-row",children:[t.jsx("div",{className:"hp7-pricing-breakdown",children:$?t.jsxs(t.Fragment,{children:[f>0&&t.jsxs(t.Fragment,{children:[F&&t.jsxs("span",{className:"hp7-strikethrough",children:["$",i,"/night"]}),t.jsxs("span",{className:F?"hp7-changed-value":"",children:["$",f,"/night"]})]}),f>0&&j>0&&t.jsx("span",{children:"×"}),j>0&&t.jsxs(t.Fragment,{children:[T&&t.jsx("span",{className:"hp7-strikethrough",children:l}),t.jsx("span",{className:T?"hp7-changed-value":"",children:j})]}),j>0&&k>0&&t.jsx("span",{children:"×"}),k>0&&t.jsxs(t.Fragment,{children:[R&&t.jsxs("span",{className:"hp7-strikethrough",children:[a," wks"]}),t.jsxs("span",{className:R?"hp7-changed-value":"",children:[k," wks"]})]})]}):t.jsx("span",{children:"Pricing details"})}),t.jsxs("div",{className:"hp7-pricing-total-wrapper",children:[t.jsx("div",{className:"hp7-pricing-total-label",children:n?"Was Offered":"Your Earnings"}),t.jsxs("div",{className:`hp7-pricing-total${n?" declined":""}`,children:[C&&t.jsx("span",{className:"hp7-strikethrough hp7-total-strikethrough",children:V}),t.jsx("span",{className:C?"hp7-changed-value":"",children:O})]})]})]})}const Nt=[{key:"submitted",label:"Submitted"},{key:"reviewed",label:"Reviewed"},{key:"accepted",label:"Accepted"},{key:"application",label:"Application"},{key:"lease",label:"Lease"},{key:"active",label:"Active"}];function ks(e){var i,a;const n=typeof(e==null?void 0:e.status)=="string"?e.status:((i=e==null?void 0:e.status)==null?void 0:i.id)||((a=e==null?void 0:e.status)==null?void 0:a._id)||"";return{proposal_submitted:0,host_review:1,host_counteroffer:1,accepted:3,lease_documents_sent:4,lease_documents_signatures:4,lease_signed:4,payment_submitted:5}[n]??0}function Ns(e){var i,a;const n=typeof(e==null?void 0:e.status)=="string"?e.status:((i=e==null?void 0:e.status)==null?void 0:i.id)||((a=e==null?void 0:e.status)==null?void 0:a._id)||"";return["accepted","lease_documents_sent","lease_documents_signatures","lease_signed","payment_submitted"].includes(n)}function bs({proposal:e}){if(!Ns(e))return null;const n=ks(e);return t.jsx("div",{className:"hp7-progress-row",children:Nt.map((s,i)=>{const a=i<n,c=i===n,u=i===Nt.length-1;let l="hp7-progress-step";return a&&(l+=" completed"),c&&(l+=" current"),t.jsxs("div",{className:l,children:[t.jsx("div",{className:"hp7-progress-dot"}),t.jsx("span",{className:"hp7-progress-label",children:s.label}),!u&&t.jsx("div",{className:"hp7-progress-line"})]},s.key)})})}function Ot(e){const n=e==null?void 0:e.status;return n?typeof n=="string"?n:n.id||n._id||n.key||"":""}function js(e){if(e!=null&&e.has_guest_counteroffer||e!=null&&e.guest_counteroffer)return!0;const n=Ot(e);return(e==null?void 0:e.last_modified_by)==="guest"&&(n==="host_review"||n==="proposal_submitted")}function ws(e){return e==="Proposal Submitted by guest - Awaiting Rental Application"||e==="Proposal Submitted for guest by Split Lease - Awaiting Rental Application"}function _s({proposal:e,onAccept:n,onModify:s,onDecline:i,onRemindGuest:a,onMessage:c,onScheduleMeeting:u,onEditCounter:l,onWithdraw:r,onRemove:d,onRequestRentalApp:o}){const N=Ot(e);return js(e)?t.jsxs("div",{className:"hp7-actions-row",children:[t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-success",onClick:n,children:[t.jsx(Ae,{size:14}),"Accept Counter"]}),t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-outline",onClick:s,children:[t.jsx(Rt,{size:14}),"Counter Again"]}),t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-danger",onClick:i,children:[t.jsx($e,{size:14}),"Decline"]})]}):ws(N)?t.jsxs("div",{className:"hp7-actions-row",children:[t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-primary",onClick:o,children:[t.jsx(gt,{size:14}),"Send Reminder"]}),t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-ghost",onClick:c,children:[t.jsx(Oe,{size:14}),"Message"]})]}):N==="proposal_submitted"||N==="host_review"?t.jsxs("div",{className:"hp7-actions-row",children:[t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-success",onClick:n,children:[t.jsx(Ae,{size:14}),"Accept"]}),t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-outline",onClick:s,children:[t.jsx(Dn,{size:14}),"Modify"]}),t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-danger",onClick:i,children:[t.jsx($e,{size:14}),"Decline"]})]}):N==="host_counteroffer"?t.jsxs("div",{className:"hp7-actions-row",children:[t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-ghost",onClick:l,children:[t.jsx(_n,{size:14}),"Edit Counter"]}),t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-ghost",onClick:c,children:[t.jsx(Oe,{size:14}),"Message"]}),t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-danger",onClick:r,children:[t.jsx(gn,{size:14}),"Withdraw"]})]}):N==="accepted"||N.startsWith("lease_")?t.jsxs("div",{className:"hp7-actions-row",children:[t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-primary",onClick:a,children:[t.jsx(gt,{size:14}),"Remind Guest"]}),t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-outline",onClick:u,children:[t.jsx(It,{size:14}),"Schedule Meeting"]}),t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-ghost",onClick:c,children:[t.jsx(Oe,{size:14}),"Message"]})]}):N==="rejected_by_host"||N==="cancelled_by_guest"||N==="cancelled_by_splitlease"?t.jsx("div",{className:"hp7-actions-row",children:t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-ghost",onClick:d,children:[t.jsx(dn,{size:14}),"Remove"]})}):N==="payment_submitted"?t.jsx("div",{className:"hp7-actions-row",children:t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-primary",onClick:c,children:[t.jsx(Oe,{size:14}),"Message Guest"]})}):t.jsx("div",{className:"hp7-actions-row",children:t.jsxs("button",{type:"button",className:"hp7-btn hp7-btn-ghost",onClick:c,children:[t.jsx(Oe,{size:14}),"Message"]})})}function Ss(e){var s,i;const n=typeof(e==null?void 0:e.status)=="string"?e.status:((s=e==null?void 0:e.status)==null?void 0:s.id)||((i=e==null?void 0:e.status)==null?void 0:i._id)||"";return["rejected_by_host","cancelled_by_guest","cancelled_by_splitlease"].includes(n)}function Cs(e){var s,i;if(e!=null&&e.has_guest_counteroffer||e!=null&&e.guest_counteroffer)return!0;const n=typeof(e==null?void 0:e.status)=="string"?e.status:((s=e==null?void 0:e.status)==null?void 0:s.id)||((i=e==null?void 0:e.status)==null?void 0:i._id)||"";return(e==null?void 0:e.last_modified_by)==="guest"&&(n==="host_review"||n==="proposal_submitted")}function Ds({proposal:e,handlers:n={}}){const s=(e==null?void 0:e.guest)||(e==null?void 0:e.user)||{},i=(e==null?void 0:e["counter offer happened"])||(e==null?void 0:e.counterOfferHappened)||(e==null?void 0:e.counter_offer_happened);let a=(e==null?void 0:e["hc nights selected"])||[];if(typeof a=="string")try{a=JSON.parse(a)}catch{a=[]}const c=i&&a.length>0?a:(e==null?void 0:e.nights_selected)||(e==null?void 0:e["Nights Selected (Nights list)"])||[],u=Ss(e),l=Cs(e);return t.jsxs("div",{className:"hp7-card-body-inner",children:[t.jsx(as,{proposal:e}),t.jsx(ds,{proposal:e}),!u&&t.jsx(us,{guest:s}),!u&&t.jsx(ms,{onViewProfile:()=>{var r;return(r=n.onViewProfile)==null?void 0:r.call(n,e)},onMessage:()=>{var r;return(r=n.onMessage)==null?void 0:r.call(n,e)},onScheduleMeeting:()=>{var r;return(r=n.onScheduleMeeting)==null?void 0:r.call(n,e)},onCompareTerms:()=>{var r;return(r=n.onCompareTerms)==null?void 0:r.call(n,e)},showCompareTerms:l}),t.jsx(gs,{proposal:e}),!u&&t.jsx(xs,{nightsSelected:c}),t.jsx(vs,{proposal:e,isDeclined:u}),t.jsx(bs,{proposal:e}),t.jsx(_s,{proposal:e,onAccept:()=>{var r;return(r=n.onAccept)==null?void 0:r.call(n,e)},onModify:()=>{var r;return(r=n.onModify)==null?void 0:r.call(n,e)},onDecline:()=>{var r;return(r=n.onDecline)==null?void 0:r.call(n,e)},onRemindGuest:()=>{var r;return(r=n.onRemindGuest)==null?void 0:r.call(n,e)},onMessage:()=>{var r;return(r=n.onMessage)==null?void 0:r.call(n,e)},onScheduleMeeting:()=>{var r;return(r=n.onScheduleMeeting)==null?void 0:r.call(n,e)},onEditCounter:()=>{var r;return(r=n.onEditCounter)==null?void 0:r.call(n,e)},onWithdraw:()=>{var r;return(r=n.onWithdraw)==null?void 0:r.call(n,e)},onRemove:()=>{var r;return(r=n.onRemove)==null?void 0:r.call(n,e)},onRequestRentalApp:()=>{var r;return(r=n.onRequestRentalApp)==null?void 0:r.call(n,e)}})]})}function Ps({proposal:e,isExpanded:n=!1,onToggle:s,handlers:i={}}){var r;const a=qn(e),c=(e==null?void 0:e._id)||(e==null?void 0:e.id),u=`proposal-content-${c}`;let l="hp7-proposal-card";return a==="action-needed"&&(l+=" action-needed"),n&&(l+=" expanded"),t.jsxs("div",{className:l,"data-proposal-id":c,role:"listitem",children:[t.jsx(ns,{proposal:e,isExpanded:n,onToggle:s,contentId:u}),t.jsx("div",{id:u,className:"hp7-card-body",role:"region","aria-label":`Details for proposal from ${((r=e==null?void 0:e.guest)==null?void 0:r.name)||"guest"}`,hidden:!n,children:t.jsx(Ds,{proposal:e,handlers:i})})]})}function Rs(e){return{actionNeeded:yt,inProgress:jn,closed:mn}[e]||yt}function Is(e){return{actionNeeded:"Action Needed",inProgress:"In Progress",closed:"Closed"}[e]||"Proposals"}function Xe({sectionKey:e,proposals:n=[],expandedProposalId:s,onToggleExpand:i,handlers:a={}}){if(!n||n.length===0)return null;const c=Rs(e),u=Is(e),l=e==="actionNeeded";return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`hp7-section-header${l?" action-needed":""}`,children:[t.jsx(c,{className:"icon",size:14}),u,t.jsx("span",{className:"hp7-section-count",children:n.length})]}),t.jsx("div",{className:"hp7-proposal-list",children:n.map(r=>{const d=(r==null?void 0:r._id)||(r==null?void 0:r.id),o=s===d;return t.jsx(Ps,{proposal:r,isExpanded:o,onToggle:()=>i==null?void 0:i(d),handlers:a},d)})}),t.jsx("div",{className:"hp7-list-divider"})]})}function Ls({activeDays:e=[],size:n="small"}){return t.jsx("div",{className:`day-indicator day-indicator--${n}`,children:Wn.map((s,i)=>{const a=e.includes(s.full);return t.jsx("div",{className:`day-box ${a?"active":""}`,title:s.full,children:n!=="small"&&t.jsx("span",{className:"day-label",children:s.short})},i)})})}function Fe(e){return e==null||isNaN(e)?"0.00":new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}function bt(e){if(!e)return"";const n=new Date(e);if(isNaN(n.getTime()))return"";const s=n.getMonth()+1,i=n.getDate(),a=n.getFullYear().toString().slice(-2);return`${s}/${i}/${a}`}function Ms(e){if(!e)return"";const n=new Date(e);return isNaN(n.getTime())?"":n.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}).replace(",","")}function jt(e,n){const{key:s,usualOrder:i}=e;return{"Proposal Submitted by guest - Awaiting Rental Application":"Request Rental App Submission","Proposal Submitted for guest by Split Lease - Awaiting Rental Application":"Request Rental App Submission","Proposal Submitted for guest by Split Lease - Pending Confirmation":"Awaiting Guest Confirmation",Pending:"Proposal Pending","Pending Confirmation":"Awaiting Guest Confirmation","Host Review":n?"Rental App Received - Review & Decide":"Under Your Review","Rental Application Submitted":"Rental App Received - Review & Decide","Host Counteroffer Submitted / Awaiting Guest Review":"Counteroffer Sent - Awaiting Guest Response","Proposal or Counteroffer Accepted / Drafting Lease Documents":"Accepted - Drafting Lease Documents","Reviewing Documents":"Documents Under Review","Lease Documents Sent for Review":"Lease Documents Sent to Guest","Lease Documents Sent for Signatures":"Awaiting Signatures","Lease Documents Signed / Awaiting Initial payment":"Awaiting Initial Payment","Lease Signed / Awaiting Initial Payment":"Awaiting Initial Payment","Initial Payment Submitted / Lease activated ":"Lease Activated!"}[s]||e.label||"Review Proposal"}function As({proposal:e,isOpen:n,onClose:s,onAccept:i,onReject:a,onModify:c,onSendMessage:u,onRemindSplitLease:l,onChooseVirtualMeeting:r,onRequestRentalApp:d,currentUserId:o}){const[N,S]=y.useState(!0),[f,I]=y.useState(!0),[j,k]=y.useState(!1),[W,F]=y.useState(!0);if(!e||!n)return null;const R=e.Status||e.status||"",T=typeof R=="string"?R:(R==null?void 0:R.id)||(R==null?void 0:R._id)||"",C=Ct(T);Hn(R);const $=C.usualOrder??0,O=Dt(T),V=$>=3&&!O,Z=C.key==="Proposal Submitted by guest - Awaiting Rental Application"||C.key==="Proposal Submitted for guest by Split Lease - Awaiting Rental Application",z=e.rentalApplication||e["rental application"]||e["Rental Application"],se=(z==null?void 0:z.submitted)==="yes"||(z==null?void 0:z.submitted)===!0,P=e.guest||e.Guest||e["Created By"]||{},q=P.firstName||P["Name - First"]||P["First Name"]||P.first_name||"Guest",Se=P.lastName||P["Name - Last"]||P["Last Name"]||P.last_name||"",Ce=P.bio||P.Bio||"",J=P.avatar||P.Avatar||P["Profile Photo"]||P["Profile Picture"]||`https://ui-avatars.com/api/?name=${encodeURIComponent(q)}&background=random&size=60`,ie=P.linkedinVerified||P["Linkedin Verified"]||!1,Y=P.phoneVerified||P["Phone Verified"]||!1,ye=P.emailVerified||P["Email Verified"]||!1,xe=P.identityVerified||P["Identity Verified"]||!1,ae=e["hc nights selected"]||e["Nights Selected (Nights list)"]||e.nightsSelected||e["Nights Selected"],ce=e["hc days selected"]||e["Days Selected"]||e.daysSelected,{checkInDay:B,checkOutDay:te}=it(ce),ve=e.checkInTime||e["Check In Time"]||"2:00 pm",me=e.checkOutTime||e["Check Out Time"]||"11:00 am",Le=e.moveInRangeStart||e["Move in range start"]||e["Move In Range Start"],ne=e.moveInRangeEnd||e["Move in range end"]||e["Move In Range End"],re=e.reservationSpanWeeks||e["Reservation Span (Weeks)"]||e["Reservation Span (weeks)"]||0,de=e.hostCompensation||e["host compensation"]||e["Host Compensation"]||0,ke=e.totalCompensation||e["Total Compensation (proposal - host)"]||e["Total Compensation"]||0,Ne=de,De=e.maintenanceFee||e["cleaning fee"]||e["Maintenance Fee"]||0,le=e.damageDeposit||e["damage deposit"]||e["Damage Deposit"]||0,he=e.counterOfferHappened||e["Counter Offer Happened"]||!1,K=e.reasonForCancellation||e["Reason For Cancellation"]||"",_=(e.rentalType||e["rental type"]||e["Rental Type"]||"nightly").toLowerCase(),be=e.custom_schedule_description||e.customScheduleDescription||"",Pe=e.virtualMeeting||e["Virtual Meeting"],g=Bn(ae),h={proposalSubmitted:{completed:!0,current:$===0},rentalApp:{completed:$>=1,current:!1},hostReview:{completed:$>=3,current:$>=1&&$<3},leaseDocs:{completed:$>=6,current:$>=3&&$<6},initialPayment:{completed:$>=7,current:$===6}},U=h.initialPayment.current?"initialPayment":h.leaseDocs.current?"leaseDocs":h.hostReview.current?"hostReview":h.proposalSubmitted.current?"proposalSubmitted":h.initialPayment.completed?"initialPayment":h.leaseDocs.completed?"leaseDocs":h.hostReview.completed?"hostReview":h.rentalApp.completed?"rentalApp":"proposalSubmitted",L=m=>O?"cancelled":m.completed?"completed":m.current?"current":"",G=m=>!O&&U===m,H=(m,v)=>O?"cancelled":m.completed&&(v.completed||v.current)?"completed":"",E=()=>{const{key:m}=C;return m==="Proposal Submitted by guest - Awaiting Rental Application"||m==="Proposal Submitted for guest by Split Lease - Awaiting Rental Application"?t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"action-btn accept",onClick:()=>d==null?void 0:d(e),children:"Request Rental App"}),t.jsx("button",{className:"action-btn modify",onClick:()=>c==null?void 0:c(e),children:"View Details"})]}):m==="Host Counteroffer Submitted / Awaiting Guest Review"?t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"action-btn secondary",onClick:()=>u==null?void 0:u(e),children:"Send Message"}),t.jsx("button",{className:"action-btn modify",onClick:()=>c==null?void 0:c(e),children:"See Details"})]}):V?t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"action-btn secondary",onClick:()=>c==null?void 0:c(e),children:"See Details"}),t.jsx("button",{className:"action-btn primary",onClick:()=>l==null?void 0:l(e),children:"Remind Split Lease"})]}):t.jsxs(t.Fragment,{children:[t.jsx("button",{className:"action-btn accept",onClick:()=>i==null?void 0:i(e),children:"Accept Proposal"}),t.jsx("button",{className:"action-btn modify",onClick:()=>c==null?void 0:c(e),children:"Review / Modify"})]})};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:`modal-backdrop ${n?"active":""}`,onClick:s}),t.jsxs("div",{className:`proposal-modal ${n?"open":""}`,children:[t.jsx("div",{className:"proposal-modal-grab-handle","aria-hidden":"true"}),t.jsx("button",{className:"modal-close",onClick:s,children:t.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:t.jsx("path",{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),t.jsxs("div",{className:"modal-content",children:[t.jsxs("div",{className:"modal-header",children:[t.jsxs("h2",{className:"modal-title",children:[q,"'s Proposal"]}),t.jsxs("div",{className:"modal-schedule",children:[t.jsxs("span",{className:"schedule-text",children:[B," to ",te," (check-out)",he&&" · Proposed by You"]}),t.jsx(Ls,{activeDays:g,size:"medium"})]})]}),t.jsxs("div",{className:"proposal-details",children:[t.jsxs("div",{className:"detail-row",children:[t.jsx("span",{className:"detail-label",children:"Duration"}),t.jsxs("span",{className:"detail-value",children:[re," weeks"]})]}),t.jsxs("div",{className:"detail-row",children:[t.jsx("span",{className:"detail-label",children:"Move-in Range"}),t.jsxs("span",{className:"detail-value",children:[bt(Le)," ",bt(ne)]})]}),t.jsxs("div",{className:"detail-row",children:[t.jsx("span",{className:"detail-label",children:"Check-in / Check-out"}),t.jsxs("span",{className:"detail-value",children:[ve," / ",me]})]}),t.jsxs("div",{className:"detail-row",children:[t.jsxs("span",{className:"detail-label",children:["Compensation per ",_==="monthly"?"Month":_==="weekly"?"Week":"Night"]}),t.jsxs("span",{className:"detail-value",children:[he&&t.jsxs("span",{className:"original-value",children:["$",de]}),"$",Fe(Ne),"/",_==="monthly"?"month":_==="weekly"?"week":"night"]})]}),t.jsxs("div",{className:"detail-row",children:[t.jsx("span",{className:"detail-label",children:"Maintenance Fee"}),t.jsxs("span",{className:"detail-value",children:[t.jsx("span",{className:"bullet",children:"*"})," $",Fe(De)]})]}),t.jsxs("div",{className:"detail-row",children:[t.jsx("span",{className:"detail-label",children:"Damage deposit"}),t.jsxs("span",{className:"detail-value",children:[t.jsx("span",{className:"bullet",children:"*"})," $",Fe(le)]})]}),t.jsx("div",{className:"detail-row total-row",children:t.jsxs("span",{className:"detail-value total",children:[he&&t.jsxs("span",{className:"original-value",children:["$",Fe(de*re*7)]}),"$",Fe(ke)," Total"]})})]}),(()=>{var A;const m=ln(Pe,o),v=m.buttonText,M=m.buttonDisabled,w=m.state;let b="";return w===we.NO_MEETING?b=`Schedule a virtual meeting with ${q} to discuss the proposal.`:w===we.REQUESTED_BY_OTHER?b=`${q} has requested a virtual meeting. Please respond to their request.`:w===we.REQUESTED_BY_ME?b=`You've requested a virtual meeting with ${q}. Waiting for their response.`:w===we.BOOKED_AWAITING_CONFIRMATION?b="A meeting time has been selected. Awaiting confirmation from Split Lease.":w===we.CONFIRMED?b=`Your virtual meeting with ${q} is confirmed!`:w===we.DECLINED&&(b="The previous meeting was declined. You can request an alternative meeting."),t.jsxs("div",{className:"collapsible-section",children:[t.jsxs("button",{className:"section-header",onClick:()=>k(!j),children:[t.jsx("span",{children:"Virtual meetings"}),t.jsx("svg",{className:`chevron ${j?"open":""}`,width:"20",height:"20",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M5 7.5L10 12.5L15 7.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})})]}),j&&t.jsxs("div",{className:"section-content virtual-meeting-content",children:[t.jsxs("div",{className:"virtual-meeting-header",children:[t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[t.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),t.jsx("path",{d:"M16 2V6M8 2V6M3 10H21",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),t.jsx("span",{children:b})]}),Pe&&(w===we.REQUESTED_BY_OTHER||w===we.REQUESTED_BY_ME)&&((A=Pe.suggestedTimes)==null?void 0:A.length)>0&&t.jsx("div",{className:"time-slots",children:Pe.suggestedTimes.map((Q,X)=>t.jsx("div",{className:"time-slot-display",children:Ms(Q)},X))}),t.jsx("button",{className:`request-meeting-btn ${M?"disabled":""} ${w===we.CONFIRMED?"success":""}`,onClick:()=>r==null?void 0:r(e),disabled:M,children:v})]})]})})(),t.jsxs("div",{className:"collapsible-section",children:[t.jsxs("button",{className:"section-header",onClick:()=>S(!N),children:[t.jsx("span",{children:"Guest details"}),t.jsx("svg",{className:`chevron ${N?"open":""}`,width:"20",height:"20",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M5 7.5L10 12.5L15 7.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})})]}),N&&t.jsxs("div",{className:"section-content guest-details-content",children:[t.jsxs("div",{className:"guest-profile",children:[t.jsx("img",{src:J,alt:q,className:"guest-avatar-large"}),t.jsxs("div",{className:"guest-info",children:[t.jsxs("h4",{className:"guest-name",children:[q," ",Se]}),t.jsx("button",{className:"send-message-btn",onClick:()=>u==null?void 0:u(e),children:"Send a Message"})]})]}),Ce&&t.jsx("p",{className:"guest-bio",children:Ce}),t.jsxs("div",{className:"verification-badges",children:[t.jsxs("div",{className:`verification-item ${ie?"verified":""}`,children:[t.jsx("span",{className:"verification-label",children:"LinkedIn"}),t.jsx("span",{className:"verification-status",children:ie?"Verified":"Unverified"})]}),t.jsxs("div",{className:`verification-item ${Y?"verified":""}`,children:[t.jsx("span",{className:"verification-label",children:"Number"}),t.jsx("span",{className:"verification-status",children:Y?"Verified":"Unverified"})]}),t.jsxs("div",{className:`verification-item ${ye?"verified":""}`,children:[t.jsx("span",{className:"verification-label",children:"Email"}),t.jsx("span",{className:"verification-status",children:ye?"Verified":"Unverified"})]}),t.jsxs("div",{className:`verification-item ${xe?"verified":""}`,children:[t.jsx("span",{className:"verification-label",children:"Identity"}),t.jsx("span",{className:"verification-status",children:xe?"Verified":"Unverified"})]})]})]})]}),be&&t.jsxs("div",{className:"collapsible-section",children:[t.jsxs("button",{className:"section-header",onClick:()=>F(!W),children:[t.jsx("span",{children:"Schedule Preferences"}),t.jsx("svg",{className:`chevron ${W?"open":""}`,width:"20",height:"20",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M5 7.5L10 12.5L15 7.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})})]}),W&&t.jsxs("div",{className:"section-content custom-schedule-content",children:[t.jsx("p",{className:"custom-schedule-label",children:"Guest's schedule request:"}),t.jsx("p",{className:"custom-schedule-text",children:be})]})]}),t.jsxs("div",{className:"collapsible-section",children:[t.jsxs("button",{className:"section-header",onClick:()=>I(!f),children:[t.jsx("span",{children:"Proposal Status"}),t.jsx("svg",{className:`chevron ${f?"open":""}`,width:"20",height:"20",viewBox:"0 0 20 20",children:t.jsx("path",{d:"M5 7.5L10 12.5L15 7.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"none"})})]}),f&&t.jsxs("div",{className:"section-content status-content",children:[t.jsxs("div",{className:"progress-tracker",children:[t.jsxs("div",{className:"progress-tracker-line",children:[t.jsx("div",{className:`progress-step ${L(h.proposalSubmitted)}`,children:t.jsx("div",{className:"step-circle",style:G("proposalSubmitted")?{backgroundColor:"#31135D"}:void 0})}),t.jsx("div",{className:`progress-line ${H(h.proposalSubmitted,h.rentalApp)}`}),t.jsx("div",{className:`progress-step ${L(h.rentalApp)}`,children:t.jsx("div",{className:"step-circle",style:G("rentalApp")?{backgroundColor:"#31135D"}:void 0})}),t.jsx("div",{className:`progress-line ${H(h.rentalApp,h.hostReview)}`}),t.jsx("div",{className:`progress-step ${L(h.hostReview)}`,children:t.jsx("div",{className:"step-circle",style:G("hostReview")?{backgroundColor:"#31135D"}:void 0})}),t.jsx("div",{className:`progress-line ${H(h.hostReview,h.leaseDocs)}`}),t.jsx("div",{className:`progress-step ${L(h.leaseDocs)}`,children:t.jsx("div",{className:"step-circle",style:G("leaseDocs")?{backgroundColor:"#31135D"}:void 0})}),t.jsx("div",{className:`progress-line ${H(h.leaseDocs,h.initialPayment)}`}),t.jsx("div",{className:`progress-step ${L(h.initialPayment)}`,children:t.jsx("div",{className:"step-circle",style:G("initialPayment")?{backgroundColor:"#31135D"}:void 0})})]}),t.jsxs("div",{className:"progress-tracker-labels",children:[t.jsx("div",{className:"progress-label-wrapper",children:t.jsx("span",{className:"step-label",children:"Proposal Submitted"})}),t.jsx("div",{className:"progress-label-spacer"}),t.jsx("div",{className:"progress-label-wrapper",children:t.jsx("span",{className:"step-label",children:h.rentalApp.completed?"Rental App Submitted":"Rental Application"})}),t.jsx("div",{className:"progress-label-spacer"}),t.jsx("div",{className:"progress-label-wrapper",children:t.jsx("span",{className:"step-label",children:"Host Review"})}),t.jsx("div",{className:"progress-label-spacer"}),t.jsx("div",{className:"progress-label-wrapper",children:t.jsx("span",{className:"step-label",children:h.leaseDocs.completed?"Lease Documents":"Lease Docs"})}),t.jsx("div",{className:"progress-label-spacer"}),t.jsx("div",{className:"progress-label-wrapper",children:t.jsx("span",{className:"step-label",children:"Initial Payment"})})]})]}),t.jsx("div",{className:"status-box",style:{backgroundColor:O?"#FEE2E2":"#F7F2FA",borderColor:O?"#991B1B":V||Z?"#31135D":"#79747E"},children:O?t.jsxs(t.Fragment,{children:[t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"#991B1B",children:t.jsx("path",{d:"M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 10 0ZM14.12 13.12L12.71 14.53L10 11.82L7.29 14.53L5.88 13.12L8.59 10.41L5.88 7.7L7.29 6.29L10 9L12.71 6.29L14.12 7.7L11.41 10.41L14.12 13.12Z"})}),t.jsxs("span",{children:["Proposal Rejected Reason: ",K||"Cancelled"]})]}):V?t.jsxs(t.Fragment,{children:[t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"#31135D",children:t.jsx("path",{d:"M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 10 0ZM8 15L3 10L4.41 8.59L8 12.17L15.59 4.58L17 6L8 15Z"})}),t.jsxs("span",{children:["Status: ",C.label||"Accepted"," - Lease Documents will be sent via HelloSign"]})]}):Z?t.jsxs(t.Fragment,{children:[t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"#31135D",children:t.jsx("path",{d:"M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 10 0ZM8 15L3 10L4.41 8.59L8 12.17L15.59 4.58L17 6L8 15Z"})}),t.jsxs("span",{children:["Status: ",jt(C,se)]})]}):t.jsxs(t.Fragment,{children:[t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"#79747E",children:t.jsx("path",{d:"M10 0C4.48 0 0 4.48 0 10C0 15.52 4.48 20 10 20C15.52 20 20 15.52 20 10C20 4.48 15.52 0 10 0ZM11 15H9V13H11V15ZM11 11H9V5H11V11Z"})}),t.jsxs("span",{children:["Status: ",jt(C,se)]})]})})]})]})]}),!O&&t.jsxs("div",{className:"modal-actions",children:[t.jsx("button",{className:"action-btn reject",onClick:()=>a==null?void 0:a(e),children:"Reject Proposal"}),E()]})]})]})}function Ft(e,n,s=null){const i=(e==null?void 0:e[n])||(e==null?void 0:e[n.replace(/([A-Z])/g," $1").trim()]);return i?new Date(i):s?new Date(s):new Date}function ze(e,n,s){return(e==null?void 0:e[n])??(e==null?void 0:e[n.replace(/([A-Z])/g," $1").trim()])??s}function $t(e){const n=(e==null?void 0:e["check in day"])??(e==null?void 0:e.checkInDay);return typeof n=="number"||typeof n=="string"&&/^\d$/.test(n)?_e(Number(n))||"Monday":n||"Monday"}function Ht(e){const n=(e==null?void 0:e["check out day"])??(e==null?void 0:e.checkOutDay);return typeof n=="number"||typeof n=="string"&&/^\d$/.test(n)?_e(Number(n))||"Friday":n||"Friday"}function Ue(e){return(e==null?void 0:e["Reservation Span (Weeks)"])||(e==null?void 0:e.reservationSpanWeeks)||8}function nt(e){const n=e==null?void 0:e["Nights Selected (Nights list)"];if(Array.isArray(n)&&n.length>0&&typeof n[0]=="number")return Ln(n);const s=e==null?void 0:e.nightsSelected;return Array.isArray(s)&&s.length>0?s:["Monday Night","Tuesday Night","Wednesday Night","Thursday Night"]}function Wt(e,n,s=[]){const i=(e==null?void 0:e.houseRules)||(e==null?void 0:e["House Rules"])||(e==null?void 0:e["Features - House Rules"])||(n==null?void 0:n.houseRules)||(n==null?void 0:n["Features - House Rules"])||[];return!Array.isArray(i)||i.length===0?[]:i[0]&&typeof i[0]=="object"&&i[0].id?i:typeof i[0]=="string"?i[0].includes("x")&&i[0].length>20?i.map(c=>s.find(u=>u.id===c)).filter(Boolean):i.map(c=>s.find(u=>{var l;return((l=u.name)==null?void 0:l.toLowerCase())===(c==null?void 0:c.toLowerCase())})).filter(Boolean):[]}function wt(e,n={},s=[]){const i=Ue(e),a=Lt(i)||He.find(c=>c.value==="other");return{moveInDate:Ft(e,"moveInRangeStart",e==null?void 0:e["Move in range start"]),checkInDay:$t(e),checkOutDay:Ht(e),reservationSpanWeeks:i,reservationSpan:a,nightsSelected:nt(e),houseRules:Wt(e,n,s),daysSelected:ze(e,"daysSelected",["Monday","Tuesday","Wednesday","Thursday"])}}function Ts(e,n="full"){return!e||!(e instanceof Date)||isNaN(e.getTime())?"":n==="short"?new Intl.DateTimeFormat("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"}).format(e):new Intl.DateTimeFormat("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}).format(e)}function fe(e){if(e==null)return"";if(typeof e=="string"&&isNaN(parseInt(e,10)))return e;const n=typeof e=="string"?parseInt(e,10):e,s=_e(n);if(s)return s;if(n>=1&&n<=7){const i=n===7?6:n-1,a=_e(i);if(a)return a}return e}function Es({moveInDate:e,checkInDay:n,checkOutDay:s,reservationSpan:i,weeksReservationSpan:a,houseRules:c=[],nightsSelected:u=[],nightlyCompensation:l=0,totalCompensation:r=0,hostCompensationPer4Weeks:d=0,originalTotalCompensation:o,originalCompensationPer4Weeks:N,isVisible:S=!0,originalValues:f}){var F;if(!S)return null;const I=u.length*a,j=f!=null&&f.nightsSelected?f.nightsSelected.length*(f.weeksReservationSpan||0):0,k={moveInDate:f!=null&&f.moveInDate?Te(f.moveInDate,"short")!==Te(e,"short"):!1,checkInDay:(f==null?void 0:f.checkInDay)!==void 0?fe(f.checkInDay)!==fe(n):!1,checkOutDay:(f==null?void 0:f.checkOutDay)!==void 0?fe(f.checkOutDay)!==fe(s):!1,weeksReservationSpan:f!=null&&f.weeksReservationSpan?f.weeksReservationSpan!==a:!1,houseRules:f!=null&&f.houseRules?(()=>{const R=new Set((f.houseRules||[]).map(C=>C.id)),T=new Set((c||[]).map(C=>C.id));return R.size!==T.size||[...R].some(C=>!T.has(C))})():!1,nightsSelected:f!=null&&f.nightsSelected?(()=>{const R=new Set(f.nightsSelected||[]),T=new Set(u||[]);return R.size!==T.size||[...R].some(C=>!T.has(C))})():!1},W=k.nightsSelected||k.weeksReservationSpan;return t.jsxs("div",{className:"hep-breakdown",children:[t.jsxs("div",{className:"hep-breakdown-row",children:[t.jsx("span",{className:"hep-breakdown-label",children:"Move-in"}),k.moveInDate?t.jsxs("span",{className:"hep-breakdown-value hep-breakdown-value--changed",children:[t.jsx("span",{className:"hep-breakdown-original",children:Te(f.moveInDate,"short")}),t.jsx("span",{className:"hep-breakdown-new",children:Te(e)})]}):t.jsx("span",{className:"hep-breakdown-value",children:Te(e)})]}),t.jsxs("div",{className:"hep-breakdown-row",children:[t.jsx("span",{className:"hep-breakdown-label",children:"Check-in"}),k.checkInDay?t.jsxs("span",{className:"hep-breakdown-value hep-breakdown-value--changed",children:[t.jsx("span",{className:"hep-breakdown-original",children:fe(f.checkInDay)}),t.jsx("span",{className:"hep-breakdown-new",children:fe(n)})]}):t.jsx("span",{className:"hep-breakdown-value",children:fe(n)})]}),t.jsxs("div",{className:"hep-breakdown-row",children:[t.jsx("span",{className:"hep-breakdown-label",children:"Check-out"}),k.checkOutDay?t.jsxs("span",{className:"hep-breakdown-value hep-breakdown-value--changed",children:[t.jsx("span",{className:"hep-breakdown-original",children:fe(f.checkOutDay)}),t.jsx("span",{className:"hep-breakdown-new",children:fe(s)})]}):t.jsx("span",{className:"hep-breakdown-value",children:fe(s)})]}),t.jsxs("div",{className:"hep-breakdown-row",children:[t.jsxs("span",{className:"hep-breakdown-label",children:["Reservation Length",k.weeksReservationSpan&&t.jsx("span",{className:"hep-change-badge",children:"Changed"})]}),k.weeksReservationSpan?t.jsxs("span",{className:"hep-breakdown-value hep-breakdown-value--changed",children:[t.jsxs("span",{className:"hep-breakdown-original",children:[f.weeksReservationSpan," wks"]}),t.jsxs("span",{className:"hep-breakdown-new",children:[a," weeks"]})]}):t.jsxs("span",{className:"hep-breakdown-value",children:[a," weeks"]})]}),t.jsxs("div",{className:"hep-breakdown-row",children:[t.jsxs("span",{className:"hep-breakdown-label",children:["Nights/week",k.nightsSelected&&t.jsx("span",{className:"hep-change-badge",children:"Changed"})]}),k.nightsSelected?t.jsxs("span",{className:"hep-breakdown-value hep-breakdown-value--changed",children:[t.jsxs("span",{className:"hep-breakdown-original",children:[f.nightsSelected.length," nights"]}),t.jsxs("span",{className:"hep-breakdown-new",children:[u.length," nights"]})]}):t.jsxs("span",{className:"hep-breakdown-value",children:[u.length," nights"]})]}),t.jsxs("div",{className:"hep-breakdown-row",children:[t.jsxs("span",{className:"hep-breakdown-label",children:["House Rules",k.houseRules&&t.jsx("span",{className:"hep-change-badge",children:"Changed"})]}),k.houseRules?t.jsxs("span",{className:"hep-breakdown-value hep-breakdown-value--changed",children:[t.jsxs("span",{className:"hep-breakdown-original",children:[((F=f.houseRules)==null?void 0:F.length)||0," rules"]}),t.jsxs("span",{className:"hep-breakdown-new",children:[c.length," rules"]})]}):t.jsxs("span",{className:"hep-breakdown-value",children:[c.length," rules"]})]}),t.jsx("hr",{className:"hep-breakdown-divider"}),t.jsxs("div",{className:"hep-breakdown-row",children:[t.jsx("span",{className:"hep-breakdown-label",children:"Compensation /night"}),t.jsx("span",{className:"hep-breakdown-value",children:Ge(l)})]}),t.jsxs("div",{className:"hep-breakdown-row",children:[t.jsx("span",{className:"hep-breakdown-label",children:"Nights reserved"}),W?t.jsxs("span",{className:"hep-breakdown-value hep-breakdown-value--changed",children:[t.jsxs("span",{className:"hep-breakdown-original",children:["x ",j]}),t.jsxs("span",{className:"hep-breakdown-new",children:["x ",I]})]}):t.jsxs("span",{className:"hep-breakdown-value",children:["x ",I]})]}),t.jsx("hr",{className:"hep-breakdown-divider"}),t.jsxs("div",{className:"hep-breakdown-row hep-breakdown-total",children:[t.jsx("span",{className:"hep-breakdown-label",children:"Total Compensation"}),W&&o!==void 0?t.jsxs("span",{className:"hep-breakdown-value hep-breakdown-value--changed",children:[t.jsx("span",{className:"hep-breakdown-original",children:Ge(o)}),t.jsx("span",{className:"hep-breakdown-new",children:Ge(r)})]}):t.jsx("span",{className:"hep-breakdown-value",children:Ge(r)})]})]})}function Os(e){return e.map(n=>{const s=Re.find(i=>i.id===n);return s==null?void 0:s.name}).filter(Boolean)}function pe(e){return e.map(n=>{const s=Re.find(i=>i.name===n);return s==null?void 0:s.id}).filter(n=>n!==void 0)}function Fs({initialNightsSelected:e=[],availableNights:n,onChange:s,disabled:i=!1}){const a=pe(e),[c,u]=y.useState(a),l=n?pe(n):Re.map(f=>f.id);y.useEffect(()=>{const f=pe(e);u(f)},[e]);const r=y.useCallback(f=>{const I=vt(f),j=tt(f);I!==null&&j!==null&&s({checkInDay:_e(I),checkOutDay:_e(j),nightsSelected:Os(f),daysSelected:En(f).map(k=>_e(k))})},[s]),d=y.useCallback(f=>{if(i||!l.includes(f))return;const I=c.includes(f);let j;if(I)j=c.filter(k=>k!==f);else{if(c.length>=7)return;j=[...c,f]}u(j),r(j)},[c,l,i,r]),o=vt(c),N=tt(c),S=c.length;return t.jsxs("div",{className:"hss-host-schedule-selector",children:[t.jsx("div",{className:"hss-nights-grid",children:st.map(f=>{const I=f.id,j=c.includes(I),k=l.includes(I),W=["hss-night-cell"];return j&&W.push("hss-selected"),k||W.push("hss-unavailable"),i&&W.push("hss-disabled"),t.jsx("div",{className:W.join(" "),onClick:()=>d(I),role:"checkbox","aria-checked":j,"aria-label":`${f.name} night`,"aria-disabled":i||!k,tabIndex:i||!k?-1:0,onKeyDown:F=>{(F.key===" "||F.key==="Enter")&&(F.preventDefault(),d(I))},children:t.jsx("span",{className:"hss-night-letter",children:f.singleLetter})},f.id)})}),t.jsxs("div",{className:"hss-selection-summary",children:[t.jsxs("div",{className:"hss-summary-item",children:[t.jsx("span",{className:"hss-summary-label",children:"Nights Selected:"}),t.jsxs("span",{className:"hss-summary-value",children:[S," night",S!==1?"s":"","/week"]})]}),o!==null&&t.jsxs("div",{className:"hss-summary-item",children:[t.jsx("span",{className:"hss-summary-label",children:"Check-in Day:"}),t.jsx("span",{className:"hss-summary-value hss-checkin",children:_e(o)})]}),N!==null&&t.jsxs("div",{className:"hss-summary-item",children:[t.jsx("span",{className:"hss-summary-label",children:"Check-out Day:"}),t.jsx("span",{className:"hss-summary-value hss-checkout",children:_e(N)})]})]})]})}function $s({value:e,onChange:n,placeholder:s="Select date",disabled:i=!1,minDate:a,maxDate:c}){const u=y.useRef(null),l=r=>{const d=new Date(r.target.value);isNaN(d.getTime())||n(d)};return t.jsxs("div",{className:"hep-date-input-wrapper",children:[t.jsx("input",{ref:u,type:"date",className:"hep-input-base hep-input-date",value:Je(e),onChange:l,placeholder:s,disabled:i,min:a?Je(a):void 0,max:c?Je(c):void 0}),t.jsxs("svg",{className:"hep-date-icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),t.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10",stroke:"currentColor",strokeWidth:"2"}),t.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),t.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})]})}function Hs({value:e,onChange:n,options:s=He,placeholder:i="Select reservation span",disabled:a=!1}){const[c,u]=y.useState(!1),l=y.useRef(null);y.useEffect(()=>{const d=o=>{l.current&&!l.current.contains(o.target)&&u(!1)};return document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)},[]);const r=d=>{n(d),u(!1)};return t.jsxs("div",{ref:l,className:"hep-dropdown-wrapper",children:[t.jsxs("button",{type:"button",className:"hep-input-base hep-dropdown",onClick:()=>!a&&u(!c),disabled:a,children:[t.jsx("span",{className:e?"":"hep-placeholder",children:e?e.label:i}),t.jsx("svg",{className:`hep-dropdown-chevron ${c?"hep-dropdown-chevron--open":""}`,width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M6 9L12 15L18 9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),c&&t.jsx("div",{className:"hep-dropdown-menu",children:s.map(d=>t.jsx("div",{className:`hep-dropdown-option ${(e==null?void 0:e.value)===d.value?"hep-dropdown-option--selected":""}`,onClick:()=>r(d),children:d.label},d.value))})]})}function Ws({value:e,onChange:n,placeholder:s="Enter number",disabled:i=!1,min:a,max:c}){const u=l=>{const r=parseInt(l.target.value,10);isNaN(r)||n(r)};return t.jsx("input",{type:"number",className:"hep-input-base hep-input-number",value:e,onChange:u,placeholder:s,disabled:i,min:a,max:c})}function Bs({value:e=[],onChange:n,options:s=[],placeholder:i="Add house rules...",disabled:a=!1}){const[c,u]=y.useState(!1),l=o=>{const N=e.some(S=>S.id===o.id);n(N?e.filter(S=>S.id!==o.id):[...e,o])},r=o=>{n(e.filter(N=>N.id!==o.id))},d=()=>{u(!1)};return t.jsxs("div",{className:"hep-rules-selector",children:[e.length>0&&t.jsxs("div",{className:"hep-rules-chips",children:[e.map(o=>t.jsxs("span",{className:"hep-rule-chip",children:[o.name||o.Display||o,t.jsx("button",{type:"button",className:"hep-rule-chip-remove",onClick:()=>r(o),disabled:a,"aria-label":`Remove ${o.name||o.Display||o}`,children:"×"})]},o.id)),!a&&t.jsx("button",{type:"button",className:"hep-rules-add-btn",onClick:()=>u(!0),"aria-label":"Add house rule",children:"+"})]}),e.length===0&&t.jsxs("button",{type:"button",className:`hep-rules-empty ${a?"hep-rules-empty--disabled":""}`,onClick:()=>!a&&u(!0),disabled:a,children:[t.jsx("span",{className:"hep-rules-empty-text",children:i}),t.jsx("span",{className:"hep-rules-empty-icon",children:"+"})]}),c&&t.jsx("div",{className:"hep-rules-popup-overlay",onClick:d,children:t.jsxs("div",{className:"hep-rules-popup",onClick:o=>o.stopPropagation(),children:[t.jsxs("div",{className:"hep-rules-popup-header",children:[t.jsx("span",{className:"hep-rules-popup-title",children:"House Rules"}),t.jsx("button",{type:"button",className:"hep-rules-popup-close",onClick:d,"aria-label":"Close",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#374151",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),t.jsx("div",{className:"hep-rules-popup-body",children:s.map(o=>{const N=e.some(S=>S.id===o.id);return t.jsxs("button",{type:"button",className:`hep-rules-popup-option ${N?"hep-rules-popup-option--selected":""}`,onClick:()=>l(o),children:[t.jsx("span",{className:"hep-rules-popup-option-text",children:o.name||o.Display}),t.jsx("span",{className:`hep-rules-popup-checkbox ${N?"hep-rules-popup-checkbox--checked":""}`,children:N&&t.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"3",children:t.jsx("polyline",{points:"20 6 9 17 4 12"})})})]},o.id)})}),t.jsx("div",{className:"hep-rules-popup-footer",children:t.jsx("button",{type:"button",className:"hep-rules-popup-done",onClick:d,children:"Done"})})]})})]})}function _t({proposal:e,availableHouseRules:n=[],isInternalUsage:s=!1,initialShowReject:i=!1,onAcceptAsIs:a,onCounteroffer:c,onReject:u,onCancel:l,onAlert:r}){const[d,o]=y.useState("pristine"),[N,S]=y.useState(!0),[f,I]=y.useState(!1),j=(e==null?void 0:e.guest)||(e==null?void 0:e.Guest)||(e==null?void 0:e._guest)||(e==null?void 0:e["Created By"])||{},k=(e==null?void 0:e.listing)||(e==null?void 0:e._listing)||{},W=(j==null?void 0:j.firstName)||(j==null?void 0:j["Name - First"])||(j==null?void 0:j["First Name"])||(j==null?void 0:j.first_name)||"Guest",F=(k==null?void 0:k.title)||(k==null?void 0:k.Name)||"Listing",[R,T]=y.useState(()=>Ft(e,"moveInRangeStart",e==null?void 0:e["Move in range start"])),[C,$]=y.useState(()=>{const m=Ue(e),v=Lt(m);return v||He.find(M=>M.value==="other")}),[O,V]=y.useState(()=>Ue(e)),[Z,z]=y.useState(()=>$t(e)),[se,P]=y.useState(()=>Ht(e)),[q,Se]=y.useState(()=>nt(e)),[Ce,Ie]=y.useState(()=>ze(e,"daysSelected",["Monday","Tuesday","Wednesday","Thursday"])),[J,ie]=y.useState([]),[Y,ye]=y.useState(!1);y.useEffect(()=>{if(n.length>0&&!Y){const m=Wt(e,k,n);ie(m),ye(!0)}},[n,Y,e,k]);const[xe,ae]=y.useState(!1),[ce,B]=y.useState(i);y.useEffect(()=>{if(N&&e){const m=(e==null?void 0:e.status)||(e==null?void 0:e.Status);if((Rn[m]||{usualOrder:0}).usualOrder>=3){const w=(e==null?void 0:e.hcMoveInDate)||(e==null?void 0:e["hc Move-in Date"]);w&&T(new Date(w));const b=(e==null?void 0:e.hcReservationSpan)||(e==null?void 0:e["hc Reservation Span"]);b&&$(b);const A=(e==null?void 0:e.hcReservationSpanWeeks)||(e==null?void 0:e["hc Reservation Span Weeks"]);A&&V(A);const Q=(e==null?void 0:e.hcCheckInDay)||(e==null?void 0:e["hc Check-in Day"]);Q&&z(Q);const X=(e==null?void 0:e.hcCheckOutDay)||(e==null?void 0:e["hc Check-out Day"]);X&&P(X);const oe=(e==null?void 0:e.hcNightsSelected)||(e==null?void 0:e["hc Nights Selected"]);oe&&Se(oe);const ue=(e==null?void 0:e.hcDaysSelected)||(e==null?void 0:e["hc Days Selected"]);ue&&Ie(ue);const We=(e==null?void 0:e.hcHouseRules)||(e==null?void 0:e["hc House Rules"]);We&&ie(We)}S(!1)}},[e,N]);const te=y.useCallback(()=>{const m=wt(e,k,n),v=Te(m.moveInDate,"short")!==Te(R,"short"),M=m.reservationSpanWeeks!==O,w=m.checkInDay!==Z||m.checkOutDay!==se;let b=!1;if(Y&&m.houseRules.length>0){const A=new Set(m.houseRules.map(X=>X.id)),Q=new Set(J.map(X=>X.id));b=A.size!==Q.size||[...A].some(X=>!Q.has(X))}return v||M||w||b},[e,k,n,R,O,Z,se,J,Y]),me=q.length*O,ne=(ze(e,"proposalNightlyPrice",0)||ze(e,"proposal nightly price",0)||100)*.85,re=ne*me,de=O>0?re/O*4:0,ke=nt(e).length,Ne=Ue(e),De=ke*Ne,le=ne*De,he=Ne>0?le/Ne*4:0,K=wt(e,k,n),_=()=>{o("editing")},be=()=>{o("pristine")},Pe=m=>{z(m.checkInDay),P(m.checkOutDay),Se(m.nightsSelected),Ie(m.daysSelected)},g=()=>{o("general")},x=async()=>{if(!f){I(!0);try{te()?(c&&await c({proposal:e,numberOfWeeks:O,reservationSpan:C,checkIn:Z,checkOut:se,nightsSelected:q,daysSelected:Ce,newHouseRules:J,moveInDate:R}),r==null||r({type:"information",title:"Modifications submitted!",content:"Awaiting Guest Review."})):(a&&await a(e),r==null||r({type:"information",title:"Proposal Accepted!",content:"The proposal has been accepted as-is."})),ae(!1),o("pristine"),l==null||l()}catch{r==null||r({type:"error",title:"Error",content:"Failed to process your request. Please try again."})}finally{I(!1)}}},h=async m=>{if(u)try{await u(e,m),r==null||r({type:"information",title:"Proposal Rejected",content:"The proposal has been rejected."}),B(!1),l==null||l()}catch{r==null||r({type:"error",title:"Error",content:"Failed to reject proposal. Please try again."})}},D=()=>{o("pristine"),S(!0),l==null||l()},U=()=>{o("editing")},L=()=>d==="pristine"?t.jsxs("div",{className:"hep-header",children:[t.jsxs("div",{className:"hep-header-left",children:[t.jsx("div",{className:"hep-header-icon",children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),t.jsx("polyline",{points:"14,2 14,8 20,8"}),t.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),t.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]})}),t.jsxs("div",{children:[t.jsx("div",{className:"hep-header-title",children:"Review Proposal"}),t.jsxs("div",{className:"hep-header-subtitle",children:["From ",W," for ",F]})]})]}),t.jsx("button",{type:"button",className:"hep-header-close",onClick:D,"aria-label":"Close",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#374151",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}):d==="editing"?t.jsxs("div",{className:"hep-header",children:[t.jsxs("div",{className:"hep-header-left",children:[t.jsx("div",{className:"hep-header-icon",children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),t.jsx("polyline",{points:"14,2 14,8 20,8"}),t.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),t.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]})}),t.jsxs("div",{children:[t.jsx("div",{className:"hep-header-title",children:"Edit Proposal"}),t.jsx("div",{className:"hep-header-subtitle",children:F})]})]}),t.jsx("button",{type:"button",className:"hep-header-close",onClick:D,"aria-label":"Close",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#374151",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}):t.jsxs("div",{className:"hep-header",children:[t.jsxs("div",{className:"hep-header-left",children:[t.jsx("div",{className:"hep-header-icon",children:t.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[t.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),t.jsx("polyline",{points:"14,2 14,8 20,8"}),t.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),t.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"})]})}),t.jsxs("div",{children:[t.jsx("div",{className:"hep-header-title",children:"Review Changes"}),t.jsx("div",{className:"hep-header-subtitle",children:F})]})]}),t.jsx("button",{type:"button",className:"hep-header-close",onClick:D,"aria-label":"Close",children:t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"#374151",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),G=()=>d==="pristine"?t.jsxs("div",{className:"hep-footer",children:[t.jsx("button",{type:"button",className:"hep-btn hep-btn-secondary",onClick:D,children:"Cancel"}),t.jsx("button",{type:"button",className:"hep-btn hep-btn-primary",onClick:_,children:"Edit Proposal"})]}):d==="editing"?t.jsxs("div",{className:"hep-footer",children:[t.jsx("button",{type:"button",className:"hep-btn hep-btn-secondary",onClick:be,children:"Cancel Edits"}),t.jsx("button",{type:"button",className:"hep-btn hep-btn-primary",onClick:g,children:"Update Proposal"})]}):t.jsxs("div",{className:"hep-footer",children:[t.jsx("button",{type:"button",className:"hep-btn hep-btn-secondary",onClick:be,children:"Cancel Edits"}),t.jsx("button",{type:"button",className:"hep-btn hep-btn-success",onClick:x,disabled:f,children:"Submit"})]}),H=()=>{var m,v;return t.jsxs("div",{className:"hep-pristine-view",children:[t.jsxs("div",{className:"hep-detail-row",children:[t.jsx("span",{className:"hep-detail-label",children:"Move-in"}),t.jsx("span",{className:"hep-detail-value",children:Ts(K.moveInDate,"full")})]}),t.jsxs("div",{className:"hep-detail-row",children:[t.jsx("span",{className:"hep-detail-label",children:"Check-in"}),t.jsx("span",{className:"hep-detail-value",children:K.checkInDay})]}),t.jsxs("div",{className:"hep-detail-row",children:[t.jsx("span",{className:"hep-detail-label",children:"Check-out"}),t.jsx("span",{className:"hep-detail-value",children:K.checkOutDay})]}),t.jsxs("div",{className:"hep-detail-row",children:[t.jsx("span",{className:"hep-detail-label",children:"Reservation Length"}),t.jsxs("span",{className:"hep-detail-value",children:[K.reservationSpanWeeks," weeks"]})]}),t.jsxs("div",{className:"hep-detail-row",children:[t.jsx("span",{className:"hep-detail-label",children:"Weekly Pattern"}),t.jsxs("span",{className:"hep-detail-value",children:[(m=K.checkInDay)==null?void 0:m.substring(0,3)," - ",(v=K.checkOutDay)==null?void 0:v.substring(0,3)," (",K.nightsSelected.length," nights/week)"]})]}),t.jsxs("div",{className:"hep-detail-row",children:[t.jsx("span",{className:"hep-detail-label",children:"House Rules"}),t.jsxs("span",{className:"hep-detail-value",children:[K.houseRules.length," rules"]})]}),t.jsxs("div",{className:"hep-pricing-section",children:[t.jsx("div",{className:"hep-pricing-title",children:"Compensation Breakdown"}),t.jsxs("div",{className:"hep-pricing-row",children:[t.jsx("span",{className:"hep-pricing-label",children:"Compensation /night"}),t.jsxs("span",{className:"hep-pricing-value",children:["$",ne.toFixed(2)]})]}),t.jsxs("div",{className:"hep-pricing-row",children:[t.jsx("span",{className:"hep-pricing-label",children:"Nights reserved"}),t.jsxs("span",{className:"hep-pricing-value",children:["x ",De]})]}),t.jsxs("div",{className:"hep-pricing-row hep-pricing-row--total",children:[t.jsx("span",{className:"hep-pricing-label",children:"Total Compensation"}),t.jsxs("span",{className:"hep-pricing-value",children:["$",le.toFixed(2)]})]})]})]})},E=()=>t.jsxs("div",{className:"hep-editing-view",children:[t.jsxs("div",{className:"hep-form-section",children:[t.jsx("label",{className:"hep-form-label",children:"Schedule Selection"}),t.jsx(Fs,{initialNightsSelected:q,availableNights:(k==null?void 0:k.nightsAvailable)||(k==null?void 0:k["Nights Available"]),onChange:Pe,disabled:s||(k==null?void 0:k.rentalType)==="Weekly"})]}),t.jsxs("div",{className:"hep-form-section",children:[t.jsx("label",{className:"hep-form-label",children:"Move-in Date"}),t.jsx($s,{value:R,onChange:T,placeholder:"Move-in",minDate:new Date})]}),t.jsxs("div",{className:"hep-form-section",children:[t.jsx("label",{className:"hep-form-label",children:"Reservation Span"}),t.jsx(Hs,{value:C,onChange:m=>{$(m),m.value!=="other"&&V(m.weeks)},options:He,placeholder:"Select reservation span"}),(C==null?void 0:C.value)==="other"&&t.jsxs("div",{className:"hep-form-section hep-form-section--inline",children:[t.jsx("label",{className:"hep-form-label",children:"# of weeks"}),t.jsx(Ws,{value:O,onChange:V,placeholder:"Enter # Weeks",min:1,max:52})]})]}),t.jsxs("div",{className:"hep-form-section",children:[t.jsx("label",{className:"hep-form-label",children:"House Rules"}),t.jsx(Bs,{value:J,onChange:ie,options:n,placeholder:"Choose some options..."})]})]});return i&&ce?t.jsx(xt,{isOpen:ce,proposal:e,userType:"host",buttonText:"Reject Proposal",onClose:()=>{B(!1),l==null||l()},onConfirm:h}):t.jsxs("div",{className:"hep-container",children:[t.jsx("div",{className:"hep-grab-handle","aria-hidden":"true"}),L(),t.jsxs("div",{className:"hep-body",children:[d==="pristine"&&H(),d==="editing"&&E(),d==="general"&&t.jsxs(t.Fragment,{children:[t.jsxs("button",{type:"button",className:"hep-back-link",onClick:()=>o("editing"),"aria-label":"Back to editing",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:t.jsx("path",{d:"M15 18L9 12L15 6"})}),"Back to editing"]}),t.jsx(Es,{moveInDate:R,checkInDay:Z,checkOutDay:se,reservationSpan:C,weeksReservationSpan:O,houseRules:J,nightsSelected:q,nightlyCompensation:ne,totalCompensation:re,hostCompensationPer4Weeks:de,originalTotalCompensation:le,originalCompensationPer4Weeks:he,isVisible:!0,originalValues:K,onEditField:U})]})]}),G(),t.jsx(xt,{isOpen:ce,proposal:e,userType:"host",buttonText:"Reject Proposal",onClose:()=>B(!1),onConfirm:h}),xe&&t.jsx("div",{className:"hep-popup-overlay",children:t.jsxs("div",{className:"hep-popup",children:[t.jsx("h3",{className:"hep-popup-title",children:te()?"Confirm Counteroffer":"Accept Proposal"}),t.jsx("p",{className:"hep-popup-content",children:te()?"You have made changes to the proposal terms. This will send a counteroffer to the guest for their review.":"You are accepting the proposal as-is without any modifications."}),t.jsxs("div",{className:"hep-popup-actions",children:[t.jsx("button",{type:"button",className:"hep-btn hep-btn-secondary",onClick:()=>ae(!1),children:"No, Go Back"}),t.jsx("button",{type:"button",className:"hep-btn hep-btn-primary",onClick:x,disabled:f,children:"Yes, Proceed"})]})]})})]})}const Gs=!1,zs=[{_id:"1766003594466x67309961278997728",title:"1 Bedroom Entire Place in Brooklyn",thumbnail:"https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=200&h=200&fit=crop",neighborhood:"Downtown Brooklyn",address:"285 Jay St, Brooklyn, NY 11201",bedrooms:1,bathrooms:1,monthly_rate:3500},{_id:"demo-listing-2",title:"Sunny Studio in Williamsburg",thumbnail:"https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=200&h=200&fit=crop",neighborhood:"Williamsburg",address:"123 Bedford Ave, Brooklyn, NY 11249",bedrooms:0,bathrooms:1,monthly_rate:2200}];function St(){return t.jsxs("div",{className:"loading-state",role:"status","aria-live":"polite",children:[t.jsx("div",{className:"spinner","aria-hidden":"true"}),t.jsx("p",{children:"Loading your proposals..."})]})}function Us({error:e,onRetry:n}){return t.jsxs("div",{className:"hp7-empty-state",role:"alert",children:[t.jsx("div",{className:"hp7-empty-state-icon",style:{color:"#dc2626"},"aria-hidden":"true",children:"!"}),t.jsx("h2",{className:"hp7-empty-state-title",children:"Something went wrong"}),t.jsx("p",{className:"hp7-empty-state-text",children:e}),t.jsx("button",{className:"hp7-btn hp7-btn-primary",onClick:n,children:"Try Again"})]})}function qs({listingName:e}){return t.jsxs("div",{className:"hp7-empty-state",children:[t.jsx("div",{className:"hp7-empty-state-icon","aria-hidden":"true",children:t.jsx(et,{size:48,strokeWidth:1.5})}),t.jsx("h2",{className:"hp7-empty-state-title",children:"No proposals yet"}),t.jsx("p",{className:"hp7-empty-state-text",children:e?`There are no proposals for ${e}.`:"You don't have any proposals yet."})]})}function Vs(){var K;const[e,n]=y.useState(null),[s,i]=y.useState((K=zs[0])==null?void 0:K._id),{authState:a,user:c,listings:u,selectedListing:l,proposals:r,selectedProposal:d,isModalOpen:o,isEditingProposal:N,isVirtualMeetingModalOpen:S,virtualMeetingView:f,virtualMeetingProposal:I,allHouseRules:j,isLoading:k,error:W,proposalCountsByListing:F,handleListingChange:R,handleProposalClick:T,handleCloseModal:C,handleDeleteProposal:$,handleAcceptProposal:O,handleRejectProposal:V,handleModifyProposal:Z,handleSendMessage:z,handleRemindSplitLease:se,handleChooseVirtualMeeting:P,handleRequestRentalApp:q,handleRetry:Se,handleCloseVirtualMeetingModal:Ce,handleVirtualMeetingSuccess:Ie,showRejectOnOpen:J,handleCloseEditing:ie,handleAcceptAsIs:Y,handleCounteroffer:ye,handleRejectFromEditing:xe,handleEditingAlert:ae}=$n({skipAuth:Gs}),ce=u,B=l,te=r,ve=k,me=W,Le=R,ne=F,re=y.useMemo(()=>Un(te||[]),[te]),de=y.useCallback(_=>{n(be=>be===_?null:_)},[]),ke=y.useMemo(()=>({onViewProfile:_=>{T(_)},onMessage:_=>{z(_)},onScheduleMeeting:_=>{P(_)},onCompareTerms:_=>{T(_)},onAccept:_=>{O(_)},onModify:_=>{Z(_)},onDecline:_=>{V(_)},onRemindGuest:_=>{z(_)},onEditCounter:_=>{Z(_)},onWithdraw:_=>{V(_)},onRemove:_=>{$(_)},onRequestRentalApp:_=>{q(_)}}),[T,z,P,O,Z,V,$,q]),Ne=y.useCallback(_=>{n(null),Le(_)},[Le]);if(a.shouldRedirect)return t.jsxs(t.Fragment,{children:[t.jsx(ht,{}),t.jsx("main",{className:"main-content",children:t.jsx("div",{className:"hp7-page",children:t.jsx(St,{})})}),t.jsx(ot,{})]});const De=(B==null?void 0:B._id)||(B==null?void 0:B.id),le=(B==null?void 0:B.title)||(B==null?void 0:B.name),he=te&&te.length>0;return t.jsxs(t.Fragment,{children:[t.jsx(ht,{}),t.jsxs("main",{className:"main-content",role:"main",id:"main-content",children:[t.jsx("h1",{className:"sr-only",children:"Host Proposals Dashboard"}),t.jsxs("div",{className:"hp7-page",children:[t.jsxs("div",{className:"hp7-page-header",children:[t.jsx("div",{className:"hp7-page-header-top",children:t.jsx("h2",{className:"hp7-page-title","aria-label":`Proposals${le?` for ${le}`:""}`,children:"Proposals"})}),!ve&&!me&&ce&&ce.length>0&&t.jsx("nav",{"aria-label":"Listing filter",children:t.jsx(Zn,{listings:ce,selectedListingId:De,onListingChange:Ne,proposalCounts:ne})})]}),ve&&t.jsx(St,{}),!ve&&me&&t.jsx(Us,{error:me,onRetry:Se}),!ve&&!me&&t.jsx(t.Fragment,{children:he?t.jsxs("div",{className:"hp7-sections",children:[t.jsx(Xe,{sectionKey:"actionNeeded",proposals:re.actionNeeded,expandedProposalId:e,onToggleExpand:de,handlers:ke}),t.jsx(Xe,{sectionKey:"inProgress",proposals:re.inProgress,expandedProposalId:e,onToggleExpand:de,handlers:ke}),t.jsx(Xe,{sectionKey:"closed",proposals:re.closed,expandedProposalId:e,onToggleExpand:de,handlers:ke})]}):t.jsx(qs,{listingName:le})})]})]}),t.jsx(ot,{}),t.jsx(As,{proposal:d,isOpen:o,onClose:C,onAccept:O,onReject:V,onModify:Z,onSendMessage:z,onRemindSplitLease:se,onChooseVirtualMeeting:P,onRequestRentalApp:q,currentUserId:(c==null?void 0:c._id)||(c==null?void 0:c.userId)}),S&&I&&t.jsx(hn,{proposal:I,initialView:f,currentUser:c,onClose:Ce,onSuccess:Ie}),N&&d&&(J?t.jsx(_t,{proposal:d,availableHouseRules:j,initialShowReject:J,onAcceptAsIs:()=>Y(d),onCounteroffer:ye,onReject:_=>xe(d,_),onCancel:ie,onAlert:ae}):t.jsx("div",{className:"editing-proposal-overlay",children:t.jsx("div",{className:"editing-proposal-container",children:t.jsx(_t,{proposal:d,availableHouseRules:j,initialShowReject:J,onAcceptAsIs:()=>Y(d),onCounteroffer:ye,onReject:_=>xe(d,_),onCancel:ie,onAlert:ae})})}))]})}Zt(document.getElementById("root")).render(t.jsx(Jt.StrictMode,{children:t.jsx(on,{children:t.jsx(nn,{children:t.jsx(Vs,{})})})}));

var Se=Object.defineProperty;var ke=(s,t,n)=>t in s?Se(s,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):s[t]=n;var te=(s,t,n)=>ke(s,typeof t!="symbol"?t+"":t,n);import{r,j as e,c as we,R as Ce}from"./client-BJVKzfAi.js";import{N as ie,i as De,g as oe,a as Ae}from"./nycZipCodes-DGfN4kWJ.js";import{s as X}from"./supabase-BoCLEw6R.js";import{g as Pe,e as Le,a as Fe}from"./aiService-Bc-ZcM1i.js";import{A as le,H as Ie}from"./HostScheduleSelector-HOEnT3Yo.js";import{d as Te}from"./photoUpload-vf9LU0fY.js";import{H as ce}from"./Header-BJKWma2V.js";import{S as Ee}from"./proposalDataFetcher-CipdyWU2.js";import{u as Me,T as Oe}from"./Toast-BQk6Nzgd.js";import{c as de,v as Re}from"./tokenValidation-WTJVhUoY.js";import{c as ue}from"./listingService-CLUhv1SF.js";import{i as Be}from"./isGuest-DSCtqO4x.js";import{E as _e}from"./ErrorBoundary-9_HbXv1y.js";/* empty css             */import"./config-QPKPRtag.js";import"./auth-QZ4BJadW.js";import"./constants-CPVJY5eo.js";import"./proposalStatuses-1Bj0NYR4.js";const Ue=({data:s,onChange:t,onNext:n,isLoadingInitialData:h=!1})=>{const[d,u]=r.useState({}),[m,A]=r.useState(""),[k,p]=r.useState(!1),[P,R]=r.useState(!1),L=r.useRef(null),o=r.useRef(null),S=r.useRef(s);r.useEffect(()=>{S.current=s},[s]);const j=r.useCallback(a=>{if(a.length===0)return;const g=a[0],c=document.getElementById(g);c&&(c.scrollIntoView({behavior:"smooth",block:"center"}),c.focus())},[]);r.useEffect(()=>{s.address.validated&&s.address.fullAddress&&(p(!0),A(""),console.log("Address already validated on mount:",s.address.fullAddress))},[s.address.validated,s.address.fullAddress]),r.useEffect(()=>{let a=0;const g=50,c=()=>{if(!window.google||!window.google.maps||!window.google.maps.places){a++,a<g?(console.log("Waiting for Google Maps to load...",a),setTimeout(c,100)):(console.error("Google Maps API failed to load. Please check your API key in index.html"),A("Address autocomplete is unavailable. Please use manual entry."));return}if(!L.current){setTimeout(c,100);return}try{console.log("Initializing Google Maps Autocomplete...");const T=new window.google.maps.LatLngBounds(new window.google.maps.LatLng(ie.south,ie.west),new window.google.maps.LatLng(ie.north,ie.east)),O=new window.google.maps.places.Autocomplete(L.current,{types:["address"],componentRestrictions:{country:"us"},bounds:T,strictBounds:!0,fields:["address_components","formatted_address","geometry","name","place_id"]});console.log("Google Maps Autocomplete initialized successfully (NYC + Hudson County NJ)"),window.google.maps.event.addDomListener(L.current,"keydown",i=>{i.key==="Enter"&&i.preventDefault()}),o.current=O,O.addListener("place_changed",()=>{const i=O.getPlace();if(console.log("Place selected:",i),!i.place_id){console.log("No place_id - user did not select from dropdown");return}if(!i.geometry||!i.address_components){console.error("Invalid place selected - missing geometry or address components"),A("Please select a valid address from the dropdown"),p(!1);return}console.log("Valid place selected, parsing address components...");let x="",I="",M="",D="",E="",B="",K="";if(i.address_components.forEach(H=>{const z=H.types;z.includes("street_number")&&(x=H.long_name),z.includes("route")&&(I=H.long_name),z.includes("locality")&&(M=H.long_name),z.includes("administrative_area_level_1")&&(D=H.short_name),z.includes("administrative_area_level_2")&&(K=H.long_name),z.includes("postal_code")&&(E=H.long_name),(z.includes("neighborhood")||z.includes("sublocality")||z.includes("sublocality_level_1"))&&(B=H.long_name)}),console.log("Extracted address components:",{streetNumber:x,streetName:I,city:M,state:D,county:K,zip:E,neighborhood:B}),!De(E,D,K)){let H;if(E){const z=oe(E);H=z?`This address appears to be outside our service area. Zip code ${E} is in ${z}, but we only accept listings in NYC (Manhattan, Brooklyn, Queens, Bronx, Staten Island) and Hudson County, NJ.`:`This address is outside our service area (zip: ${E}). We only accept listings in NYC (Manhattan, Brooklyn, Queens, Bronx, Staten Island) and Hudson County, NJ.`}else D==="NJ"?H=`This address is outside our service area. We only accept listings in Hudson County, NJ (Jersey City, Hoboken, Weehawken, Union City, etc.), not ${K||"other NJ counties"}.`:H="This address is outside our service area. We only accept listings in NYC (Manhattan, Brooklyn, Queens, Bronx, Staten Island) and Hudson County, NJ.";console.warn("Invalid address selected:",{zip:E,state:D,county:K}),A(H),p(!1);return}const ne=E?oe(E):Ae(D,K)?"Hudson County, NJ":"Unknown";console.log("Valid address:",E||"(no zip)","- Area:",ne);const ee={fullAddress:i.formatted_address||"",number:x,street:I,city:M,state:D,zip:E,neighborhood:B,latitude:i.geometry.location.lat(),longitude:i.geometry.location.lng(),validated:!0};console.log("Parsed address:",ee),t({...S.current,address:ee}),p(!0),R(!1),A(""),console.log("Address validated successfully!")})}catch(T){console.error("Error initializing Google Maps Autocomplete:",T)}};return c(),()=>{o.current&&window.google&&window.google.maps.event.clearInstanceListeners(o.current)}},[]);const U=(a,g)=>{if(t({...s,[a]:g}),d[a]){const c={...d};delete c[a],u(c)}},W=(a,g)=>{t({...s,address:{...s.address,[a]:g}}),A("")},b=a=>{const g=a.target.value;t({...s,address:{...s.address,fullAddress:g,validated:!1}}),p(!1),A("")},l=()=>{R(!P)},N=()=>{const a={},g=[];return!s.listingName||s.listingName.trim().length===0?(a.listingName="Listing name is required",g.push("listingName")):s.listingName.length>35&&(a.listingName="Listing name must be 35 characters or less",g.push("listingName")),s.typeOfSpace||(a.typeOfSpace="Type of space is required",g.push("typeOfSpace")),(!s.bedrooms||s.bedrooms<0)&&(a.bedrooms="Number of bedrooms is required",g.push("bedrooms")),s.typeOfKitchen||(a.typeOfKitchen="Type of kitchen is required",g.push("typeOfKitchen")),s.typeOfParking||(a.typeOfParking="Type of parking is required",g.push("typeOfParking")),(!s.bathrooms||s.bathrooms<0)&&(a.bathrooms="Number of bathrooms is required",g.push("bathrooms")),!s.address.fullAddress||s.address.fullAddress.trim().length===0?(A("Listing address is required"),a.address="Address is required",g.push("fullAddress")):!k&&!P&&(A("Please select a valid address from the dropdown or enter manually"),a.address="Address validation required",g.push("fullAddress")),P&&!s.address.state&&(a.state="State is required when entering address manually",g.push("state")),u(a),g},$=()=>{const a=N();a.length===0?n():j(a)},v=["Private Room","Entire Place","Shared Room"],_=["Full Kitchen","Kitchenette","No Kitchen","Kitchen Not Accessible"],J=["Street Parking","No Parking","Off-Street Parking","Attached Garage","Detached Garage","Nearby Parking Structure"],F=["Studio","1","2","3","4","5","6"],w=["1","2","3","4","5","6","7"],y=["1","1.5","2","2.5","3","3.5","4","4.5","5","5.5","6"],C=[{code:"NY",name:"New York"},{code:"NJ",name:"New Jersey"},{code:"CT",name:"Connecticut"},{code:"PA",name:"Pennsylvania"},{code:"MA",name:"Massachusetts"},{code:"CA",name:"California"},{code:"TX",name:"Texas"},{code:"FL",name:"Florida"}];return e.jsxs("div",{className:"section-container space-snapshot-section",children:[e.jsx("h2",{className:"section-title",children:"Space Snapshot"}),e.jsx("p",{className:"section-subtitle",children:"Let's start with the basics about your space"}),e.jsxs("div",{className:"info-alert",children:[e.jsx("span",{className:"info-icon",children:"â„¹ï¸"}),e.jsx("p",{children:"Start typing your address and select from the dropdown. We accept listings in NYC (Manhattan, Brooklyn, Queens, Bronx, Staten Island) and Hudson County, NJ."})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"listingName",children:["Listing Name",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("input",{type:"text",id:"listingName",placeholder:h?"Loading listing name...":"Listing Name (35 character max)",maxLength:35,value:s.listingName,onChange:a=>U("listingName",a.target.value),className:d.listingName?"input-error":"",disabled:h}),d.listingName&&e.jsx("span",{className:"error-message",children:d.listingName})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"typeOfSpace",children:["Type of Space",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("select",{id:"typeOfSpace",value:s.typeOfSpace,onChange:a=>U("typeOfSpace",a.target.value),className:d.typeOfSpace?"input-error":"",children:[e.jsx("option",{value:"",children:"Choose an optionâ€¦"}),v.map(a=>e.jsx("option",{value:a,children:a},a))]}),d.typeOfSpace&&e.jsx("span",{className:"error-message",children:d.typeOfSpace})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"bedrooms",children:["Bedrooms",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("select",{id:"bedrooms",value:s.bedrooms.toString(),onChange:a=>U("bedrooms",parseInt(a.target.value)),className:d.bedrooms?"input-error":"",children:F.map(a=>e.jsx("option",{value:a==="Studio"?"0":a,children:a},a))}),d.bedrooms&&e.jsx("span",{className:"error-message",children:d.bedrooms})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"typeOfKitchen",children:["Type of Kitchen",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("select",{id:"typeOfKitchen",value:s.typeOfKitchen,onChange:a=>U("typeOfKitchen",a.target.value),className:d.typeOfKitchen?"input-error":"",children:[e.jsx("option",{value:"",children:"Choose an optionâ€¦"}),_.map(a=>e.jsx("option",{value:a,children:a},a))]}),d.typeOfKitchen&&e.jsx("span",{className:"error-message",children:d.typeOfKitchen})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"beds",children:"Beds"}),e.jsx("select",{id:"beds",value:s.beds.toString(),onChange:a=>U("beds",parseInt(a.target.value)),children:w.map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"typeOfParking",children:["Type of Parking",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("select",{id:"typeOfParking",value:s.typeOfParking,onChange:a=>U("typeOfParking",a.target.value),className:d.typeOfParking?"input-error":"",children:[e.jsx("option",{value:"",children:"Choose an optionâ€¦"}),J.map(a=>e.jsx("option",{value:a,children:a},a))]}),d.typeOfParking&&e.jsx("span",{className:"error-message",children:d.typeOfParking})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"bathrooms",children:["Bathrooms",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("select",{id:"bathrooms",value:s.bathrooms.toString(),onChange:a=>U("bathrooms",parseFloat(a.target.value)),className:d.bathrooms?"input-error":"",children:y.map(a=>e.jsx("option",{value:a,children:a},a))}),d.bathrooms&&e.jsx("span",{className:"error-message",children:d.bathrooms})]})]}),e.jsxs("div",{className:"address-section",children:[e.jsxs("label",{htmlFor:"fullAddress",children:["Listing Address",e.jsx("span",{className:"required",children:"*"})," ",e.jsx("span",{className:"address-note",children:"(private and will not be shared)"})]}),e.jsx("input",{ref:L,type:"text",id:"fullAddress",placeholder:"Start typing your address...",value:s.address.fullAddress,onChange:b,className:d.address?"input-error":""}),k&&e.jsx("div",{className:"success-message",children:"âœ“ Address verified"}),m&&e.jsxs("div",{className:"error-alert",children:[e.jsx("span",{className:"error-icon",children:"âš ï¸"}),e.jsx("p",{children:m})]}),!k&&s.address.fullAddress&&e.jsx("button",{type:"button",className:"btn-link",onClick:l,style:{marginTop:"0.5rem"},children:P?"Hide manual entry":"Can't find your address? Enter manually"}),P&&e.jsxs("div",{className:"address-details",children:[e.jsxs("p",{className:"confirmation-message",children:[e.jsx("span",{className:"info-icon",children:"â„¹ï¸"}),"Please confirm your address details"]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"number",children:"Street Number"}),e.jsx("input",{type:"text",id:"number",value:s.address.number,onChange:a=>W("number",a.target.value),placeholder:"123"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"street",children:"Street Name"}),e.jsx("input",{type:"text",id:"street",value:s.address.street,onChange:a=>W("street",a.target.value),placeholder:"Main St"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"city",children:"City"}),e.jsx("input",{type:"text",id:"city",value:s.address.city,onChange:a=>W("city",a.target.value),placeholder:"New York"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"state",children:["State",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("select",{id:"state",value:s.address.state,onChange:a=>W("state",a.target.value),className:d.state?"input-error":"",children:[e.jsx("option",{value:"",children:"Select state"}),C.map(a=>e.jsx("option",{value:a.code,children:a.name},a.code))]}),d.state&&e.jsx("span",{className:"error-message",children:d.state})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"zip",children:"Zip Code"}),e.jsx("input",{type:"text",id:"zip",value:s.address.zip,onChange:a=>W("zip",a.target.value),placeholder:"10001"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"neighborhood",children:"Neighborhood (Optional)"}),e.jsx("p",{className:"field-info",children:"Enter the neighborhood name if known"}),e.jsx("input",{type:"text",id:"neighborhood",value:s.address.neighborhood,onChange:a=>W("neighborhood",a.target.value),placeholder:"e.g., Manhattan, Brooklyn, Queens"})]})]})]}),e.jsx("div",{className:"section-navigation",children:e.jsx("button",{type:"button",className:"btn-next",onClick:$,children:"Next"})})]})};async function $e(s){if(!s||s.trim().length===0)return console.warn("No ZIP code provided for neighborhood lookup"),null;try{const{data:t,error:n}=await X.rpc("get_neighborhood_by_zip",{zip_code:s});if(n)return console.error("Error fetching neighborhood data:",n),null;if(!t||t.length===0)return console.warn(`No neighborhood found for ZIP code: ${s}`),null;const h=t[0];return{neighborhood_name:h.Display||"",description:h["Neighborhood Description"]||"",zips:h.Zips||[]}}catch(t){return console.error("Unexpected error in getNeighborhoodByZipCode:",t),null}}async function qe(s,t){const n=await $e(s);if(n&&n.description)return console.log("[neighborhoodService] Found description in database"),{description:n.description,neighborhood_name:n.neighborhood_name,source:"database"};if(console.log("[neighborhoodService] No database match, generating via AI"),!t.fullAddress&&!t.city)return console.warn("[neighborhoodService] Insufficient address data for AI generation"),null;try{const h=await Pe(t);return h?{description:h,source:"ai"}:null}catch(h){return console.error("[neighborhoodService] AI generation failed:",h),null}}async function ge(s){if(!s||s.trim().length===0)return console.warn("No amenity type provided"),[];try{console.log("Fetching all amenities for type:",s);const{data:t,error:n}=await X.from("zat_features_amenity").select('Name, "Type - Amenity Categories"').eq('"Type - Amenity Categories"',s).eq("pending",!1).order("Name",{ascending:!0});if(n)return console.error("Error fetching amenities:",n),[];if(!t||t.length===0)return console.warn(`No amenities found for type: ${s}`),[];const h=t.map(d=>d.Name);return console.log(`Fetched ${h.length} amenities for type "${s}":`,h),h}catch(t){return console.error("Unexpected error in getAllAmenitiesByType:",t),[]}}async function We(){return ge("In Unit")}async function Ge(){return ge("In Building")}async function pe(s){if(!s||s.trim().length===0)return console.warn("No amenity type provided"),[];try{console.log("Fetching amenities for type:",s);const{data:t,error:n}=await X.from("zat_features_amenity").select('Name, "pre-set?", "Type - Amenity Categories"').eq('"pre-set?"',!0).eq('"Type - Amenity Categories"',s).order("Name",{ascending:!0});if(console.log("Supabase response:",{data:t,error:n}),n)return console.error("Error fetching common amenities:",n),[];if(!t||t.length===0)return console.warn(`No common amenities found for type: ${s}`),[];const h=t.map(d=>d.Name);return console.log("Fetched amenities:",h),h}catch(t){return console.error("Unexpected error in getCommonAmenitiesByType:",t),[]}}async function Ye(){return pe("In Unit")}async function ze(){return pe("In Building")}const He=({data:s,onChange:t,onNext:n,onBack:h,zipCode:d,showToast:u})=>{const[m,A]=r.useState({}),[k,p]=r.useState(!1),[P,R]=r.useState(!1),[L,o]=r.useState(!1),[S,j]=r.useState(!1),[U,W]=r.useState([]),[b,l]=r.useState([]),[N,$]=r.useState(!0);r.useEffect(()=>{(async()=>{$(!0);try{const[T,O]=await Promise.all([We(),Ge()]);W(T),l(O),console.log("[Section2Features] Loaded amenities from database:",{inUnit:T.length,building:O.length})}catch(T){console.error("[Section2Features] Error fetching amenities:",T)}finally{$(!1)}})()},[]);const v=r.useCallback(c=>{if(c.length===0)return;const T=c[0],O=document.getElementById(T);O&&(O.scrollIntoView({behavior:"smooth",block:"center"}),O.focus())},[]),_=(c,T)=>{if(t({...s,[c]:T}),m[c]){const O={...m};delete O[c],A(O)}},J=(c,T)=>{const O=T?"amenitiesInsideUnit":"amenitiesOutsideUnit",i=s[O],x=i.includes(c)?i.filter(I=>I!==c):[...i,c];_(O,x)},F=async()=>{R(!0);try{const c=await Ye();c.length>0?_("amenitiesInsideUnit",[...new Set([...s.amenitiesInsideUnit,...c])]):alert("No common in-unit amenities found in the database.")}catch(c){console.error("Error loading common in-unit amenities:",c),alert("Error loading common amenities. Please try again.")}finally{R(!1)}},w=async()=>{o(!0);try{const c=await ze();c.length>0?_("amenitiesOutsideUnit",[...new Set([...s.amenitiesOutsideUnit,...c])]):alert("No common building amenities found in the database.")}catch(c){console.error("Error loading common building amenities:",c),alert("Error loading common amenities. Please try again.")}finally{o(!1)}},y=async()=>{j(!0);try{const c=Le();if(!c){alert("Please complete Section 1 (Address) first to generate a description.");return}const T={...c,amenitiesInsideUnit:s.amenitiesInsideUnit,amenitiesOutsideUnit:s.amenitiesOutsideUnit};console.log("[Section2Features] Generating AI description with data:",T);const O=await Fe(T);O?(_("descriptionOfLodging",O),console.log("[Section2Features] âœ… AI description generated successfully")):alert("Could not generate description. Please try again.")}catch(c){console.error("[Section2Features] Error generating description:",c);const T=c instanceof Error?c.message:"Unknown error";alert(`Error generating description: ${T}`)}finally{j(!1)}},C=async()=>{var c,T,O,i,x,I;if(!d){alert("Please complete Section 1 (Address) first to load neighborhood template.");return}p(!0);try{const M=localStorage.getItem("selfListingDraft"),D=M?JSON.parse(M):null,E={fullAddress:((T=(c=D==null?void 0:D.spaceSnapshot)==null?void 0:c.address)==null?void 0:T.fullAddress)||"",city:((i=(O=D==null?void 0:D.spaceSnapshot)==null?void 0:O.address)==null?void 0:i.city)||"",state:((I=(x=D==null?void 0:D.spaceSnapshot)==null?void 0:x.address)==null?void 0:I.state)||"",zip:d},B=await qe(d,E);B&&B.description?(_("neighborhoodDescription",B.description),B.source==="ai"?console.log("[Section2Features] AI-generated neighborhood description loaded"):console.log(`[Section2Features] Database template loaded for ${B.neighborhood_name||"neighborhood"}`)):alert(`Could not find or generate neighborhood information for ZIP code: ${d}`)}catch(M){console.error("Error loading neighborhood template:",M),alert("Error loading neighborhood template. Please try again.")}finally{p(!1)}},a=()=>{const c={},T=[];return s.amenitiesInsideUnit.length===0&&(c.amenitiesInsideUnit="At least one amenity inside unit is required",T.push("amenitiesInsideUnit")),(!s.descriptionOfLodging||s.descriptionOfLodging.trim().length===0)&&(c.descriptionOfLodging="Description of lodging is required",T.push("descriptionOfLodging")),A(c),T},g=()=>{const c=a();c.length===0?n():(u({title:"Required Fields Missing",content:"Please complete all required fields before proceeding.",type:"warning",duration:5e3}),v(c))};return e.jsxs("div",{className:"section-container features-section",children:[e.jsx("h2",{className:"section-title",children:"Features"}),e.jsx("p",{className:"section-subtitle",children:"Describe your property's amenities and features"}),e.jsxs("div",{className:"features-two-column",children:[e.jsxs("div",{id:"amenitiesInsideUnit",className:"form-group",children:[e.jsxs("div",{className:"label-with-action",children:[e.jsxs("label",{children:["Amenities inside Unit",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("button",{type:"button",className:"btn-link",onClick:F,disabled:P||N,children:P?"loading...":"load common"})]}),m.amenitiesInsideUnit&&e.jsx("span",{className:"error-message",children:m.amenitiesInsideUnit}),e.jsx("div",{className:"checkbox-grid",children:N?e.jsx("span",{className:"loading-text",children:"Loading amenities..."}):U.length===0?e.jsx("span",{className:"empty-text",children:"No amenities available"}):U.map(c=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.amenitiesInsideUnit.includes(c),onChange:()=>J(c,!0)}),e.jsx("span",{children:c})]},c))})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"label-with-action",children:[e.jsx("label",{children:"Amenities outside Unit (Optional)"}),e.jsx("button",{type:"button",className:"btn-link",onClick:w,disabled:L||N,children:L?"loading...":"load common"})]}),e.jsx("div",{className:"checkbox-grid",children:N?e.jsx("span",{className:"loading-text",children:"Loading amenities..."}):b.length===0?e.jsx("span",{className:"empty-text",children:"No amenities available"}):b.map(c=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.amenitiesOutsideUnit.includes(c),onChange:()=>J(c,!1)}),e.jsx("span",{children:c})]},c))})]})]}),e.jsxs("div",{className:"features-two-column",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"label-with-action",children:[e.jsxs("label",{htmlFor:"descriptionOfLodging",children:["Description of Lodging",e.jsx("span",{className:"required",children:"*"})]}),e.jsx("button",{type:"button",className:"btn-link",onClick:y,disabled:S||k,children:S?"generating...":"load template"})]}),e.jsx("textarea",{id:"descriptionOfLodging",rows:8,placeholder:"Describe your space in detail...",value:s.descriptionOfLodging,onChange:c=>_("descriptionOfLodging",c.target.value),className:m.descriptionOfLodging?"input-error":""}),m.descriptionOfLodging&&e.jsx("span",{className:"error-message",children:m.descriptionOfLodging})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"label-with-action",children:[e.jsx("label",{htmlFor:"neighborhoodDescription",children:"Describe Life in the Neighborhood (Optional)"}),e.jsx("button",{type:"button",className:"btn-link",onClick:C,disabled:k||S,children:k?"loading/generating...":"load template"})]}),e.jsx("textarea",{id:"neighborhoodDescription",rows:8,placeholder:"Tell guests about the neighborhood...",value:s.neighborhoodDescription,onChange:c=>_("neighborhoodDescription",c.target.value)})]})]}),e.jsxs("div",{className:"section-navigation",children:[e.jsx("button",{type:"button",className:"btn-back",onClick:h,children:"Back"}),e.jsx("button",{type:"button",className:"btn-next",onClick:g,children:"Next"})]})]})},Ke=({data:s,onChange:t,onNext:n,onBack:h})=>{const[d,u]=r.useState({}),m=r.useCallback(l=>{if(l.length===0)return;const N=l[0],$=document.getElementById(N)||document.querySelector(`.${N.replace("Error","")}-config`);$&&$.scrollIntoView({behavior:"smooth",block:"center"})},[]),A=r.useMemo(()=>s.availableNights?le.filter(l=>s.availableNights[l.id]).map(l=>l.id):[],[s.availableNights]),k=r.useCallback(l=>({sunday:l.includes("sunday"),monday:l.includes("monday"),tuesday:l.includes("tuesday"),wednesday:l.includes("wednesday"),thursday:l.includes("thursday"),friday:l.includes("friday"),saturday:l.includes("saturday")}),[]),p=r.useCallback(l=>{t({...s,availableNights:k(l)})},[s,t,k]),P=l=>{const N={...s,rentalType:l},$={sunday:!0,monday:!0,tuesday:!0,wednesday:!0,thursday:!0,friday:!0,saturday:!0};l==="Nightly"?(N.availableNights=$,delete N.weeklyPattern,delete N.subsidyAgreement):l==="Weekly"?(N.availableNights=$,N.weeklyPattern="",delete N.subsidyAgreement):l==="Monthly"&&(N.availableNights=$,delete N.weeklyPattern),t(N),u({})},R=r.useCallback(()=>{const l=le.map(N=>N.id);p(l)},[p]),L=()=>A.length,o=()=>7-A.length,S=l=>{t({...s,weeklyPattern:l}),u({})},j=l=>{t({...s,subsidyAgreement:l}),u({})},U=()=>{const l={},N=[];return s.rentalType==="Weekly"&&!s.weeklyPattern&&(l.weeklyPattern="Please select a weekly pattern",N.push("weeklyPattern")),s.rentalType==="Monthly"&&!s.subsidyAgreement&&(l.subsidyAgreement="You must agree to the subsidy terms for monthly rentals",N.push("subsidyAgreement")),u(l),N},W=()=>{const l=U();l.length===0?n():m(l)},b=["One week on, one week off","Two weeks on, two weeks off","One week on, three weeks off"];return e.jsxs("div",{className:"section-container lease-styles-section",children:[e.jsx("h2",{className:"section-title",children:"Lease Styles"}),e.jsx("p",{className:"section-subtitle",children:"Choose your rental frequency"}),e.jsxs("div",{className:"rental-type-selector",children:[e.jsxs("div",{className:`rental-type-card ${s.rentalType==="Nightly"?"selected":""}`,onClick:()=>P("Nightly"),role:"button",tabIndex:0,children:[e.jsx("div",{className:"rental-type-icon",children:"ðŸŒ™"}),e.jsx("h3",{children:"Nightly"}),e.jsx("p",{children:"Rent by the night with flexible availability"})]}),e.jsxs("div",{className:`rental-type-card ${s.rentalType==="Weekly"?"selected":""}`,onClick:()=>P("Weekly"),role:"button",tabIndex:0,children:[e.jsx("div",{className:"rental-type-icon",children:"ðŸ“…"}),e.jsx("h3",{children:"Weekly"}),e.jsx("p",{children:"Rent in weekly patterns"})]}),e.jsxs("div",{className:`rental-type-card ${s.rentalType==="Monthly"?"selected":""}`,onClick:()=>P("Monthly"),role:"button",tabIndex:0,children:[e.jsx("div",{className:"rental-type-icon",children:"ðŸ“†"}),e.jsx("h3",{children:"Monthly"}),e.jsx("p",{children:"Traditional month-to-month rental"})]})]}),s.rentalType==="Nightly"&&s.availableNights&&e.jsxs("div",{className:"nightly-config",children:[e.jsx("h3",{children:"Select Available Nights"}),e.jsx("p",{children:"Choose which nights of the week you want to offer"}),e.jsx("div",{className:"host-schedule-selector-wrapper",children:e.jsx(Ie,{selectedNights:A,onSelectionChange:p,isClickable:!0,mode:"normal"})}),e.jsxs("div",{className:"nights-counter",children:[e.jsx("span",{children:L()===7?"Full-Nights of the week Availability":`${L()} Nights Available, ${o()} Nights Not Available`}),o()>0&&e.jsx("button",{type:"button",className:"btn-link",onClick:R,children:"select all nights"})]})]}),s.rentalType==="Weekly"&&e.jsxs("div",{className:"weekly-config",id:"weeklyPattern",children:[e.jsx("h3",{children:"Weekly Pattern You're Offering"}),e.jsx("p",{className:"info-text",children:"This pattern is independent of the beginning of the month"}),e.jsxs("select",{value:s.weeklyPattern||"",onChange:l=>S(l.target.value),className:d.weeklyPattern?"input-error":"",children:[e.jsx("option",{value:"",children:"Select a pattern"}),b.map(l=>e.jsx("option",{value:l,children:l},l))]}),d.weeklyPattern&&e.jsx("span",{className:"error-message",children:d.weeklyPattern})]}),s.rentalType==="Monthly"&&e.jsxs("div",{className:"monthly-config",id:"subsidyAgreement",children:[e.jsx("h3",{children:"Monthly Lease Agreement"}),e.jsx("div",{className:"agreement-text",children:e.jsx("p",{children:"Our Split Lease 'Monthly' model helps guests meet rent obligations through a subsidy. For financial stability, we may need to sublease unused nights. If this isn't ideal, our other models might be more fitting for you, as they don't require this provision."})}),e.jsxs("div",{className:"agreement-options",children:[e.jsxs("label",{className:`radio-label ${s.subsidyAgreement===!0?"selected":""}`,children:[e.jsx("input",{type:"radio",name:"subsidyAgreement",checked:s.subsidyAgreement===!0,onChange:()=>j(!0)}),e.jsx("span",{children:"I agree to the monthly subsidy terms"})]}),e.jsxs("label",{className:`radio-label ${s.subsidyAgreement===!1?"selected":""}`,children:[e.jsx("input",{type:"radio",name:"subsidyAgreement",checked:s.subsidyAgreement===!1,onChange:()=>j(!1)}),e.jsx("span",{children:"No, I will select a different rental style"})]})]}),d.subsidyAgreement&&e.jsx("span",{className:"error-message",children:d.subsidyAgreement})]}),e.jsxs("div",{className:"section-navigation",children:[e.jsx("button",{type:"button",className:"btn-back",onClick:h,children:"Back"}),e.jsx("button",{type:"button",className:"btn-next",onClick:W,children:"Next"})]})]})},Ve=({initialP1:s=100,initialDecay:t=.95,onPricesChange:n})=>{const h=Math.round((1-t)*100/.25)||20,[d,u]=r.useState(s),[m,A]=r.useState(Math.min(50,Math.max(0,h))),k=r.useRef([s,s,s,s,s,s,s]),p=r.useRef(n);r.useEffect(()=>{p.current=n},[n]);const P=7,R=.7,L=1,o=y=>y.toLocaleString(void 0,{style:"currency",currency:"USD",maximumFractionDigits:0}),S=y=>"$"+Math.round(y),j=y=>Math.ceil(y),U=(y,C,a)=>Math.max(C,Math.min(a,y)),W=r.useCallback((y,C)=>{if(y<=0||C>=y)return 1;const a=C/y,g=Math.pow(a,.25);return U(g,R,L)},[]),b=r.useCallback(()=>{const y=d*(1-m/100),C=W(d,y),a=[j(d)];for(let g=1;g<P;g++)a.push(j(a[g-1]*C));if(k.current=a,p.current){const g=a.map(c=>Math.round(c));p.current({p1:g[0],n1:g[0],n2:g[1],n3:g[2],n4:g[3],n5:g[4],n6:g[5],n7:g[6],decay:+C.toFixed(3),total:g.reduce((c,T)=>c+T,0)})}return{prices:a,decay:C}},[d,m,W]);r.useEffect(()=>{b()},[b]);const l=k.current,N=l[4],$=5*N,v=N,_=$*4,J=7*l[6],F=y=>{let C=parseFloat(y.target.value);(isNaN(C)||C<0)&&(C=0),u(C)},w=y=>{A(parseInt(y.target.value))};return e.jsxs("div",{className:"nightly-price-slider",children:[e.jsxs("div",{className:"control-group",style:{textAlign:"center"},children:[e.jsx("label",{className:"calc-label",style:{display:"block",marginBottom:"10px"},children:"Base Nightly Rate"}),e.jsxs("div",{className:"base-input-wrapper",children:[e.jsx("span",{className:"currency-symbol",children:"$"}),e.jsx("input",{type:"number",className:"base-input",value:d,onChange:F,min:"0",step:"1"})]})]}),e.jsxs("div",{className:"control-group",children:[e.jsxs("div",{className:"label-row",children:[e.jsx("span",{className:"calc-label",children:"Long Stay Discount"}),e.jsxs("span",{className:"value-display",children:[m,"%"]})]}),e.jsx("div",{className:"range-wrapper",children:e.jsx("input",{type:"range",min:"0",max:"50",value:m,onChange:w})}),e.jsxs("div",{className:"marks",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"25%"}),e.jsx("span",{children:"50%"})]}),e.jsxs("p",{className:"calc-hint",children:["Consecutive nights get progressively cheaper. A 5-night stay averages ",e.jsx("strong",{children:o(v)}),"/night."]})]}),e.jsxs("div",{className:"nights-display-wrapper",children:[e.jsx("div",{className:"nights-display-header",children:"Price per consecutive night"}),e.jsx("div",{className:"palette-container",children:e.jsx("div",{className:"palette-row",children:[1,2,3,4,5,6,7].map(y=>e.jsxs("div",{className:`palette-swatch n${y}`,children:[e.jsxs("span",{className:"swatch-number",children:["Night ",y]}),e.jsx("span",{className:"swatch-price",children:S(l[y-1])}),e.jsx("span",{className:"swatch-label",children:"per night"})]},y))})}),e.jsx("div",{className:"formula-row",children:l.map((y,C)=>{const g=(C+1)*y;return e.jsx("div",{className:"formula-item",children:S(g)},C)})}),e.jsxs("div",{className:"formula-total-row",children:[e.jsx("div",{className:"formula-total-label",children:"7-Night Total"}),e.jsx("div",{className:"formula-total",children:S(J)})]})]}),e.jsxs("div",{className:"summary-row",children:[e.jsxs("div",{className:"summary-item",children:[e.jsx("div",{className:"summary-label",children:"5-Night Total"}),e.jsx("div",{className:"summary-value",children:o($)})]}),e.jsxs("div",{className:"summary-item",children:[e.jsx("div",{className:"summary-label",children:"Est. Monthly (4 weeks)"}),e.jsx("div",{className:"summary-value",children:o(_)})]})]}),e.jsxs("details",{className:"pricing-details",children:[e.jsx("summary",{children:"How does Smart Pricing work?"}),e.jsxs("div",{className:"details-content",children:['We calculate a "decay curve" for your pricing. The first night is your full Base Rate. Each consecutive night gets slightly cheaper based on your Discount setting.',e.jsx("br",{}),e.jsx("br",{}),"This encourages guests to book longer blocks (like Mon-Fri) instead of just two nights, maximizing your occupancy and reducing turnover effort."]})]})]})},Je=({data:s,rentalType:t,onChange:n,onNext:h,onBack:d})=>{var R,L;const[u,m]=r.useState({}),A=r.useCallback(o=>{if(o.length===0)return;const S=o[0],j=document.getElementById(S);j&&(j.scrollIntoView({behavior:"smooth",block:"center"}),j.focus())},[]),k=(o,S)=>{if(n({...s,[o]:S}),u[o]){const j={...u};delete j[o],m(j)}},p=()=>{const o={},S=[];return t==="Monthly"?(!s.monthlyCompensation||s.monthlyCompensation<=0)&&(o.monthlyCompensation="Monthly compensation is required",S.push("monthlyCompensation")):t==="Weekly"?(!s.weeklyCompensation||s.weeklyCompensation<=0)&&(o.weeklyCompensation="Weekly compensation is required",S.push("weeklyCompensation")):t==="Nightly"&&(!s.nightlyPricing||s.nightlyPricing.oneNightPrice<=0)&&(o.nightlyPricing="1-night price is required",S.push("nightlyPricing")),s.damageDeposit<500&&(o.damageDeposit="Damage deposit must be at least $500",S.push("damageDeposit")),m(o),S},P=()=>{const o=p();o.length===0?h():A(o)};return e.jsxs("div",{className:"section-container pricing-section",children:[e.jsx("h2",{className:"section-title",children:"Pricing"}),e.jsx("p",{className:"section-subtitle",children:"Set your rental rates and fees"}),t==="Nightly"&&e.jsxs("div",{className:"nightly-pricing",id:"nightlyPricing",children:[e.jsx("p",{className:"pricing-description",style:{color:"#6b7280",fontSize:"0.9rem",marginBottom:"20px"},children:"Set your base rate. Longer stays get automatic discounts to encourage bookings."}),e.jsx(Ve,{initialP1:((R=s.nightlyPricing)==null?void 0:R.oneNightPrice)||99,initialDecay:((L=s.nightlyPricing)==null?void 0:L.decayPerNight)||.956,onPricesChange:o=>{const S={oneNightPrice:o.p1,decayPerNight:o.decay,fiveNightTotal:o.n1+o.n2+o.n3+o.n4+o.n5,calculatedRates:{night1:o.n1,night2:o.n2,night3:o.n3,night4:o.n4,night5:o.n5,night6:o.n6,night7:o.n7,cumulativeNight2:o.n1+o.n2,cumulativeNight3:o.n1+o.n2+o.n3,cumulativeNight4:o.n1+o.n2+o.n3+o.n4,cumulativeNight5:o.n1+o.n2+o.n3+o.n4+o.n5,cumulativeNight6:o.n1+o.n2+o.n3+o.n4+o.n5+o.n6,cumulativeNight7:o.n1+o.n2+o.n3+o.n4+o.n5+o.n6+o.n7}};n({...s,nightlyPricing:S})}}),u.nightlyPricing&&e.jsx("span",{className:"error-message",children:u.nightlyPricing})]}),t==="Weekly"&&e.jsx("div",{className:"weekly-pricing",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"weeklyCompensation",children:["Weekly Compensation",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("div",{className:"price-input-group",children:[e.jsx("span",{className:"currency-symbol",children:"$"}),e.jsx("input",{type:"number",id:"weeklyCompensation",placeholder:"600 (example)",value:s.weeklyCompensation||"",onChange:o=>k("weeklyCompensation",parseInt(o.target.value)||0),className:u.weeklyCompensation?"input-error":""})]}),u.weeklyCompensation&&e.jsx("span",{className:"error-message",children:u.weeklyCompensation})]})}),t==="Monthly"&&e.jsx("div",{className:"monthly-pricing",children:e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"monthlyCompensation",children:["Monthly Compensation",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("div",{className:"price-input-group",children:[e.jsx("span",{className:"currency-symbol",children:"$"}),e.jsx("input",{type:"number",id:"monthlyCompensation",placeholder:"1850 (example)",value:s.monthlyCompensation||"",onChange:o=>k("monthlyCompensation",parseInt(o.target.value)||0),className:u.monthlyCompensation?"input-error":""})]}),u.monthlyCompensation&&e.jsx("span",{className:"error-message",children:u.monthlyCompensation})]})}),e.jsxs("div",{className:"common-pricing-fields",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"damageDeposit",children:["Damage Deposit",e.jsx("span",{className:"required",children:"*"}),e.jsx("span",{className:"field-note",children:" (minimum $500)"})]}),e.jsxs("div",{className:"price-input-group",children:[e.jsx("span",{className:"currency-symbol",children:"$"}),e.jsx("input",{type:"number",id:"damageDeposit",min:"500",value:s.damageDeposit,onChange:o=>k("damageDeposit",parseInt(o.target.value)||500),className:u.damageDeposit?"input-error":""})]}),u.damageDeposit&&e.jsx("span",{className:"error-message",children:u.damageDeposit})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"maintenanceFee",children:"Monthly Maintenance/Cleaning Fee (Optional)"}),e.jsxs("div",{className:"price-input-group",children:[e.jsx("span",{className:"currency-symbol",children:"$"}),e.jsx("input",{type:"number",id:"maintenanceFee",min:"0",placeholder:"0",value:s.maintenanceFee,onChange:o=>k("maintenanceFee",parseInt(o.target.value)||0)})]}),e.jsx("small",{className:"field-hint",children:"This fee will be charged monthly"})]})]}),e.jsxs("div",{className:"section-navigation",children:[e.jsx("button",{type:"button",className:"btn-back",onClick:d,children:"Back"}),e.jsx("button",{type:"button",className:"btn-next",onClick:P,children:"Next"})]})]})},Ze=["Smoke Detector","Carbon Monoxide Detector","Fire Extinguisher","First Aid Kit","Fire Sprinklers","Lock on Bedroom Door"],Qe=["Clear Common Areas","Conserve Water","Don't Move Furniture","Flush Toilet Paper ONLY","Lock Doors","Maximum Occupancy","No Access On Off Days","No Candles","No Drinking","No Drugs","No Entertaining","No Food in Bedroom","No Guests","No Overnight Guests","No Package Delivery","No Parties","No Pets","No Shoes Inside","No Smoking Inside","No Smoking Outside","Quiet Hours","Not Suitable for Children","Off Limit Areas","Recycle","Take Out Trash","Wash Your Dishes","Respect Neighbors","No Loud Music","Clean Up After Yourself","Turn Off Lights"],re={spaceSnapshot:{listingName:"",typeOfSpace:"",bedrooms:2,typeOfKitchen:"",beds:2,typeOfParking:"",bathrooms:2.5,address:{fullAddress:"",number:"",street:"",city:"",state:"",zip:"",neighborhood:"",validated:!1}},features:{amenitiesInsideUnit:[],amenitiesOutsideUnit:[],descriptionOfLodging:"",neighborhoodDescription:""},leaseStyles:{rentalType:"Monthly",subsidyAgreement:!1},pricing:{damageDeposit:500,maintenanceFee:0},rules:{cancellationPolicy:"",preferredGender:"No Preference",numberOfGuests:2,checkInTime:"2:00 PM",checkOutTime:"11:00 AM",idealMinDuration:6,idealMaxDuration:52,houseRules:[],blockedDates:[]},photos:{photos:[],minRequired:3},review:{agreedToTerms:!1,safetyFeatures:[],squareFootage:void 0,firstDayAvailable:"",previousReviewsLink:""},currentSection:1,completedSections:[],isDraft:!0,isSubmitted:!1},Xe=({data:s,rentalType:t,onChange:n,onNext:h,onBack:d,showToast:u})=>{const[m,A]=r.useState({}),[k,p]=r.useState(null),[P,R]=r.useState(new Date),[L,o]=r.useState("individual"),S=r.useCallback(i=>{if(i.length===0)return;const x=i[0],I=document.getElementById(x);I&&(I.scrollIntoView({behavior:"smooth",block:"center"}),I.focus())},[]),j=(i,x)=>{if(n({...s,[i]:x}),m[i]){const I={...m};delete I[i],A(I)}},U=i=>{if(!s.houseRules.includes(i)&&s.houseRules.length>=12){u({title:"Maximum reached",content:"You can select up to 12 house rules",type:"info"});return}const x=s.houseRules.includes(i)?s.houseRules.filter(I=>I!==i):[...s.houseRules,i];j("houseRules",x)},W=()=>{const i=["No Parties","No Smoking Inside","Quiet Hours","Wash Your Dishes","Lock Doors"];j("houseRules",[...new Set([...s.houseRules,...i])])},b=i=>{const x=s.blockedDates.filter(I=>I.toDateString()!==i.toDateString());j("blockedDates",x)},l=i=>{const x=i.toDateString();if(s.blockedDates.some(M=>M.toDateString()===x)){const M=s.blockedDates.filter(D=>D.toDateString()!==x);j("blockedDates",M)}else j("blockedDates",[...s.blockedDates,i])},N=i=>{const x=i.filter(I=>!s.blockedDates.some(M=>M.toDateString()===I.toDateString()));j("blockedDates",[...s.blockedDates,...x])},$=(i,x)=>{const I=[];let M=new Date(i),D=new Date(x);if(M>D){const B=M;M=D,D=B}const E=new Date(M);for(;E<=D;)I.push(new Date(E)),E.setDate(E.getDate()+1);return I},v=i=>{if(L==="individual")l(i);else if(!k)p(i);else{const x=$(k,i);N(x),p(null)}},_=()=>{const i=P.getFullYear(),x=P.getMonth(),I=new Date(i,x,1),D=new Date(i,x+1,0).getDate(),E=I.getDay(),B=[];for(let K=0;K<E;K++)B.push(null);for(let K=1;K<=D;K++)B.push(new Date(i,x,K));return B},J=()=>{R(new Date(P.getFullYear(),P.getMonth()-1,1))},F=()=>{R(new Date(P.getFullYear(),P.getMonth()+1,1))},w=i=>{o(i),p(null)},y=i=>s.blockedDates.some(x=>x.toDateString()===i.toDateString()),C=()=>{const i={},x=[];return s.cancellationPolicy||(i.cancellationPolicy="Cancellation policy is required",x.push("cancellationPolicy")),s.idealMinDuration<6&&(i.idealMinDuration="Minimum duration must be at least 6 weeks",x.push("idealMinDuration")),s.idealMaxDuration>52&&(i.idealMaxDuration="Maximum duration cannot exceed 52 weeks",x.push("idealMaxDuration")),s.idealMinDuration>s.idealMaxDuration&&(i.idealMaxDuration="Maximum duration must be greater than or equal to minimum",x.includes("idealMaxDuration")||x.push("idealMaxDuration")),A(i),x},a=()=>{const i=C();i.length===0?h():S(i)},g=["1:00 PM","1:30 PM","2:00 PM","2:30 PM","3:00 PM","3:30 PM","4:00 PM"],c=["10:00 AM","10:30 AM","11:00 AM","11:30 AM","12:00 PM","12:30 PM","1:00 PM"],O=t==="Monthly"?"months":"weeks";return e.jsxs("div",{className:"section-container rules-section",children:[e.jsx("h2",{className:"section-title",children:"Rules"}),e.jsx("p",{className:"section-subtitle",children:"Set house rules and preferences"}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"cancellationPolicy",children:["Cancellation Policy",e.jsx("span",{className:"required",children:"*"})]}),e.jsxs("select",{id:"cancellationPolicy",value:s.cancellationPolicy,onChange:i=>j("cancellationPolicy",i.target.value),className:m.cancellationPolicy?"input-error":"",children:[e.jsx("option",{value:"",children:"Choose an optionâ€¦"}),e.jsx("option",{value:"Standard",children:"Standard"}),e.jsx("option",{value:"Additional Host Restrictions",children:"Additional Host Restrictions"})]}),m.cancellationPolicy&&e.jsx("span",{className:"error-message",children:m.cancellationPolicy}),e.jsx("a",{href:"https://www.split.lease/policies#cancellation-and-refund-policy",target:"_blank",rel:"noopener noreferrer",className:"btn-link",children:"Review Standard Policy"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"preferredGender",children:"Preferred Gender"}),e.jsxs("select",{id:"preferredGender",value:s.preferredGender,onChange:i=>j("preferredGender",i.target.value),children:[e.jsx("option",{value:"No Preference",children:"No Preference"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Other/Non Defined",children:"Other/Non Defined"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"numberOfGuests",children:"# of Guests"}),e.jsx("select",{id:"numberOfGuests",value:s.numberOfGuests,onChange:i=>j("numberOfGuests",parseInt(i.target.value)),children:[1,2,3,4,5,6].map(i=>e.jsx("option",{value:i,children:i},i))})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"checkInTime",children:"Check In Time"}),e.jsx("select",{id:"checkInTime",value:s.checkInTime,onChange:i=>j("checkInTime",i.target.value),children:g.map(i=>e.jsx("option",{value:i,children:i},i))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"checkOutTime",children:"Check Out Time"}),e.jsx("select",{id:"checkOutTime",value:s.checkOutTime,onChange:i=>j("checkOutTime",i.target.value),children:c.map(i=>e.jsx("option",{value:i,children:i},i))})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"idealMinDuration",children:["Ideal rental duration (min ",O,")",e.jsx("span",{className:"field-note",children:" (minimum 6 weeks)"})]}),e.jsx("input",{type:"number",id:"idealMinDuration",min:"6",max:"52",value:s.idealMinDuration,onChange:i=>j("idealMinDuration",parseInt(i.target.value)||6),className:m.idealMinDuration?"input-error":""}),m.idealMinDuration&&e.jsx("span",{className:"error-message",children:m.idealMinDuration})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"idealMaxDuration",children:["Ideal rental duration (max ",O,")",e.jsx("span",{className:"field-note",children:" (maximum 52 weeks)"})]}),e.jsx("input",{type:"number",id:"idealMaxDuration",min:"6",max:"52",value:s.idealMaxDuration,onChange:i=>j("idealMaxDuration",parseInt(i.target.value)||52),className:m.idealMaxDuration?"input-error":""}),m.idealMaxDuration&&e.jsx("span",{className:"error-message",children:m.idealMaxDuration})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"label-with-action",children:[e.jsx("label",{children:"House Rules"}),e.jsx("button",{type:"button",className:"btn-link",onClick:W,children:"load common house rules"})]}),e.jsx("div",{className:"checkbox-grid",children:Qe.map(i=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:s.houseRules.includes(i),onChange:()=>U(i)}),e.jsx("span",{children:i})]},i))})]}),e.jsxs("div",{className:"form-group block-dates-section",children:[e.jsx("label",{className:"block-dates-label",children:"Block Dates"}),e.jsxs("div",{className:"availability-calendar-container",children:[e.jsxs("div",{className:"availability-instructions",children:[e.jsx("p",{className:"availability-description",children:"Add or remove blocked dates by selecting a range or individual days."}),e.jsxs("div",{className:"availability-mode-toggle",children:[e.jsxs("label",{className:"availability-mode-option",children:[e.jsx("input",{type:"radio",name:"selectionMode",checked:L==="range",onChange:()=>w("range")}),e.jsx("span",{children:"Range"})]}),e.jsxs("label",{className:"availability-mode-option",children:[e.jsx("input",{type:"radio",name:"selectionMode",checked:L==="individual",onChange:()=>w("individual")}),e.jsx("span",{children:"Individual dates"})]})]}),k&&L==="range"&&e.jsxs("p",{className:"availability-range-hint",children:["Range start selected: ",k.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}),". Click another date to complete the range."]}),e.jsxs("div",{className:"availability-blocked-info",children:[e.jsx("p",{className:"availability-blocked-title",children:e.jsx("strong",{children:"Dates Blocked by You"})}),s.blockedDates.length>0?e.jsxs("div",{className:"availability-blocked-list",children:[s.blockedDates.slice(0,10).map((i,x)=>e.jsxs("span",{className:"availability-blocked-date",children:[i.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),e.jsx("button",{type:"button",className:"availability-remove-date",onClick:()=>b(i),title:"Remove blocked date",children:"Ã—"})]},x)),s.blockedDates.length>10&&e.jsxs("span",{className:"availability-more-dates",children:["+",s.blockedDates.length-10," more dates"]})]}):e.jsx("p",{className:"availability-no-blocked",children:"You don't have any future date blocked yet"})]})]}),e.jsxs("div",{className:"availability-calendar",children:[e.jsxs("div",{className:"month-navigation",children:[e.jsx("button",{type:"button",onClick:J,className:"nav-btn",children:"â€¹"}),e.jsx("span",{className:"current-month",children:P.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{type:"button",onClick:F,className:"nav-btn",children:"â€º"})]}),e.jsxs("div",{className:"calendar-day-headers",children:[e.jsx("div",{children:"Sun"}),e.jsx("div",{children:"Mon"}),e.jsx("div",{children:"Tue"}),e.jsx("div",{children:"Wed"}),e.jsx("div",{children:"Thu"}),e.jsx("div",{children:"Fri"}),e.jsx("div",{children:"Sat"})]}),e.jsx("div",{className:"calendar-grid",children:_().map((i,x)=>{if(!i)return e.jsx("div",{className:"calendar-day empty"},x);const I=y(i),M=i<new Date(new Date().setHours(0,0,0,0)),D=L==="range"&&k&&i.toDateString()===k.toDateString(),E=!M;return e.jsx("div",{className:`calendar-day ${I?"blocked":""} ${M?"past":""} ${D?"range-start":""} ${E?"selectable":""}`,onClick:()=>E&&v(i),role:E?"button":void 0,tabIndex:E?0:void 0,onKeyDown:B=>{E&&(B.key==="Enter"||B.key===" ")&&(B.preventDefault(),v(i))},children:String(i.getDate()).padStart(2,"0")},x)})}),e.jsxs("div",{className:"calendar-legend",children:[e.jsxs("div",{className:"calendar-legend__item",children:[e.jsx("span",{className:"calendar-legend__dot calendar-legend__dot--restricted"}),e.jsx("span",{children:"Restricted Weekly"})]}),e.jsxs("div",{className:"calendar-legend__item",children:[e.jsx("span",{className:"calendar-legend__dot calendar-legend__dot--blocked"}),e.jsx("span",{children:"Blocked Manually"})]}),e.jsxs("div",{className:"calendar-legend__item",children:[e.jsx("span",{className:"calendar-legend__dot calendar-legend__dot--available"}),e.jsx("span",{children:"Available"})]}),e.jsxs("div",{className:"calendar-legend__item",children:[e.jsx("span",{className:"calendar-legend__dot calendar-legend__dot--first"}),e.jsx("span",{children:"First Available"})]})]})]})]})]}),e.jsxs("div",{className:"section-navigation",children:[e.jsx("button",{type:"button",className:"btn-back",onClick:d,children:"Back"}),e.jsx("button",{type:"button",className:"btn-next",onClick:a,children:"Next"})]})]})},he="listing-photos",me="selfListingDraftId";async function es(){let s=localStorage.getItem(me);if(s)return s;const{data:t,error:n}=await X.rpc("generate_bubble_id");return n||!t?s=`draft_${Date.now()}_${Math.random().toString(36).substr(2,9)}`:s=t,localStorage.setItem(me,s),s}async function ss(s,t,n){var p;const h=((p=s.name.split(".").pop())==null?void 0:p.toLowerCase())||"jpg",d=Date.now(),u=`${n}_${d}.${h}`,m=`listings/${t}/${u}`,{error:A}=await X.storage.from(he).upload(m,s,{cacheControl:"3600",upsert:!1,contentType:s.type||`image/${h}`});if(A)throw new Error(`Upload failed: ${A.message}`);const{data:k}=X.storage.from(he).getPublicUrl(m);return{url:k.publicUrl,storagePath:m}}const ts=({data:s,onChange:t,onNext:n,onBack:h})=>{const[d,u]=r.useState({}),[m,A]=r.useState(0),k=r.useRef(null),[p,P]=r.useState(null),[R,L]=r.useState(null),o=r.useCallback(F=>{if(F.length===0)return;const w=F[0],y=document.getElementById(w)||document.querySelector(".upload-area");y&&y.scrollIntoView({behavior:"smooth",block:"center"})},[]),S=async F=>{const w=F.target.files;if(!w||w.length===0)return;const y=Array.from(w).filter(g=>g.type.startsWith("image/"));if(y.length===0)return;const C=5*1024*1024,a=y.filter(g=>g.size>C);if(a.length>0){u({photos:`${a.length} file(s) exceed the 5MB size limit. Please resize and try again.`});return}u({}),A(y.length);try{const g=await es(),c=s.photos.length,T=[],O=y.map(async(M,D)=>{const E=c+D;try{const{url:B,storagePath:K}=await ss(M,g,E);return{id:`photo-${Date.now()}-${D}`,url:B,storagePath:K,displayOrder:E,isUploading:!1}}catch(B){return console.error(`Failed to upload photo ${D+1}:`,B),{id:`photo-${Date.now()}-${D}`,url:"",displayOrder:E,isUploading:!1,uploadError:B instanceof Error?B.message:"Upload failed"}}}),i=await Promise.all(O),x=i.filter(M=>M.url&&!M.uploadError),I=i.length-x.length;I>0&&u({photos:`${I} photo(s) failed to upload. Please try again.`}),x.length>0&&t({...s,photos:[...s.photos,...x]})}catch(g){console.error("Photo upload error:",g),u({photos:"Failed to upload photos. Please try again."})}finally{A(0),k.current&&(k.current.value="")}},j=async F=>{const w=s.photos.find(C=>C.id===F);if(w!=null&&w.storagePath)try{await Te(w.storagePath),console.log("[Section6Photos] Deleted photo from storage:",w.storagePath)}catch(C){console.error("[Section6Photos] Failed to delete from storage:",C)}const y=s.photos.filter(C=>C.id!==F);y.forEach((C,a)=>{C.displayOrder=a}),t({...s,photos:y})},U=F=>{P(F)},W=(F,w)=>{F.preventDefault(),L(w)},b=()=>{L(null)},l=(F,w)=>{if(F.preventDefault(),p===null||p===w){P(null),L(null);return}const y=[...s.photos],[C]=y.splice(p,1);y.splice(w,0,C),y.forEach((a,g)=>{a.displayOrder=g}),t({...s,photos:y}),P(null),L(null)},N=()=>{P(null),L(null)},$=()=>{const F={},w=[];return s.photos.length<s.minRequired&&(F.photos=`Please upload at least ${s.minRequired} photos`,w.push("photos")),u(F),w},v=()=>{if(m>0)return;const F=$();if(F.length>0){o(F);return}n()},_=m>0,J=()=>{alert("Mobile upload feature would open here with a QR code or deep link")};return e.jsxs("div",{className:"section-container photos-section",children:[e.jsx("h2",{className:"section-title",children:"Photos"}),e.jsxs("p",{className:"section-subtitle",children:["Add photos of your property (minimum ",s.minRequired," required)"]}),e.jsxs("div",{className:"upload-area",children:[e.jsx("input",{ref:k,type:"file",accept:"image/*",multiple:!0,onChange:S,disabled:_,style:{display:"none"}}),e.jsxs("div",{style:{display:"flex",gap:"16px",flexWrap:"wrap",alignItems:"stretch"},children:[e.jsx("button",{type:"button",className:"btn-upload",onClick:()=>{var F;return(F=k.current)==null?void 0:F.click()},disabled:_,children:_?`Uploading ${m} photo(s)...`:"Upload Photos"}),e.jsx("button",{type:"button",className:"btn-secondary",onClick:J,disabled:_,children:"Do you want to continue on mobile?"})]}),_&&e.jsx("div",{className:"upload-progress-indicator",style:{marginTop:"12px",color:"#5B21B6"},children:"Uploading photos to server..."}),d.photos&&e.jsx("div",{className:"error-message",children:d.photos}),e.jsxs("p",{className:"upload-info",children:["Please submit at least ",s.minRequired," photos. Supported formats: JPG, PNG, HEIC. Max 5MB per photo."]})]}),s.photos.length>0&&e.jsxs("div",{className:"photo-gallery",children:[e.jsxs("h3",{children:["Uploaded Photos (",s.photos.length,")"]}),e.jsx("p",{className:"drag-drop-hint",children:"ðŸ’¡ Drag and drop photos to reorder. First photo is the cover photo."}),e.jsx("div",{className:"photo-grid",children:s.photos.map((F,w)=>e.jsxs("div",{className:`photo-item ${p===w?"dragging":""} ${R===w?"drag-over":""}`,draggable:!0,onDragStart:()=>U(w),onDragOver:y=>W(y,w),onDragLeave:b,onDrop:y=>l(y,w),onDragEnd:N,children:[e.jsx("img",{src:F.url,alt:`Property photo ${w+1}`}),e.jsx("div",{className:"photo-controls",children:e.jsx("button",{type:"button",onClick:()=>j(F.id),className:"btn-delete",title:"Remove photo",children:"ðŸ—‘ï¸"})}),w===0&&e.jsx("div",{className:"photo-badge",children:"Cover Photo"})]},F.id))})]}),e.jsxs("div",{className:"photo-progress",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${Math.min(100,s.photos.length/s.minRequired*100)}%`}})}),e.jsxs("p",{children:[s.photos.length," of ",s.minRequired," minimum photos uploaded",s.photos.length>=s.minRequired&&" âœ“"]})]}),e.jsxs("div",{className:"section-navigation",children:[e.jsx("button",{type:"button",className:"btn-back",onClick:h,disabled:_,children:"Back"}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("button",{type:"button",className:"btn-skip",onClick:n,disabled:_,children:"Skip for Now"}),e.jsx("button",{type:"button",className:"btn-next",onClick:v,disabled:s.photos.length<s.minRequired||_,children:_?"Uploading...":"Next"})]})]})]})};async function ns(){try{console.log("[safetyService] Fetching common safety features...");const{data:s,error:t}=await X.schema("reference_table").from("zat_features_safetyfeature").select('Name, "pre-set?"').eq('"pre-set?"',!0).order("Name",{ascending:!0});if(t)return console.error("[safetyService] Error fetching common safety features:",t),[];if(!s||s.length===0)return console.warn("[safetyService] No common safety features found"),[];const n=s.map(h=>h.Name);return console.log("[safetyService] Fetched common safety features:",n),n}catch(s){return console.error("[safetyService] Unexpected error:",s),[]}}const is=({formData:s,reviewData:t,onChange:n,onSubmit:h,onBack:d,onNavigateToSection:u,isSubmitting:m})=>{const[A,k]=r.useState({}),[p,P]=r.useState({}),[R,L]=r.useState(!1),o=async()=>{L(!0);try{const b=await ns();b.length>0&&j("safetyFeatures",b)}catch(b){console.error("Failed to load common safety features:",b)}finally{L(!1)}},S=b=>{P(l=>({...l,[b]:!l[b]}))},j=(b,l)=>{if(n({...t,[b]:l}),A[b]){const N={...A};delete N[b],k(N)}},U=b=>{const l=t.safetyFeatures||[],N=l.includes(b)?l.filter($=>$!==b):[...l,b];j("safetyFeatures",N)},W=()=>{h()};return e.jsxs("div",{className:"section-container review-section",children:[e.jsx("h2",{className:"section-title",children:"Review & Submit"}),e.jsx("p",{className:"section-subtitle",children:"Review your listing details before submitting"}),e.jsxs("div",{className:"optional-details-section",children:[e.jsx("h3",{className:"optional-section-title",children:"Additional Details (Optional)"}),e.jsx("p",{className:"optional-section-subtitle",children:"Provide extra information to make your listing stand out"}),e.jsxs("div",{className:"optional-fields-grid",children:[e.jsxs("div",{className:"optional-field-column",children:[e.jsxs("div",{className:"form-group",children:[e.jsxs("div",{className:"label-with-action",children:[e.jsx("label",{children:"Safety Features"}),e.jsx("button",{type:"button",className:"btn-link load-common-btn",onClick:o,disabled:R,children:R?"loading...":"load common"})]}),e.jsx("p",{className:"field-hint",children:"Select safety features available at your property"}),e.jsx("div",{className:"checkbox-grid",children:Ze.map(b=>e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:(t.safetyFeatures||[]).includes(b),onChange:()=>U(b)}),e.jsx("span",{children:b})]},b))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"squareFootage",children:s.spaceSnapshot.typeOfSpace==="Entire Place"?"Square Footage (Entire Place)":"Square Footage (Room)"}),e.jsx("p",{className:"field-hint",children:"Approximate size in square feet"}),e.jsx("input",{id:"squareFootage",type:"number",min:"0",placeholder:"e.g., 500",value:t.squareFootage||"",onChange:b=>j("squareFootage",b.target.value?Number(b.target.value):void 0)})]})]}),e.jsxs("div",{className:"optional-field-column",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"firstDayAvailable",children:"First Day Available"}),e.jsx("p",{className:"field-hint",children:"When can guests start booking?"}),e.jsx("input",{id:"firstDayAvailable",type:"date",value:t.firstDayAvailable||"",onChange:b=>j("firstDayAvailable",b.target.value),min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"previousReviewsLink",children:"Import Previous Reviews"}),e.jsx("p",{className:"field-hint",children:"Link to your reviews from Airbnb, VRBO, or other platforms"}),e.jsx("input",{id:"previousReviewsLink",type:"url",placeholder:"https://www.airbnb.com/users/show/...",value:t.previousReviewsLink||"",onChange:b=>j("previousReviewsLink",b.target.value)})]})]})]})]}),e.jsxs("div",{className:"review-summary",children:[e.jsxs("div",{className:`summary-card collapsible ${p.space?"expanded":""}`,children:[e.jsxs("div",{className:"summary-card-header",onClick:()=>S("space"),children:[e.jsx("h3",{children:"ðŸ“ Space Details"}),e.jsxs("div",{className:"summary-card-header-right",children:[e.jsxs("span",{className:"summary-brief",children:[s.spaceSnapshot.typeOfSpace," in ",s.spaceSnapshot.address.city||"NYC"]}),e.jsx("span",{className:"expand-icon",children:p.space?"â–¼":"â–¶"})]})]}),p.space&&e.jsxs("div",{className:"summary-content",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Listing Name:"})," ",s.spaceSnapshot.listingName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Type:"})," ",s.spaceSnapshot.typeOfSpace]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Bedrooms:"})," ",s.spaceSnapshot.bedrooms]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Bathrooms:"})," ",s.spaceSnapshot.bathrooms]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Address:"})," ",s.spaceSnapshot.address.fullAddress]}),e.jsx("button",{type:"button",className:"btn-link",onClick:()=>u==null?void 0:u(1),children:"Edit Section"})]})]}),e.jsxs("div",{className:`summary-card collapsible ${p.features?"expanded":""}`,children:[e.jsxs("div",{className:"summary-card-header",onClick:()=>S("features"),children:[e.jsx("h3",{children:"âœ¨ Features"}),e.jsxs("div",{className:"summary-card-header-right",children:[e.jsxs("span",{className:"summary-brief",children:[s.features.amenitiesInsideUnit.length+s.features.amenitiesOutsideUnit.length," amenities"]}),e.jsx("span",{className:"expand-icon",children:p.features?"â–¼":"â–¶"})]})]}),p.features&&e.jsxs("div",{className:"summary-content",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Amenities Inside:"})," ",s.features.amenitiesInsideUnit.length," selected"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amenities Outside:"})," ",s.features.amenitiesOutsideUnit.length," selected"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",s.features.descriptionOfLodging.substring(0,100),"..."]}),e.jsx("button",{type:"button",className:"btn-link",onClick:()=>u==null?void 0:u(2),children:"Edit Section"})]})]}),e.jsxs("div",{className:`summary-card collapsible ${p.lease?"expanded":""}`,children:[e.jsxs("div",{className:"summary-card-header",onClick:()=>S("lease"),children:[e.jsx("h3",{children:"ðŸ“… Lease Style"}),e.jsxs("div",{className:"summary-card-header-right",children:[e.jsxs("span",{className:"summary-brief",children:[s.leaseStyles.rentalType," rental"]}),e.jsx("span",{className:"expand-icon",children:p.lease?"â–¼":"â–¶"})]})]}),p.lease&&e.jsxs("div",{className:"summary-content",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Rental Type:"})," ",s.leaseStyles.rentalType]}),s.leaseStyles.rentalType==="Nightly"&&s.leaseStyles.availableNights&&e.jsxs("p",{children:[e.jsx("strong",{children:"Available Nights:"})," ",Object.values(s.leaseStyles.availableNights).filter(Boolean).length," nights per week"]}),s.leaseStyles.rentalType==="Weekly"&&e.jsxs("p",{children:[e.jsx("strong",{children:"Pattern:"})," ",s.leaseStyles.weeklyPattern]}),s.leaseStyles.rentalType==="Monthly"&&e.jsxs("p",{children:[e.jsx("strong",{children:"Subsidy Agreement:"})," ",s.leaseStyles.subsidyAgreement?"Agreed":"Not agreed"]}),e.jsx("button",{type:"button",className:"btn-link",onClick:()=>u==null?void 0:u(3),children:"Edit Section"})]})]}),e.jsxs("div",{className:`summary-card collapsible ${p.pricing?"expanded":""}`,children:[e.jsxs("div",{className:"summary-card-header",onClick:()=>S("pricing"),children:[e.jsx("h3",{children:"ðŸ’° Pricing"}),e.jsxs("div",{className:"summary-card-header-right",children:[e.jsxs("span",{className:"summary-brief",children:[s.leaseStyles.rentalType==="Monthly"&&`$${s.pricing.monthlyCompensation}/mo`,s.leaseStyles.rentalType==="Weekly"&&`$${s.pricing.weeklyCompensation}/wk`,s.leaseStyles.rentalType==="Nightly"&&s.pricing.nightlyPricing&&`$${s.pricing.nightlyPricing.oneNightPrice}/night`]}),e.jsx("span",{className:"expand-icon",children:p.pricing?"â–¼":"â–¶"})]})]}),p.pricing&&e.jsxs("div",{className:"summary-content",children:[s.leaseStyles.rentalType==="Monthly"&&e.jsxs("p",{children:[e.jsx("strong",{children:"Monthly Rate:"})," $",s.pricing.monthlyCompensation]}),s.leaseStyles.rentalType==="Weekly"&&e.jsxs("p",{children:[e.jsx("strong",{children:"Weekly Rate:"})," $",s.pricing.weeklyCompensation]}),s.leaseStyles.rentalType==="Nightly"&&s.pricing.nightlyPricing&&e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"1-Night Price:"})," $",s.pricing.nightlyPricing.oneNightPrice]}),e.jsxs("p",{children:[e.jsx("strong",{children:"5-Night Total:"})," $",s.pricing.nightlyPricing.fiveNightTotal]})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Damage Deposit:"})," $",s.pricing.damageDeposit]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Monthly Maintenance Fee:"})," $",s.pricing.maintenanceFee,"/month"]}),e.jsx("button",{type:"button",className:"btn-link",onClick:()=>u==null?void 0:u(4),children:"Edit Section"})]})]}),e.jsxs("div",{className:`summary-card collapsible ${p.rules?"expanded":""}`,children:[e.jsxs("div",{className:"summary-card-header",onClick:()=>S("rules"),children:[e.jsx("h3",{children:"ðŸ“‹ Rules"}),e.jsxs("div",{className:"summary-card-header-right",children:[e.jsxs("span",{className:"summary-brief",children:[s.rules.houseRules.length," rules, ",s.rules.cancellationPolicy]}),e.jsx("span",{className:"expand-icon",children:p.rules?"â–¼":"â–¶"})]})]}),p.rules&&e.jsxs("div",{className:"summary-content",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Cancellation:"})," ",s.rules.cancellationPolicy]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Check-in:"})," ",s.rules.checkInTime]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Check-out:"})," ",s.rules.checkOutTime]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Max Guests:"})," ",s.rules.numberOfGuests]}),e.jsxs("p",{children:[e.jsx("strong",{children:"House Rules:"})," ",s.rules.houseRules.length," selected"]}),e.jsx("button",{type:"button",className:"btn-link",onClick:()=>u==null?void 0:u(5),children:"Edit Section"})]})]}),e.jsxs("div",{className:`summary-card collapsible ${p.photos?"expanded":""}`,children:[e.jsxs("div",{className:"summary-card-header",onClick:()=>S("photos"),children:[e.jsx("h3",{children:"ðŸ“· Photos"}),e.jsxs("div",{className:"summary-card-header-right",children:[e.jsxs("span",{className:"summary-brief",children:[s.photos.photos.length," photos uploaded"]}),e.jsx("span",{className:"expand-icon",children:p.photos?"â–¼":"â–¶"})]})]}),p.photos&&e.jsxs("div",{className:"summary-content",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Total Photos:"})," ",s.photos.photos.length]}),e.jsx("div",{className:"photo-preview-grid",children:s.photos.photos.slice(0,4).map(b=>e.jsx("img",{src:b.url,alt:"Property preview",className:"photo-preview-thumb"},b.id))}),s.photos.photos.length>4&&e.jsxs("p",{children:["+",s.photos.photos.length-4," more photos"]}),e.jsx("button",{type:"button",className:"btn-link",onClick:()=>u==null?void 0:u(6),children:"Edit Section"})]})]})]}),e.jsxs("div",{className:"info-box",children:[e.jsx("h4",{children:"Before you submit:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Your listing will be reviewed by our team within 24-48 hours"}),e.jsx("li",{children:"You will receive an email notification once your listing is approved"}),e.jsx("li",{children:"You can edit your listing anytime after submission"}),e.jsx("li",{children:"Your contact information will remain private and secure"}),e.jsx("li",{children:"You will agree to Terms and Conditions during sign-up"})]})]}),e.jsxs("div",{className:"review-fixed-navigation",children:[e.jsx("button",{type:"button",className:"btn-back",onClick:d,disabled:m,children:"Back"}),e.jsx("button",{type:"button",className:"btn-submit",onClick:W,disabled:m,children:m?"Submitting...":"Submit Listing"})]}),m&&e.jsxs("div",{className:"submitting-overlay",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Submitting your listing..."})]})]})},Q={DRAFT:"selfListingDraft",STAGED:"selfListingStagedForSubmission",LAST_SAVED:"selfListingLastSaved",USER_ID:"selfListingUserId"};class as{constructor(){te(this,"state");te(this,"listeners");te(this,"autoSaveTimer");te(this,"AUTO_SAVE_DELAY",1e3);this.state={data:re,lastSaved:null,isDirty:!1,stagingStatus:"not_staged",errors:[]},this.listeners=new Set,this.autoSaveTimer=null}initialize(){var t;try{const n=localStorage.getItem(Q.DRAFT),h=localStorage.getItem(Q.LAST_SAVED);if(n){const u=JSON.parse(n);(t=u.rules)!=null&&t.blockedDates&&(u.rules.blockedDates=u.rules.blockedDates.map(m=>new Date(m))),this.state.data={...re,...u},this.state.lastSaved=h?new Date(h):null,console.log("ðŸ“‚ ListingLocalStore: Loaded draft from localStorage")}return localStorage.getItem(Q.STAGED)&&(this.state.stagingStatus="staged",console.log("ðŸ“¦ ListingLocalStore: Found staged data awaiting submission")),this.notifyListeners(),this.state}catch(n){return console.error("âŒ ListingLocalStore: Error initializing store:",n),this.state}}getState(){return{...this.state}}getData(){return{...this.state.data}}updateData(t){this.state.data={...this.state.data,...t,updatedAt:new Date},this.state.isDirty=!0,this.scheduleAutoSave(),this.notifyListeners()}updateSection(t,n){this.state.data={...this.state.data,[t]:n,updatedAt:new Date},this.state.isDirty=!0,this.scheduleAutoSave(),this.notifyListeners()}updateSpaceSnapshot(t){this.updateSection("spaceSnapshot",t)}updateFeatures(t){this.updateSection("features",t)}updateLeaseStyles(t){this.updateSection("leaseStyles",t)}updatePricing(t){this.updateSection("pricing",t)}updateRules(t){this.updateSection("rules",t)}updatePhotos(t){this.updateSection("photos",t)}updateReview(t){this.updateSection("review",t)}setCurrentSection(t){this.state.data.currentSection=t,this.scheduleAutoSave(),this.notifyListeners()}markSectionComplete(t){const n=new Set(this.state.data.completedSections);n.add(t),this.state.data.completedSections=Array.from(n).sort(),this.scheduleAutoSave(),this.notifyListeners()}scheduleAutoSave(){this.autoSaveTimer&&clearTimeout(this.autoSaveTimer),this.autoSaveTimer=setTimeout(()=>{this.saveDraft()},this.AUTO_SAVE_DELAY)}saveDraft(){try{const t={...this.state.data,rules:{...this.state.data.rules,blockedDates:this.state.data.rules.blockedDates.map(n=>n instanceof Date?n.toISOString():n)},photos:{...this.state.data.photos,photos:this.state.data.photos.photos.map(n=>({id:n.id,url:n.url,caption:n.caption,displayOrder:n.displayOrder,storagePath:n.storagePath}))}};return localStorage.setItem(Q.DRAFT,JSON.stringify(t)),localStorage.setItem(Q.LAST_SAVED,new Date().toISOString()),this.state.lastSaved=new Date,this.state.isDirty=!1,console.log("ðŸ’¾ ListingLocalStore: Draft saved to localStorage"),this.notifyListeners(),!0}catch(t){return console.error("âŒ ListingLocalStore: Error saving draft:",t),this.state.errors.push("Failed to save draft"),this.notifyListeners(),!1}}stageForSubmission(){const t=this.validateForSubmission();if(t.length>0)return this.state.errors=t,this.notifyListeners(),{success:!1,errors:t};try{const n={...this.state.data,stagedAt:new Date().toISOString(),rules:{...this.state.data.rules,blockedDates:this.state.data.rules.blockedDates.map(h=>h instanceof Date?h.toISOString():h)},photos:{...this.state.data.photos,photos:this.state.data.photos.photos.map(h=>({id:h.id,url:h.url,caption:h.caption,displayOrder:h.displayOrder,storagePath:h.storagePath}))}};localStorage.setItem(Q.STAGED,JSON.stringify(n)),console.log("ðŸ“¦ ListingLocalStore: Data staged for submission")}catch{console.warn("âš ï¸ ListingLocalStore: Could not stage to localStorage (quota exceeded), continuing with submission")}return this.state.stagingStatus="staged",this.state.errors=[],this.notifyListeners(),{success:!0,errors:[]}}getStagedData(){var t;try{const n=localStorage.getItem(Q.STAGED);if(n){const h=JSON.parse(n);return(t=h.rules)!=null&&t.blockedDates&&(h.rules.blockedDates=h.rules.blockedDates.map(d=>new Date(d))),h}return null}catch(n){return console.error("âŒ ListingLocalStore: Error getting staged data:",n),null}}markSubmitting(){this.state.stagingStatus="submitting",this.notifyListeners()}markSubmitted(){this.state.stagingStatus="submitted",this.state.data.isSubmitted=!0,this.state.data.isDraft=!1,localStorage.removeItem(Q.DRAFT),localStorage.removeItem(Q.STAGED),localStorage.removeItem(Q.LAST_SAVED),console.log("âœ… ListingLocalStore: Submission successful, local data cleared"),this.notifyListeners()}markSubmissionFailed(t){this.state.stagingStatus="failed",this.state.errors.push(t),console.error("âŒ ListingLocalStore: Submission failed:",t),this.notifyListeners()}clearStagingError(){this.state.stagingStatus="staged",this.state.errors=[],this.notifyListeners()}validateForSubmission(){var h;const t=[],n=this.state.data;if(n.spaceSnapshot.listingName||t.push("Listing name is required"),n.spaceSnapshot.typeOfSpace||t.push("Type of space is required"),n.spaceSnapshot.typeOfKitchen||t.push("Type of kitchen is required"),n.spaceSnapshot.typeOfParking||t.push("Type of parking is required"),(!n.spaceSnapshot.address.fullAddress||!n.spaceSnapshot.address.validated)&&t.push("Valid NYC address is required"),n.features.amenitiesInsideUnit.length===0&&t.push("At least one amenity inside unit is required"),n.features.descriptionOfLodging||t.push("Description of lodging is required"),n.leaseStyles.rentalType||t.push("Rental type is required"),n.leaseStyles.rentalType==="Nightly"){const d=n.leaseStyles.availableNights;(!d||!Object.values(d).some(u=>u))&&t.push("At least one available night must be selected")}return n.leaseStyles.rentalType==="Weekly"&&!n.leaseStyles.weeklyPattern&&t.push("Weekly pattern is required"),n.pricing.damageDeposit<500&&t.push("Damage deposit must be at least $500"),n.leaseStyles.rentalType==="Monthly"&&!n.pricing.monthlyCompensation&&t.push("Monthly compensation is required"),n.leaseStyles.rentalType==="Weekly"&&!n.pricing.weeklyCompensation&&t.push("Weekly compensation is required"),n.leaseStyles.rentalType==="Nightly"&&!((h=n.pricing.nightlyPricing)!=null&&h.oneNightPrice)&&t.push("Nightly pricing is required"),n.rules.cancellationPolicy||t.push("Cancellation policy is required"),n.rules.checkInTime||t.push("Check-in time is required"),n.rules.checkOutTime||t.push("Check-out time is required"),n.photos.photos.length<n.photos.minRequired&&t.push(`At least ${n.photos.minRequired} photos are required`),t}reset(){this.state={data:re,lastSaved:null,isDirty:!1,stagingStatus:"not_staged",errors:[]},localStorage.removeItem(Q.DRAFT),localStorage.removeItem(Q.STAGED),localStorage.removeItem(Q.LAST_SAVED),console.log("ðŸ”„ ListingLocalStore: Store reset to default state"),this.notifyListeners()}subscribe(t){return this.listeners.add(t),()=>{this.listeners.delete(t)}}notifyListeners(){this.listeners.forEach(t=>{t(this.getState())})}getDebugSummary(){var t;return{hasData:!!this.state.data,listingName:this.state.data.spaceSnapshot.listingName||"(empty)",completedSections:this.state.data.completedSections,currentSection:this.state.data.currentSection,photosCount:this.state.data.photos.photos.length,stagingStatus:this.state.stagingStatus,lastSaved:((t=this.state.lastSaved)==null?void 0:t.toISOString())||"never",isDirty:this.state.isDirty,errorsCount:this.state.errors.length}}}const q=new as;function rs(){const[s,t]=r.useState(()=>q.getState());r.useEffect(()=>{const v=q.initialize();return t(v),q.subscribe(J=>{t(J)})},[]);const n=r.useCallback(v=>{q.updateData(v)},[]),h=r.useCallback(v=>{q.updateSpaceSnapshot(v)},[]),d=r.useCallback(v=>{q.updateFeatures(v)},[]),u=r.useCallback(v=>{q.updateLeaseStyles(v)},[]),m=r.useCallback(v=>{q.updatePricing(v)},[]),A=r.useCallback(v=>{q.updateRules(v)},[]),k=r.useCallback(v=>{q.updatePhotos(v)},[]),p=r.useCallback(v=>{q.updateReview(v)},[]),P=r.useCallback(v=>{q.setCurrentSection(v)},[]),R=r.useCallback(v=>{q.markSectionComplete(v)},[]),L=r.useCallback(()=>q.saveDraft(),[]),o=r.useCallback(()=>q.stageForSubmission(),[]),S=r.useCallback(()=>q.getStagedData(),[]),j=r.useCallback(()=>{q.markSubmitting()},[]),U=r.useCallback(()=>{q.markSubmitted()},[]),W=r.useCallback(v=>{q.markSubmissionFailed(v)},[]),b=r.useCallback(()=>{q.clearStagingError()},[]),l=r.useCallback(()=>{q.reset()},[]),N=r.useCallback(()=>q.validateForSubmission(),[]),$=r.useCallback(()=>q.getDebugSummary(),[]);return{formData:s.data,lastSaved:s.lastSaved,isDirty:s.isDirty,stagingStatus:s.stagingStatus,errors:s.errors,updateFormData:n,updateSpaceSnapshot:h,updateFeatures:d,updateLeaseStyles:u,updatePricing:m,updateRules:A,updatePhotos:k,updateReview:p,setCurrentSection:P,markSectionComplete:R,saveDraft:L,stageForSubmission:o,getStagedData:S,markSubmitting:j,markSubmitted:U,markSubmissionFailed:W,clearStagingError:b,reset:l,validate:N,getDebugSummary:$}}async function os(s){if(console.log("[Bubble API] Fetching listing via Edge Function"),console.log("[Bubble API] Listing ID:",s),!(s!=null&&s.trim()))throw new Error("Listing ID is required");try{const{data:t,error:n}=await X.functions.invoke("bubble-proxy",{body:{action:"get_listing",payload:{listing_id:s.trim()}}});if(n)throw console.error("[Bubble API] Edge Function error:",n),new Error(n.message||"Failed to fetch listing");if(!t.success)throw new Error(t.error||"Unknown error");return console.log("[Bubble API] âœ… Listing fetched:",t.data),t.data}catch(t){throw console.error("[Bubble API] Failed to fetch listing:",t),t}}const V={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e4},modal:{backgroundColor:"white",borderRadius:"16px",padding:"2.5rem",maxWidth:"480px",width:"90%",textAlign:"center",boxShadow:"0 25px 50px -12px rgba(0, 0, 0, 0.25)"},iconWrapper:{width:"80px",height:"80px",backgroundColor:"#10B981",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1.5rem"},icon:{fontSize:"40px",color:"white"},title:{fontSize:"1.5rem",fontWeight:"700",color:"#1a202c",margin:"0 0 0.75rem"},subtitle:{fontSize:"1rem",color:"#6b7280",margin:"0 0 1.5rem",lineHeight:"1.5"},listingName:{fontWeight:"600",color:"#5B21B6"},button:{display:"inline-block",padding:"0.875rem 2rem",backgroundColor:"#5B21B6",color:"white",border:"none",borderRadius:"8px",fontSize:"1rem",fontWeight:"600",cursor:"pointer",textDecoration:"none",transition:"background-color 0.15s ease"},secondaryText:{fontSize:"0.875rem",color:"#9ca3af",marginTop:"1rem"},loadingIconWrapper:{width:"80px",height:"80px",backgroundColor:"#5B21B6",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 1.5rem"},spinner:{width:"40px",height:"40px",border:"4px solid rgba(255, 255, 255, 0.3)",borderTop:"4px solid white",borderRadius:"50%",animation:"spin 1s linear infinite"},loadingTitle:{fontSize:"1.5rem",fontWeight:"700",color:"#1a202c",margin:"0 0 0.75rem"},loadingSubtitle:{fontSize:"1rem",color:"#6b7280",margin:"0 0 1.5rem",lineHeight:"1.5"}},ls=({isOpen:s,listingId:t,listingName:n,isLoading:h=!1})=>{if(!s)return null;const d=()=>{window.location.href=`/listing-dashboard.html?listing_id=${t}`},u=()=>{window.location.href=`/preview-split-lease?listing_id=${t}`};return h?e.jsxs("div",{style:V.overlay,children:[e.jsx("style",{children:`
            @keyframes spin {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
            }
          `}),e.jsxs("div",{style:V.modal,children:[e.jsx("div",{style:V.loadingIconWrapper,children:e.jsx("div",{style:V.spinner})}),e.jsx("h2",{style:V.loadingTitle,children:"Creating Your Listing..."}),e.jsxs("p",{style:V.loadingSubtitle,children:["Please wait while we set up ",e.jsxs("span",{style:V.listingName,children:['"',n,'"']}),". This may take a moment."]})]})]}):e.jsx("div",{style:V.overlay,children:e.jsxs("div",{style:V.modal,children:[e.jsx("div",{style:V.iconWrapper,children:e.jsx("span",{style:V.icon,children:"âœ“"})}),e.jsx("h2",{style:V.title,children:"Listing Created Successfully!"}),e.jsxs("p",{style:V.subtitle,children:["Your listing ",e.jsxs("span",{style:V.listingName,children:['"',n,'"']})," has been submitted and is now pending review."]}),e.jsx("button",{style:V.button,onClick:d,onMouseEnter:m=>m.currentTarget.style.backgroundColor="#4C1D95",onMouseLeave:m=>m.currentTarget.style.backgroundColor="#5B21B6",children:"Go to My Dashboard"}),e.jsx("button",{style:{...V.button,backgroundColor:"transparent",color:"#5B21B6",border:"2px solid #5B21B6",marginTop:"0.75rem"},onClick:u,onMouseEnter:m=>{m.currentTarget.style.backgroundColor="#F5F3FF"},onMouseLeave:m=>{m.currentTarget.style.backgroundColor="transparent"},children:"Preview Listing"}),e.jsx("p",{style:V.secondaryText,children:"You'll be notified once your listing is approved."})]})})},cs=()=>{console.log("ðŸ  SelfListingPage: Component mounting");const{formData:s,lastSaved:t,isDirty:n,stagingStatus:h,updateSpaceSnapshot:d,updateFeatures:u,updateLeaseStyles:m,updatePricing:A,updateRules:k,updatePhotos:p,updateReview:P,setCurrentSection:R,markSectionComplete:L,saveDraft:o,stageForSubmission:S,markSubmitting:j,markSubmitted:U,markSubmissionFailed:W,getDebugSummary:b}=rs(),[l,N]=r.useState(s.currentSection||1),[$,v]=r.useState(!1),[_,J]=r.useState(!1),[F,w]=r.useState(null),[y,C]=r.useState(!1),[a,g]=r.useState(!1),[c,T]=r.useState(!0),[O,i]=r.useState(!1),[x,I]=r.useState(""),{toasts:M,showToast:D,removeToast:E}=Me(),[B,K]=r.useState(0);r.useEffect(()=>{(async()=>{if(console.log("ðŸ” SelfListingPage: Checking access control..."),!await de()){console.log("âœ… SelfListingPage: User is logged out - access allowed"),T(!1);return}const G=await Re({clearOnFailure:!1}),Z=G==null?void 0:G.userType;if(console.log("ðŸ” SelfListingPage: User type:",Z),Be({userType:Z})){console.log("âŒ SelfListingPage: Guest user detected - redirecting to index"),window.location.href="/";return}console.log("âœ… SelfListingPage: Host user - access allowed"),T(!1)})()},[]),r.useEffect(()=>{s.currentSection&&s.currentSection!==l&&N(s.currentSection)},[s.currentSection]),r.useEffect(()=>{(async()=>{const G=new URLSearchParams(window.location.search).get("listing_id");if(console.log("ðŸ  SelfListingPage: Listing ID from URL:",G),G){J(!0);try{console.log("ðŸ“¡ Fetching listing data from Bubble API...");const Z=await os(G);if(console.log("âœ… Listing data fetched from Bubble:",Z),Z!=null&&Z.Name){console.log("âœ… Preloading listing name:",Z.Name);const ae=q.getData();d({...ae.spaceSnapshot,listingName:Z.Name})}else console.warn("âš ï¸ No listing name found in fetched data")}catch(Z){console.error("âŒ Error fetching listing from Bubble:",Z)}finally{J(!1),console.log("âœ… Loading complete")}}else{console.log("ðŸ“‚ No listing ID in URL, checking for pending listing name");const Z=localStorage.getItem("pendingListingName");if(Z){console.log("ðŸ“ Found pending listing name:",Z);const ae=q.getData();d({...ae.spaceSnapshot,listingName:Z}),localStorage.removeItem("pendingListingName"),console.log("âœ… Pending listing name applied and cleaned up")}else console.log("ðŸ“‚ No pending listing name, using stored draft data")}})()},[]),r.useEffect(()=>{console.log("ðŸ“Š Store Debug Summary:",b())},[s,b]);const ne=f=>{var Y;switch(f){case 1:return!!(s.spaceSnapshot.listingName&&s.spaceSnapshot.typeOfSpace&&s.spaceSnapshot.typeOfKitchen&&s.spaceSnapshot.typeOfParking&&s.spaceSnapshot.address.fullAddress&&s.spaceSnapshot.address.validated);case 2:return!!(s.features.amenitiesInsideUnit.length>0&&s.features.descriptionOfLodging);case 3:return!!(s.leaseStyles.rentalType&&(s.leaseStyles.rentalType!=="Nightly"||s.leaseStyles.availableNights&&Object.values(s.leaseStyles.availableNights).some(G=>G))&&(s.leaseStyles.rentalType!=="Weekly"||s.leaseStyles.weeklyPattern));case 4:return!!(s.leaseStyles.rentalType==="Monthly"&&s.pricing.monthlyCompensation||s.leaseStyles.rentalType==="Weekly"&&s.pricing.weeklyCompensation||s.leaseStyles.rentalType==="Nightly"&&((Y=s.pricing.nightlyPricing)!=null&&Y.oneNightPrice));case 5:return!!(s.rules.cancellationPolicy&&s.rules.checkInTime&&s.rules.checkOutTime);case 6:return s.photos.photos.length>=s.photos.minRequired;case 7:return!0;default:return!1}},ee=f=>{if(f===1)return!1;const Y=f-1;return!s.completedSections.includes(Y)},H=r.useCallback(f=>{ee(f)||(N(f),R(f),window.scrollTo({top:0,behavior:"smooth"}))},[ee,R]),z=r.useCallback(()=>{if(l<7){if(ne(l))L(l);else{D({title:"Incomplete Section",content:`Please complete all required fields in Section ${l} before proceeding.`,type:"warning",duration:6e3});return}const f=l+1;N(f),R(f),window.scrollTo({top:0,behavior:"smooth"})}},[l,ne,L,R]),se=r.useCallback(()=>{l>1&&H(l-1)},[l,H]),ye=r.useCallback(()=>{const f=o();alert(f?"Draft saved successfully!":"Failed to save draft. Please try again.")},[o]),fe=f=>{console.log("[SelfListingPage] Auth success callback triggered",f),C(!1);const Y=(f==null?void 0:f.isNewUser)!==!1;D(Y?"Account created successfully! Creating your listing...":"Logged in successfully! Creating your listing...","success",4e3),P({...s.review,agreedToTerms:!0}),setTimeout(()=>{K(G=>G+1)},100),a&&(g(!1),v(!0),i(!0),setTimeout(()=>{xe()},300))},xe=async()=>{j();try{const{success:f,errors:Y}=S();if(!f){console.error("âŒ Validation errors:",Y),i(!1),v(!1),alert(`Please fix the following errors:

${Y.join(`
`)}`);return}console.log("[SelfListingPage] Submitting listing after auth..."),console.log("[SelfListingPage] Form data:",s);const G=await ue(s);console.log("[SelfListingPage] âœ… Listing created:",G),U(),I(G._id)}catch(f){console.error("[SelfListingPage] âŒ Error submitting listing:",f),W(f instanceof Error?f.message:"Unknown error"),i(!1),alert(`Error submitting listing: ${f instanceof Error?f.message:"Unknown error"}. Please try again.`)}finally{v(!1)}},be=async()=>{v(!0),j();try{const{success:f,errors:Y}=S();if(!f){console.error("âŒ Validation errors:",Y),alert(`Please fix the following errors:

${Y.join(`
`)}`),v(!1);return}i(!0),console.log("[SelfListingPage] Submitting listing..."),console.log("[SelfListingPage] Form data:",s);const G=await ue(s);console.log("[SelfListingPage] âœ… Listing created:",G),U(),I(G._id)}catch(f){console.error("[SelfListingPage] âŒ Error submitting listing:",f),W(f instanceof Error?f.message:"Unknown error"),i(!1),alert(`Error submitting listing: ${f instanceof Error?f.message:"Unknown error"}. Please try again.`)}finally{v(!1)}},je=async()=>{console.log("[SelfListingPage] Submit clicked, checking auth status...");const f=await de();if(w(f),!f){console.log("[SelfListingPage] User not logged in, showing auth modal"),g(!0),C(!0);return}console.log("[SelfListingPage] User is logged in, proceeding with submission"),be()},Ne=[{number:1,title:"Address",icon:"ðŸ“"},{number:2,title:"Features",icon:"âœ¨"},{number:3,title:"Lease Styles",icon:"ðŸ“…"},{number:4,title:"Pricing",icon:"ðŸ’°"},{number:5,title:"Rules",icon:"ðŸ“‹"},{number:6,title:"Photos",icon:"ðŸ“·"},{number:7,title:"Review and Submit",icon:"âœ…"}],ve=f=>{const Y=s.completedSections.includes(f),G=f===l;return Y&&G?"completed active":Y?"completed":G?"active":ee(f)?"locked":"pending"};return console.log("ðŸŽ¨ SelfListingPage: Rendering component"),console.log("ðŸŽ¨ Current form data:",s),console.log("ðŸŽ¨ Listing name in form:",s.spaceSnapshot.listingName),c?e.jsxs(e.Fragment,{children:[e.jsx(ce,{}),e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"50vh"},children:e.jsx("p",{children:"Loading..."})})]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{toasts:M,onRemove:E}),console.log("ðŸŽ¨ Rendering Header component"),e.jsx(ce,{autoShowLogin:!1},B),e.jsxs("div",{className:"self-listing-page",children:[e.jsx("header",{className:"listing-header",children:e.jsxs("div",{className:"header-content",children:[e.jsx("h1",{children:"Create Your Listing"}),e.jsxs("div",{className:"header-actions",children:[e.jsx("button",{className:"btn-save-draft",onClick:ye,disabled:!n&&h!=="failed",children:n?"Save Draft":t?"Saved":"Save Draft"}),e.jsx("button",{className:"btn-help",children:"Need Help?"})]}),t&&e.jsxs("span",{className:"last-saved-indicator",children:["Last saved: ",t.toLocaleTimeString()]})]})}),e.jsxs("div",{className:"listing-container",children:[e.jsxs("aside",{className:"navigation-sidebar",children:[e.jsxs("div",{className:"progress-indicator",children:[e.jsxs("div",{className:"progress-circle",children:[e.jsxs("svg",{viewBox:"0 0 36 36",className:"circular-chart",children:[e.jsx("path",{className:"circle-bg",d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"}),e.jsx("path",{className:"circle",strokeDasharray:`${Math.min(l,6)/6*100}, 100`,d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"})]}),e.jsxs("div",{className:"progress-text",children:[Math.min(l,6),"/6"]})]}),e.jsx("p",{className:"progress-label",children:"Sections Complete"})]}),e.jsx("nav",{className:"section-nav",children:Ne.map(f=>{const Y=ve(f.number),G=Y==="locked";return e.jsxs("button",{className:`nav-item ${Y}`,onClick:()=>H(f.number),disabled:G,title:G?"Complete previous section to unlock":"",children:[e.jsx("div",{className:"nav-icon",children:f.icon}),e.jsxs("div",{className:"nav-content",children:[e.jsx("div",{className:"nav-number",children:f.number<=6?`Section ${f.number}`:"Final Step"}),e.jsx("div",{className:"nav-title",children:f.title})]}),s.completedSections.includes(f.number)&&e.jsx("div",{className:"nav-check",children:"âœ“"}),G&&e.jsx("div",{className:"nav-lock",children:"ðŸ”’"})]},f.number)})})]}),e.jsxs("main",{className:"main-content",children:[l===1&&e.jsx(Ue,{data:s.spaceSnapshot,onChange:d,onNext:z,isLoadingInitialData:_}),l===2&&e.jsx(He,{data:s.features,onChange:u,onNext:z,onBack:se,zipCode:s.spaceSnapshot.address.zip,showToast:D}),l===3&&e.jsx(Ke,{data:s.leaseStyles,onChange:m,onNext:z,onBack:se}),l===4&&e.jsx(Je,{data:s.pricing,rentalType:s.leaseStyles.rentalType,onChange:A,onNext:z,onBack:se}),l===5&&e.jsx(Xe,{data:s.rules,rentalType:s.leaseStyles.rentalType,onChange:k,onNext:z,onBack:se,showToast:D}),l===6&&e.jsx(ts,{data:s.photos,onChange:p,onNext:z,onBack:se}),l===7&&e.jsx(is,{formData:s,reviewData:s.review,onChange:P,onSubmit:je,onBack:se,onNavigateToSection:H,isSubmitting:$})]})]})]}),e.jsx(Ee,{isOpen:y,onClose:()=>{C(!1),g(!1)},initialView:"signup",defaultUserType:"host",skipReload:!0,onAuthSuccess:fe}),e.jsx(ls,{isOpen:O,listingId:x,listingName:s.spaceSnapshot.listingName,isLoading:$&&!x})]})};function ds(){return e.jsx(cs,{})}we(document.getElementById("root")).render(e.jsx(Ce.StrictMode,{children:e.jsx(_e,{children:e.jsx(ds,{})})}));

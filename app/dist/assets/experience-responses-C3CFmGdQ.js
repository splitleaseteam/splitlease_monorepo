import{r as a,j as e,c as R,R as q}from"./client-BJVKzfAi.js";import{u as A,a as F}from"./Toast-BQk6Nzgd.js";import{s as T}from"./supabase-BoCLEw6R.js";import{A as x}from"./AdminHeader-tCInZd3n.js";import{E as I}from"./ErrorBoundary-9_HbXv1y.js";/* empty css             */import"./config-QPKPRtag.js";import"./auth-QZ4BJadW.js";import"./star-OtPMgcH9.js";import"./createLucideIcon-CgZZH2OU.js";import"./file-text-Bqp_Hw0X.js";import"./triangle-alert-Bp6DQQmR.js";import"./users-d0RSvnp4.js";import"./pen-line-Duo49k9O.js";import"./calendar-CDI4qHEX.js";import"./mail-CRbL90NL.js";import"./user-check-CoCGzn5Y.js";import"./dollar-sign-Dn2-KjNW.js";import"./send-C4mziT0-.js";import"./x-CrJVeoCh.js";function D(s){return{id:s._id,name:s.Name||null,type:s.Type||null,date:s["Created Date"]||null,experience:s.Experience||null,challenge:s.Challenge||null,challengeExperience:s["Challenge Experience"]||null,change:s.Change||null,service:s.Service||null,additionalService:s["Additional Service"]||null,share:s.Share===!0||s.Share==="Yes",recommend:s.Recommend??null,staff:s["Split Lease Staff"]||null,questions:s.Questions||null}}function H(){const{showToast:s}=A(),[n,l]=a.useState("checking"),[r,c]=a.useState([]),[h,g]=a.useState(!0),[v,N]=a.useState(null),[o,y]=a.useState({name:"",types:["Guest","Host"]}),[m,p]=a.useState(null);a.useEffect(()=>{l("authorized")},[]);const j=a.useCallback(async()=>{g(!0),N(null);try{const{data:t,error:i}=await T.from("experiencesurvey").select(`
          "_id",
          "Name",
          "Type",
          "Created Date",
          "Experience",
          "Challenge",
          "Challenge Experience",
          "Change",
          "Service",
          "Additional Service",
          "Share",
          "Recommend",
          "Split Lease Staff",
          "Questions"
        `).order("Created Date",{ascending:!1});if(i)throw i;const d=(t||[]).map(D);c(d),d.length>0&&!m&&p(d[0].id)}catch(t){console.error("[ExperienceResponses] Fetch error:",t),N(t.message||"Failed to load responses"),s({title:"Failed to load responses",type:"error"})}finally{g(!1)}},[m]);a.useEffect(()=>{n==="authorized"&&j()},[n,j]);const k=a.useMemo(()=>{const t=o.name.trim()!=="",i=o.types.length<2;return t||i},[o]),u=a.useMemo(()=>r.filter(t=>{const i=o.name===""||t.name&&t.name.toLowerCase().includes(o.name.toLowerCase()),d=o.types.length===0||o.types.includes(t.type);return i&&d}),[r,o]);a.useEffect(()=>{u.length>0?u.some(i=>i.id===m)||p(u[0].id):p(null)},[u,m]);const S=a.useCallback(t=>{y(i=>({...i,name:t}))},[]),b=a.useCallback(t=>{y(i=>{const d=i.types.includes(t)?i.types.filter(E=>E!==t):[...i.types,t];return{...i,types:d}})},[]),C=a.useCallback(()=>{y({name:"",types:["Guest","Host"]})},[]),w=a.useCallback(t=>{p(t)},[]),L=a.useCallback(()=>{j()},[j]);return{authState:n,responses:r,filteredResponses:u,isLoading:h,error:v,selectedId:m,handleSelectResponse:w,filters:o,hasActiveFilters:k,handleSearchChange:S,handleTypeToggle:b,handleClearFilters:C,handleRetry:L}}function W({searchTerm:s,selectedTypes:n,onSearchChange:l,onTypeToggle:r}){return e.jsxs("div",{className:"er-filter-bar",children:[e.jsxs("div",{className:"er-search-container",children:[e.jsx("input",{type:"text",className:"er-search-input",placeholder:"Search by name...",value:s,onChange:c=>l(c.target.value),"aria-label":"Search responses by name"}),e.jsx("span",{className:"er-search-icon",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})})]}),e.jsxs("div",{className:"er-type-filters",children:[e.jsxs("label",{className:"er-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:n.includes("Guest"),onChange:()=>r("Guest")}),e.jsx("span",{className:"er-checkbox-text",children:"Guest"})]}),e.jsxs("label",{className:"er-checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:n.includes("Host"),onChange:()=>r("Host")}),e.jsx("span",{className:"er-checkbox-text",children:"Host"})]})]})]})}function B({response:s,isSelected:n,onSelect:l}){var c;const r=h=>{if(!h)return"Unknown date";try{return new Date(h).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return"Invalid date"}};return e.jsxs("button",{type:"button",className:`er-list-item ${n?"er-list-item--selected":""}`,onClick:l,"aria-pressed":n,children:[e.jsxs("div",{className:"er-list-item-header",children:[e.jsx("span",{className:"er-list-item-name",children:s.name||"Anonymous"}),e.jsx("span",{className:`er-list-item-type er-list-item-type--${((c=s.type)==null?void 0:c.toLowerCase())||"unknown"}`,children:s.type||"Unknown"})]}),e.jsx("div",{className:"er-list-item-date",children:r(s.date)})]})}function U({responses:s,selectedId:n,onSelect:l}){return e.jsx("div",{className:"er-response-list",children:s.map(r=>e.jsx(B,{response:r,isSelected:r.id===n,onSelect:()=>l(r.id)},r.id))})}function z({response:s}){var r;if(!s)return e.jsx("div",{className:"er-detail er-detail--empty",children:e.jsxs("div",{className:"er-detail-placeholder",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e.jsx("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e.jsx("polyline",{points:"10 9 9 9 8 9"})]}),e.jsx("p",{children:"Select a response to view details"})]})});const n=c=>{if(!c)return"Unknown date";try{return new Date(c).toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}catch{return"Invalid date"}},l=[{question:"How was your overall experience?",key:"experience"},{question:"What challenges did you face before using Split Lease?",key:"challenge"},{question:"How did those challenges make you feel?",key:"challengeExperience"},{question:"What has changed since using Split Lease?",key:"change"},{question:"What was most memorable about our service?",key:"service"},{question:"What additional services would you like to see?",key:"additionalService"}];return e.jsxs("div",{className:"er-detail",children:[e.jsxs("div",{className:"er-detail-header",children:[e.jsxs("div",{className:"er-detail-identity",children:[e.jsx("h2",{className:"er-detail-name",children:s.name||"Anonymous"}),e.jsx("span",{className:`er-detail-type er-detail-type--${((r=s.type)==null?void 0:r.toLowerCase())||"unknown"}`,children:s.type||"Unknown"})]}),e.jsx("div",{className:"er-detail-date",children:n(s.date)})]}),e.jsxs("div",{className:"er-detail-content",children:[l.map((c,h)=>e.jsxs("div",{className:"er-detail-section",children:[e.jsx("h3",{className:"er-detail-question",children:c.question}),e.jsx("p",{className:"er-detail-answer",children:s[c.key]||e.jsx("em",{className:"er-no-response",children:"No response"})})]},h)),e.jsxs("div",{className:"er-detail-section er-detail-section--inline",children:[e.jsx("h3",{className:"er-detail-question",children:"Permission to share publicly?"}),e.jsx("span",{className:`er-detail-badge ${s.share?"er-detail-badge--yes":"er-detail-badge--no"}`,children:s.share?"Yes":"No"})]}),e.jsxs("div",{className:"er-detail-section er-detail-section--inline",children:[e.jsx("h3",{className:"er-detail-question",children:"Would you recommend Split Lease?"}),e.jsxs("div",{className:"er-detail-nps",children:[e.jsx("span",{className:"er-nps-score",children:s.recommend??"â€”"}),e.jsx("span",{className:"er-nps-label",children:"/ 10"})]})]}),e.jsxs("div",{className:"er-detail-section",children:[e.jsx("h3",{className:"er-detail-question",children:"Any staff members you'd like to recognize?"}),e.jsx("p",{className:"er-detail-answer",children:s.staff||e.jsx("em",{className:"er-no-response",children:"No response"})})]}),e.jsxs("div",{className:"er-detail-section",children:[e.jsx("h3",{className:"er-detail-question",children:"Any questions for us?"}),e.jsx("p",{className:"er-detail-answer",children:s.questions||e.jsx("em",{className:"er-no-response",children:"No response"})})]})]})]})}function f({message:s="Loading..."}){return e.jsxs("div",{className:"er-loading-state",children:[e.jsx("div",{className:"er-spinner"}),e.jsx("p",{className:"er-loading-message",children:s})]})}function G({message:s,hasFilters:n,onClearFilters:l}){return e.jsxs("div",{className:"er-empty-state",children:[e.jsx("div",{className:"er-empty-icon",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),e.jsx("line",{x1:"8",y1:"11",x2:"14",y2:"11"})]})}),e.jsx("p",{className:"er-empty-message",children:s}),n&&l&&e.jsx("button",{className:"er-btn er-btn-secondary",onClick:l,children:"Clear Filters"})]})}function M(){const s=H();if(s.authState==="checking")return e.jsxs("div",{className:"er-page",children:[e.jsx(x,{}),e.jsx(f,{message:"Checking authentication..."})]});if(s.authState==="unauthorized")return e.jsxs("div",{className:"er-page",children:[e.jsx(x,{}),e.jsxs("div",{className:"er-error-state",children:[e.jsx("h2",{children:"Access Denied"}),e.jsx("p",{children:"You do not have permission to access this page."})]})]});if(s.isLoading&&s.responses.length===0)return e.jsxs("div",{className:"er-page",children:[e.jsx(x,{}),e.jsx("header",{className:"er-header",children:e.jsx("h1",{className:"er-title",children:"Experience Responses"})}),e.jsx(f,{message:"Loading responses..."})]});if(s.error&&s.responses.length===0)return e.jsxs("div",{className:"er-page",children:[e.jsx(x,{}),e.jsx("header",{className:"er-header",children:e.jsx("h1",{className:"er-title",children:"Experience Responses"})}),e.jsxs("div",{className:"er-error-state",children:[e.jsx("h2",{children:"Error Loading Responses"}),e.jsx("p",{children:s.error}),e.jsx("button",{className:"er-btn er-btn-primary",onClick:s.handleRetry,children:"Try Again"})]})]});const n=s.filteredResponses.find(l=>l.id===s.selectedId);return e.jsxs("div",{className:"er-page",children:[e.jsx(x,{}),e.jsxs("header",{className:"er-header",children:[e.jsx("h1",{className:"er-title",children:"Experience Responses"}),e.jsxs("span",{className:"er-counter",children:[s.filteredResponses.length," response",s.filteredResponses.length!==1?"s":""]})]}),e.jsx(W,{searchTerm:s.filters.name,selectedTypes:s.filters.types,onSearchChange:s.handleSearchChange,onTypeToggle:s.handleTypeToggle}),e.jsx("main",{className:"er-main",children:s.filteredResponses.length===0?e.jsx(G,{message:s.hasActiveFilters?"No responses match your filters.":"No survey responses yet.",hasFilters:s.hasActiveFilters,onClearFilters:s.handleClearFilters}):e.jsxs("div",{className:"er-content",children:[e.jsx(U,{responses:s.filteredResponses,selectedId:s.selectedId,onSelect:s.handleSelectResponse}),e.jsx(z,{response:n})]})}),s.isLoading&&s.responses.length>0&&e.jsx("div",{className:"er-loading-overlay",children:e.jsx("div",{className:"er-spinner"})})]})}R(document.getElementById("root")).render(e.jsx(q.StrictMode,{children:e.jsx(I,{children:e.jsx(F,{children:e.jsx(M,{})})})}));

/**
 * SuggestedProposalPopup Styles
 *
 * All classes prefixed with sp- to avoid conflicts.
 * Follows Split Lease Design System v1.0
 *
 * KEY RULES:
 * - NO GREEN, NO YELLOW (monochromatic purple palette)
 * - Minimum font size: 15px
 * - Touch targets: 48px minimum
 * - Buttons: pill-shaped (100px radius)
 * - Spacing: 8/16/24px scale only
 */

/* CSS Variables - Split Lease Design System */
:root {
  /* Purple Palette (monochromatic - NO GREEN/YELLOW) */
  --sp-primary-purple: var(--primary-purple);
  --sp-action-purple: #5B5FCF;
  --sp-secondary-purple: #6D31C2;
  --sp-light-purple-bg: #F7F2FA;
  --sp-light-purple-tint: #f8f5ff;
  --sp-primary-contrast: #FFFFFF;

  /* Text Colors (WCAG AAA compliant) */
  --sp-text-primary: #111111;
  --sp-text-secondary: var(--text-description);
  --sp-text-muted: #4b5563;
  --sp-text-ghost: #49454F;

  /* UI Colors */
  --sp-bg-card: #FFFFFF;
  --sp-bg-panel: #F7F2FA;
  --sp-border-light: #E7E0EC;
  --sp-danger: #DC3545;

  /* Typography */
  --sp-font-primary: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  --sp-font-size-2xl: 36px;
  --sp-font-size-xl: 28px;
  --sp-font-size-lg: 22px;
  --sp-font-size-md: 18px;
  --sp-font-size-base: 17px;
  --sp-font-size-sm: 15px;
  --sp-font-size-label: 14px;
  --sp-line-height-tight: 1.3;
  --sp-line-height-normal: 1.6;
  --sp-line-height-relaxed: 1.8;

  /* Spacing (8/16/24 scale) */
  --sp-spacing-sm: 8px;
  --sp-spacing-md: 12px;
  --sp-spacing-lg: 16px;
  --sp-spacing-xl: 20px;
  --sp-spacing-2xl: 24px;

  /* Touch Targets */
  --sp-min-touch-target: 48px;

  /* Border Radius */
  --sp-radius-sm: 8px;
  --sp-radius-md: 12px;
  --sp-radius-lg: 24px;
  --sp-radius-pill: 100px;

  /* Focus States */
  --sp-focus-outline: 3px solid var(--sp-secondary-purple);
  --sp-focus-offset: 3px;

  /* Shadows */
  --sp-shadow-card: 0 8px 32px rgba(0, 0, 0, 0.15);

  /* Transitions */
  --sp-transition-fast: 150ms ease;
  --sp-transition-normal: 200ms ease;
}

/* ===== ACCESSIBILITY UTILITIES ===== */

/* Screen Reader Only - Hidden visually but accessible to screen readers */
.sp-sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* ===== ICON BASE STYLES (Feather Icons) ===== */

/* Base icon style - stroke only, never fill */
.sp-icon {
  stroke: var(--sp-primary-purple);
  stroke-width: 2;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

/* Icon sizes per design system */
.sp-icon--sm { width: 16px; height: 16px; }
.sp-icon--md { width: 20px; height: 20px; }
.sp-icon--lg { width: 24px; height: 24px; }

/* ===== MODAL STRUCTURE ===== */

/* Backdrop */
.sp-popup-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.5);
  z-index: 999;
  animation: sp-fadeIn 0.2s ease;
}

/* Overlay container */
.sp-popup-overlay {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 1000;
  max-width: 900px;
  width: calc(100% - 32px);
  max-height: calc(100vh - 48px);
  animation: sp-slideIn 0.25s ease;
}

/* Main card - Modal spec: 92vh max, 24px radius */
.sp-popup-card {
  background: var(--sp-bg-card);
  border-radius: var(--sp-radius-lg);
  box-shadow: var(--sp-shadow-card);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  max-height: 92vh;
}

/* Header */
.sp-popup-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--sp-spacing-lg) var(--sp-spacing-2xl);
  border-bottom: 1px solid var(--sp-border-light);
  background: var(--sp-bg-panel);
  flex-shrink: 0;
}

.sp-popup-header-left {
  display: flex;
  align-items: center;
  gap: var(--sp-spacing-lg);
}

.sp-popup-badge {
  background: var(--sp-primary-purple);
  color: var(--sp-primary-contrast);
  padding: var(--sp-spacing-sm) var(--sp-spacing-md);
  border-radius: var(--sp-radius-pill);
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-sm);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.sp-popup-counter {
  color: var(--sp-text-muted);
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-sm);
}

.sp-popup-header-right {
  display: flex;
  align-items: center;
  gap: var(--sp-spacing-sm);
}

.sp-popup-nav {
  display: flex;
  gap: var(--sp-spacing-sm);
}

/* Navigation buttons - 48px touch target */
.sp-popup-nav-btn {
  width: var(--sp-min-touch-target);
  height: var(--sp-min-touch-target);
  border: 2px solid var(--sp-border-light);
  border-radius: var(--rounded-full);
  background: var(--sp-bg-card);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all var(--sp-transition-fast);
}

.sp-popup-nav-btn:hover {
  background: var(--sp-light-purple-tint);
  border-color: var(--sp-primary-purple);
}

.sp-popup-nav-btn:focus-visible {
  outline: var(--sp-focus-outline);
  outline-offset: var(--sp-focus-offset);
}

.sp-popup-nav-btn svg {
  width: 20px;
  height: 20px;
  stroke: var(--sp-primary-purple);
  stroke-width: 2;
  fill: none;
}

.sp-nav-arrow {
  font-size: var(--sp-font-size-xl);
  font-weight: 300;
  color: var(--sp-primary-purple);
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
}

/* Close button - 48px touch target */
.sp-popup-close-btn {
  width: var(--sp-min-touch-target);
  height: var(--sp-min-touch-target);
  border: none;
  border-radius: var(--rounded-full);
  background: transparent;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-left: var(--sp-spacing-sm);
  transition: background var(--sp-transition-fast);
}

.sp-popup-close-btn:hover {
  background: rgba(220, 53, 69, 0.1);
}

.sp-popup-close-btn:focus-visible {
  outline: var(--sp-focus-outline);
  outline-offset: var(--sp-focus-offset);
}

/* Close icon - base styles (desktop) */
.sp-popup-close-icon {
  width: 32px;
  height: 32px;
  min-width: 32px;
  min-height: 32px;
  stroke: var(--sp-text-muted);
  stroke-width: 2.5;
  fill: none;
}

.sp-popup-close-btn:hover svg {
  stroke: var(--sp-danger);
}

/* Content area */
.sp-popup-content {
  display: grid;
  grid-template-columns: 55% 45%;
  overflow-y: auto;
  flex-grow: 1;
  -webkit-overflow-scrolling: touch;
}

/* Left column */
.sp-popup-left {
  padding: var(--sp-spacing-2xl);
  display: flex;
  flex-direction: column;
  gap: var(--sp-spacing-lg);
}

/* Right column */
.sp-popup-right {
  padding: var(--sp-spacing-2xl);
  background: var(--sp-bg-panel);
  border-left: 1px solid var(--sp-border-light);
  display: flex;
  flex-direction: column;
  gap: var(--sp-spacing-2xl);
}

/* Title & Address */
.sp-popup-title {
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-lg);
  font-weight: 700;
  color: var(--sp-text-primary);
  margin: 0;
  line-height: var(--sp-line-height-tight);
}

.sp-popup-address {
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-sm);
  color: var(--sp-text-secondary);
  margin: 0;
  line-height: var(--sp-line-height-normal);
}

/* Dates */
.sp-popup-dates {
  display: flex;
  align-items: center;
  gap: var(--sp-spacing-sm);
  flex-wrap: wrap;
}

.sp-popup-date-label {
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-sm);
  color: var(--sp-text-muted);
}

.sp-popup-date-value {
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-sm);
  font-weight: 500;
  color: var(--sp-text-primary);
}

.sp-popup-date-separator {
  color: var(--sp-border-light);
}

/* Gallery */
.sp-gallery {
  display: flex;
  flex-direction: column;
  gap: var(--sp-spacing-sm);
}

.sp-gallery-main {
  width: 100%;
  aspect-ratio: 16 / 10;
  border-radius: var(--sp-radius-md);
  overflow: hidden;
  background: var(--sp-bg-panel);
  border: 1px solid var(--sp-border-light);
}

.sp-gallery-main-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.sp-gallery-placeholder {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: var(--sp-text-muted);
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-sm);
}

.sp-gallery-thumbs {
  display: flex;
  gap: var(--sp-spacing-sm);
}

/* Thumbnail buttons - 48px touch target height */
.sp-gallery-thumb {
  width: 64px;
  height: var(--sp-min-touch-target);
  border-radius: var(--sp-radius-sm);
  overflow: hidden;
  border: 2px solid transparent;
  cursor: pointer;
  background: var(--sp-bg-panel);
  padding: 0;
  transition: border-color var(--sp-transition-fast);
}

.sp-gallery-thumb:focus-visible {
  outline: var(--sp-focus-outline);
  outline-offset: var(--sp-focus-offset);
}

.sp-gallery-thumb img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.sp-gallery-thumb:hover {
  border-color: var(--sp-secondary-purple);
}

.sp-gallery-thumb--active {
  border-color: var(--sp-primary-purple);
}

.sp-gallery-thumb--more {
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-sm);
  font-weight: 500;
  color: var(--sp-text-muted);
  cursor: default;
}

/* Amenities */
.sp-amenities {
  display: flex;
  flex-wrap: wrap;
  gap: var(--sp-spacing-lg);
}

.sp-amenity {
  display: flex;
  align-items: center;
  gap: var(--sp-spacing-sm);
}

.sp-amenity-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: var(--sp-font-size-md);
  height: var(--sp-font-size-md);
  color: var(--sp-primary-purple);
}

/* Feather icon SVG inside amenity icon container */
.sp-amenity-icon-svg {
  width: 100%;
  height: 100%;
  stroke: var(--sp-primary-purple);
  stroke-width: 2;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.sp-amenity-text {
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-sm);
  color: var(--sp-text-secondary);
}

/* Pricing */
.sp-pricing {
  background: var(--sp-light-purple-tint);
  border-radius: var(--sp-radius-md);
  border: 1px solid var(--sp-border-light);
  padding: var(--sp-spacing-lg);
  display: flex;
  flex-direction: column;
  gap: var(--sp-spacing-sm);
}

.sp-pricing-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.sp-pricing-label {
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-base);
  color: var(--sp-text-muted);
}

.sp-pricing-value {
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-base);
  font-weight: 500;
  color: var(--sp-text-primary);
}

.sp-pricing-row--total {
  padding-top: var(--sp-spacing-sm);
  border-top: 1px solid var(--sp-border-light);
}

.sp-pricing-value--total {
  font-size: var(--sp-font-size-lg);
  font-weight: 700;
  color: var(--sp-action-purple);
}

/* Action buttons */
.sp-actions {
  display: flex;
  gap: var(--sp-spacing-lg);
  margin-top: auto;
  padding-top: var(--sp-spacing-sm);
}

/* Base button - Design System compliant */
.sp-action-btn {
  flex: 1;
  min-height: var(--sp-min-touch-target);
  min-width: 120px;
  padding: var(--sp-spacing-lg) var(--sp-spacing-2xl);
  border-radius: var(--sp-radius-pill);
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-base);
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--sp-spacing-sm);
  transition: all var(--sp-transition-fast);
  border: 2px solid transparent;
}

.sp-action-btn:focus-visible {
  outline: var(--sp-focus-outline);
  outline-offset: var(--sp-focus-offset);
}

/* Primary button - solid purple */
.sp-action-btn--primary {
  background: var(--sp-primary-purple);
  color: var(--sp-primary-contrast);
  border-color: var(--sp-primary-purple);
}

.sp-action-btn--primary:hover:not(:disabled) {
  background: var(--sp-secondary-purple);
  border-color: var(--sp-secondary-purple);
}

/* Secondary button - ghost style per design system */
.sp-action-btn--secondary {
  background: transparent;
  color: var(--sp-text-ghost);
  border: 1px solid var(--sp-border-light);
}

.sp-action-btn--secondary:hover:not(:disabled) {
  border-color: var(--sp-danger);
  color: var(--sp-danger);
}

.sp-action-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.sp-action-icon {
  width: 20px;
  height: 20px;
}

.sp-action-spinner {
  width: 20px;
  height: 20px;
  border: 2px solid currentColor;
  border-top-color: transparent;
  border-radius: var(--rounded-full);
  animation: sp-spin 0.8s linear infinite;
}

/* Map section */
.sp-map-section {
  display: flex;
  flex-direction: column;
  gap: var(--sp-spacing-sm);
}

.sp-map-title {
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-base);
  font-weight: 600;
  color: var(--sp-text-primary);
  margin: 0;
}

.sp-map-container {
  position: relative;
  width: 100%;
  aspect-ratio: 2 / 1;
  border-radius: var(--sp-radius-md);
  overflow: hidden;
  background: var(--sp-bg-card);
  border: 1px solid var(--sp-border-light);
}

.sp-map-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.sp-map-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--sp-spacing-sm);
}

.sp-map-placeholder-icon {
  font-size: 32px;
  color: var(--sp-primary-purple);
}

.sp-map-placeholder-text {
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-sm);
  color: var(--sp-text-muted);
  text-align: center;
  padding: 0 var(--sp-spacing-lg);
}

.sp-map-address {
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-sm);
  color: var(--sp-text-muted);
  margin: 0;
  line-height: var(--sp-line-height-normal);
}

/* Carto map wrapper for fallback */
.sp-map-carto-wrapper {
  position: relative;
  width: 100%;
  height: 100%;
}

.sp-map-carto-wrapper .sp-map-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.sp-map-marker {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -100%);
  pointer-events: none;
  filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
}

/* Interactive map container */
.sp-map-interactive {
  width: 100%;
  height: 100%;
  border-radius: var(--sp-radius-md);
}

/* Loading state for map */
.sp-map-loading {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--sp-bg-panel);
}

.sp-map-spinner {
  width: 32px;
  height: 32px;
  border: 3px solid var(--sp-border-light);
  border-top-color: var(--sp-primary-purple);
  border-radius: var(--rounded-full);
  animation: sp-spin 0.8s linear infinite;
}

/* Why this proposal section - Info Banner style */
.sp-why-section {
  display: flex;
  flex-direction: column;
  gap: var(--sp-spacing-sm);
  background: var(--sp-light-purple-bg);
  border: 1px solid var(--sp-border-light);
  border-radius: var(--sp-radius-sm);
  padding: var(--sp-spacing-md);
}

.sp-why-title {
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-base);
  font-weight: 600;
  color: var(--sp-text-primary);
  margin: 0;
  display: flex;
  align-items: center;
  gap: var(--sp-spacing-sm);
}

.sp-why-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: var(--sp-font-size-md);
  height: var(--sp-font-size-md);
}

/* Feather icon SVG inside why icon container */
.sp-why-icon-svg {
  width: 100%;
  height: 100%;
  stroke: var(--sp-primary-purple);
  stroke-width: 2;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.sp-why-text {
  font-family: var(--sp-font-primary);
  font-size: var(--sp-font-size-sm);
  line-height: var(--sp-line-height-relaxed);
  color: var(--sp-text-secondary);
  margin: 0;
}

.sp-why-text--placeholder {
  font-style: italic;
  color: var(--sp-text-muted);
}

/* Animations */
@keyframes sp-fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes sp-slideIn {
  from {
    opacity: 0;
    transform: translate(-50%, -48%);
  }
  to {
    opacity: 1;
    transform: translate(-50%, -50%);
  }
}

@keyframes sp-slideUp {
  from {
    transform: translateY(100%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

@keyframes sp-spin {
  to {
    transform: rotate(360deg);
  }
}

/* Reduced Motion - Accessibility requirement */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  .sp-popup-backdrop,
  .sp-popup-overlay,
  .sp-popup-card {
    animation: none;
  }
}

/* High Contrast Mode - Accessibility requirement */
@media (prefers-contrast: high) {
  :root {
    --sp-border-light: #000000;
    --sp-text-muted: var(--text-description);
  }

  .sp-action-btn {
    border-width: 3px;
  }

  .sp-popup-card {
    border: 3px solid #000000;
  }
}

/* Mobile grab handle - shown only on mobile bottom sheets */
.sp-popup-grab-handle {
  display: none;
}

/* Mobile responsive - Bottom sheet on mobile */
@media (max-width: 480px) {
  .sp-popup-overlay {
    width: 100%;
    max-width: none;
    height: auto;
    max-height: 92vh;
    top: auto;
    bottom: 0;
    left: 0;
    transform: none;
    animation: sp-slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .sp-popup-card {
    border-radius: var(--sp-radius-lg) var(--sp-radius-lg) 0 0;
    max-height: 92vh;
  }

  /* Mobile grab handle - 36x4px per design system */
  .sp-popup-grab-handle {
    display: block;
    width: 36px;
    height: 4px;
    background: var(--sp-border-light);
    border-radius: 2px;
    margin: var(--sp-spacing-sm) auto;
    flex-shrink: 0;
  }

  .sp-popup-header {
    padding: var(--sp-spacing-md) var(--sp-spacing-lg);
  }

  /* Mobile modal title style */
  .sp-popup-badge {
    font-size: var(--sp-font-size-sm);
  }

  .sp-popup-content {
    grid-template-columns: 1fr;
    overflow-y: auto;
  }

  .sp-popup-left,
  .sp-popup-right {
    padding: var(--sp-spacing-lg);
  }

  .sp-popup-right {
    border-left: none;
    border-top: 1px solid var(--sp-border-light);
  }

  .sp-popup-title {
    font-size: var(--sp-font-size-md);
    font-weight: 400;
  }

  /* Stack action buttons vertically on mobile */
  .sp-actions {
    flex-direction: column;
  }

  .sp-action-btn {
    width: 100%;
  }

  /* Footer extra padding for safe area */
  .sp-popup-left {
    padding-bottom: var(--sp-spacing-xl);
  }

  /* Navigation icons slightly smaller on mobile */
  .sp-popup-nav-btn svg {
    width: 20px;
    height: 20px;
  }

  /* Close icon - larger on mobile for better tap target */
  .sp-popup-close-icon {
    width: 36px;
    height: 36px;
    stroke-width: 2.5;
  }
}

/* Tablet breakpoint */
@media (min-width: 481px) and (max-width: 768px) {
  /* Close icon - larger on tablet for better tap target */
  .sp-popup-close-icon {
    width: 36px;
    height: 36px;
    stroke-width: 2.5;
  }

  .sp-popup-overlay {
    width: calc(100% - 32px);
    max-width: 600px;
  }

  .sp-popup-content {
    grid-template-columns: 1fr;
  }

  .sp-popup-right {
    border-left: none;
    border-top: 1px solid var(--sp-border-light);
  }

  .sp-actions {
    flex-direction: row;
  }
}
